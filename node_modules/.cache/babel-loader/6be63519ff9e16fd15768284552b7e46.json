{"remainingRequest":"/Users/antonyching/Desktop/project/new-builder-demo/node_modules/babel-loader/lib/index.js!/Users/antonyching/Desktop/project/new-builder-demo/node_modules/@ckeditor/ckeditor5-ui/src/template.js","dependencies":[{"path":"/Users/antonyching/Desktop/project/new-builder-demo/node_modules/@ckeditor/ckeditor5-ui/src/template.js","mtime":499162500000},{"path":"/Users/antonyching/Desktop/project/new-builder-demo/node_modules/@ckeditor/ckeditor5-dev-webpack-plugin/lib/translatesourceloader.js","mtime":499162500000},{"path":"/Users/antonyching/Desktop/project/new-builder-demo/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/antonyching/Desktop/project/new-builder-demo/node_modules/babel-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:LyoqCiAqIEBsaWNlbnNlIENvcHlyaWdodCAoYykgMjAwMy0yMDE5LCBDS1NvdXJjZSAtIEZyZWRlcmljbyBLbmFiYmVuLiBBbGwgcmlnaHRzIHJlc2VydmVkLgogKiBGb3IgbGljZW5zaW5nLCBzZWUgTElDRU5TRS5tZCBvciBodHRwczovL2NrZWRpdG9yLmNvbS9sZWdhbC9ja2VkaXRvci1vc3MtbGljZW5zZQogKi8KCi8qKgogKiBAbW9kdWxlIHVpL3RlbXBsYXRlCiAqLwoKLyogZ2xvYmFsIGRvY3VtZW50ICovCmltcG9ydCBDS0VkaXRvckVycm9yIGZyb20gJ0Bja2VkaXRvci9ja2VkaXRvcjUtdXRpbHMvc3JjL2NrZWRpdG9yZXJyb3InOwppbXBvcnQgbWl4IGZyb20gJ0Bja2VkaXRvci9ja2VkaXRvcjUtdXRpbHMvc3JjL21peCc7CmltcG9ydCBFbWl0dGVyTWl4aW4gZnJvbSAnQGNrZWRpdG9yL2NrZWRpdG9yNS11dGlscy9zcmMvZW1pdHRlcm1peGluJzsKaW1wb3J0IFZpZXcgZnJvbSAnLi92aWV3JzsKaW1wb3J0IFZpZXdDb2xsZWN0aW9uIGZyb20gJy4vdmlld2NvbGxlY3Rpb24nOwppbXBvcnQgaXNOb2RlIGZyb20gJ0Bja2VkaXRvci9ja2VkaXRvcjUtdXRpbHMvc3JjL2RvbS9pc25vZGUnOwppbXBvcnQgeyBpc09iamVjdCwgY2xvbmVEZWVwV2l0aCB9IGZyb20gJ2xvZGFzaC1lcyc7CmNvbnN0IHhodG1sTnMgPSAnaHR0cDovL3d3dy53My5vcmcvMTk5OS94aHRtbCc7Ci8qKgogKiBBIGJhc2ljIFRlbXBsYXRlIGNsYXNzLiBJdCByZW5kZXJzIGEgRE9NIEhUTUwgZWxlbWVudCBvciB0ZXh0IGZyb20gYQogKiB7QGxpbmsgbW9kdWxlOnVpL3RlbXBsYXRlflRlbXBsYXRlRGVmaW5pdGlvbiBkZWZpbml0aW9ufSBhbmQgc3VwcG9ydHMgZWxlbWVudCBhdHRyaWJ1dGVzLCBjaGlsZHJlbiwKICogYmluZGluZ3MgdG8ge0BsaW5rIG1vZHVsZTp1dGlscy9vYnNlcnZhYmxlbWl4aW5+T2JzZXJ2YWJsZSBvYnNlcnZhYmxlc30gYW5kIERPTSBldmVudCBwcm9wYWdhdGlvbi4KICoKICogQSBzaW1wbGUgdGVtcGxhdGUgY2FuIGxvb2sgbGlrZSB0aGlzOgogKgogKgkJY29uc3QgYmluZCA9IFRlbXBsYXRlLmJpbmQoIG9ic2VydmFibGUsIGVtaXR0ZXIgKTsKICoKICoJCW5ldyBUZW1wbGF0ZSggewogKgkJCXRhZzogJ3AnLAogKgkJCWF0dHJpYnV0ZXM6IHsKICoJCQkJY2xhc3M6ICdmb28nLAogKgkJCQlzdHlsZTogewogKgkJCQkJYmFja2dyb3VuZENvbG9yOiAneWVsbG93JwogKgkJCQl9CiAqCQkJfSwKICoJCQlvbjogewogKgkJCQljbGljazogYmluZC50byggJ2NsaWNrZWQnICkKICoJCQl9LAogKgkJCWNoaWxkcmVuOiBbCiAqCQkJCSdBIHBhcmFncmFwaC4nCiAqCQkJXQogKgkJfSApLnJlbmRlcigpOwogKgogKiBhbmQgaXQgd2lsbCByZW5kZXIgdGhlIGZvbGxvd2luZyBIVE1MIGVsZW1lbnQ6CiAqCiAqCQk8cCBjbGFzcz0iZm9vIiBzdHlsZT0iYmFja2dyb3VuZC1jb2xvcjogeWVsbG93OyI+QSBwYXJhZ3JhcGguPC9wPgogKgogKiBBZGRpdGlvbmFsbHksIHRoZSBgb2JzZXJ2YWJsZWAgd2lsbCBhbHdheXMgZmlyZSBgY2xpY2tlZGAgdXBvbiBjbGlja2luZyBgPHA+YCBpbiB0aGUgRE9NLgogKgogKiBTZWUge0BsaW5rIG1vZHVsZTp1aS90ZW1wbGF0ZX5UZW1wbGF0ZURlZmluaXRpb259IHRvIGtub3cgbW9yZSBhYm91dCB0ZW1wbGF0ZXMgYW5kIGNvbXBsZXgKICogdGVtcGxhdGUgZGVmaW5pdGlvbnMuCiAqCiogQG1peGVzIG1vZHVsZTp1dGlscy9lbWl0dGVybWl4aW5+RW1pdHRlck1peGluCiAqLwoKZXhwb3J0IGRlZmF1bHQgY2xhc3MgVGVtcGxhdGUgewogIC8qKgogICAqIENyZWF0ZXMgYW4gaW5zdGFuY2Ugb2YgdGhlIHtAbGluayB+VGVtcGxhdGV9IGNsYXNzLgogICAqCiAgICogQHBhcmFtIHttb2R1bGU6dWkvdGVtcGxhdGV+VGVtcGxhdGVEZWZpbml0aW9ufSBkZWYgVGhlIGRlZmluaXRpb24gb2YgdGhlIHRlbXBsYXRlLgogICAqLwogIGNvbnN0cnVjdG9yKGRlZikgewogICAgT2JqZWN0LmFzc2lnbih0aGlzLCBub3JtYWxpemUoY2xvbmUoZGVmKSkpOwogICAgLyoqCiAgICAgKiBJbmRpY2F0ZXMgd2hldGhlciB0aGlzIHBhcnRpY3VsYXIgVGVtcGxhdGUgaW5zdGFuY2UgaGFzIGJlZW4KICAgICAqIHtAbGluayAjcmVuZGVyIHJlbmRlcmVkfS4KICAgICAqCiAgICAgKiBAcmVhZG9ubHkKICAgICAqIEBwcm90ZWN0ZWQKICAgICAqIEBtZW1iZXIge0Jvb2xlYW59CiAgICAgKi8KCiAgICB0aGlzLl9pc1JlbmRlcmVkID0gZmFsc2U7CiAgICAvKioKICAgICAqIFRoZSB0YWcgKGB0YWdOYW1lYCkgb2YgdGhpcyB0ZW1wbGF0ZSwgZS5nLiBgZGl2YC4gSXQgYWxzbyBpbmRpY2F0ZXMgdGhhdCB0aGUgdGVtcGxhdGUKICAgICAqIHJlbmRlcnMgdG8gYW4gSFRNTCBlbGVtZW50LgogICAgICoKICAgICAqIEBtZW1iZXIge1N0cmluZ30gI3RhZwogICAgICovCgogICAgLyoqCiAgICAgKiBUaGUgdGV4dCBvZiB0aGUgdGVtcGxhdGUuIEl0IGFsc28gaW5kaWNhdGVzIHRoYXQgdGhlIHRlbXBsYXRlIHJlbmRlcnMgdG8gYSBET00gdGV4dCBub2RlLgogICAgICoKICAgICAqIEBtZW1iZXIge0FycmF5LjxTdHJpbmd8bW9kdWxlOnVpL3RlbXBsYXRlflRlbXBsYXRlVmFsdWVTY2hlbWE+fSAjdGV4dAogICAgICovCgogICAgLyoqCiAgICAgKiBUaGUgYXR0cmlidXRlcyBvZiB0aGUgdGVtcGxhdGUsIGUuZy4gYHsgaWQ6IFsgJ2NrLWlkJyBdIH1gLCBjb3JyZXNwb25kaW5nIHdpdGgKICAgICAqIHRoZSBhdHRyaWJ1dGVzIG9mIGFuIEhUTUwgZWxlbWVudC4KICAgICAqCiAgICAgKiAqKk5vdGUqKjogVGhpcyBwcm9wZXJ0eSBvbmx5IG1ha2VzIHNlbnNlIHdoZW4ge0BsaW5rICN0YWd9IGlzIGRlZmluZWQuCiAgICAgKgogICAgICogQG1lbWJlciB7T2JqZWN0fSAjYXR0cmlidXRlcwogICAgICovCgogICAgLyoqCiAgICAgKiBUaGUgY2hpbGRyZW4gb2YgdGhlIHRlbXBsYXRlLiBUaGV5IGNhbiBiZSBlaXRoZXI6CiAgICAgKiAqIGluZGVwZW5kZW50IGluc3RhbmNlcyBvZiB7QGxpbmsgflRlbXBsYXRlfSAoc3Vi4oCTdGVtcGxhdGVzKSwKICAgICAqICogbmF0aXZlIERPTSBOb2Rlcy4KICAgICAqCiAgICAgKiAqKk5vdGUqKjogVGhpcyBwcm9wZXJ0eSBvbmx5IG1ha2VzIHNlbnNlIHdoZW4ge0BsaW5rICN0YWd9IGlzIGRlZmluZWQuCiAgICAgKgogICAgICogQG1lbWJlciB7QXJyYXkuPG1vZHVsZTp1aS90ZW1wbGF0ZX5UZW1wbGF0ZXxOb2RlPn0gI2NoaWxkcmVuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSBET00gZXZlbnQgbGlzdGVuZXJzIG9mIHRoZSB0ZW1wbGF0ZS4KICAgICAqCiAgICAgKiBAbWVtYmVyIHtPYmplY3R9ICNldmVudExpc3RlbmVycwogICAgICovCgogICAgLyoqCiAgICAgKiBUaGUgZGF0YSB1c2VkIGJ5IHRoZSB7QGxpbmsgI3JldmVydH0gbWV0aG9kIHRvIHJlc3RvcmUgYSBub2RlIHRvIGl0cyBvcmlnaW5hbCBzdGF0ZS4KICAgICAqCiAgICAgKiBTZWU6IHtAbGluayAjYXBwbHl9LgogICAgICoKICAgICAqIEByZWFkb25seQogICAgICogQHByb3RlY3RlZAogICAgICogQG1lbWJlciB7bW9kdWxlOnVpL3RlbXBsYXRlflJlbmRlckRhdGF9CiAgICAgKi8KCiAgICB0aGlzLl9yZXZlcnREYXRhID0gbnVsbDsKICB9CiAgLyoqCiAgICogUmVuZGVycyBhIERPTSBOb2RlIChhbiBIVE1MIGVsZW1lbnQgb3IgdGV4dCkgb3V0IG9mIHRoZSB0ZW1wbGF0ZS4KICAgKgogICAqCQljb25zdCBkb21Ob2RlID0gbmV3IFRlbXBsYXRlKCB7IC4uLiB9ICkucmVuZGVyKCk7CiAgICoKICAgKiBTZWU6IHtAbGluayAjYXBwbHl9LgogICAqCiAgICogQHJldHVybnMge0hUTUxFbGVtZW50fFRleHR9CiAgICovCgoKICByZW5kZXIoKSB7CiAgICBjb25zdCBub2RlID0gdGhpcy5fcmVuZGVyTm9kZSh7CiAgICAgIGludG9GcmFnbWVudDogdHJ1ZQogICAgfSk7CgogICAgdGhpcy5faXNSZW5kZXJlZCA9IHRydWU7CiAgICByZXR1cm4gbm9kZTsKICB9CiAgLyoqCiAgICogQXBwbGllcyB0aGUgdGVtcGxhdGUgdG8gYW4gZXhpc3RpbmcgRE9NIE5vZGUsIGVpdGhlciBIVE1MIGVsZW1lbnQgb3IgdGV4dC4KICAgKgogICAqICoqTm90ZToqKiBObyBuZXcgRE9NIG5vZGVzIHdpbGwgYmUgY3JlYXRlZC4gQXBwbHlpbmcgZXh0ZW5kczoKICAgKgogICAqIHtAbGluayBtb2R1bGU6dWkvdGVtcGxhdGV+VGVtcGxhdGVEZWZpbml0aW9uIGF0dHJpYnV0ZXN9LAogICAqIHtAbGluayBtb2R1bGU6dWkvdGVtcGxhdGV+VGVtcGxhdGVEZWZpbml0aW9uIGV2ZW50IGxpc3RlbmVyc30sIGFuZAogICAqIGB0ZXh0Q29udGVudGAgb2Yge0BsaW5rIG1vZHVsZTp1aS90ZW1wbGF0ZX5UZW1wbGF0ZURlZmluaXRpb24gY2hpbGRyZW59IG9ubHkuCiAgICoKICAgKiAqKk5vdGU6KiogRXhpc3RpbmcgYGNsYXNzYCBhbmQgYHN0eWxlYCBhdHRyaWJ1dGVzIGFyZSBleHRlbmRlZCB3aGVuIGEgdGVtcGxhdGUKICAgKiBpcyBhcHBsaWVkIHRvIGFuIEhUTUwgZWxlbWVudCwgd2hpbGUgb3RoZXIgYXR0cmlidXRlcyBhbmQgYHRleHRDb250ZW50YCBhcmUgb3ZlcnJpZGRlbi4KICAgKgogICAqICoqTm90ZToqKiBUaGUgcHJvY2VzcyBvZiBhcHBseWluZyBhIHRlbXBsYXRlIGNhbiBiZSBlYXNpbHkgcmV2ZXJ0ZWQgdXNpbmcgdGhlCiAgICoge0BsaW5rIG1vZHVsZTp1aS90ZW1wbGF0ZX5UZW1wbGF0ZSNyZXZlcnR9IG1ldGhvZC4KICAgKgogICAqCQljb25zdCBlbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCggJ2RpdicgKTsKICAgKgkJY29uc3Qgb2JzZXJ2YWJsZSA9IG5ldyBNb2RlbCggeyBkaXZDbGFzczogJ215LWRpdicgfSApOwogICAqCQljb25zdCBlbWl0dGVyID0gT2JqZWN0LmNyZWF0ZSggRW1pdHRlck1peGluICk7CiAgICoJCWNvbnN0IGJpbmQgPSBUZW1wbGF0ZS5iaW5kKCBvYnNlcnZhYmxlLCBlbWl0dGVyICk7CiAgICoKICAgKgkJbmV3IFRlbXBsYXRlKCB7CiAgICoJCQlhdHRyaWJ1dGVzOiB7CiAgICoJCQkJaWQ6ICdmaXJzdC1kaXYnLAogICAqCQkJCWNsYXNzOiBiaW5kLnRvKCAnZGl2Q2xhc3MnICkKICAgKgkJCX0sCiAgICoJCQlvbjogewogICAqCQkJCWNsaWNrOiBiaW5kKCAnZWxlbWVudENsaWNrZWQnICkgLy8gV2lsbCBiZSBmaXJlZCBieSB0aGUgb2JzZXJ2YWJsZS4KICAgKgkJCX0sCiAgICoJCQljaGlsZHJlbjogWwogICAqCQkJCSdEaXYgdGV4dC4nCiAgICoJCQldCiAgICoJCX0gKS5hcHBseSggZWxlbWVudCApOwogICAqCiAgICoJCWNvbnNvbGUubG9nKCBlbGVtZW50Lm91dGVySFRNTCApOyAvLyAtPiAnPGRpdiBpZD0iZmlyc3QtZGl2IiBjbGFzcz0ibXktZGl2Ij48L2Rpdj4nCiAgICoKICAgKiBAc2VlIG1vZHVsZTp1aS90ZW1wbGF0ZX5UZW1wbGF0ZSNyZW5kZXIKICAgKiBAc2VlIG1vZHVsZTp1aS90ZW1wbGF0ZX5UZW1wbGF0ZSNyZXZlcnQKICAgKiBAcGFyYW0ge05vZGV9IG5vZGUgUm9vdCBub2RlIGZvciB0aGUgdGVtcGxhdGUgdG8gYXBwbHkuCiAgICovCgoKICBhcHBseShub2RlKSB7CiAgICB0aGlzLl9yZXZlcnREYXRhID0gZ2V0RW1wdHlSZXZlcnREYXRhKCk7CgogICAgdGhpcy5fcmVuZGVyTm9kZSh7CiAgICAgIG5vZGUsCiAgICAgIGlzQXBwbHlpbmc6IHRydWUsCiAgICAgIHJldmVydERhdGE6IHRoaXMuX3JldmVydERhdGEKICAgIH0pOwoKICAgIHJldHVybiBub2RlOwogIH0KICAvKioKICAgKiBSZXZlcnRzIGEgdGVtcGxhdGUge0BsaW5rIG1vZHVsZTp1aS90ZW1wbGF0ZX5UZW1wbGF0ZSNhcHBseSBhcHBsaWVkfSB0byBhIERPTSBub2RlLgogICAqCiAgICogQHBhcmFtIHtOb2RlfSBub2RlIFRoZSByb290IG5vZGUgZm9yIHRoZSB0ZW1wbGF0ZSB0byByZXZlcnQuIEluIG1vc3Qgb2YgdGhlIGNhc2VzLCBpdCBpcyB0aGUKICAgKiBzYW1lIG5vZGUgdXNlZCBieSB7QGxpbmsgbW9kdWxlOnVpL3RlbXBsYXRlflRlbXBsYXRlI2FwcGx5fS4KICAgKi8KCgogIHJldmVydChub2RlKSB7CiAgICBpZiAoIXRoaXMuX3JldmVydERhdGEpIHsKICAgICAgLyoqCiAgICAgICAqIEF0dGVtcHRpbmcgdG8gcmV2ZXJ0IGEgdGVtcGxhdGUgd2hpY2ggaGFzIG5vdCBiZWVuIGFwcGxpZWQgeWV0LgogICAgICAgKgogICAgICAgKiBAZXJyb3IgdWktdGVtcGxhdGUtcmV2ZXJ0LW5vdC1hcHBsaWVkCiAgICAgICAqLwogICAgICB0aHJvdyBuZXcgQ0tFZGl0b3JFcnJvcigndWktdGVtcGxhdGUtcmV2ZXJ0LW5vdC1hcHBsaWVkOiBBdHRlbXB0aW5nIHRvIHJldmVydCBhIHRlbXBsYXRlIHdoaWNoIGhhcyBub3QgYmVlbiBhcHBsaWVkIHlldC4nLCBbdGhpcywgbm9kZV0pOwogICAgfQoKICAgIHRoaXMuX3JldmVydFRlbXBsYXRlRnJvbU5vZGUobm9kZSwgdGhpcy5fcmV2ZXJ0RGF0YSk7CiAgfQogIC8qKgogICAqIFJldHVybnMgYW4gaXRlcmF0b3Igd2hpY2ggdHJhdmVyc2VzIHRoZSB0ZW1wbGF0ZSBpbiBzZWFyY2ggb2Yge0BsaW5rIG1vZHVsZTp1aS92aWV3flZpZXd9CiAgICogaW5zdGFuY2VzIGFuZCByZXR1cm5zIHRoZW0gb25lIGJ5IG9uZS4KICAgKgogICAqCQljb25zdCB2aWV3Rm9vID0gbmV3IFZpZXcoKTsKICAgKgkJY29uc3Qgdmlld0JhciA9IG5ldyBWaWV3KCk7CiAgICoJCWNvbnN0IHZpZXdCYXogPSBuZXcgVmlldygpOwogICAqCQljb25zdCB0ZW1wbGF0ZSA9IG5ldyBUZW1wbGF0ZSggewogICAqCQkJdGFnOiAnZGl2JywKICAgKgkJCWNoaWxkcmVuOiBbCiAgICoJCQkJdmlld0ZvbywKICAgKgkJCQl7CiAgICoJCQkJCXRhZzogJ2RpdicsCiAgICoJCQkJCWNoaWxkcmVuOiBbCiAgICoJCQkJCQl2aWV3QmFyCiAgICoJCQkJCV0KICAgKgkJCQl9LAogICAqCQkJCXZpZXdCYXoKICAgKgkJCV0KICAgKgkJfSApOwogICAqCiAgICoJCS8vIExvZ3M6IHZpZXdGb28sIHZpZXdCYXIsIHZpZXdCYXoKICAgKgkJZm9yICggY29uc3QgdmlldyBvZiB0ZW1wbGF0ZS5nZXRWaWV3cygpICkgewogICAqCQkJY29uc29sZS5sb2coIHZpZXcgKTsKICAgKgkJfQogICAqCiAgICogQHJldHVybnMge0l0ZXJhYmxlLjxtb2R1bGU6dWkvdmlld35WaWV3Pn0KICAgKi8KCgogICpnZXRWaWV3cygpIHsKICAgIGZ1bmN0aW9uKiBzZWFyY2goZGVmKSB7CiAgICAgIGlmIChkZWYuY2hpbGRyZW4pIHsKICAgICAgICBmb3IgKGNvbnN0IGNoaWxkIG9mIGRlZi5jaGlsZHJlbikgewogICAgICAgICAgaWYgKGlzVmlldyhjaGlsZCkpIHsKICAgICAgICAgICAgeWllbGQgY2hpbGQ7CiAgICAgICAgICB9IGVsc2UgaWYgKGlzVGVtcGxhdGUoY2hpbGQpKSB7CiAgICAgICAgICAgIHlpZWxkKiBzZWFyY2goY2hpbGQpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfQoKICAgIHlpZWxkKiBzZWFyY2godGhpcyk7CiAgfQogIC8qKgogICAqIEFuIGVudHJ5IHBvaW50IHRvIHRoZSBpbnRlcmZhY2Ugd2hpY2ggYmluZHMgRE9NIG5vZGVzIHRvCiAgICoge0BsaW5rIG1vZHVsZTp1dGlscy9vYnNlcnZhYmxlbWl4aW5+T2JzZXJ2YWJsZSBvYnNlcnZhYmxlc30uCiAgICogVGhlcmUgYXJlIHR3byB0eXBlcyBvZiBiaW5kaW5nczoKICAgKgogICAqICogSFRNTCBlbGVtZW50IGF0dHJpYnV0ZXMgb3IgdGV4dCBgdGV4dENvbnRlbnRgIHN5bmNocm9uaXplZCB3aXRoIGF0dHJpYnV0ZXMgb2YgYW4KICAgKiB7QGxpbmsgbW9kdWxlOnV0aWxzL29ic2VydmFibGVtaXhpbn5PYnNlcnZhYmxlfS4gTGVhcm4gbW9yZSBhYm91dCB7QGxpbmsgbW9kdWxlOnVpL3RlbXBsYXRlfkJpbmRDaGFpbiN0b30KICAgKiBhbmQge0BsaW5rIG1vZHVsZTp1aS90ZW1wbGF0ZX5CaW5kQ2hhaW4jaWZ9LgogICAqCiAgICoJCWNvbnN0IGJpbmQgPSBUZW1wbGF0ZS5iaW5kKCBvYnNlcnZhYmxlLCBlbWl0dGVyICk7CiAgICoKICAgKgkJbmV3IFRlbXBsYXRlKCB7CiAgICoJCQlhdHRyaWJ1dGVzOiB7CiAgICoJCQkJLy8gQmluZHMgdGhlIGVsZW1lbnQgImNsYXNzIiBhdHRyaWJ1dGUgdG8gb2JzZXJ2YWJsZSNjbGFzc0F0dHJpYnV0ZS4KICAgKgkJCQljbGFzczogYmluZC50byggJ2NsYXNzQXR0cmlidXRlJyApCiAgICoJCQl9CiAgICoJCX0gKS5yZW5kZXIoKTsKICAgKgogICAqICogRE9NIGV2ZW50cyBmaXJlZCBvbiBIVE1MIGVsZW1lbnQgcHJvcGFnYXRlZCB0aHJvdWdoCiAgICoge0BsaW5rIG1vZHVsZTp1dGlscy9vYnNlcnZhYmxlbWl4aW5+T2JzZXJ2YWJsZX0uIExlYXJuIG1vcmUgYWJvdXQge0BsaW5rIG1vZHVsZTp1aS90ZW1wbGF0ZX5CaW5kQ2hhaW4jdG99LgogICAqCiAgICoJCWNvbnN0IGJpbmQgPSBUZW1wbGF0ZS5iaW5kKCBvYnNlcnZhYmxlLCBlbWl0dGVyICk7CiAgICoKICAgKgkJbmV3IFRlbXBsYXRlKCB7CiAgICoJCQlvbjogewogICAqCQkJCS8vIFdpbGwgYmUgZmlyZWQgYnkgdGhlIG9ic2VydmFibGUuCiAgICoJCQkJY2xpY2s6IGJpbmQoICdlbGVtZW50Q2xpY2tlZCcgKQogICAqCQkJfQogICAqCQl9ICkucmVuZGVyKCk7CiAgICoKICAgKiBBbHNvIHNlZSB7QGxpbmsgbW9kdWxlOnVpL3ZpZXd+VmlldyNiaW5kVGVtcGxhdGV9LgogICAqCiAgICogQHBhcmFtIHttb2R1bGU6dXRpbHMvb2JzZXJ2YWJsZW1peGlufk9ic2VydmFibGV9IG9ic2VydmFibGUgQW4gb2JzZXJ2YWJsZSB3aGljaCBwcm92aWRlcyBib3VuZGFibGUgYXR0cmlidXRlcy4KICAgKiBAcGFyYW0ge21vZHVsZTp1dGlscy9lbWl0dGVybWl4aW5+RW1pdHRlcn0gZW1pdHRlciBBbiBlbWl0dGVyIHRoYXQgbGlzdGVucyB0byBvYnNlcnZhYmxlIGF0dHJpYnV0ZQogICAqIGNoYW5nZXMgb3IgRE9NIEV2ZW50cyAoZGVwZW5kaW5nIG9uIHRoZSBraW5kIG9mIHRoZSBiaW5kaW5nKS4gVXN1YWxseSwgYSB7QGxpbmsgbW9kdWxlOnVpL3ZpZXd+Vmlld30gaW5zdGFuY2UuCiAgICogQHJldHVybnMge21vZHVsZTp1aS90ZW1wbGF0ZX5CaW5kQ2hhaW59CiAgICovCgoKICBzdGF0aWMgYmluZChvYnNlcnZhYmxlLCBlbWl0dGVyKSB7CiAgICByZXR1cm4gewogICAgICB0byhldmVudE5hbWVPckZ1bmN0aW9uT3JBdHRyaWJ1dGUsIGNhbGxiYWNrKSB7CiAgICAgICAgcmV0dXJuIG5ldyBUZW1wbGF0ZVRvQmluZGluZyh7CiAgICAgICAgICBldmVudE5hbWVPckZ1bmN0aW9uOiBldmVudE5hbWVPckZ1bmN0aW9uT3JBdHRyaWJ1dGUsCiAgICAgICAgICBhdHRyaWJ1dGU6IGV2ZW50TmFtZU9yRnVuY3Rpb25PckF0dHJpYnV0ZSwKICAgICAgICAgIG9ic2VydmFibGUsCiAgICAgICAgICBlbWl0dGVyLAogICAgICAgICAgY2FsbGJhY2sKICAgICAgICB9KTsKICAgICAgfSwKCiAgICAgIGlmKGF0dHJpYnV0ZSwgdmFsdWVJZlRydWUsIGNhbGxiYWNrKSB7CiAgICAgICAgcmV0dXJuIG5ldyBUZW1wbGF0ZUlmQmluZGluZyh7CiAgICAgICAgICBvYnNlcnZhYmxlLAogICAgICAgICAgZW1pdHRlciwKICAgICAgICAgIGF0dHJpYnV0ZSwKICAgICAgICAgIHZhbHVlSWZUcnVlLAogICAgICAgICAgY2FsbGJhY2sKICAgICAgICB9KTsKICAgICAgfQoKICAgIH07CiAgfQogIC8qKgogICAqIEV4dGVuZHMgYW4gZXhpc3Rpbmcge0BsaW5rIG1vZHVsZTp1aS90ZW1wbGF0ZX5UZW1wbGF0ZX0gaW5zdGFuY2Ugd2l0aCBzb21lIGFkZGl0aW9uYWwgY29udGVudAogICAqIGZyb20gYW5vdGhlciB7QGxpbmsgbW9kdWxlOnVpL3RlbXBsYXRlflRlbXBsYXRlRGVmaW5pdGlvbn0uCiAgICoKICAgKgkJY29uc3QgYmluZCA9IFRlbXBsYXRlLmJpbmQoIG9ic2VydmFibGUsIGVtaXR0ZXIgKTsKICAgKgogICAqCQljb25zdCB0ZW1wbGF0ZSA9IG5ldyBUZW1wbGF0ZSggewogICAqCQkJdGFnOiAncCcsCiAgICoJCQlhdHRyaWJ1dGVzOiB7CiAgICoJCQkJY2xhc3M6ICdhJywKICAgKgkJCQlkYXRhLXg6IGJpbmQudG8oICdmb28nICkKICAgKgkJCX0sCiAgICoJCQljaGlsZHJlbjogWwogICAqCQkJCXsKICAgKgkJCQkJdGFnOiAnc3BhbicsCiAgICoJCQkJCWF0dHJpYnV0ZXM6IHsKICAgKgkJCQkJCWNsYXNzOiAnYicKICAgKgkJCQkJfSwKICAgKgkJCQkJY2hpbGRyZW46IFsKICAgKgkJCQkJCSdTcGFuJwogICAqCQkJCQldCiAgICoJCQkJfQogICAqCQkJXQogICAqCQkgfSApOwogICAqCiAgICoJCS8vIEluc3RhbmNlLWxldmVsIGV4dGVuc2lvbi4KICAgKgkJVGVtcGxhdGUuZXh0ZW5kKCB0ZW1wbGF0ZSwgewogICAqCQkJYXR0cmlidXRlczogewogICAqCQkJCWNsYXNzOiAnYicsCiAgICoJCQkJZGF0YS14OiBiaW5kLnRvKCAnYmFyJyApCiAgICoJCQl9LAogICAqCQkJY2hpbGRyZW46IFsKICAgKgkJCQl7CiAgICoJCQkJCWF0dHJpYnV0ZXM6IHsKICAgKgkJCQkJCWNsYXNzOiAnYycKICAgKgkJCQkJfQogICAqCQkJCX0KICAgKgkJCV0KICAgKgkJfSApOwogICAqCiAgICoJCS8vIENoaWxkIGV4dGVuc2lvbi4KICAgKgkJVGVtcGxhdGUuZXh0ZW5kKCB0ZW1wbGF0ZS5jaGlsZHJlblsgMCBdLCB7CiAgICoJCQlhdHRyaWJ1dGVzOiB7CiAgICoJCQkJY2xhc3M6ICdkJwogICAqCQkJfQogICAqCQl9ICk7CiAgICoKICAgKiB0aGUgYG91dGVySFRNTGAgb2YgYHRlbXBsYXRlLnJlbmRlcigpYCBpczoKICAgKgogICAqCQk8cCBjbGFzcz0iYSBiIiBkYXRhLXg9Insgb2JzZXJ2YWJsZS5mb28gfSB7IG9ic2VydmFibGUuYmFyIH0iPgogICAqCQkJPHNwYW4gY2xhc3M9ImIgYyBkIj5TcGFuPC9zcGFuPgogICAqCQk8L3A+CiAgICoKICAgKiBAcGFyYW0ge21vZHVsZTp1aS90ZW1wbGF0ZX5UZW1wbGF0ZX0gdGVtcGxhdGUgQW4gZXhpc3RpbmcgdGVtcGxhdGUgaW5zdGFuY2UgdG8gYmUgZXh0ZW5kZWQuCiAgICogQHBhcmFtIHttb2R1bGU6dWkvdGVtcGxhdGV+VGVtcGxhdGVEZWZpbml0aW9ufSBkZWYgQWRkaXRpb25hbCBkZWZpbml0aW9uIHRvIGJlIGFwcGxpZWQgdG8gYSB0ZW1wbGF0ZS4KICAgKi8KCgogIHN0YXRpYyBleHRlbmQodGVtcGxhdGUsIGRlZikgewogICAgaWYgKHRlbXBsYXRlLl9pc1JlbmRlcmVkKSB7CiAgICAgIC8qKgogICAgICAgKiBFeHRlbmRpbmcgYSB0ZW1wbGF0ZSBhZnRlciByZW5kZXJpbmcgbWF5IG5vdCB3b3JrIGFzIGV4cGVjdGVkLiBUbyBtYWtlIHN1cmUKICAgICAgICogdGhlIHtAbGluayBtb2R1bGU6dWkvdGVtcGxhdGV+VGVtcGxhdGUuZXh0ZW5kIGV4dGVuZGluZ30gd29ya3MgZm9yIGFuIGVsZW1lbnQsCiAgICAgICAqIG1ha2Ugc3VyZSBpdCBoYXBwZW5zIGJlZm9yZSB7QGxpbmsgI3JlbmRlcn0gaXMgY2FsbGVkLgogICAgICAgKgogICAgICAgKiBAZXJyb3IgdGVtcGxhdGUtZXh0ZW5kLXJlbmRlcgogICAgICAgKi8KICAgICAgdGhyb3cgbmV3IENLRWRpdG9yRXJyb3IoJ3RlbXBsYXRlLWV4dGVuZC1yZW5kZXI6IEF0dGVtcHRpbmcgdG8gZXh0ZW5kIGEgdGVtcGxhdGUgd2hpY2ggaGFzIGFscmVhZHkgYmVlbiByZW5kZXJlZC4nLCBbdGhpcywgdGVtcGxhdGVdKTsKICAgIH0KCiAgICBleHRlbmRUZW1wbGF0ZSh0ZW1wbGF0ZSwgbm9ybWFsaXplKGNsb25lKGRlZikpKTsKICB9CiAgLyoqCiAgICogUmVuZGVycyBhIERPTSBOb2RlIChlaXRoZXIgYW4gSFRNTCBlbGVtZW50IG9yIHRleHQpIG91dCBvZiB0aGUgdGVtcGxhdGUuCiAgICoKICAgKiBAcHJvdGVjdGVkCiAgICogQHBhcmFtIHttb2R1bGU6dWkvdGVtcGxhdGV+UmVuZGVyRGF0YX0gZGF0YSBSZW5kZXJpbmcgZGF0YS4KICAgKi8KCgogIF9yZW5kZXJOb2RlKGRhdGEpIHsKICAgIGxldCBpc0ludmFsaWQ7CgogICAgaWYgKGRhdGEubm9kZSkgewogICAgICAvLyBXaGVuIGFwcGx5aW5nLCBhIGRlZmluaXRpb24gY2Fubm90IGhhdmUgInRhZyIgYW5kICJ0ZXh0IiBhdCB0aGUgc2FtZSB0aW1lLgogICAgICBpc0ludmFsaWQgPSB0aGlzLnRhZyAmJiB0aGlzLnRleHQ7CiAgICB9IGVsc2UgewogICAgICAvLyBXaGVuIHJlbmRlcmluZywgYSBkZWZpbml0aW9uIG11c3QgaGF2ZSBlaXRoZXIgInRhZyIgb3IgInRleHQiOiBYT1IoIHRoaXMudGFnLCB0aGlzLnRleHQgKS4KICAgICAgaXNJbnZhbGlkID0gdGhpcy50YWcgPyB0aGlzLnRleHQgOiAhdGhpcy50ZXh0OwogICAgfQoKICAgIGlmIChpc0ludmFsaWQpIHsKICAgICAgLyoqCiAgICAgICAqIE5vZGUgZGVmaW5pdGlvbiBjYW5ub3QgaGF2ZSB0aGUgInRhZyIgYW5kICJ0ZXh0IiBwcm9wZXJ0aWVzIGF0IHRoZSBzYW1lIHRpbWUuCiAgICAgICAqIE5vZGUgZGVmaW5pdGlvbiBtdXN0IGhhdmUgZWl0aGVyICJ0YWciIG9yICJ0ZXh0IiB3aGVuIHJlbmRlcmluZyBhIG5ldyBOb2RlLgogICAgICAgKgogICAgICAgKiBAZXJyb3IgdWktdGVtcGxhdGUtd3Jvbmctc3ludGF4CiAgICAgICAqLwogICAgICB0aHJvdyBuZXcgQ0tFZGl0b3JFcnJvcigndWktdGVtcGxhdGUtd3Jvbmctc3ludGF4OiBOb2RlIGRlZmluaXRpb24gbXVzdCBoYXZlIGVpdGhlciAidGFnIiBvciAidGV4dCIgd2hlbiByZW5kZXJpbmcgYSBuZXcgTm9kZS4nLCB0aGlzKTsKICAgIH0KCiAgICBpZiAodGhpcy50ZXh0KSB7CiAgICAgIHJldHVybiB0aGlzLl9yZW5kZXJUZXh0KGRhdGEpOwogICAgfSBlbHNlIHsKICAgICAgcmV0dXJuIHRoaXMuX3JlbmRlckVsZW1lbnQoZGF0YSk7CiAgICB9CiAgfQogIC8qKgogICAqIFJlbmRlcnMgYW4gSFRNTCBlbGVtZW50IG91dCBvZiB0aGUgdGVtcGxhdGUuCiAgICoKICAgKiBAcHJvdGVjdGVkCiAgICogQHBhcmFtIHttb2R1bGU6dWkvdGVtcGxhdGV+UmVuZGVyRGF0YX0gZGF0YSBSZW5kZXJpbmcgZGF0YS4KICAgKi8KCgogIF9yZW5kZXJFbGVtZW50KGRhdGEpIHsKICAgIGxldCBub2RlID0gZGF0YS5ub2RlOwoKICAgIGlmICghbm9kZSkgewogICAgICBub2RlID0gZGF0YS5ub2RlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKHRoaXMubnMgfHwgeGh0bWxOcywgdGhpcy50YWcpOwogICAgfQoKICAgIHRoaXMuX3JlbmRlckF0dHJpYnV0ZXMoZGF0YSk7CgogICAgdGhpcy5fcmVuZGVyRWxlbWVudENoaWxkcmVuKGRhdGEpOwoKICAgIHRoaXMuX3NldFVwTGlzdGVuZXJzKGRhdGEpOwoKICAgIHJldHVybiBub2RlOwogIH0KICAvKioKICAgKiBSZW5kZXJzIGEgdGV4dCBub2RlIG91dCBvZiB7QGxpbmsgbW9kdWxlOnVpL3RlbXBsYXRlflRlbXBsYXRlI3RleHR9LgogICAqCiAgICogQHByb3RlY3RlZAogICAqIEBwYXJhbSB7bW9kdWxlOnVpL3RlbXBsYXRlflJlbmRlckRhdGF9IGRhdGEgUmVuZGVyaW5nIGRhdGEuCiAgICovCgoKICBfcmVuZGVyVGV4dChkYXRhKSB7CiAgICBsZXQgbm9kZSA9IGRhdGEubm9kZTsgLy8gU2F2ZSB0aGUgb3JpZ2luYWwgdGV4dENvbnRlbnQgdG8gcmV2ZXJ0IGl0IGluICNyZXZlcnQoKS4KCiAgICBpZiAobm9kZSkgewogICAgICBkYXRhLnJldmVydERhdGEudGV4dCA9IG5vZGUudGV4dENvbnRlbnQ7CiAgICB9IGVsc2UgewogICAgICBub2RlID0gZGF0YS5ub2RlID0gZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJycpOwogICAgfSAvLyBDaGVjayBpZiB0aGlzIFRleHQgTm9kZSBpcyBib3VuZCB0byBPYnNlcnZhYmxlLiBDYXNlczoKICAgIC8vCiAgICAvLwkJdGV4dDogWyBUZW1wbGF0ZS5iaW5kKCAuLi4gKS50byggLi4uICkgXQogICAgLy8KICAgIC8vCQl0ZXh0OiBbCiAgICAvLwkJCSdmb28nLAogICAgLy8JCQlUZW1wbGF0ZS5iaW5kKCAuLi4gKS50byggLi4uICksCiAgICAvLwkJCS4uLgogICAgLy8JCV0KICAgIC8vCgoKICAgIGlmIChoYXNUZW1wbGF0ZUJpbmRpbmcodGhpcy50ZXh0KSkgewogICAgICB0aGlzLl9iaW5kVG9PYnNlcnZhYmxlKHsKICAgICAgICBzY2hlbWE6IHRoaXMudGV4dCwKICAgICAgICB1cGRhdGVyOiBnZXRUZXh0VXBkYXRlcihub2RlKSwKICAgICAgICBkYXRhCiAgICAgIH0pOwogICAgfSAvLyBTaW1wbHkgc2V0IHRleHQuIENhc2VzOgogICAgLy8KICAgIC8vCQl0ZXh0OiBbICdhbGwnLCAnYXJlJywgJ3N0YXRpYycgXQogICAgLy8KICAgIC8vCQl0ZXh0OiBbICdmb28nIF0KICAgIC8vCiAgICBlbHNlIHsKICAgICAgICBub2RlLnRleHRDb250ZW50ID0gdGhpcy50ZXh0LmpvaW4oJycpOwogICAgICB9CgogICAgcmV0dXJuIG5vZGU7CiAgfQogIC8qKgogICAqIFJlbmRlcnMgSFRNTCBlbGVtZW50IGF0dHJpYnV0ZXMgb3V0IG9mIHtAbGluayBtb2R1bGU6dWkvdGVtcGxhdGV+VGVtcGxhdGUjYXR0cmlidXRlc30uCiAgICoKICAgKiBAcHJvdGVjdGVkCiAgICogQHBhcmFtIHttb2R1bGU6dWkvdGVtcGxhdGV+UmVuZGVyRGF0YX0gZGF0YSBSZW5kZXJpbmcgZGF0YS4KICAgKi8KCgogIF9yZW5kZXJBdHRyaWJ1dGVzKGRhdGEpIHsKICAgIGxldCBhdHRyTmFtZSwgYXR0clZhbHVlLCBkb21BdHRyVmFsdWUsIGF0dHJOczsKCiAgICBpZiAoIXRoaXMuYXR0cmlidXRlcykgewogICAgICByZXR1cm47CiAgICB9CgogICAgY29uc3Qgbm9kZSA9IGRhdGEubm9kZTsKICAgIGNvbnN0IHJldmVydERhdGEgPSBkYXRhLnJldmVydERhdGE7CgogICAgZm9yIChhdHRyTmFtZSBpbiB0aGlzLmF0dHJpYnV0ZXMpIHsKICAgICAgLy8gQ3VycmVudCBhdHRyaWJ1dGUgdmFsdWUgaW4gRE9NLgogICAgICBkb21BdHRyVmFsdWUgPSBub2RlLmdldEF0dHJpYnV0ZShhdHRyTmFtZSk7IC8vIFRoZSB2YWx1ZSB0byBiZSBzZXQuCgogICAgICBhdHRyVmFsdWUgPSB0aGlzLmF0dHJpYnV0ZXNbYXR0ck5hbWVdOyAvLyBTYXZlIHJldmVydCBkYXRhLgoKICAgICAgaWYgKHJldmVydERhdGEpIHsKICAgICAgICByZXZlcnREYXRhLmF0dHJpYnV0ZXNbYXR0ck5hbWVdID0gZG9tQXR0clZhbHVlOwogICAgICB9IC8vIERldGVjdCBjdXN0b20gbmFtZXNwYWNlOgogICAgICAvLwogICAgICAvLwkJY2xhc3M6IHsKICAgICAgLy8JCQluczogJ2FiYycsCiAgICAgIC8vCQkJdmFsdWU6IFRlbXBsYXRlLmJpbmQoIC4uLiApLnRvKCAuLi4gKQogICAgICAvLwkJfQogICAgICAvLwoKCiAgICAgIGF0dHJOcyA9IGlzT2JqZWN0KGF0dHJWYWx1ZVswXSkgJiYgYXR0clZhbHVlWzBdLm5zID8gYXR0clZhbHVlWzBdLm5zIDogbnVsbDsgLy8gQWN0aXZhdGUgYmluZGluZyBpZiBvbmUgaXMgZm91bmQuIENhc2VzOgogICAgICAvLwogICAgICAvLwkJY2xhc3M6IFsKICAgICAgLy8JCQlUZW1wbGF0ZS5iaW5kKCAuLi4gKS50byggLi4uICkKICAgICAgLy8JCV0KICAgICAgLy8KICAgICAgLy8JCWNsYXNzOiBbCiAgICAgIC8vCQkJJ2JhcicsCiAgICAgIC8vCQkJVGVtcGxhdGUuYmluZCggLi4uICkudG8oIC4uLiApLAogICAgICAvLwkJCSdiYXonCiAgICAgIC8vCQldCiAgICAgIC8vCiAgICAgIC8vCQljbGFzczogewogICAgICAvLwkJCW5zOiAnYWJjJywKICAgICAgLy8JCQl2YWx1ZTogVGVtcGxhdGUuYmluZCggLi4uICkudG8oIC4uLiApCiAgICAgIC8vCQl9CiAgICAgIC8vCgogICAgICBpZiAoaGFzVGVtcGxhdGVCaW5kaW5nKGF0dHJWYWx1ZSkpIHsKICAgICAgICAvLyBOb3JtYWxpemUgYXR0cmlidXRlcyB3aXRoIGFkZGl0aW9uYWwgZGF0YSBsaWtlIG5hbWVzcGFjZToKICAgICAgICAvLwogICAgICAgIC8vCQljbGFzczogewogICAgICAgIC8vCQkJbnM6ICdhYmMnLAogICAgICAgIC8vCQkJdmFsdWU6IFsgLi4uIF0KICAgICAgICAvLwkJfQogICAgICAgIC8vCiAgICAgICAgY29uc3QgdmFsdWVUb0JpbmQgPSBhdHRyTnMgPyBhdHRyVmFsdWVbMF0udmFsdWUgOiBhdHRyVmFsdWU7IC8vIEV4dGVuZCB0aGUgb3JpZ2luYWwgdmFsdWUgb2YgYXR0cmlidXRlcyBsaWtlICJzdHlsZSIgYW5kICJjbGFzcyIsCiAgICAgICAgLy8gZG9uJ3Qgb3ZlcnJpZGUgdGhlbS4KCiAgICAgICAgaWYgKHJldmVydERhdGEgJiYgc2hvdWxkRXh0ZW5kKGF0dHJOYW1lKSkgewogICAgICAgICAgdmFsdWVUb0JpbmQudW5zaGlmdChkb21BdHRyVmFsdWUpOwogICAgICAgIH0KCiAgICAgICAgdGhpcy5fYmluZFRvT2JzZXJ2YWJsZSh7CiAgICAgICAgICBzY2hlbWE6IHZhbHVlVG9CaW5kLAogICAgICAgICAgdXBkYXRlcjogZ2V0QXR0cmlidXRlVXBkYXRlcihub2RlLCBhdHRyTmFtZSwgYXR0ck5zKSwKICAgICAgICAgIGRhdGEKICAgICAgICB9KTsKICAgICAgfSAvLyBTdHlsZSBhdHRyaWJ1dGUgY291bGQgYmUgYW4gT2JqZWN0IHNvIGl0IG5lZWRzIHRvIGJlIHBhcnNlZCBpbiBhIHNwZWNpZmljIHdheS4KICAgICAgLy8KICAgICAgLy8JCXN0eWxlOiB7CiAgICAgIC8vCQkJd2lkdGg6ICcxMDBweCcsCiAgICAgIC8vCQkJaGVpZ2h0OiBUZW1wbGF0ZS5iaW5kKCAuLi4gKS50byggLi4uICkKICAgICAgLy8JCX0KICAgICAgLy8KICAgICAgZWxzZSBpZiAoYXR0ck5hbWUgPT0gJ3N0eWxlJyAmJiB0eXBlb2YgYXR0clZhbHVlWzBdICE9PSAnc3RyaW5nJykgewogICAgICAgICAgdGhpcy5fcmVuZGVyU3R5bGVBdHRyaWJ1dGUoYXR0clZhbHVlWzBdLCBkYXRhKTsKICAgICAgICB9IC8vIE90aGVyd2lzZSBzaW1wbHkgc2V0IHRoZSBzdGF0aWMgYXR0cmlidXRlOgogICAgICAgIC8vCiAgICAgICAgLy8JCWNsYXNzOiBbICdmb28nIF0KICAgICAgICAvLwogICAgICAgIC8vCQljbGFzczogWyAnYWxsJywgJ2FyZScsICdzdGF0aWMnIF0KICAgICAgICAvLwogICAgICAgIC8vCQljbGFzczogWwogICAgICAgIC8vCQkJewogICAgICAgIC8vCQkJCW5zOiAnYWJjJywKICAgICAgICAvLwkJCQl2YWx1ZTogWyAnZm9vJyBdCiAgICAgICAgLy8JCQl9CiAgICAgICAgLy8JCV0KICAgICAgICAvLwogICAgICAgIGVsc2UgewogICAgICAgICAgICAvLyBFeHRlbmQgdGhlIG9yaWdpbmFsIHZhbHVlIG9mIGF0dHJpYnV0ZXMgbGlrZSAic3R5bGUiIGFuZCAiY2xhc3MiLAogICAgICAgICAgICAvLyBkb24ndCBvdmVycmlkZSB0aGVtLgogICAgICAgICAgICBpZiAocmV2ZXJ0RGF0YSAmJiBkb21BdHRyVmFsdWUgJiYgc2hvdWxkRXh0ZW5kKGF0dHJOYW1lKSkgewogICAgICAgICAgICAgIGF0dHJWYWx1ZS51bnNoaWZ0KGRvbUF0dHJWYWx1ZSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGF0dHJWYWx1ZSA9IGF0dHJWYWx1ZSAvLyBSZXRyaWV2ZSAidmFsdWVzIiBmcm9tOgogICAgICAgICAgICAvLwogICAgICAgICAgICAvLwkJY2xhc3M6IFsKICAgICAgICAgICAgLy8JCQl7CiAgICAgICAgICAgIC8vCQkJCW5zOiAnYWJjJywKICAgICAgICAgICAgLy8JCQkJdmFsdWU6IFsgLi4uIF0KICAgICAgICAgICAgLy8JCQl9CiAgICAgICAgICAgIC8vCQldCiAgICAgICAgICAgIC8vCiAgICAgICAgICAgIC5tYXAodmFsID0+IHZhbCA/IHZhbC52YWx1ZSB8fCB2YWwgOiB2YWwpIC8vIEZsYXR0ZW4gdGhlIGFycmF5LgogICAgICAgICAgICAucmVkdWNlKChwcmV2LCBuZXh0KSA9PiBwcmV2LmNvbmNhdChuZXh0KSwgW10pIC8vIENvbnZlcnQgaW50byBzdHJpbmcuCiAgICAgICAgICAgIC5yZWR1Y2UoYXJyYXlWYWx1ZVJlZHVjZXIsICcnKTsKCiAgICAgICAgICAgIGlmICghaXNGYWxzeShhdHRyVmFsdWUpKSB7CiAgICAgICAgICAgICAgbm9kZS5zZXRBdHRyaWJ1dGVOUyhhdHRyTnMsIGF0dHJOYW1lLCBhdHRyVmFsdWUpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICB9CiAgfQogIC8qKgogICAqIFJlbmRlcnMgdGhlIGBzdHlsZWAgYXR0cmlidXRlIG9mIGFuIEhUTUwgZWxlbWVudCBiYXNlZCBvbgogICAqIHtAbGluayBtb2R1bGU6dWkvdGVtcGxhdGV+VGVtcGxhdGUjYXR0cmlidXRlc30uCiAgICoKICAgKiBBIHN0eWxlIGF0dHJpYnV0ZSBpcyBhbiB7T2JqZWN0fSB3aXRoIHN0YXRpYyB2YWx1ZXM6CiAgICoKICAgKgkJYXR0cmlidXRlczogewogICAqCQkJc3R5bGU6IHsKICAgKgkJCQljb2xvcjogJ3JlZCcKICAgKgkJCX0KICAgKgkJfQogICAqCiAgICogb3IgdmFsdWVzIGJvdW5kIHRvIHtAbGluayBtb2R1bGU6dWkvbW9kZWx+TW9kZWx9IHByb3BlcnRpZXM6CiAgICoKICAgKgkJYXR0cmlidXRlczogewogICAqCQkJc3R5bGU6IHsKICAgKgkJCQljb2xvcjogYmluZC50byggLi4uICkKICAgKgkJCX0KICAgKgkJfQogICAqCiAgICogTm90ZTogVGhlIGBzdHlsZWAgYXR0cmlidXRlIGlzIHJlbmRlcmVkIHdpdGhvdXQgc2V0dGluZyB0aGUgbmFtZXNwYWNlLiBJdCBkb2VzIG5vdCBzZWVtIHRvIGJlCiAgICogbmVlZGVkLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0ge09iamVjdH0gc3R5bGVzIFN0eWxlcyBsb2NhdGVkIGluIGBhdHRyaWJ1dGVzLnN0eWxlYCBvZiB7QGxpbmsgbW9kdWxlOnVpL3RlbXBsYXRlflRlbXBsYXRlRGVmaW5pdGlvbn0uCiAgICogQHBhcmFtIHttb2R1bGU6dWkvdGVtcGxhdGV+UmVuZGVyRGF0YX0gZGF0YSBSZW5kZXJpbmcgZGF0YS4KICAgKi8KCgogIF9yZW5kZXJTdHlsZUF0dHJpYnV0ZShzdHlsZXMsIGRhdGEpIHsKICAgIGNvbnN0IG5vZGUgPSBkYXRhLm5vZGU7CgogICAgZm9yIChjb25zdCBzdHlsZU5hbWUgaW4gc3R5bGVzKSB7CiAgICAgIGNvbnN0IHN0eWxlVmFsdWUgPSBzdHlsZXNbc3R5bGVOYW1lXTsgLy8gQ2FzZXM6CiAgICAgIC8vCiAgICAgIC8vCQlzdHlsZTogewogICAgICAvLwkJCWNvbG9yOiBiaW5kLnRvKCAnYXR0cmlidXRlJyApCiAgICAgIC8vCQl9CiAgICAgIC8vCgogICAgICBpZiAoaGFzVGVtcGxhdGVCaW5kaW5nKHN0eWxlVmFsdWUpKSB7CiAgICAgICAgdGhpcy5fYmluZFRvT2JzZXJ2YWJsZSh7CiAgICAgICAgICBzY2hlbWE6IFtzdHlsZVZhbHVlXSwKICAgICAgICAgIHVwZGF0ZXI6IGdldFN0eWxlVXBkYXRlcihub2RlLCBzdHlsZU5hbWUpLAogICAgICAgICAgZGF0YQogICAgICAgIH0pOwogICAgICB9IC8vIENhc2VzOgogICAgICAvLwogICAgICAvLwkJc3R5bGU6IHsKICAgICAgLy8JCQljb2xvcjogJ3JlZCcKICAgICAgLy8JCX0KICAgICAgLy8KICAgICAgZWxzZSB7CiAgICAgICAgICBub2RlLnN0eWxlW3N0eWxlTmFtZV0gPSBzdHlsZVZhbHVlOwogICAgICAgIH0KICAgIH0KICB9CiAgLyoqCiAgICogUmVjdXJzaXZlbHkgcmVuZGVycyBIVE1MIGVsZW1lbnQncyBjaGlsZHJlbiBmcm9tIHtAbGluayBtb2R1bGU6dWkvdGVtcGxhdGV+VGVtcGxhdGUjY2hpbGRyZW59LgogICAqCiAgICogQHByb3RlY3RlZAogICAqIEBwYXJhbSB7bW9kdWxlOnVpL3RlbXBsYXRlflJlbmRlckRhdGF9IGRhdGEgUmVuZGVyaW5nIGRhdGEuCiAgICovCgoKICBfcmVuZGVyRWxlbWVudENoaWxkcmVuKGRhdGEpIHsKICAgIGNvbnN0IG5vZGUgPSBkYXRhLm5vZGU7CiAgICBjb25zdCBjb250YWluZXIgPSBkYXRhLmludG9GcmFnbWVudCA/IGRvY3VtZW50LmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKSA6IG5vZGU7CiAgICBjb25zdCBpc0FwcGx5aW5nID0gZGF0YS5pc0FwcGx5aW5nOwogICAgbGV0IGNoaWxkSW5kZXggPSAwOwoKICAgIGZvciAoY29uc3QgY2hpbGQgb2YgdGhpcy5jaGlsZHJlbikgewogICAgICBpZiAoaXNWaWV3Q29sbGVjdGlvbihjaGlsZCkpIHsKICAgICAgICBpZiAoIWlzQXBwbHlpbmcpIHsKICAgICAgICAgIGNoaWxkLnNldFBhcmVudChub2RlKTsgLy8gTm90ZTogVmlld0NvbGxlY3Rpb24gcmVuZGVycyBpdHMgY2hpbGRyZW4uCgogICAgICAgICAgZm9yIChjb25zdCB2aWV3IG9mIGNoaWxkKSB7CiAgICAgICAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZCh2aWV3LmVsZW1lbnQpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSBlbHNlIGlmIChpc1ZpZXcoY2hpbGQpKSB7CiAgICAgICAgaWYgKCFpc0FwcGx5aW5nKSB7CiAgICAgICAgICBpZiAoIWNoaWxkLmlzUmVuZGVyZWQpIHsKICAgICAgICAgICAgY2hpbGQucmVuZGVyKCk7CiAgICAgICAgICB9CgogICAgICAgICAgY29udGFpbmVyLmFwcGVuZENoaWxkKGNoaWxkLmVsZW1lbnQpOwogICAgICAgIH0KICAgICAgfSBlbHNlIGlmIChpc05vZGUoY2hpbGQpKSB7CiAgICAgICAgY29udGFpbmVyLmFwcGVuZENoaWxkKGNoaWxkKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBpZiAoaXNBcHBseWluZykgewogICAgICAgICAgY29uc3QgcmV2ZXJ0RGF0YSA9IGRhdGEucmV2ZXJ0RGF0YTsKICAgICAgICAgIGNvbnN0IGNoaWxkUmV2ZXJ0RGF0YSA9IGdldEVtcHR5UmV2ZXJ0RGF0YSgpOwogICAgICAgICAgcmV2ZXJ0RGF0YS5jaGlsZHJlbi5wdXNoKGNoaWxkUmV2ZXJ0RGF0YSk7CgogICAgICAgICAgY2hpbGQuX3JlbmRlck5vZGUoewogICAgICAgICAgICBub2RlOiBjb250YWluZXIuY2hpbGROb2Rlc1tjaGlsZEluZGV4KytdLAogICAgICAgICAgICBpc0FwcGx5aW5nOiB0cnVlLAogICAgICAgICAgICByZXZlcnREYXRhOiBjaGlsZFJldmVydERhdGEKICAgICAgICAgIH0pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQoY2hpbGQucmVuZGVyKCkpOwogICAgICAgIH0KICAgICAgfQogICAgfQoKICAgIGlmIChkYXRhLmludG9GcmFnbWVudCkgewogICAgICBub2RlLmFwcGVuZENoaWxkKGNvbnRhaW5lcik7CiAgICB9CiAgfQogIC8qKgogICAqIEFjdGl2YXRlcyBgb25gIGV2ZW50IGxpc3RlbmVycyBmcm9tIHRoZSB7QGxpbmsgbW9kdWxlOnVpL3RlbXBsYXRlflRlbXBsYXRlRGVmaW5pdGlvbn0KICAgKiBvbiBhbiBIVE1MIGVsZW1lbnQuCiAgICoKICAgKiBAcHJvdGVjdGVkCiAgICogQHBhcmFtIHttb2R1bGU6dWkvdGVtcGxhdGV+UmVuZGVyRGF0YX0gZGF0YSBSZW5kZXJpbmcgZGF0YS4KICAgKi8KCgogIF9zZXRVcExpc3RlbmVycyhkYXRhKSB7CiAgICBpZiAoIXRoaXMuZXZlbnRMaXN0ZW5lcnMpIHsKICAgICAgcmV0dXJuOwogICAgfQoKICAgIGZvciAoY29uc3Qga2V5IGluIHRoaXMuZXZlbnRMaXN0ZW5lcnMpIHsKICAgICAgY29uc3QgcmV2ZXJ0QmluZGluZ3MgPSB0aGlzLmV2ZW50TGlzdGVuZXJzW2tleV0ubWFwKHNjaGVtYUl0ZW0gPT4gewogICAgICAgIGNvbnN0IFtkb21FdnROYW1lLCBkb21TZWxlY3Rvcl0gPSBrZXkuc3BsaXQoJ0AnKTsKICAgICAgICByZXR1cm4gc2NoZW1hSXRlbS5hY3RpdmF0ZURvbUV2ZW50TGlzdGVuZXIoZG9tRXZ0TmFtZSwgZG9tU2VsZWN0b3IsIGRhdGEpOwogICAgICB9KTsKCiAgICAgIGlmIChkYXRhLnJldmVydERhdGEpIHsKICAgICAgICBkYXRhLnJldmVydERhdGEuYmluZGluZ3MucHVzaChyZXZlcnRCaW5kaW5ncyk7CiAgICAgIH0KICAgIH0KICB9CiAgLyoqCiAgICogRm9yIGEgZ2l2ZW4ge0BsaW5rIG1vZHVsZTp1aS90ZW1wbGF0ZX5UZW1wbGF0ZVZhbHVlU2NoZW1hfSBjb250YWluaW5nIHtAbGluayBtb2R1bGU6dWkvdGVtcGxhdGV+VGVtcGxhdGVCaW5kaW5nfQogICAqIGFjdGl2YXRlcyB0aGUgYmluZGluZyBhbmQgc2V0cyBpdHMgaW5pdGlhbCB2YWx1ZS4KICAgKgogICAqIE5vdGU6IHtAbGluayBtb2R1bGU6dWkvdGVtcGxhdGV+VGVtcGxhdGVWYWx1ZVNjaGVtYX0gY2FuIGJlIGZvciBIVE1MIGVsZW1lbnQgYXR0cmlidXRlcyBvcgogICAqIHRleHQgbm9kZSBgdGV4dENvbnRlbnRgLgogICAqCiAgICogQHByb3RlY3RlZAogICAqIEBwYXJhbSB7T2JqZWN0fSBvcHRpb25zIEJpbmRpbmcgb3B0aW9ucy4KICAgKiBAcGFyYW0ge21vZHVsZTp1aS90ZW1wbGF0ZX5UZW1wbGF0ZVZhbHVlU2NoZW1hfSBvcHRpb25zLnNjaGVtYQogICAqIEBwYXJhbSB7RnVuY3Rpb259IG9wdGlvbnMudXBkYXRlciBBIGZ1bmN0aW9uIHdoaWNoIHVwZGF0ZXMgdGhlIERPTSAobGlrZSBhdHRyaWJ1dGUgb3IgdGV4dCkuCiAgICogQHBhcmFtIHttb2R1bGU6dWkvdGVtcGxhdGV+UmVuZGVyRGF0YX0gb3B0aW9ucy5kYXRhIFJlbmRlcmluZyBkYXRhLgogICAqLwoKCiAgX2JpbmRUb09ic2VydmFibGUoewogICAgc2NoZW1hLAogICAgdXBkYXRlciwKICAgIGRhdGEKICB9KSB7CiAgICBjb25zdCByZXZlcnREYXRhID0gZGF0YS5yZXZlcnREYXRhOyAvLyBTZXQgaW5pdGlhbCB2YWx1ZXMuCgogICAgc3luY1ZhbHVlU2NoZW1hVmFsdWUoc2NoZW1hLCB1cGRhdGVyLCBkYXRhKTsKICAgIGNvbnN0IHJldmVydEJpbmRpbmdzID0gc2NoZW1hIC8vIEZpbHRlciAiZmFsc3kiIChmYWxzZSwgdW5kZWZpbmVkLCBudWxsLCAnJykgdmFsdWUgc2NoZW1hIGNvbXBvbmVudHMgb3V0LgogICAgLmZpbHRlcihpdGVtID0+ICFpc0ZhbHN5KGl0ZW0pKSAvLyBGaWx0ZXIgaW5hY3RpdmUgYmluZGluZ3MgZnJvbSBzY2hlbWEsIGxpa2Ugc3RhdGljIHN0cmluZ3MgKCdmb28nKSwgbnVtYmVycyAoNDIpLCBldGMuCiAgICAuZmlsdGVyKGl0ZW0gPT4gaXRlbS5vYnNlcnZhYmxlKSAvLyBPbmNlIG9ubHkgdGhlIGFjdHVhbCBiaW5kaW5nIGFyZSBsZWZ0LCBsZXQgdGhlIGVtaXR0ZXIgbGlzdGVuIHRvIG9ic2VydmFibGUgY2hhbmdlOmF0dHJpYnV0ZSBldmVudC4KICAgIC8vIFRPRE86IFJlZHVjZSB0aGUgbnVtYmVyIG9mIGxpc3RlbmVycyBhdHRhY2hlZCBhcyBtYW55IGJpbmRpbmdzIG1heSBsaXN0ZW4KICAgIC8vIHRvIHRoZSBzYW1lIG9ic2VydmFibGUgYXR0cmlidXRlLgogICAgLm1hcCh0ZW1wbGF0ZUJpbmRpbmcgPT4gdGVtcGxhdGVCaW5kaW5nLmFjdGl2YXRlQXR0cmlidXRlTGlzdGVuZXIoc2NoZW1hLCB1cGRhdGVyLCBkYXRhKSk7CgogICAgaWYgKHJldmVydERhdGEpIHsKICAgICAgcmV2ZXJ0RGF0YS5iaW5kaW5ncy5wdXNoKHJldmVydEJpbmRpbmdzKTsKICAgIH0KICB9CiAgLyoqCiAgICogUmV2ZXJ0cyB7QGxpbmsgbW9kdWxlOnVpL3RlbXBsYXRlflJlbmRlckRhdGEjcmV2ZXJ0RGF0YSB0ZW1wbGF0ZSBkYXRhfSBmcm9tIGEgbm9kZSB0bwogICAqIHJldHVybiBpdCB0byB0aGUgb3JpZ2luYWwgc3RhdGUuCiAgICoKICAgKiBAcHJvdGVjdGVkCiAgICogQHBhcmFtIHtIVE1MRWxlbWVudHxUZXh0fSBub2RlIEEgbm9kZSB0byBiZSByZXZlcnRlZC4KICAgKiBAcGFyYW0ge09iamVjdH0gcmV2ZXJ0RGF0YSBBbiBvYmplY3QgdGhhdCBzdG9yZXMgaW5mb3JtYXRpb24gYWJvdXQgd2hhdCBjaGFuZ2VzIGhhdmUgYmVlbiBtYWRlIGJ5CiAgICoge0BsaW5rICNhcHBseX0gdG8gdGhlIG5vZGUuIFNlZSB7QGxpbmsgbW9kdWxlOnVpL3RlbXBsYXRlflJlbmRlckRhdGEjcmV2ZXJ0RGF0YX0gZm9yIG1vcmUgaW5mb3JtYXRpb24uCiAgICovCgoKICBfcmV2ZXJ0VGVtcGxhdGVGcm9tTm9kZShub2RlLCByZXZlcnREYXRhKSB7CiAgICBmb3IgKGNvbnN0IGJpbmRpbmcgb2YgcmV2ZXJ0RGF0YS5iaW5kaW5ncykgewogICAgICAvLyBFYWNoIGJpbmRpbmcgbWF5IGNvbnNpc3Qgb2Ygc2V2ZXJhbCBvYnNlcnZhYmxlK29ic2VydmFibGUjYXR0cmlidXRlLgogICAgICAvLyBsaWtlIHRoZSBmb2xsb3dpbmcgaGFzIDI6CiAgICAgIC8vCiAgICAgIC8vCQljbGFzczogWwogICAgICAvLwkJCSd4JywKICAgICAgLy8JCQliaW5kLnRvKCAnZm9vJyApLAogICAgICAvLwkJCSd5JywKICAgICAgLy8JCQliaW5kLnRvKCAnYmFyJyApCiAgICAgIC8vCQldCiAgICAgIC8vCiAgICAgIGZvciAoY29uc3QgcmV2ZXJ0QmluZGluZyBvZiBiaW5kaW5nKSB7CiAgICAgICAgcmV2ZXJ0QmluZGluZygpOwogICAgICB9CiAgICB9CgogICAgaWYgKHJldmVydERhdGEudGV4dCkgewogICAgICBub2RlLnRleHRDb250ZW50ID0gcmV2ZXJ0RGF0YS50ZXh0OwogICAgICByZXR1cm47CiAgICB9CgogICAgZm9yIChjb25zdCBhdHRyTmFtZSBpbiByZXZlcnREYXRhLmF0dHJpYnV0ZXMpIHsKICAgICAgY29uc3QgYXR0clZhbHVlID0gcmV2ZXJ0RGF0YS5hdHRyaWJ1dGVzW2F0dHJOYW1lXTsgLy8gV2hlbiB0aGUgYXR0cmlidXRlIGhhcyAqKm5vdCoqIGJlZW4gc2V0IGJlZm9yZSAjYXBwbHkoKS4KCiAgICAgIGlmIChhdHRyVmFsdWUgPT09IG51bGwpIHsKICAgICAgICBub2RlLnJlbW92ZUF0dHJpYnV0ZShhdHRyTmFtZSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgbm9kZS5zZXRBdHRyaWJ1dGUoYXR0ck5hbWUsIGF0dHJWYWx1ZSk7CiAgICAgIH0KICAgIH0KCiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHJldmVydERhdGEuY2hpbGRyZW4ubGVuZ3RoOyArK2kpIHsKICAgICAgdGhpcy5fcmV2ZXJ0VGVtcGxhdGVGcm9tTm9kZShub2RlLmNoaWxkTm9kZXNbaV0sIHJldmVydERhdGEuY2hpbGRyZW5baV0pOwogICAgfQogIH0KCn0KbWl4KFRlbXBsYXRlLCBFbWl0dGVyTWl4aW4pOwovKioKICogRGVzY3JpYmVzIGEgYmluZGluZyBjcmVhdGVkIGJ5IHRoZSB7QGxpbmsgbW9kdWxlOnVpL3RlbXBsYXRlflRlbXBsYXRlLmJpbmR9IGludGVyZmFjZS4KICoKICogQHByb3RlY3RlZAogKi8KCmV4cG9ydCBjbGFzcyBUZW1wbGF0ZUJpbmRpbmcgewogIC8qKgogICAqIENyZWF0ZXMgYW4gaW5zdGFuY2Ugb2YgdGhlIHtAbGluayBtb2R1bGU6dWkvdGVtcGxhdGV+VGVtcGxhdGVCaW5kaW5nfSBjbGFzcy4KICAgKgogICAqIEBwYXJhbSB7bW9kdWxlOnVpL3RlbXBsYXRlflRlbXBsYXRlRGVmaW5pdGlvbn0gZGVmIFRoZSBkZWZpbml0aW9uIG9mIHRoZSBiaW5kaW5nLgogICAqLwogIGNvbnN0cnVjdG9yKGRlZikgewogICAgT2JqZWN0LmFzc2lnbih0aGlzLCBkZWYpOwogICAgLyoqCiAgICAgKiBBbiBvYnNlcnZhYmxlIGluc3RhbmNlIG9mIHRoZSBiaW5kaW5nLiBJdCBlaXRoZXI6CiAgICAgKgogICAgICogKiBwcm92aWRlcyB0aGUgYXR0cmlidXRlIHdpdGggdGhlIHZhbHVlLAogICAgICogKiBvciBwYXNzZXMgdGhlIGV2ZW50IHdoZW4gYSBjb3JyZXNwb25kaW5nIERPTSBldmVudCBpcyBmaXJlZC4KICAgICAqCiAgICAgKiBAbWVtYmVyIHttb2R1bGU6dXRpbHMvb2JzZXJ2YWJsZW1peGlufk9ic2VydmFibGVNaXhpbn0gbW9kdWxlOnVpL3RlbXBsYXRlflRlbXBsYXRlQmluZGluZyNvYnNlcnZhYmxlCiAgICAgKi8KCiAgICAvKioKICAgICAqIEFuIHtAbGluayBtb2R1bGU6dXRpbHMvZW1pdHRlcm1peGlufkVtaXR0ZXJ9IHVzZWQgYnkgdGhlIGJpbmRpbmcgdG86CiAgICAgKgogICAgICogKiBsaXN0ZW4gdG8gdGhlIGF0dHJpYnV0ZSBjaGFuZ2UgaW4gdGhlIHtAbGluayBtb2R1bGU6dWkvdGVtcGxhdGV+VGVtcGxhdGVCaW5kaW5nI29ic2VydmFibGV9LAogICAgICogKiBvciBsaXN0ZW4gdG8gdGhlIGV2ZW50IGluIHRoZSBET00uCiAgICAgKgogICAgICogQG1lbWJlciB7bW9kdWxlOnV0aWxzL2VtaXR0ZXJtaXhpbn5FbWl0dGVyTWl4aW59IG1vZHVsZTp1aS90ZW1wbGF0ZX5UZW1wbGF0ZUJpbmRpbmcjZW1pdHRlcgogICAgICovCgogICAgLyoqCiAgICAgKiBUaGUgbmFtZSBvZiB0aGUge0BsaW5rIG1vZHVsZTp1aS90ZW1wbGF0ZX5UZW1wbGF0ZUJpbmRpbmcjb2JzZXJ2YWJsZSBvYnNlcnZlZCBhdHRyaWJ1dGV9LgogICAgICoKICAgICAqIEBtZW1iZXIge1N0cmluZ30gbW9kdWxlOnVpL3RlbXBsYXRlflRlbXBsYXRlQmluZGluZyNhdHRyaWJ1dGUKICAgICAqLwoKICAgIC8qKgogICAgICogQSBjdXN0b20gZnVuY3Rpb24gdG8gcHJvY2VzcyB0aGUgdmFsdWUgb2YgdGhlIHtAbGluayBtb2R1bGU6dWkvdGVtcGxhdGV+VGVtcGxhdGVCaW5kaW5nI2F0dHJpYnV0ZX0uCiAgICAgKgogICAgICogQG1lbWJlciB7RnVuY3Rpb259IFttb2R1bGU6dWkvdGVtcGxhdGV+VGVtcGxhdGVCaW5kaW5nI2NhbGxiYWNrXQogICAgICovCiAgfQogIC8qKgogICAqIFJldHVybnMgdGhlIHZhbHVlIG9mIHRoZSBiaW5kaW5nLiBJdCBpcyB0aGUgdmFsdWUgb2YgdGhlIHtAbGluayBtb2R1bGU6dWkvdGVtcGxhdGV+VGVtcGxhdGVCaW5kaW5nI2F0dHJpYnV0ZX0gaW4KICAgKiB7QGxpbmsgbW9kdWxlOnVpL3RlbXBsYXRlflRlbXBsYXRlQmluZGluZyNvYnNlcnZhYmxlfS4gVGhlIHZhbHVlIG1heSBiZSBwcm9jZXNzZWQgYnkgdGhlCiAgICoge0BsaW5rIG1vZHVsZTp1aS90ZW1wbGF0ZX5UZW1wbGF0ZUJpbmRpbmcjY2FsbGJhY2t9LCBpZiBzdWNoIGhhcyBiZWVuIHBhc3NlZCB0byB0aGUgYmluZGluZy4KICAgKgogICAqIEBwYXJhbSB7Tm9kZX0gW25vZGVdIEEgbmF0aXZlIERPTSBub2RlLCBwYXNzZWQgdG8gdGhlIGN1c3RvbSB7QGxpbmsgbW9kdWxlOnVpL3RlbXBsYXRlflRlbXBsYXRlQmluZGluZyNjYWxsYmFja30uCiAgICogQHJldHVybnMgeyp9IFRoZSB2YWx1ZSBvZiB7QGxpbmsgbW9kdWxlOnVpL3RlbXBsYXRlflRlbXBsYXRlQmluZGluZyNhdHRyaWJ1dGV9IGluCiAgICoge0BsaW5rIG1vZHVsZTp1aS90ZW1wbGF0ZX5UZW1wbGF0ZUJpbmRpbmcjb2JzZXJ2YWJsZX0uCiAgICovCgoKICBnZXRWYWx1ZShub2RlKSB7CiAgICBjb25zdCB2YWx1ZSA9IHRoaXMub2JzZXJ2YWJsZVt0aGlzLmF0dHJpYnV0ZV07CiAgICByZXR1cm4gdGhpcy5jYWxsYmFjayA/IHRoaXMuY2FsbGJhY2sodmFsdWUsIG5vZGUpIDogdmFsdWU7CiAgfQogIC8qKgogICAqIEFjdGl2YXRlcyB0aGUgbGlzdGVuZXIgd2hpY2ggd2FpdHMgZm9yIGNoYW5nZXMgb2YgdGhlIHtAbGluayBtb2R1bGU6dWkvdGVtcGxhdGV+VGVtcGxhdGVCaW5kaW5nI2F0dHJpYnV0ZX0gaW4KICAgKiB7QGxpbmsgbW9kdWxlOnVpL3RlbXBsYXRlflRlbXBsYXRlQmluZGluZyNvYnNlcnZhYmxlfSwgdGhlbiB1cGRhdGVzIHRoZSBET00gd2l0aCB0aGUgYWdncmVnYXRlZAogICAqIHZhbHVlIG9mIHtAbGluayBtb2R1bGU6dWkvdGVtcGxhdGV+VGVtcGxhdGVWYWx1ZVNjaGVtYX0uCiAgICoKICAgKiBAcGFyYW0ge21vZHVsZTp1aS90ZW1wbGF0ZX5UZW1wbGF0ZVZhbHVlU2NoZW1hfSBzY2hlbWEgQSBmdWxsIHNjaGVtYSB0byBnZW5lcmF0ZSBhbiBhdHRyaWJ1dGUgb3IgdGV4dCBpbiB0aGUgRE9NLgogICAqIEBwYXJhbSB7RnVuY3Rpb259IHVwZGF0ZXIgQSBET00gdXBkYXRlciBmdW5jdGlvbiB1c2VkIHRvIHVwZGF0ZSB0aGUgbmF0aXZlIERPTSBhdHRyaWJ1dGUgb3IgdGV4dC4KICAgKiBAcGFyYW0ge21vZHVsZTp1aS90ZW1wbGF0ZX5SZW5kZXJEYXRhfSBkYXRhIFJlbmRlcmluZyBkYXRhLgogICAqIEByZXR1cm5zIHtGdW5jdGlvbn0gQSBmdW5jdGlvbiB0byBzZXZlciB0aGUgbGlzdGVuZXIgYmluZGluZy4KICAgKi8KCgogIGFjdGl2YXRlQXR0cmlidXRlTGlzdGVuZXIoc2NoZW1hLCB1cGRhdGVyLCBkYXRhKSB7CiAgICBjb25zdCBjYWxsYmFjayA9ICgpID0+IHN5bmNWYWx1ZVNjaGVtYVZhbHVlKHNjaGVtYSwgdXBkYXRlciwgZGF0YSk7CgogICAgdGhpcy5lbWl0dGVyLmxpc3RlblRvKHRoaXMub2JzZXJ2YWJsZSwgJ2NoYW5nZTonICsgdGhpcy5hdHRyaWJ1dGUsIGNhbGxiYWNrKTsgLy8gQWxsb3dzIHJldmVydCBvZiB0aGUgbGlzdGVuZXIuCgogICAgcmV0dXJuICgpID0+IHsKICAgICAgdGhpcy5lbWl0dGVyLnN0b3BMaXN0ZW5pbmcodGhpcy5vYnNlcnZhYmxlLCAnY2hhbmdlOicgKyB0aGlzLmF0dHJpYnV0ZSwgY2FsbGJhY2spOwogICAgfTsKICB9Cgp9Ci8qKgogKiBEZXNjcmliZXMgZWl0aGVyOgogKgogKiAqIGEgYmluZGluZyB0byBhbiB7QGxpbmsgbW9kdWxlOnV0aWxzL29ic2VydmFibGVtaXhpbn5PYnNlcnZhYmxlfSwKICogKiBvciBhIG5hdGl2ZSBET00gZXZlbnQgYmluZGluZy4KICoKICogSXQgaXMgY3JlYXRlZCBieSB0aGUge0BsaW5rIG1vZHVsZTp1aS90ZW1wbGF0ZX5CaW5kQ2hhaW4jdG99IG1ldGhvZC4KICoKICogQHByb3RlY3RlZAogKi8KCmV4cG9ydCBjbGFzcyBUZW1wbGF0ZVRvQmluZGluZyBleHRlbmRzIFRlbXBsYXRlQmluZGluZyB7CiAgLyoqCiAgICogQWN0aXZhdGVzIHRoZSBsaXN0ZW5lciBmb3IgdGhlIG5hdGl2ZSBET00gZXZlbnQsIHdoaWNoIHdoZW4gZmlyZWQsIGlzIHByb3BhZ2F0ZWQgYnkKICAgKiB0aGUge0BsaW5rIG1vZHVsZTp1aS90ZW1wbGF0ZX5UZW1wbGF0ZUJpbmRpbmcjZW1pdHRlcn0uCiAgICoKICAgKiBAcGFyYW0ge1N0cmluZ30gZG9tRXZ0TmFtZSBUaGUgbmFtZSBvZiB0aGUgbmF0aXZlIERPTSBldmVudC4KICAgKiBAcGFyYW0ge1N0cmluZ30gZG9tU2VsZWN0b3IgVGhlIHNlbGVjdG9yIGluIHRoZSBET00gdG8gZmlsdGVyIGRlbGVnYXRlZCBldmVudHMuCiAgICogQHBhcmFtIHttb2R1bGU6dWkvdGVtcGxhdGV+UmVuZGVyRGF0YX0gZGF0YSBSZW5kZXJpbmcgZGF0YS4KICAgKiBAcmV0dXJucyB7RnVuY3Rpb259IEEgZnVuY3Rpb24gdG8gc2V2ZXIgdGhlIGxpc3RlbmVyIGJpbmRpbmcuCiAgICovCiAgYWN0aXZhdGVEb21FdmVudExpc3RlbmVyKGRvbUV2dE5hbWUsIGRvbVNlbGVjdG9yLCBkYXRhKSB7CiAgICBjb25zdCBjYWxsYmFjayA9IChldnQsIGRvbUV2dCkgPT4gewogICAgICBpZiAoIWRvbVNlbGVjdG9yIHx8IGRvbUV2dC50YXJnZXQubWF0Y2hlcyhkb21TZWxlY3RvcikpIHsKICAgICAgICBpZiAodHlwZW9mIHRoaXMuZXZlbnROYW1lT3JGdW5jdGlvbiA9PSAnZnVuY3Rpb24nKSB7CiAgICAgICAgICB0aGlzLmV2ZW50TmFtZU9yRnVuY3Rpb24oZG9tRXZ0KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhpcy5vYnNlcnZhYmxlLmZpcmUodGhpcy5ldmVudE5hbWVPckZ1bmN0aW9uLCBkb21FdnQpOwogICAgICAgIH0KICAgICAgfQogICAgfTsKCiAgICB0aGlzLmVtaXR0ZXIubGlzdGVuVG8oZGF0YS5ub2RlLCBkb21FdnROYW1lLCBjYWxsYmFjayk7IC8vIEFsbG93cyByZXZlcnQgb2YgdGhlIGxpc3RlbmVyLgoKICAgIHJldHVybiAoKSA9PiB7CiAgICAgIHRoaXMuZW1pdHRlci5zdG9wTGlzdGVuaW5nKGRhdGEubm9kZSwgZG9tRXZ0TmFtZSwgY2FsbGJhY2spOwogICAgfTsKICB9Cgp9Ci8qKgogKiBEZXNjcmliZXMgYSBiaW5kaW5nIHRvIHtAbGluayBtb2R1bGU6dXRpbHMvb2JzZXJ2YWJsZW1peGlufk9ic2VydmFibGVNaXhpbn0gY3JlYXRlZCBieSB0aGUge0BsaW5rIG1vZHVsZTp1aS90ZW1wbGF0ZX5CaW5kQ2hhaW4jaWZ9CiAqIG1ldGhvZC4KICoKICogQHByb3RlY3RlZAogKi8KCmV4cG9ydCBjbGFzcyBUZW1wbGF0ZUlmQmluZGluZyBleHRlbmRzIFRlbXBsYXRlQmluZGluZyB7CiAgLyoqCiAgICogQGluaGVyaXREb2MKICAgKi8KICBnZXRWYWx1ZShub2RlKSB7CiAgICBjb25zdCB2YWx1ZSA9IHN1cGVyLmdldFZhbHVlKG5vZGUpOwogICAgcmV0dXJuIGlzRmFsc3kodmFsdWUpID8gZmFsc2UgOiB0aGlzLnZhbHVlSWZUcnVlIHx8IHRydWU7CiAgfQogIC8qKgogICAqIFRoZSB2YWx1ZSBvZiB0aGUgRE9NIGF0dHJpYnV0ZSBvciB0ZXh0IHRvIGJlIHNldCBpZiB0aGUge0BsaW5rIG1vZHVsZTp1aS90ZW1wbGF0ZX5UZW1wbGF0ZUJpbmRpbmcjYXR0cmlidXRlfSBpbgogICAqIHtAbGluayBtb2R1bGU6dWkvdGVtcGxhdGV+VGVtcGxhdGVCaW5kaW5nI29ic2VydmFibGV9IGlzIGB0cnVlYC4KICAgKgogICAqIEBtZW1iZXIge1N0cmluZ30gW21vZHVsZTp1aS90ZW1wbGF0ZX5UZW1wbGF0ZUlmQmluZGluZyN2YWx1ZUlmVHJ1ZV0KICAgKi8KCgp9IC8vIENoZWNrcyB3aGV0aGVyIGdpdmVuIHtAbGluayBtb2R1bGU6dWkvdGVtcGxhdGV+VGVtcGxhdGVWYWx1ZVNjaGVtYX0gY29udGFpbnMgYQovLyB7QGxpbmsgbW9kdWxlOnVpL3RlbXBsYXRlflRlbXBsYXRlQmluZGluZ30uCi8vCi8vIEBwYXJhbSB7bW9kdWxlOnVpL3RlbXBsYXRlflRlbXBsYXRlVmFsdWVTY2hlbWF9IHNjaGVtYQovLyBAcmV0dXJucyB7Qm9vbGVhbn0KCmZ1bmN0aW9uIGhhc1RlbXBsYXRlQmluZGluZyhzY2hlbWEpIHsKICBpZiAoIXNjaGVtYSkgewogICAgcmV0dXJuIGZhbHNlOwogIH0gLy8gTm9ybWFsaXplIGF0dHJpYnV0ZXMgd2l0aCBhZGRpdGlvbmFsIGRhdGEgbGlrZSBuYW1lc3BhY2U6CiAgLy8KICAvLwkJY2xhc3M6IHsKICAvLwkJCW5zOiAnYWJjJywKICAvLwkJCXZhbHVlOiBbIC4uLiBdCiAgLy8JCX0KICAvLwoKCiAgaWYgKHNjaGVtYS52YWx1ZSkgewogICAgc2NoZW1hID0gc2NoZW1hLnZhbHVlOwogIH0KCiAgaWYgKEFycmF5LmlzQXJyYXkoc2NoZW1hKSkgewogICAgcmV0dXJuIHNjaGVtYS5zb21lKGhhc1RlbXBsYXRlQmluZGluZyk7CiAgfSBlbHNlIGlmIChzY2hlbWEgaW5zdGFuY2VvZiBUZW1wbGF0ZUJpbmRpbmcpIHsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgcmV0dXJuIGZhbHNlOwp9IC8vIEFzc2VtYmxlcyB0aGUgdmFsdWUgdXNpbmcge0BsaW5rIG1vZHVsZTp1aS90ZW1wbGF0ZX5UZW1wbGF0ZVZhbHVlU2NoZW1hfSBhbmQgc3RvcmVzIGl0IGluIGEgZm9ybSBvZgovLyBhbiBBcnJheS4gRWFjaCBlbnRyeSBvZiB0aGUgQXJyYXkgY29ycmVzcG9uZHMgdG8gb25lIG9mIHtAbGluayBtb2R1bGU6dWkvdGVtcGxhdGV+VGVtcGxhdGVWYWx1ZVNjaGVtYX0KLy8gaXRlbXMuCi8vCi8vIEBwYXJhbSB7bW9kdWxlOnVpL3RlbXBsYXRlflRlbXBsYXRlVmFsdWVTY2hlbWF9IHNjaGVtYQovLyBAcGFyYW0ge05vZGV9IG5vZGUgRE9NIE5vZGUgdXBkYXRlZCB3aGVuIHtAbGluayBtb2R1bGU6dXRpbHMvb2JzZXJ2YWJsZW1peGlufk9ic2VydmFibGVNaXhpbn0gY2hhbmdlcy4KLy8gQHJldHVybnMge0FycmF5fQoKCmZ1bmN0aW9uIGdldFZhbHVlU2NoZW1hVmFsdWUoc2NoZW1hLCBub2RlKSB7CiAgcmV0dXJuIHNjaGVtYS5tYXAoc2NoZW1hSXRlbSA9PiB7CiAgICAvLyBQcm9jZXNzIHtAbGluayBtb2R1bGU6dWkvdGVtcGxhdGV+VGVtcGxhdGVCaW5kaW5nfSBiaW5kaW5ncy4KICAgIGlmIChzY2hlbWFJdGVtIGluc3RhbmNlb2YgVGVtcGxhdGVCaW5kaW5nKSB7CiAgICAgIHJldHVybiBzY2hlbWFJdGVtLmdldFZhbHVlKG5vZGUpOwogICAgfSAvLyBBbGwgc3RhdGljIHZhbHVlcyBsaWtlIHN0cmluZ3MsIG51bWJlcnMsIGFuZCAiZmFsc3kiIHZhbHVlcyAoZmFsc2UsIG51bGwsIHVuZGVmaW5lZCwgJycsIGV0Yy4pIGp1c3QgcGFzcy4KCgogICAgcmV0dXJuIHNjaGVtYUl0ZW07CiAgfSk7Cn0gLy8gQSBmdW5jdGlvbiBleGVjdXRlZCBlYWNoIHRpbWUgdGhlIGJvdW5kIE9ic2VydmFibGUgYXR0cmlidXRlIGNoYW5nZXMsIHdoaWNoIHVwZGF0ZXMgdGhlIERPTSB3aXRoIGEgdmFsdWUKLy8gY29uc3RydWN0ZWQgZnJvbSB7QGxpbmsgbW9kdWxlOnVpL3RlbXBsYXRlflRlbXBsYXRlVmFsdWVTY2hlbWF9LgovLwovLyBAcGFyYW0ge21vZHVsZTp1aS90ZW1wbGF0ZX5UZW1wbGF0ZVZhbHVlU2NoZW1hfSBzY2hlbWEKLy8gQHBhcmFtIHtGdW5jdGlvbn0gdXBkYXRlciBBIGZ1bmN0aW9uIHdoaWNoIHVwZGF0ZXMgdGhlIERPTSAobGlrZSBhdHRyaWJ1dGUgb3IgdGV4dCkuCi8vIEBwYXJhbSB7Tm9kZX0gbm9kZSBET00gTm9kZSB1cGRhdGVkIHdoZW4ge0BsaW5rIG1vZHVsZTp1dGlscy9vYnNlcnZhYmxlbWl4aW5+T2JzZXJ2YWJsZU1peGlufSBjaGFuZ2VzLgoKCmZ1bmN0aW9uIHN5bmNWYWx1ZVNjaGVtYVZhbHVlKHNjaGVtYSwgdXBkYXRlciwgewogIG5vZGUKfSkgewogIGxldCB2YWx1ZSA9IGdldFZhbHVlU2NoZW1hVmFsdWUoc2NoZW1hLCBub2RlKTsgLy8gQ2hlY2sgaWYgc2NoZW1hIGlzIGEgc2luZ2xlIFRlbXBsYXRlLmJpbmQuaWYsIGxpa2U6CiAgLy8KICAvLwkJY2xhc3M6IFRlbXBsYXRlLmJpbmQuaWYoICdmb28nICkKICAvLwoKICBpZiAoc2NoZW1hLmxlbmd0aCA9PSAxICYmIHNjaGVtYVswXSBpbnN0YW5jZW9mIFRlbXBsYXRlSWZCaW5kaW5nKSB7CiAgICB2YWx1ZSA9IHZhbHVlWzBdOwogIH0gZWxzZSB7CiAgICB2YWx1ZSA9IHZhbHVlLnJlZHVjZShhcnJheVZhbHVlUmVkdWNlciwgJycpOwogIH0KCiAgaWYgKGlzRmFsc3kodmFsdWUpKSB7CiAgICB1cGRhdGVyLnJlbW92ZSgpOwogIH0gZWxzZSB7CiAgICB1cGRhdGVyLnNldCh2YWx1ZSk7CiAgfQp9IC8vIFJldHVybnMgYW4gb2JqZWN0IGNvbnNpc3Rpbmcgb2YgYHNldGAgYW5kIGByZW1vdmVgIGZ1bmN0aW9ucywgd2hpY2gKLy8gY2FuIGJlIHVzZWQgaW4gdGhlIGNvbnRleHQgb2YgRE9NIE5vZGUgdG8gc2V0IG9yIHJlc2V0IGB0ZXh0Q29udGVudGAuCi8vIEBzZWUgbW9kdWxlOnVpL3ZpZXd+VmlldyNfYmluZFRvT2JzZXJ2YWJsZQovLwovLyBAcGFyYW0ge05vZGV9IG5vZGUgRE9NIE5vZGUgdG8gYmUgbW9kaWZpZWQuCi8vIEByZXR1cm5zIHtPYmplY3R9CgoKZnVuY3Rpb24gZ2V0VGV4dFVwZGF0ZXIobm9kZSkgewogIHJldHVybiB7CiAgICBzZXQodmFsdWUpIHsKICAgICAgbm9kZS50ZXh0Q29udGVudCA9IHZhbHVlOwogICAgfSwKCiAgICByZW1vdmUoKSB7CiAgICAgIG5vZGUudGV4dENvbnRlbnQgPSAnJzsKICAgIH0KCiAgfTsKfSAvLyBSZXR1cm5zIGFuIG9iamVjdCBjb25zaXN0aW5nIG9mIGBzZXRgIGFuZCBgcmVtb3ZlYCBmdW5jdGlvbnMsIHdoaWNoCi8vIGNhbiBiZSB1c2VkIGluIHRoZSBjb250ZXh0IG9mIERPTSBOb2RlIHRvIHNldCBvciByZXNldCBhbiBhdHRyaWJ1dGUuCi8vIEBzZWUgbW9kdWxlOnVpL3ZpZXd+VmlldyNfYmluZFRvT2JzZXJ2YWJsZQovLwovLyBAcGFyYW0ge05vZGV9IG5vZGUgRE9NIE5vZGUgdG8gYmUgbW9kaWZpZWQuCi8vIEBwYXJhbSB7U3RyaW5nfSBhdHRyTmFtZSBOYW1lIG9mIHRoZSBhdHRyaWJ1dGUgdG8gYmUgbW9kaWZpZWQuCi8vIEBwYXJhbSB7U3RyaW5nfSBbbnM9bnVsbF0gTmFtZXNwYWNlIHRvIHVzZS4KLy8gQHJldHVybnMge09iamVjdH0KCgpmdW5jdGlvbiBnZXRBdHRyaWJ1dGVVcGRhdGVyKGVsLCBhdHRyTmFtZSwgbnMpIHsKICByZXR1cm4gewogICAgc2V0KHZhbHVlKSB7CiAgICAgIGVsLnNldEF0dHJpYnV0ZU5TKG5zLCBhdHRyTmFtZSwgdmFsdWUpOwogICAgfSwKCiAgICByZW1vdmUoKSB7CiAgICAgIGVsLnJlbW92ZUF0dHJpYnV0ZU5TKG5zLCBhdHRyTmFtZSk7CiAgICB9CgogIH07Cn0gLy8gUmV0dXJucyBhbiBvYmplY3QgY29uc2lzdGluZyBvZiBgc2V0YCBhbmQgYHJlbW92ZWAgZnVuY3Rpb25zLCB3aGljaAovLyBjYW4gYmUgdXNlZCBpbiB0aGUgY29udGV4dCBvZiBDU1NTdHlsZURlY2xhcmF0aW9uIHRvIHNldCBvciByZW1vdmUgYSBzdHlsZS4KLy8gQHNlZSBtb2R1bGU6dWkvdmlld35WaWV3I19iaW5kVG9PYnNlcnZhYmxlCi8vCi8vIEBwYXJhbSB7Tm9kZX0gbm9kZSBET00gTm9kZSB0byBiZSBtb2RpZmllZC4KLy8gQHBhcmFtIHtTdHJpbmd9IHN0eWxlTmFtZSBOYW1lIG9mIHRoZSBzdHlsZSB0byBiZSBtb2RpZmllZC4KLy8gQHJldHVybnMge09iamVjdH0KCgpmdW5jdGlvbiBnZXRTdHlsZVVwZGF0ZXIoZWwsIHN0eWxlTmFtZSkgewogIHJldHVybiB7CiAgICBzZXQodmFsdWUpIHsKICAgICAgZWwuc3R5bGVbc3R5bGVOYW1lXSA9IHZhbHVlOwogICAgfSwKCiAgICByZW1vdmUoKSB7CiAgICAgIGVsLnN0eWxlW3N0eWxlTmFtZV0gPSBudWxsOwogICAgfQoKICB9Owp9IC8vIENsb25lcyBkZWZpbml0aW9uIG9mIHRoZSB0ZW1wbGF0ZS4KLy8KLy8gQHBhcmFtIHttb2R1bGU6dWkvdGVtcGxhdGV+VGVtcGxhdGVEZWZpbml0aW9ufSBkZWYKLy8gQHJldHVybnMge21vZHVsZTp1aS90ZW1wbGF0ZX5UZW1wbGF0ZURlZmluaXRpb259CgoKZnVuY3Rpb24gY2xvbmUoZGVmKSB7CiAgY29uc3QgY2xvbmUgPSBjbG9uZURlZXBXaXRoKGRlZiwgdmFsdWUgPT4gewogICAgLy8gRG9uJ3QgY2xvbmUgdGhlIGBUZW1wbGF0ZS5iaW5kYCogYmluZGluZ3MgYmVjYXVzZSBvZiB0aGUgcmVmZXJlbmNlcyB0byBPYnNlcnZhYmxlCiAgICAvLyBhbmQgRG9tRW1pdHRlck1peGluIGluc3RhbmNlcyBpbnNpZGUsIHdoaWNoIHdvdWxkIGFsc28gYmUgdHJhdmVyc2VkIGFuZCBjbG9uZWQgYnkgZ3JlZWR5CiAgICAvLyBjbG9uZURlZXBXaXRoIGFsZ29yaXRobS4gVGhlcmUncyBubyBwb2ludCBpbiBjbG9uaW5nIE9ic2VydmFibGUvRG9tRW1pdHRlck1peGlucwogICAgLy8gYWxvbmcgd2l0aCB0aGUgZGVmaW5pdGlvbi4KICAgIC8vCiAgICAvLyBEb24ndCBjbG9uZSBUZW1wbGF0ZSBpbnN0YW5jZXMgaWYgcHJvdmlkZWQgYXMgYSBjaGlsZC4gVGhleSdyZSBzaW1wbHkgI3JlbmRlcigpZWQKICAgIC8vIGFuZCBub3RoaW5nIHNob3VsZCBpbnRlcmZlcmUuCiAgICAvLwogICAgLy8gQWxzbyBkb24ndCBjbG9uZSBWaWV3IGluc3RhbmNlcyBpZiBwcm92aWRlZCBhcyBhIGNoaWxkIG9mIHRoZSBUZW1wbGF0ZS4gVGhlIHRlbXBsYXRlCiAgICAvLyBpbnN0YW5jZSB3aWxsIGJlIGV4dHJhY3RlZCBmcm9tIHRoZSBWaWV3IGR1cmluZyB0aGUgbm9ybWFsaXphdGlvbiBhbmQgdGhlcmUncyBubyBuZWVkCiAgICAvLyB0byBjbG9uZSBpdC4KICAgIGlmICh2YWx1ZSAmJiAodmFsdWUgaW5zdGFuY2VvZiBUZW1wbGF0ZUJpbmRpbmcgfHwgaXNUZW1wbGF0ZSh2YWx1ZSkgfHwgaXNWaWV3KHZhbHVlKSB8fCBpc1ZpZXdDb2xsZWN0aW9uKHZhbHVlKSkpIHsKICAgICAgcmV0dXJuIHZhbHVlOwogICAgfQogIH0pOwogIHJldHVybiBjbG9uZTsKfSAvLyBOb3JtYWxpemVzIGdpdmVuIHtAbGluayBtb2R1bGU6dWkvdGVtcGxhdGV+VGVtcGxhdGVEZWZpbml0aW9ufS4KLy8KLy8gU2VlOgovLyAgKiB7QGxpbmsgbm9ybWFsaXplQXR0cmlidXRlc30KLy8gICoge0BsaW5rIG5vcm1hbGl6ZUxpc3RlbmVyc30KLy8gICoge0BsaW5rIG5vcm1hbGl6ZVBsYWluVGV4dERlZmluaXRpb259Ci8vICAqIHtAbGluayBub3JtYWxpemVUZXh0RGVmaW5pdGlvbn0KLy8KLy8gQHBhcmFtIHttb2R1bGU6dWkvdGVtcGxhdGV+VGVtcGxhdGVEZWZpbml0aW9ufSBkZWYKLy8gQHJldHVybnMge21vZHVsZTp1aS90ZW1wbGF0ZX5UZW1wbGF0ZURlZmluaXRpb259IE5vcm1hbGl6ZWQgZGVmaW5pdGlvbi4KCgpmdW5jdGlvbiBub3JtYWxpemUoZGVmKSB7CiAgaWYgKHR5cGVvZiBkZWYgPT0gJ3N0cmluZycpIHsKICAgIGRlZiA9IG5vcm1hbGl6ZVBsYWluVGV4dERlZmluaXRpb24oZGVmKTsKICB9IGVsc2UgaWYgKGRlZi50ZXh0KSB7CiAgICBub3JtYWxpemVUZXh0RGVmaW5pdGlvbihkZWYpOwogIH0KCiAgaWYgKGRlZi5vbikgewogICAgZGVmLmV2ZW50TGlzdGVuZXJzID0gbm9ybWFsaXplTGlzdGVuZXJzKGRlZi5vbik7IC8vIFRlbXBsYXRlIG1peGVzIEVtaXR0ZXJNaXhpbiwgc28gZGVsZXRlICNvbiB0byBhdm9pZCBjb2xsaXNpb24uCgogICAgZGVsZXRlIGRlZi5vbjsKICB9CgogIGlmICghZGVmLnRleHQpIHsKICAgIGlmIChkZWYuYXR0cmlidXRlcykgewogICAgICBub3JtYWxpemVBdHRyaWJ1dGVzKGRlZi5hdHRyaWJ1dGVzKTsKICAgIH0KCiAgICBjb25zdCBjaGlsZHJlbiA9IFtdOwoKICAgIGlmIChkZWYuY2hpbGRyZW4pIHsKICAgICAgaWYgKGlzVmlld0NvbGxlY3Rpb24oZGVmLmNoaWxkcmVuKSkgewogICAgICAgIGNoaWxkcmVuLnB1c2goZGVmLmNoaWxkcmVuKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBmb3IgKGNvbnN0IGNoaWxkIG9mIGRlZi5jaGlsZHJlbikgewogICAgICAgICAgaWYgKGlzVGVtcGxhdGUoY2hpbGQpIHx8IGlzVmlldyhjaGlsZCkgfHwgaXNOb2RlKGNoaWxkKSkgewogICAgICAgICAgICBjaGlsZHJlbi5wdXNoKGNoaWxkKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGNoaWxkcmVuLnB1c2gobmV3IFRlbXBsYXRlKGNoaWxkKSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgZGVmLmNoaWxkcmVuID0gY2hpbGRyZW47CiAgfQoKICByZXR1cm4gZGVmOwp9IC8vIE5vcm1hbGl6ZXMgImF0dHJpYnV0ZXMiIHNlY3Rpb24gb2Yge0BsaW5rIG1vZHVsZTp1aS90ZW1wbGF0ZX5UZW1wbGF0ZURlZmluaXRpb259LgovLwovLwkJYXR0cmlidXRlczogewovLwkJCWE6ICdiYXInLAovLwkJCWI6IHtAbGluayBtb2R1bGU6dWkvdGVtcGxhdGV+VGVtcGxhdGVCaW5kaW5nfSwKLy8JCQljOiB7Ci8vCQkJCXZhbHVlOiAnYmFyJwovLwkJCX0KLy8JCX0KLy8KLy8gYmVjb21lcwovLwovLwkJYXR0cmlidXRlczogewovLwkJCWE6IFsgJ2JhcicgXSwKLy8JCQliOiBbIHtAbGluayBtb2R1bGU6dWkvdGVtcGxhdGV+VGVtcGxhdGVCaW5kaW5nfSBdLAovLwkJCWM6IHsKLy8JCQkJdmFsdWU6IFsgJ2JhcicgXQovLwkJCX0KLy8JCX0KLy8KLy8gQHBhcmFtIHtPYmplY3R9IGF0dHJpYnV0ZXMKCgpmdW5jdGlvbiBub3JtYWxpemVBdHRyaWJ1dGVzKGF0dHJpYnV0ZXMpIHsKICBmb3IgKGNvbnN0IGEgaW4gYXR0cmlidXRlcykgewogICAgaWYgKGF0dHJpYnV0ZXNbYV0udmFsdWUpIHsKICAgICAgYXR0cmlidXRlc1thXS52YWx1ZSA9IFtdLmNvbmNhdChhdHRyaWJ1dGVzW2FdLnZhbHVlKTsKICAgIH0KCiAgICBhcnJheWlmeShhdHRyaWJ1dGVzLCBhKTsKICB9Cn0gLy8gTm9ybWFsaXplcyAib24iIHNlY3Rpb24gb2Yge0BsaW5rIG1vZHVsZTp1aS90ZW1wbGF0ZX5UZW1wbGF0ZURlZmluaXRpb259LgovLwovLwkJb246IHsKLy8JCQlhOiAnYmFyJywKLy8JCQliOiB7QGxpbmsgbW9kdWxlOnVpL3RlbXBsYXRlflRlbXBsYXRlQmluZGluZ30sCi8vCQkJYzogWyB7QGxpbmsgbW9kdWxlOnVpL3RlbXBsYXRlflRlbXBsYXRlQmluZGluZ30sICgpID0+IHsgLi4uIH0gXQovLwkJfQovLwovLyBiZWNvbWVzCi8vCi8vCQlvbjogewovLwkJCWE6IFsgJ2JhcicgXSwKLy8JCQliOiBbIHtAbGluayBtb2R1bGU6dWkvdGVtcGxhdGV+VGVtcGxhdGVCaW5kaW5nfSBdLAovLwkJCWM6IFsge0BsaW5rIG1vZHVsZTp1aS90ZW1wbGF0ZX5UZW1wbGF0ZUJpbmRpbmd9LCAoKSA9PiB7IC4uLiB9IF0KLy8JCX0KLy8KLy8gQHBhcmFtIHtPYmplY3R9IGxpc3RlbmVycwovLyBAcmV0dXJucyB7T2JqZWN0fSBPYmplY3QgY29udGFpbmluZyBub3JtYWxpemVkIGxpc3RlbmVycy4KCgpmdW5jdGlvbiBub3JtYWxpemVMaXN0ZW5lcnMobGlzdGVuZXJzKSB7CiAgZm9yIChjb25zdCBsIGluIGxpc3RlbmVycykgewogICAgYXJyYXlpZnkobGlzdGVuZXJzLCBsKTsKICB9CgogIHJldHVybiBsaXN0ZW5lcnM7Cn0gLy8gTm9ybWFsaXplcyAic3RyaW5nIiB7QGxpbmsgbW9kdWxlOnVpL3RlbXBsYXRlflRlbXBsYXRlRGVmaW5pdGlvbn0uCi8vCi8vCQkiZm9vIgovLwovLyBiZWNvbWVzCi8vCi8vCQl7IHRleHQ6IFsgJ2ZvbycgXSB9LAovLwovLyBAcGFyYW0ge1N0cmluZ30gZGVmCi8vIEByZXR1cm5zIHttb2R1bGU6dWkvdGVtcGxhdGV+VGVtcGxhdGVEZWZpbml0aW9ufSBOb3JtYWxpemVkIHRlbXBsYXRlIGRlZmluaXRpb24uCgoKZnVuY3Rpb24gbm9ybWFsaXplUGxhaW5UZXh0RGVmaW5pdGlvbihkZWYpIHsKICByZXR1cm4gewogICAgdGV4dDogW2RlZl0KICB9Owp9IC8vIE5vcm1hbGl6ZXMgdGV4dCB7QGxpbmsgbW9kdWxlOnVpL3RlbXBsYXRlflRlbXBsYXRlRGVmaW5pdGlvbn0uCi8vCi8vCQljaGlsZHJlbjogWwovLwkJCXsgdGV4dDogJ2RlZicgfSwKLy8JCQl7IHRleHQ6IHtAbGluayBtb2R1bGU6dWkvdGVtcGxhdGV+VGVtcGxhdGVCaW5kaW5nfSB9Ci8vCQldCi8vCi8vIGJlY29tZXMKLy8KLy8JCWNoaWxkcmVuOiBbCi8vCQkJeyB0ZXh0OiBbICdkZWYnIF0gfSwKLy8JCQl7IHRleHQ6IFsge0BsaW5rIG1vZHVsZTp1aS90ZW1wbGF0ZX5UZW1wbGF0ZUJpbmRpbmd9IF0gfQovLwkJXQovLwovLyBAcGFyYW0ge21vZHVsZTp1aS90ZW1wbGF0ZX5UZW1wbGF0ZURlZmluaXRpb259IGRlZgoKCmZ1bmN0aW9uIG5vcm1hbGl6ZVRleHREZWZpbml0aW9uKGRlZikgewogIGlmICghQXJyYXkuaXNBcnJheShkZWYudGV4dCkpIHsKICAgIGRlZi50ZXh0ID0gW2RlZi50ZXh0XTsKICB9Cn0gLy8gV3JhcHMgYW4gZW50cnkgaW4gT2JqZWN0IGluIGFuIEFycmF5LCBpZiBub3QgYWxyZWFkeSBvbmUuCi8vCi8vCQl7Ci8vCQkJeDogJ3knLAovLwkJCWE6IFsgJ2InIF0KLy8JCX0KLy8KLy8gYmVjb21lcwovLwovLwkJewovLwkJCXg6IFsgJ3knIF0sCi8vCQkJYTogWyAnYicgXQovLwkJfQovLwovLyBAcGFyYW0ge09iamVjdH0gb2JqCi8vIEBwYXJhbSB7U3RyaW5nfSBrZXkKCgpmdW5jdGlvbiBhcnJheWlmeShvYmosIGtleSkgewogIGlmICghQXJyYXkuaXNBcnJheShvYmpba2V5XSkpIHsKICAgIG9ialtrZXldID0gW29ialtrZXldXTsKICB9Cn0gLy8gQSBoZWxwZXIgd2hpY2ggY29uY2F0ZW5hdGVzIHRoZSB2YWx1ZSBhdm9pZGluZyB1bndhbnRlZAovLyBsZWFkaW5nIHdoaXRlIHNwYWNlcy4KLy8KLy8gQHBhcmFtIHtTdHJpbmd9IHByZXYKLy8gQHBhcmFtIHtTdHJpbmd9IGN1cgovLyBAcmV0dXJucyB7U3RyaW5nfQoKCmZ1bmN0aW9uIGFycmF5VmFsdWVSZWR1Y2VyKHByZXYsIGN1cikgewogIGlmIChpc0ZhbHN5KGN1cikpIHsKICAgIHJldHVybiBwcmV2OwogIH0gZWxzZSBpZiAoaXNGYWxzeShwcmV2KSkgewogICAgcmV0dXJuIGN1cjsKICB9IGVsc2UgewogICAgcmV0dXJuIGAke3ByZXZ9ICR7Y3VyfWA7CiAgfQp9IC8vIEV4dGVuZHMgb25lIG9iamVjdCBkZWZpbmVkIGluIHRoZSBmb2xsb3dpbmcgZm9ybWF0OgovLwovLwkJewovLwkJCWtleTE6IFtBcnJheTFdLAovLwkJCWtleTI6IFtBcnJheTJdLAovLwkJCS4uLgovLwkJCWtleU46IFtBcnJheU5dCi8vCQl9Ci8vCi8vIHdpdGggYW5vdGhlciBvYmplY3Qgb2YgdGhlIHNhbWUgZGF0YSBmb3JtYXQuCi8vCi8vIEBwYXJhbSB7T2JqZWN0fSBvYmogQmFzZSBvYmplY3QuCi8vIEBwYXJhbSB7T2JqZWN0fSBleHQgT2JqZWN0IGV4dGVuZGluZyBiYXNlLgovLyBAcmV0dXJucyB7U3RyaW5nfQoKCmZ1bmN0aW9uIGV4dGVuZE9iamVjdFZhbHVlQXJyYXkob2JqLCBleHQpIHsKICBmb3IgKGNvbnN0IGEgaW4gZXh0KSB7CiAgICBpZiAob2JqW2FdKSB7CiAgICAgIG9ialthXS5wdXNoKC4uLmV4dFthXSk7CiAgICB9IGVsc2UgewogICAgICBvYmpbYV0gPSBleHRbYV07CiAgICB9CiAgfQp9IC8vIEEgaGVscGVyIGZvciB7QGxpbmsgbW9kdWxlOnVpL3RlbXBsYXRlflRlbXBsYXRlI2V4dGVuZH0uIFJlY3Vyc2l2ZWx5IGV4dGVuZHMge0BsaW5rIG1vZHVsZTp1aS90ZW1wbGF0ZX5UZW1wbGF0ZX0gaW5zdGFuY2UKLy8gd2l0aCBjb250ZW50IGZyb20ge0BsaW5rIG1vZHVsZTp1aS90ZW1wbGF0ZX5UZW1wbGF0ZURlZmluaXRpb259LiBTZWUge0BsaW5rIG1vZHVsZTp1aS90ZW1wbGF0ZX5UZW1wbGF0ZSNleHRlbmR9IHRvIGxlYXJuIG1vcmUuCi8vCi8vIEBwYXJhbSB7bW9kdWxlOnVpL3RlbXBsYXRlflRlbXBsYXRlfSBkZWYgQSB0ZW1wbGF0ZSBpbnN0YW5jZSB0byBiZSBleHRlbmRlZC4KLy8gQHBhcmFtIHttb2R1bGU6dWkvdGVtcGxhdGV+VGVtcGxhdGVEZWZpbml0aW9ufSBkZWYgQSBkZWZpbml0aW9uIHdoaWNoIGlzIHRvIGV4dGVuZCB0aGUgdGVtcGxhdGUgaW5zdGFuY2UuCi8vIEBwYXJhbSB7T2JqZWN0fSBFcnJvciBjb250ZXh0LgoKCmZ1bmN0aW9uIGV4dGVuZFRlbXBsYXRlKHRlbXBsYXRlLCBkZWYpIHsKICBpZiAoZGVmLmF0dHJpYnV0ZXMpIHsKICAgIGlmICghdGVtcGxhdGUuYXR0cmlidXRlcykgewogICAgICB0ZW1wbGF0ZS5hdHRyaWJ1dGVzID0ge307CiAgICB9CgogICAgZXh0ZW5kT2JqZWN0VmFsdWVBcnJheSh0ZW1wbGF0ZS5hdHRyaWJ1dGVzLCBkZWYuYXR0cmlidXRlcyk7CiAgfQoKICBpZiAoZGVmLmV2ZW50TGlzdGVuZXJzKSB7CiAgICBpZiAoIXRlbXBsYXRlLmV2ZW50TGlzdGVuZXJzKSB7CiAgICAgIHRlbXBsYXRlLmV2ZW50TGlzdGVuZXJzID0ge307CiAgICB9CgogICAgZXh0ZW5kT2JqZWN0VmFsdWVBcnJheSh0ZW1wbGF0ZS5ldmVudExpc3RlbmVycywgZGVmLmV2ZW50TGlzdGVuZXJzKTsKICB9CgogIGlmIChkZWYudGV4dCkgewogICAgdGVtcGxhdGUudGV4dC5wdXNoKC4uLmRlZi50ZXh0KTsKICB9CgogIGlmIChkZWYuY2hpbGRyZW4gJiYgZGVmLmNoaWxkcmVuLmxlbmd0aCkgewogICAgaWYgKHRlbXBsYXRlLmNoaWxkcmVuLmxlbmd0aCAhPSBkZWYuY2hpbGRyZW4ubGVuZ3RoKSB7CiAgICAgIC8qKgogICAgICAgKiBUaGUgbnVtYmVyIG9mIGNoaWxkcmVuIGluIGV4dGVuZGVkIGRlZmluaXRpb24gZG9lcyBub3QgbWF0Y2guCiAgICAgICAqCiAgICAgICAqIEBlcnJvciB1aS10ZW1wbGF0ZS1leHRlbmQtY2hpbGRyZW4tbWlzbWF0Y2gKICAgICAgICovCiAgICAgIHRocm93IG5ldyBDS0VkaXRvckVycm9yKCd1aS10ZW1wbGF0ZS1leHRlbmQtY2hpbGRyZW4tbWlzbWF0Y2g6IFRoZSBudW1iZXIgb2YgY2hpbGRyZW4gaW4gZXh0ZW5kZWQgZGVmaW5pdGlvbiBkb2VzIG5vdCBtYXRjaC4nLCB0ZW1wbGF0ZSk7CiAgICB9CgogICAgbGV0IGNoaWxkSW5kZXggPSAwOwoKICAgIGZvciAoY29uc3QgY2hpbGREZWYgb2YgZGVmLmNoaWxkcmVuKSB7CiAgICAgIGV4dGVuZFRlbXBsYXRlKHRlbXBsYXRlLmNoaWxkcmVuW2NoaWxkSW5kZXgrK10sIGNoaWxkRGVmKTsKICAgIH0KICB9Cn0gLy8gQ2hlY2tzIGlmIHZhbHVlIGlzICJmYWxzeSIuCi8vIE5vdGU6IDAgKE51bWJlcikgaXMgbm90ICJmYWxzeSIgaW4gdGhpcyBjb250ZXh0LgovLwovLyBAcHJpdmF0ZQovLyBAcGFyYW0geyp9IHZhbHVlIFZhbHVlIHRvIGJlIGNoZWNrZWQuCgoKZnVuY3Rpb24gaXNGYWxzeSh2YWx1ZSkgewogIHJldHVybiAhdmFsdWUgJiYgdmFsdWUgIT09IDA7Cn0gLy8gQ2hlY2tzIGlmIHRoZSBpdGVtIGlzIGFuIGluc3RhbmNlIG9mIHtAbGluayBtb2R1bGU6dWkvdmlld35WaWV3fQovLwovLyBAcHJpdmF0ZQovLyBAcGFyYW0geyp9IHZhbHVlIFZhbHVlIHRvIGJlIGNoZWNrZWQuCgoKZnVuY3Rpb24gaXNWaWV3KGl0ZW0pIHsKICByZXR1cm4gaXRlbSBpbnN0YW5jZW9mIFZpZXc7Cn0gLy8gQ2hlY2tzIGlmIHRoZSBpdGVtIGlzIGFuIGluc3RhbmNlIG9mIHtAbGluayBtb2R1bGU6dWkvdGVtcGxhdGV+VGVtcGxhdGV9Ci8vCi8vIEBwcml2YXRlCi8vIEBwYXJhbSB7Kn0gdmFsdWUgVmFsdWUgdG8gYmUgY2hlY2tlZC4KCgpmdW5jdGlvbiBpc1RlbXBsYXRlKGl0ZW0pIHsKICByZXR1cm4gaXRlbSBpbnN0YW5jZW9mIFRlbXBsYXRlOwp9IC8vIENoZWNrcyBpZiB0aGUgaXRlbSBpcyBhbiBpbnN0YW5jZSBvZiB7QGxpbmsgbW9kdWxlOnVpL3ZpZXdjb2xsZWN0aW9uflZpZXdDb2xsZWN0aW9ufQovLwovLyBAcHJpdmF0ZQovLyBAcGFyYW0geyp9IHZhbHVlIFZhbHVlIHRvIGJlIGNoZWNrZWQuCgoKZnVuY3Rpb24gaXNWaWV3Q29sbGVjdGlvbihpdGVtKSB7CiAgcmV0dXJuIGl0ZW0gaW5zdGFuY2VvZiBWaWV3Q29sbGVjdGlvbjsKfSAvLyBDcmVhdGVzIGFuIGVtcHR5IHNrZWxldG9uIGZvciB7QGxpbmsgbW9kdWxlOnVpL3RlbXBsYXRlflRlbXBsYXRlI3JldmVydH0KLy8gZGF0YS4KLy8KLy8gQHByaXZhdGUKCgpmdW5jdGlvbiBnZXRFbXB0eVJldmVydERhdGEoKSB7CiAgcmV0dXJuIHsKICAgIGNoaWxkcmVuOiBbXSwKICAgIGJpbmRpbmdzOiBbXSwKICAgIGF0dHJpYnV0ZXM6IHt9CiAgfTsKfSAvLyBDaGVja3Mgd2hldGhlciBhbiBhdHRyaWJ1dGUgc2hvdWxkIGJlIGV4dGVuZGVkIHdoZW4KLy8ge0BsaW5rIG1vZHVsZTp1aS90ZW1wbGF0ZX5UZW1wbGF0ZSNhcHBseX0gaXMgY2FsbGVkLgovLwovLyBAcHJpdmF0ZQovLyBAcGFyYW0ge1N0cmluZ30gYXR0ck5hbWUgQXR0cmlidXRlIG5hbWUgdG8gY2hlY2suCgoKZnVuY3Rpb24gc2hvdWxkRXh0ZW5kKGF0dHJOYW1lKSB7CiAgcmV0dXJuIGF0dHJOYW1lID09ICdjbGFzcycgfHwgYXR0ck5hbWUgPT0gJ3N0eWxlJzsKfQovKioKICogQSBkZWZpbml0aW9uIG9mIHRoZSB7QGxpbmsgbW9kdWxlOnVpL3RlbXBsYXRlflRlbXBsYXRlfS4gSXQgZGVzY3JpYmVzIHdoYXQga2luZCBvZgogKiBub2RlIGEgdGVtcGxhdGUgd2lsbCByZW5kZXIgKEhUTUwgZWxlbWVudCBvciB0ZXh0KSwgYXR0cmlidXRlcyBvZiBhbiBlbGVtZW50LCBET00gZXZlbnQKICogbGlzdGVuZXJzIGFuZCBjaGlsZHJlbi4KICoKICogQWxzbyBzZWU6CiAqICoge0BsaW5rIG1vZHVsZTp1aS90ZW1wbGF0ZX5UZW1wbGF0ZVZhbHVlU2NoZW1hfSB0byBsZWFybiBhYm91dCBIVE1MIGVsZW1lbnQgYXR0cmlidXRlcywKICogKiB7QGxpbmsgbW9kdWxlOnVpL3RlbXBsYXRlflRlbXBsYXRlTGlzdGVuZXJTY2hlbWF9IHRvIGxlYXJuIGFib3V0IERPTSBldmVudCBsaXN0ZW5lcnMuCiAqCiAqIEEgc2FtcGxlIGRlZmluaXRpb24gb24gYW4gSFRNTCBlbGVtZW50IGNhbiBsb29rIGxpa2UgdGhpczoKICoKICoJCW5ldyBUZW1wbGF0ZSggewogKgkJCXRhZzogJ3AnLAogKgkJCWNoaWxkcmVuOiBbCiAqCQkJCXsKICoJCQkJCXRhZzogJ3NwYW4nLAogKgkJCQkJYXR0cmlidXRlczogeyAuLi4gfSwKICoJCQkJCWNoaWxkcmVuOiBbIC4uLiBdLAogKgkJCQl9LAogKgkJCQl7CiAqCQkJCQl0ZXh0OiAnc3RhdGlj4oCTdGV4dCcKICoJCQkJfSwKICoJCQkJJ2Fsc28tc3RhdGlj4oCTdGV4dCcsCiAqCQkJXSwKICoJCQlhdHRyaWJ1dGVzOiB7CiAqCQkJCWNsYXNzOiB7QGxpbmsgbW9kdWxlOnVpL3RlbXBsYXRlflRlbXBsYXRlVmFsdWVTY2hlbWF9LAogKgkJCQlpZDoge0BsaW5rIG1vZHVsZTp1aS90ZW1wbGF0ZX5UZW1wbGF0ZVZhbHVlU2NoZW1hfSwKICoJCQkJc3R5bGU6IHtAbGluayBtb2R1bGU6dWkvdGVtcGxhdGV+VGVtcGxhdGVWYWx1ZVNjaGVtYX0KICoKICoJCQkJLy8gLi4uCiAqCQkJfSwKICoJCQlvbjogewogKgkJCQknY2xpY2snOiB7QGxpbmsgbW9kdWxlOnVpL3RlbXBsYXRlflRlbXBsYXRlTGlzdGVuZXJTY2hlbWF9CiAqCiAqCQkJCS8vIERvY3VtZW50LnF1ZXJ5U2VsZWN0b3IgZm9ybWF0IGlzIGFsc28gYWNjZXB0ZWQuCiAqCQkJCSdrZXl1cEBhLnNvbWUtY2xhc3MnOiB7QGxpbmsgbW9kdWxlOnVpL3RlbXBsYXRlflRlbXBsYXRlTGlzdGVuZXJTY2hlbWF9CiAqCiAqCQkJCS8vIC4uLgogKgkJCX0KICoJCX0gKTsKICoKICogQSB7QGxpbmsgbW9kdWxlOnVpL3ZpZXd+Vmlld30sIGFub3RoZXIge0BsaW5rIG1vZHVsZTp1aS90ZW1wbGF0ZX5UZW1wbGF0ZX0gb3IgYSBuYXRpdmUgRE9NIG5vZGUKICogY2FuIGFsc28gYmVjb21lIGEgY2hpbGQgb2YgYSB0ZW1wbGF0ZS4gV2hlbiBhIHZpZXcgaXMgcGFzc2VkLCBpdHMge0BsaW5rIG1vZHVsZTp1aS92aWV3flZpZXcjZWxlbWVudH0gaXMgdXNlZDoKICoKICoJCWNvbnN0IHZpZXcgPSBuZXcgU29tZVZpZXcoKTsKICoJCWNvbnN0IGNoaWxkVGVtcGxhdGUgPSBuZXcgVGVtcGxhdGUoIHsgLi4uIH0gKTsKICoJCWNvbnN0IGNoaWxkTm9kZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoICdiJyApOwogKgogKgkJbmV3IFRlbXBsYXRlKCB7CiAqCQkJdGFnOiAncCcsCiAqCiAqCQkJY2hpbGRyZW46IFsKICoJCQkJLy8gdmlldyNlbGVtZW50IHdpbGwgYmUgYWRkZWQgYXMgYSBjaGlsZCBvZiB0aGlzIDxwPi4KICoJCQkJdmlldywKICoKICogCQkJCS8vIFRoZSBvdXRwdXQgb2YgY2hpbGRUZW1wbGF0ZS5yZW5kZXIoKSB3aWxsIGJlIGFkZGVkIGhlcmUuCiAqCQkJCWNoaWxkVGVtcGxhdGUsCiAqCiAqCQkJCS8vIE5hdGl2ZSBET00gbm9kZXMgYXJlIGluY2x1ZGVkIGRpcmVjdGx5IGluIHRoZSByZW5kZXJlZCBvdXRwdXQuCiAqCQkJCWNoaWxkTm9kZQogKgkJCV0KICoJCX0gKTsKICoKICogQW4gZW50aXJlIHtAbGluayBtb2R1bGU6dWkvdmlld2NvbGxlY3Rpb25+Vmlld0NvbGxlY3Rpb259IGNhbiBiZSB1c2VkIGFzIGEgY2hpbGQgaW4gdGhlIGRlZmluaXRpb246CiAqCiAqCQljb25zdCBjb2xsZWN0aW9uID0gbmV3IFZpZXdDb2xsZWN0aW9uKCk7CiAqCQljb2xsZWN0aW9uLmFkZCggc29tZVZpZXcgKTsKICoKICoJCW5ldyBUZW1wbGF0ZSggewogKgkJCXRhZzogJ3AnLAogKgogKgkJCWNoaWxkcmVuOiBjb2xsZWN0aW9uCiAqCQl9ICk7CiAqCiAqIEB0eXBlZGVmIG1vZHVsZTp1aS90ZW1wbGF0ZX5UZW1wbGF0ZURlZmluaXRpb24KICogQHR5cGUgT2JqZWN0CiAqCiAqIEBwcm9wZXJ0eSB7U3RyaW5nfSB0YWcgU2VlIHRoZSB0ZW1wbGF0ZSB7QGxpbmsgbW9kdWxlOnVpL3RlbXBsYXRlflRlbXBsYXRlI3RhZ30gcHJvcGVydHkuCiAqCiAqIEBwcm9wZXJ0eSB7QXJyYXkuPG1vZHVsZTp1aS90ZW1wbGF0ZX5UZW1wbGF0ZURlZmluaXRpb24+fSBbY2hpbGRyZW5dCiAqIFNlZSB0aGUgdGVtcGxhdGUge0BsaW5rIG1vZHVsZTp1aS90ZW1wbGF0ZX5UZW1wbGF0ZSNjaGlsZHJlbn0gcHJvcGVydHkuCiAqCiAqIEBwcm9wZXJ0eSB7T2JqZWN0LjxTdHJpbmcsIG1vZHVsZTp1aS90ZW1wbGF0ZX5UZW1wbGF0ZVZhbHVlU2NoZW1hPn0gW2F0dHJpYnV0ZXNdCiAqIFNlZSB0aGUgdGVtcGxhdGUge0BsaW5rIG1vZHVsZTp1aS90ZW1wbGF0ZX5UZW1wbGF0ZSNhdHRyaWJ1dGVzfSBwcm9wZXJ0eS4KICoKICogQHByb3BlcnR5IHtTdHJpbmd8bW9kdWxlOnVpL3RlbXBsYXRlflRlbXBsYXRlVmFsdWVTY2hlbWF8QXJyYXkuPFN0cmluZ3xtb2R1bGU6dWkvdGVtcGxhdGV+VGVtcGxhdGVWYWx1ZVNjaGVtYT59IFt0ZXh0XQogKiBTZWUgdGhlIHRlbXBsYXRlIHtAbGluayBtb2R1bGU6dWkvdGVtcGxhdGV+VGVtcGxhdGUjdGV4dH0gcHJvcGVydHkuCiAqCiAqIEBwcm9wZXJ0eSB7T2JqZWN0LjxTdHJpbmcsIG1vZHVsZTp1aS90ZW1wbGF0ZX5UZW1wbGF0ZUxpc3RlbmVyU2NoZW1hPn0gW29uXQogKiBTZWUgdGhlIHRlbXBsYXRlIHtAbGluayBtb2R1bGU6dWkvdGVtcGxhdGV+VGVtcGxhdGUjZXZlbnRMaXN0ZW5lcnN9IHByb3BlcnR5LgogKi8KCi8qKgogKiBEZXNjcmliZXMgYSB2YWx1ZSBvZiBhbiBIVE1MIGVsZW1lbnQgYXR0cmlidXRlIG9yIGB0ZXh0Q29udGVudGAuIEl0IGFsbG93cyBjb21iaW5pbmcgbXVsdGlwbGUKICogZGF0YSBzb3VyY2VzIGxpa2Ugc3RhdGljIHZhbHVlcyBhbmQge0BsaW5rIG1vZHVsZTp1dGlscy9vYnNlcnZhYmxlbWl4aW5+T2JzZXJ2YWJsZX0gYXR0cmlidXRlcy4KICoKICogQWxzbyBzZWU6CiAqICoge0BsaW5rIG1vZHVsZTp1aS90ZW1wbGF0ZX5UZW1wbGF0ZURlZmluaXRpb259IHRvIGxlYXJuIHdoZXJlIHRvIHVzZSBpdCwKICogKiB7QGxpbmsgbW9kdWxlOnVpL3RlbXBsYXRlflRlbXBsYXRlLmJpbmR9IHRvIGxlYXJuIGhvdyB0byBjb25maWd1cmUKICoge0BsaW5rIG1vZHVsZTp1dGlscy9vYnNlcnZhYmxlbWl4aW5+T2JzZXJ2YWJsZX0gYXR0cmlidXRlIGJpbmRpbmdzLAogKiAqIHtAbGluayBtb2R1bGU6dWkvdGVtcGxhdGV+VGVtcGxhdGUjcmVuZGVyfSB0byBsZWFybiBob3cgdG8gcmVuZGVyIGEgdGVtcGxhdGUsCiAqICoge0BsaW5rIG1vZHVsZTp1aS90ZW1wbGF0ZX5CaW5kQ2hhaW4jdG8gYHRvKClgfSBhbmQge0BsaW5rIG1vZHVsZTp1aS90ZW1wbGF0ZX5CaW5kQ2hhaW4jaWYgYGlmKClgfQogKiBtZXRob2RzIHRvIGxlYXJuIG1vcmUgYWJvdXQgYmluZGluZ3MuCiAqCiAqIEF0dHJpYnV0ZSB2YWx1ZXMgY2FuIGJlIGRlc2NyaWJlZCBpbiBtYW55IGRpZmZlcmVudCB3YXlzOgogKgogKgkJLy8gQmluZCBoZWxwZXIgd2lsbCBjcmVhdGUgYmluZGluZ3MgdG8gYXR0cmlidXRlcyBvZiB0aGUgb2JzZXJ2YWJsZS4KICoJCWNvbnN0IGJpbmQgPSBUZW1wbGF0ZS5iaW5kKCBvYnNlcnZhYmxlLCBlbWl0dGVyICk7CiAqCiAqCQluZXcgVGVtcGxhdGUoIHsKICoJCQl0YWc6ICdwJywKICoJCQlhdHRyaWJ1dGVzOiB7CiAqCQkJCS8vIEEgcGxhaW4gc3RyaW5nIHNjaGVtYS4KICoJCQkJJ2NsYXNzJzogJ3N0YXRpYy10ZXh0JywKICoKICoJCQkJLy8gQW4gb2JqZWN0IHNjaGVtYSwgYmluZHMgdG8gdGhlICJmb28iIGF0dHJpYnV0ZSBvZiB0aGUKICoJCQkJLy8gb2JzZXJ2YWJsZSBhbmQgZm9sbG93cyBpdHMgdmFsdWUuCiAqCQkJCSdjbGFzcyc6IGJpbmQudG8oICdmb28nICksCiAqCiAqCQkJCS8vIEFuIGFycmF5IHNjaGVtYSwgY29tYmluZXMgdGhlIGFib3ZlLgogKgkJCQknY2xhc3MnOiBbCiAqCQkJCQknc3RhdGljLXRleHQnLAogKgkJCQkJYmluZC50byggJ2JhcicsICgpID0+IHsgLi4uIH0gKSwKICoKICogCQkJCQkvLyBCaW5kaW5ncyBjYW4gYWxzbyBiZSBjb25kaXRpb25hbC4KICoJCQkJCWJpbmQuaWYoICdiYXonLCAnY2xhc3Mtd2hlbi1iYXotaXMtdHJ1ZScgKQogKgkJCQldLAogKgogKgkJCQkvLyBBbiBhcnJheSBzY2hlbWEsIHdpdGggYSBjdXN0b20gbmFtZXNwYWNlLCBlLmcuIHVzZWZ1bCBmb3IgY3JlYXRpbmcgU1ZHcy4KICoJCQkJJ2NsYXNzJzogewogKgkJCQkJbnM6ICdodHRwOi8vbnMudXJsJywKICoJCQkJCXZhbHVlOiBbCiAqCQkJCQkJYmluZC5pZiggJ2JheicsICd2YWx1ZS13aGVuLXRydWUnICksCiAqCQkJCQkJJ3N0YXRpYy10ZXh0JwogKgkJCQkJXQogKgkJCQl9LAogKgogKgkJCQkvLyBBbiBvYmplY3Qgc2NoZW1hLCBzcGVjaWZpYyBmb3Igc3R5bGVzLgogKgkJCQlzdHlsZTogewogKgkJCQkJY29sb3I6ICdyZWQnLAogKgkJCQkJYmFja2dyb3VuZENvbG9yOiBiaW5kLnRvKCAncXV4JywgKCkgPT4geyAuLi4gfSApCiAqCQkJCX0KICoJCQl9CiAqCQl9ICk7CiAqCiAqIFRleHQgbm9kZXMgY2FuIGFsc28gaGF2ZSBjb21wbGV4IHZhbHVlczoKICoKICoJCWNvbnN0IGJpbmQgPSBUZW1wbGF0ZS5iaW5kKCBvYnNlcnZhYmxlLCBlbWl0dGVyICk7CiAqCiAqCQkvLyBXaWxsIHJlbmRlciBhICJmb28iIHRleHQgbm9kZS4KICoJCW5ldyBUZW1wbGF0ZSggewogKgkJCXRleHQ6ICdmb28nCiAqCQl9ICk7CiAqCiAqCQkvLyBXaWxsIHJlbmRlciBhICJzdGF0aWMgdGV4dDoge29ic2VydmFibGUuZm9vfSIgdGV4dCBub2RlLgogKgkJLy8gVGhlIHRleHQgb2YgdGhlIG5vZGUgd2lsbCBiZSB1cGRhdGVkIGFzIHRoZSAiZm9vIiBhdHRyaWJ1dGUgY2hhbmdlcy4KICoJCW5ldyBUZW1wbGF0ZSggewogKgkJCXRleHQ6IFsKICoJCQkJJ3N0YXRpYyB0ZXh0OiAnLAogKgkJCQliaW5kLnRvKCAnZm9vJywgKCkgPT4geyAuLi4gfSApCiAqCQkJXQogKgkJfSApOwogKgogKiBAdHlwZWRlZiBtb2R1bGU6dWkvdGVtcGxhdGV+VGVtcGxhdGVWYWx1ZVNjaGVtYQogKiBAdHlwZSB7T2JqZWN0fFN0cmluZ3xBcnJheX0KICovCgovKioKICogRGVzY3JpYmVzIGFuIGV2ZW50IGxpc3RlbmVyIGF0dGFjaGVkIHRvIGFuIEhUTUwgZWxlbWVudC4gU3VjaCBsaXN0ZW5lciBjYW4gcHJvcGFnYXRlIERPTSBldmVudHMKICogdGhyb3VnaCBhbiB7QGxpbmsgbW9kdWxlOnV0aWxzL29ic2VydmFibGVtaXhpbn5PYnNlcnZhYmxlfSBpbnN0YW5jZSwgZXhlY3V0ZSBjdXN0b20gY2FsbGJhY2tzCiAqIG9yIGJvdGgsIGlmIG5lY2Vzc2FyeS4KICoKICogQWxzbyBzZWU6CiAqICoge0BsaW5rIG1vZHVsZTp1aS90ZW1wbGF0ZX5UZW1wbGF0ZURlZmluaXRpb259IHRvIGxlYXJuIG1vcmUgYWJvdXQgdGVtcGxhdGUgZGVmaW5pdGlvbnMsCiAqICoge0BsaW5rIG1vZHVsZTp1aS90ZW1wbGF0ZX5CaW5kQ2hhaW4jdG8gYHRvKClgfSBtZXRob2QgdG8gbGVhcm4gbW9yZSBhYm91dCBiaW5kaW5ncy4KICoKICogQ2hlY2sgb3V0IGRpZmZlcmVudCB3YXlzIG9mIGF0dGFjaGluZyBldmVudCBsaXN0ZW5lcnMgYmVsb3c6CiAqCiAqCQkvLyBCaW5kIGhlbHBlciB3aWxsIHByb3BhZ2F0ZSBldmVudHMgdGhyb3VnaCB0aGUgb2JzZXJ2YWJsZS4KICoJCWNvbnN0IGJpbmQgPSBUZW1wbGF0ZS5iaW5kKCBvYnNlcnZhYmxlLCBlbWl0dGVyICk7CiAqCiAqCQluZXcgVGVtcGxhdGUoIHsKICoJCQl0YWc6ICdwJywKICoJCQlvbjogewogKgkJCQkvLyBBbiBvYmplY3Qgc2NoZW1hLiBUaGUgb2JzZXJ2YWJsZSB3aWxsIGZpcmUgdGhlICJjbGlja2VkIiBldmVudCB1cG9uIERPTSAiY2xpY2siLgogKgkJCQljbGljazogYmluZC50byggJ2NsaWNrZWQnICkKICoKICoJCQkJLy8gQW4gb2JqZWN0IHNjaGVtYS4gSXQgd2lsbCB3b3JrIGZvciAiY2xpY2siIGV2ZW50IG9uICJhLmZvbyIgY2hpbGRyZW4gb25seS4KICoJCQkJJ2NsaWNrQGEuZm9vJzogYmluZC50byggJ2NsaWNrZWQnICkKICoKICoJCQkJLy8gQW4gYXJyYXkgc2NoZW1hLCBtYWtlcyB0aGUgb2JzZXJ2YWJsZSBwcm9wYWdhdGUgbXVsdGlwbGUgZXZlbnRzLgogKgkJCQljbGljazogWwogKgkJCQkJYmluZC50byggJ2NsaWNrZWQnICksCiAqCQkJCQliaW5kLnRvKCAnZXhlY3V0ZWQnICkKICoJCQkJXSwKICoKICoJCQkJLy8gQW4gYXJyYXkgc2NoZW1hIHdpdGggYSBjdXN0b20gY2FsbGJhY2suCiAqCQkJCSdjbGlja0BhLmZvbyc6IHsKICoJCQkJCWJpbmQudG8oICdjbGlja2VkJyApLAogKgkJCQkJYmluZC50byggZXZ0ID0+IHsKICoJCQkJCQljb25zb2xlLmxvZyggYCR7IGV2dC50YXJnZXQgfSBoYXMgYmVlbiBjbGlja2VkIWAgKTsKICoJCQkJCX0gfQogKgkJCQl9CiAqCQkJfQogKgkJfSApOwogKgogKiBAdHlwZWRlZiBtb2R1bGU6dWkvdGVtcGxhdGV+VGVtcGxhdGVMaXN0ZW5lclNjaGVtYQogKiBAdHlwZSB7T2JqZWN0fFN0cmluZ3xBcnJheX0KICovCgovKioKICogVGhlIHJldHVybiB2YWx1ZSBvZiB7QGxpbmsgflRlbXBsYXRlLmJpbmQgYFRlbXBsYXRlLmJpbmQoKWB9LiBJdCBwcm92aWRlcyBgdG8oKWAgYW5kIGBpZigpYAogKiBtZXRob2RzIHRvIGNyZWF0ZSB0aGUge0BsaW5rIG1vZHVsZTp1dGlscy9vYnNlcnZhYmxlbWl4aW5+T2JzZXJ2YWJsZSBvYnNlcnZhYmxlfSBhdHRyaWJ1dGUgYW5kIGV2ZW50IGJpbmRpbmdzLgogKgogKiBAaW50ZXJmYWNlIG1vZHVsZTp1aS90ZW1wbGF0ZX5CaW5kQ2hhaW4KICovCgovKioKICogQmluZHMgYW4ge0BsaW5rIG1vZHVsZTp1dGlscy9vYnNlcnZhYmxlbWl4aW5+T2JzZXJ2YWJsZSBvYnNlcnZhYmxlfSB0byBlaXRoZXI6CiAqCiAqICogYW4gSFRNTCBlbGVtZW50IGF0dHJpYnV0ZSBvciBhIHRleHQgbm9kZSBgdGV4dENvbnRlbnRgLCBzbyBpdCByZW1haW5zIGluIHN5bmMgd2l0aCB0aGUgb2JzZXJ2YWJsZQogKiBhdHRyaWJ1dGUgYXMgaXQgY2hhbmdlcywKICogKiBvciBhbiBIVE1MIGVsZW1lbnQgRE9NIGV2ZW50LCBzbyB0aGUgRE9NIGV2ZW50cyBhcmUgcHJvcGFnYXRlZCB0aHJvdWdoIGFuIG9ic2VydmFibGUuCiAqCiAqIFNvbWUgY29tbW9uIHVzZSBjYXNlcyBvZiBgdG8oKWAgYmluZGluZ3MgYXJlIHByZXNlbnRlZCBiZWxvdzoKICoKICoJCWNvbnN0IGJpbmQgPSBUZW1wbGF0ZS5iaW5kKCBvYnNlcnZhYmxlLCBlbWl0dGVyICk7CiAqCiAqCQluZXcgVGVtcGxhdGUoIHsKICoJCQl0YWc6ICdwJywKICoJCQlhdHRyaWJ1dGVzOiB7CiAqCQkJCS8vIGNsYXNzPSIuLi4iIGF0dHJpYnV0ZSBnZXRzIGJvdW5kIHRvIGBvYnNlcnZhYmxlI2FgCiAqCQkJCWNsYXNzOiBiaW5kLnRvKCAnYScgKQogKgkJCX0sCiAqCQkJY2hpbGRyZW46IFsKICoJCQkJLy8gPHA+Li4uPC9wPiBnZXRzIGJvdW5kIHRvIG9ic2VydmFibGUjYjsgYWx3YXlzIGB0b1VwcGVyQ2FzZSgpYC4KICoJCQkJewogKgkJCQkJdGV4dDogYmluZC50byggJ2InLCAoIHZhbHVlLCBub2RlICkgPT4gdmFsdWUudG9VcHBlckNhc2UoKSApCiAqCQkJCX0KICoJCQldLAogKgkJCW9uOiB7CiAqCQkJCWNsaWNrOiBbCiAqCQkJCQkvLyBBbiBvYnNlcnZhYmxlIHdpbGwgZmlyZSAiY2xpY2tlZCIgdXBvbiAiY2xpY2siIGluIHRoZSBET00uCiAqCQkJCQliaW5kLnRvKCAnY2xpY2tlZCcgKSwKICoKICoJCQkJCS8vIEEgY3VzdG9tIGNhbGxiYWNrIHdpbGwgYmUgZXhlY3V0ZWQgdXBvbiAiY2xpY2siIGluIHRoZSBET00uCiAqCQkJCQliaW5kLnRvKCAoKSA9PiB7CiAqCQkJCQkJLi4uCiAqCQkJCQl9ICkKICoJCQkJXQogKgkJCX0KICoJCX0gKS5yZW5kZXIoKTsKICoKICogTGVhcm4gbW9yZSBhYm91dCB1c2luZyBgdG8oKWAgaW4gdGhlIHtAbGluayBtb2R1bGU6dWkvdGVtcGxhdGV+VGVtcGxhdGVWYWx1ZVNjaGVtYX0gYW5kCiAqIHtAbGluayBtb2R1bGU6dWkvdGVtcGxhdGV+VGVtcGxhdGVMaXN0ZW5lclNjaGVtYX0uCiAqCiAqIEBtZXRob2QgI3RvCiAqIEBwYXJhbSB7U3RyaW5nfEZ1bmN0aW9ufSBldmVudE5hbWVPckZ1bmN0aW9uT3JBdHRyaWJ1dGUgQW4gYXR0cmlidXRlIG5hbWUgb2YKICoge0BsaW5rIG1vZHVsZTp1dGlscy9vYnNlcnZhYmxlbWl4aW5+T2JzZXJ2YWJsZX0gb3IgYSBET00gZXZlbnQgbmFtZSBvciBhbiBldmVudCBjYWxsYmFjay4KICogQHBhcmFtIHtGdW5jdGlvbn0gW2NhbGxiYWNrXSBBbGxvd3MgZm9yIHByb2Nlc3Npbmcgb2YgdGhlIHZhbHVlLiBBY2NlcHRzIGBOb2RlYCBhbmQgYHZhbHVlYCBhcyBhcmd1bWVudHMuCiAqIEByZXR1cm5zIHttb2R1bGU6dWkvdGVtcGxhdGV+VGVtcGxhdGVCaW5kaW5nfQogKi8KCi8qKgogKiBCaW5kcyBhbiB7QGxpbmsgbW9kdWxlOnV0aWxzL29ic2VydmFibGVtaXhpbn5PYnNlcnZhYmxlIG9ic2VydmFibGV9IHRvIGFuIEhUTUwgZWxlbWVudCBhdHRyaWJ1dGUgb3IgYSB0ZXh0CiAqIG5vZGUgYHRleHRDb250ZW50YCBzbyBpdCByZW1haW5zIGluIHN5bmMgd2l0aCB0aGUgb2JzZXJ2YWJsZSBhdHRyaWJ1dGUgYXMgaXQgY2hhbmdlcy4KICoKICogVW5saWtlIHtAbGluayBtb2R1bGU6dWkvdGVtcGxhdGV+QmluZENoYWluI3RvfSwgaXQgY29udHJvbHMgdGhlIHByZXNlbmNlIG9mIHRoZSBhdHRyaWJ1dGUgb3IgYHRleHRDb250ZW50YAogKiBkZXBlbmRpbmcgb24gdGhlICJmYWxzZW5lc3MiIG9mIGFuIHtAbGluayBtb2R1bGU6dXRpbHMvb2JzZXJ2YWJsZW1peGlufk9ic2VydmFibGV9IGF0dHJpYnV0ZS4KICoKICoJCWNvbnN0IGJpbmQgPSBUZW1wbGF0ZS5iaW5kKCBvYnNlcnZhYmxlLCBlbWl0dGVyICk7CiAqCiAqCQluZXcgVGVtcGxhdGUoIHsKICoJCQl0YWc6ICdpbnB1dCcsCiAqCQkJYXR0cmlidXRlczogewogKgkJCQkvLyA8aW5wdXQgY2hlY2tlZD4gd2hlbiBgb2JzZXJ2YWJsZSNhYCBpcyBub3QgdW5kZWZpbmVkL251bGwvZmFsc2UvJycKICoJCQkJLy8gPGlucHV0PiB3aGVuIGBvYnNlcnZhYmxlI2FgIGlzIHVuZGVmaW5lZC9udWxsL2ZhbHNlCiAqCQkJCWNoZWNrZWQ6IGJpbmQuaWYoICdhJyApCiAqCQkJfSwKICoJCQljaGlsZHJlbjogWwogKgkJCQl7CiAqCQkJCQkvLyA8aW5wdXQ+ImItaXMtbm90LXNldCI8L2lucHV0PiB3aGVuIGBvYnNlcnZhYmxlI2JgIGlzIHVuZGVmaW5lZC9udWxsL2ZhbHNlLycnCiAqCQkJCQkvLyA8aW5wdXQ+PC9pbnB1dD4gd2hlbiBgb2JzZXJ2YWJsZSNiYCBpcyBub3QgImZhbHN5IgogKgkJCQkJdGV4dDogYmluZC5pZiggJ2InLCAnYi1pcy1ub3Qtc2V0JywgKCB2YWx1ZSwgbm9kZSApID0+ICF2YWx1ZSApCiAqCQkJCX0KICoJCQldCiAqCQl9ICkucmVuZGVyKCk7CiAqCiAqIExlYXJuIG1vcmUgYWJvdXQgdXNpbmcgYGlmKClgIGluIHRoZSB7QGxpbmsgbW9kdWxlOnVpL3RlbXBsYXRlflRlbXBsYXRlVmFsdWVTY2hlbWF9LgogKgogKiBAbWV0aG9kICNpZgogKiBAcGFyYW0ge1N0cmluZ30gYXR0cmlidXRlIEFuIGF0dHJpYnV0ZSBuYW1lIG9mIHtAbGluayBtb2R1bGU6dXRpbHMvb2JzZXJ2YWJsZW1peGlufk9ic2VydmFibGV9IHVzZWQgaW4gdGhlIGJpbmRpbmcuCiAqIEBwYXJhbSB7U3RyaW5nfSBbdmFsdWVJZlRydWVdIFZhbHVlIHNldCB3aGVuIHRoZSB7QGxpbmsgbW9kdWxlOnV0aWxzL29ic2VydmFibGVtaXhpbn5PYnNlcnZhYmxlfSBhdHRyaWJ1dGUgaXMgbm90CiAqIHVuZGVmaW5lZC9udWxsL2ZhbHNlLycnIChlbXB0eSBzdHJpbmcpLgogKiBAcGFyYW0ge0Z1bmN0aW9ufSBbY2FsbGJhY2tdIEFsbG93cyBmb3IgcHJvY2Vzc2luZyBvZiB0aGUgdmFsdWUuIEFjY2VwdHMgYE5vZGVgIGFuZCBgdmFsdWVgIGFzIGFyZ3VtZW50cy4KICogQHJldHVybnMge21vZHVsZTp1aS90ZW1wbGF0ZX5UZW1wbGF0ZUJpbmRpbmd9CiAqLwoKLyoqCiAqIFRoZSB7QGxpbmsgbW9kdWxlOnVpL3RlbXBsYXRlflRlbXBsYXRlI19yZW5kZXJOb2RlfSBjb25maWd1cmF0aW9uLgogKgogKiBAcHJpdmF0ZQogKiBAaW50ZXJmYWNlIG1vZHVsZTp1aS90ZW1wbGF0ZX5SZW5kZXJEYXRhCiAqLwoKLyoqCiAqIFRlbGxzIHtAbGluayBtb2R1bGU6dWkvdGVtcGxhdGV+VGVtcGxhdGUjX3JlbmRlck5vZGV9IHRvIHJlbmRlcgogKiBjaGlsZHJlbiBpbnRvIGBEb2N1bWVudEZyYWdtZW50YCBmaXJzdCBhbmQgdGhlbiBhcHBlbmQgdGhlIGZyYWdtZW50CiAqIHRvIHRoZSBwYXJlbnQgZWxlbWVudC4gSXQgaXMgYSBzcGVlZCBvcHRpbWl6YXRpb24uCiAqCiAqIEBtZW1iZXIge0Jvb2xlYW59ICNpbnRvRnJhZ21lbnQKICovCgovKioKICogQSBub2RlIHdoaWNoIGlzIGJlaW5nIHJlbmRlcmVkLgogKgogKiBAbWVtYmVyIHtIVE1MRWxlbWVudHxUZXh0fSAjbm9kZQogKi8KCi8qKgogKiBJbmRpY2F0ZXMgd2hldGhlciB0aGUge0Btb2R1bGU6dWkvdGVtcGxhdGV+UmVuZGVyTm9kZU9wdGlvbnMjbm9kZX0gaGFzCiAqIGJlZW4gcHJvdmlkZWQgYnkge0Btb2R1bGU6dWkvdGVtcGxhdGV+VGVtcGxhdGUjYXBwbHl9LgogKgogKiBAbWVtYmVyIHtCb29sZWFufSAjaXNBcHBseWluZwogKi8KCi8qKgogKiBBbiBvYmplY3Qgc3RvcmluZyB0aGUgZGF0YSB0aGF0IGhlbHBzIHtAbW9kdWxlOnVpL3RlbXBsYXRlflRlbXBsYXRlI3JldmVydH0KICogYnJpbmdpbmcgYmFjayBhbiBlbGVtZW50IHRvIGl0cyBpbml0aWFsIHN0YXRlLCBpLmUuIGJlZm9yZQogKiB7QG1vZHVsZTp1aS90ZW1wbGF0ZX5UZW1wbGF0ZSNhcHBseX0gd2FzIGNhbGxlZC4KICoKICogQG1lbWJlciB7T2JqZWN0fSAjcmV2ZXJ0RGF0YQogKi8="},{"version":3,"sources":["/Users/antonyching/Desktop/project/new-builder-demo/node_modules/@ckeditor/ckeditor5-ui/src/template.js"],"names":["CKEditorError","mix","EmitterMixin","View","ViewCollection","isNode","isObject","cloneDeepWith","xhtmlNs","Template","constructor","def","Object","assign","normalize","clone","_isRendered","_revertData","render","node","_renderNode","intoFragment","apply","getEmptyRevertData","isApplying","revertData","revert","_revertTemplateFromNode","getViews","search","children","child","isView","isTemplate","bind","observable","emitter","to","eventNameOrFunctionOrAttribute","callback","TemplateToBinding","eventNameOrFunction","attribute","if","valueIfTrue","TemplateIfBinding","extend","template","extendTemplate","data","isInvalid","tag","text","_renderText","_renderElement","document","createElementNS","ns","_renderAttributes","_renderElementChildren","_setUpListeners","textContent","createTextNode","hasTemplateBinding","_bindToObservable","schema","updater","getTextUpdater","join","attrName","attrValue","domAttrValue","attrNs","attributes","getAttribute","valueToBind","value","shouldExtend","unshift","getAttributeUpdater","_renderStyleAttribute","map","val","reduce","prev","next","concat","arrayValueReducer","isFalsy","setAttributeNS","styles","styleName","styleValue","getStyleUpdater","style","container","createDocumentFragment","childIndex","isViewCollection","setParent","view","appendChild","element","isRendered","childRevertData","push","childNodes","eventListeners","key","revertBindings","schemaItem","domEvtName","domSelector","split","activateDomEventListener","bindings","syncValueSchemaValue","filter","item","templateBinding","activateAttributeListener","binding","revertBinding","removeAttribute","setAttribute","i","length","TemplateBinding","getValue","listenTo","stopListening","evt","domEvt","target","matches","fire","Array","isArray","some","getValueSchemaValue","remove","set","el","removeAttributeNS","normalizePlainTextDefinition","normalizeTextDefinition","on","normalizeListeners","normalizeAttributes","a","arrayify","listeners","l","obj","cur","extendObjectValueArray","ext","childDef"],"mappings":"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","sourcesContent":["/**\n * @license Copyright (c) 2003-2019, CKSource - Frederico Knabben. All rights reserved.\n * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license\n */\n\n/**\n * @module ui/template\n */\n\n/* global document */\n\nimport CKEditorError from '@ckeditor/ckeditor5-utils/src/ckeditorerror';\nimport mix from '@ckeditor/ckeditor5-utils/src/mix';\nimport EmitterMixin from '@ckeditor/ckeditor5-utils/src/emittermixin';\nimport View from './view';\nimport ViewCollection from './viewcollection';\nimport isNode from '@ckeditor/ckeditor5-utils/src/dom/isnode';\nimport { isObject, cloneDeepWith } from 'lodash-es';\n\nconst xhtmlNs = 'http://www.w3.org/1999/xhtml';\n\n/**\n * A basic Template class. It renders a DOM HTML element or text from a\n * {@link module:ui/template~TemplateDefinition definition} and supports element attributes, children,\n * bindings to {@link module:utils/observablemixin~Observable observables} and DOM event propagation.\n *\n * A simple template can look like this:\n *\n *\t\tconst bind = Template.bind( observable, emitter );\n *\n *\t\tnew Template( {\n *\t\t\ttag: 'p',\n *\t\t\tattributes: {\n *\t\t\t\tclass: 'foo',\n *\t\t\t\tstyle: {\n *\t\t\t\t\tbackgroundColor: 'yellow'\n *\t\t\t\t}\n *\t\t\t},\n *\t\t\ton: {\n *\t\t\t\tclick: bind.to( 'clicked' )\n *\t\t\t},\n *\t\t\tchildren: [\n *\t\t\t\t'A paragraph.'\n *\t\t\t]\n *\t\t} ).render();\n *\n * and it will render the following HTML element:\n *\n *\t\t<p class=\"foo\" style=\"background-color: yellow;\">A paragraph.</p>\n *\n * Additionally, the `observable` will always fire `clicked` upon clicking `<p>` in the DOM.\n *\n * See {@link module:ui/template~TemplateDefinition} to know more about templates and complex\n * template definitions.\n *\n* @mixes module:utils/emittermixin~EmitterMixin\n */\nexport default class Template {\n\t/**\n\t * Creates an instance of the {@link ~Template} class.\n\t *\n\t * @param {module:ui/template~TemplateDefinition} def The definition of the template.\n\t */\n\tconstructor( def ) {\n\t\tObject.assign( this, normalize( clone( def ) ) );\n\n\t\t/**\n\t\t * Indicates whether this particular Template instance has been\n\t\t * {@link #render rendered}.\n\t\t *\n\t\t * @readonly\n\t\t * @protected\n\t\t * @member {Boolean}\n\t\t */\n\t\tthis._isRendered = false;\n\n\t\t/**\n\t\t * The tag (`tagName`) of this template, e.g. `div`. It also indicates that the template\n\t\t * renders to an HTML element.\n\t\t *\n\t\t * @member {String} #tag\n\t\t */\n\n\t\t/**\n\t\t * The text of the template. It also indicates that the template renders to a DOM text node.\n\t\t *\n\t\t * @member {Array.<String|module:ui/template~TemplateValueSchema>} #text\n\t\t */\n\n\t\t/**\n\t\t * The attributes of the template, e.g. `{ id: [ 'ck-id' ] }`, corresponding with\n\t\t * the attributes of an HTML element.\n\t\t *\n\t\t * **Note**: This property only makes sense when {@link #tag} is defined.\n\t\t *\n\t\t * @member {Object} #attributes\n\t\t */\n\n\t\t/**\n\t\t * The children of the template. They can be either:\n\t\t * * independent instances of {@link ~Template} (sub–templates),\n\t\t * * native DOM Nodes.\n\t\t *\n\t\t * **Note**: This property only makes sense when {@link #tag} is defined.\n\t\t *\n\t\t * @member {Array.<module:ui/template~Template|Node>} #children\n\t\t */\n\n\t\t/**\n\t\t * The DOM event listeners of the template.\n\t\t *\n\t\t * @member {Object} #eventListeners\n\t\t */\n\n\t\t/**\n\t\t * The data used by the {@link #revert} method to restore a node to its original state.\n\t\t *\n\t\t * See: {@link #apply}.\n\t\t *\n\t\t * @readonly\n\t\t * @protected\n\t\t * @member {module:ui/template~RenderData}\n\t\t */\n\t\tthis._revertData = null;\n\t}\n\n\t/**\n\t * Renders a DOM Node (an HTML element or text) out of the template.\n\t *\n\t *\t\tconst domNode = new Template( { ... } ).render();\n\t *\n\t * See: {@link #apply}.\n\t *\n\t * @returns {HTMLElement|Text}\n\t */\n\trender() {\n\t\tconst node = this._renderNode( {\n\t\t\tintoFragment: true\n\t\t} );\n\n\t\tthis._isRendered = true;\n\n\t\treturn node;\n\t}\n\n\t/**\n\t * Applies the template to an existing DOM Node, either HTML element or text.\n\t *\n\t * **Note:** No new DOM nodes will be created. Applying extends:\n\t *\n\t * {@link module:ui/template~TemplateDefinition attributes},\n\t * {@link module:ui/template~TemplateDefinition event listeners}, and\n\t * `textContent` of {@link module:ui/template~TemplateDefinition children} only.\n\t *\n\t * **Note:** Existing `class` and `style` attributes are extended when a template\n\t * is applied to an HTML element, while other attributes and `textContent` are overridden.\n\t *\n\t * **Note:** The process of applying a template can be easily reverted using the\n\t * {@link module:ui/template~Template#revert} method.\n\t *\n\t *\t\tconst element = document.createElement( 'div' );\n\t *\t\tconst observable = new Model( { divClass: 'my-div' } );\n\t *\t\tconst emitter = Object.create( EmitterMixin );\n\t *\t\tconst bind = Template.bind( observable, emitter );\n\t *\n\t *\t\tnew Template( {\n\t *\t\t\tattributes: {\n\t *\t\t\t\tid: 'first-div',\n\t *\t\t\t\tclass: bind.to( 'divClass' )\n\t *\t\t\t},\n\t *\t\t\ton: {\n\t *\t\t\t\tclick: bind( 'elementClicked' ) // Will be fired by the observable.\n\t *\t\t\t},\n\t *\t\t\tchildren: [\n\t *\t\t\t\t'Div text.'\n\t *\t\t\t]\n\t *\t\t} ).apply( element );\n\t *\n\t *\t\tconsole.log( element.outerHTML ); // -> '<div id=\"first-div\" class=\"my-div\"></div>'\n\t *\n\t * @see module:ui/template~Template#render\n\t * @see module:ui/template~Template#revert\n\t * @param {Node} node Root node for the template to apply.\n\t */\n\tapply( node ) {\n\t\tthis._revertData = getEmptyRevertData();\n\n\t\tthis._renderNode( {\n\t\t\tnode,\n\t\t\tisApplying: true,\n\t\t\trevertData: this._revertData\n\t\t} );\n\n\t\treturn node;\n\t}\n\n\t/**\n\t * Reverts a template {@link module:ui/template~Template#apply applied} to a DOM node.\n\t *\n\t * @param {Node} node The root node for the template to revert. In most of the cases, it is the\n\t * same node used by {@link module:ui/template~Template#apply}.\n\t */\n\trevert( node ) {\n\t\tif ( !this._revertData ) {\n\t\t\t/**\n\t\t\t * Attempting to revert a template which has not been applied yet.\n\t\t\t *\n\t\t\t * @error ui-template-revert-not-applied\n\t\t\t */\n\t\t\tthrow new CKEditorError(\n\t\t\t\t'ui-template-revert-not-applied: Attempting to revert a template which has not been applied yet.',\n\t\t\t\t[ this, node ]\n\t\t\t);\n\t\t}\n\n\t\tthis._revertTemplateFromNode( node, this._revertData );\n\t}\n\n\t/**\n\t * Returns an iterator which traverses the template in search of {@link module:ui/view~View}\n\t * instances and returns them one by one.\n\t *\n\t *\t\tconst viewFoo = new View();\n\t *\t\tconst viewBar = new View();\n\t *\t\tconst viewBaz = new View();\n\t *\t\tconst template = new Template( {\n\t *\t\t\ttag: 'div',\n\t *\t\t\tchildren: [\n\t *\t\t\t\tviewFoo,\n\t *\t\t\t\t{\n\t *\t\t\t\t\ttag: 'div',\n\t *\t\t\t\t\tchildren: [\n\t *\t\t\t\t\t\tviewBar\n\t *\t\t\t\t\t]\n\t *\t\t\t\t},\n\t *\t\t\t\tviewBaz\n\t *\t\t\t]\n\t *\t\t} );\n\t *\n\t *\t\t// Logs: viewFoo, viewBar, viewBaz\n\t *\t\tfor ( const view of template.getViews() ) {\n\t *\t\t\tconsole.log( view );\n\t *\t\t}\n\t *\n\t * @returns {Iterable.<module:ui/view~View>}\n\t */\n\t* getViews() {\n\t\tfunction* search( def ) {\n\t\t\tif ( def.children ) {\n\t\t\t\tfor ( const child of def.children ) {\n\t\t\t\t\tif ( isView( child ) ) {\n\t\t\t\t\t\tyield child;\n\t\t\t\t\t} else if ( isTemplate( child ) ) {\n\t\t\t\t\t\tyield* search( child );\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tyield* search( this );\n\t}\n\n\t/**\n\t * An entry point to the interface which binds DOM nodes to\n\t * {@link module:utils/observablemixin~Observable observables}.\n\t * There are two types of bindings:\n\t *\n\t * * HTML element attributes or text `textContent` synchronized with attributes of an\n\t * {@link module:utils/observablemixin~Observable}. Learn more about {@link module:ui/template~BindChain#to}\n\t * and {@link module:ui/template~BindChain#if}.\n\t *\n\t *\t\tconst bind = Template.bind( observable, emitter );\n\t *\n\t *\t\tnew Template( {\n\t *\t\t\tattributes: {\n\t *\t\t\t\t// Binds the element \"class\" attribute to observable#classAttribute.\n\t *\t\t\t\tclass: bind.to( 'classAttribute' )\n\t *\t\t\t}\n\t *\t\t} ).render();\n\t *\n\t * * DOM events fired on HTML element propagated through\n\t * {@link module:utils/observablemixin~Observable}. Learn more about {@link module:ui/template~BindChain#to}.\n\t *\n\t *\t\tconst bind = Template.bind( observable, emitter );\n\t *\n\t *\t\tnew Template( {\n\t *\t\t\ton: {\n\t *\t\t\t\t// Will be fired by the observable.\n\t *\t\t\t\tclick: bind( 'elementClicked' )\n\t *\t\t\t}\n\t *\t\t} ).render();\n\t *\n\t * Also see {@link module:ui/view~View#bindTemplate}.\n\t *\n\t * @param {module:utils/observablemixin~Observable} observable An observable which provides boundable attributes.\n\t * @param {module:utils/emittermixin~Emitter} emitter An emitter that listens to observable attribute\n\t * changes or DOM Events (depending on the kind of the binding). Usually, a {@link module:ui/view~View} instance.\n\t * @returns {module:ui/template~BindChain}\n\t */\n\tstatic bind( observable, emitter ) {\n\t\treturn {\n\t\t\tto( eventNameOrFunctionOrAttribute, callback ) {\n\t\t\t\treturn new TemplateToBinding( {\n\t\t\t\t\teventNameOrFunction: eventNameOrFunctionOrAttribute,\n\t\t\t\t\tattribute: eventNameOrFunctionOrAttribute,\n\t\t\t\t\tobservable, emitter, callback\n\t\t\t\t} );\n\t\t\t},\n\n\t\t\tif( attribute, valueIfTrue, callback ) {\n\t\t\t\treturn new TemplateIfBinding( {\n\t\t\t\t\tobservable, emitter, attribute, valueIfTrue, callback\n\t\t\t\t} );\n\t\t\t}\n\t\t};\n\t}\n\n\t/**\n\t * Extends an existing {@link module:ui/template~Template} instance with some additional content\n\t * from another {@link module:ui/template~TemplateDefinition}.\n\t *\n\t *\t\tconst bind = Template.bind( observable, emitter );\n\t *\n\t *\t\tconst template = new Template( {\n\t *\t\t\ttag: 'p',\n\t *\t\t\tattributes: {\n\t *\t\t\t\tclass: 'a',\n\t *\t\t\t\tdata-x: bind.to( 'foo' )\n\t *\t\t\t},\n\t *\t\t\tchildren: [\n\t *\t\t\t\t{\n\t *\t\t\t\t\ttag: 'span',\n\t *\t\t\t\t\tattributes: {\n\t *\t\t\t\t\t\tclass: 'b'\n\t *\t\t\t\t\t},\n\t *\t\t\t\t\tchildren: [\n\t *\t\t\t\t\t\t'Span'\n\t *\t\t\t\t\t]\n\t *\t\t\t\t}\n\t *\t\t\t]\n\t *\t\t } );\n\t *\n\t *\t\t// Instance-level extension.\n\t *\t\tTemplate.extend( template, {\n\t *\t\t\tattributes: {\n\t *\t\t\t\tclass: 'b',\n\t *\t\t\t\tdata-x: bind.to( 'bar' )\n\t *\t\t\t},\n\t *\t\t\tchildren: [\n\t *\t\t\t\t{\n\t *\t\t\t\t\tattributes: {\n\t *\t\t\t\t\t\tclass: 'c'\n\t *\t\t\t\t\t}\n\t *\t\t\t\t}\n\t *\t\t\t]\n\t *\t\t} );\n\t *\n\t *\t\t// Child extension.\n\t *\t\tTemplate.extend( template.children[ 0 ], {\n\t *\t\t\tattributes: {\n\t *\t\t\t\tclass: 'd'\n\t *\t\t\t}\n\t *\t\t} );\n\t *\n\t * the `outerHTML` of `template.render()` is:\n\t *\n\t *\t\t<p class=\"a b\" data-x=\"{ observable.foo } { observable.bar }\">\n\t *\t\t\t<span class=\"b c d\">Span</span>\n\t *\t\t</p>\n\t *\n\t * @param {module:ui/template~Template} template An existing template instance to be extended.\n\t * @param {module:ui/template~TemplateDefinition} def Additional definition to be applied to a template.\n\t */\n\tstatic extend( template, def ) {\n\t\tif ( template._isRendered ) {\n\t\t\t/**\n\t\t\t * Extending a template after rendering may not work as expected. To make sure\n\t\t\t * the {@link module:ui/template~Template.extend extending} works for an element,\n\t\t\t * make sure it happens before {@link #render} is called.\n\t\t\t *\n\t\t\t * @error template-extend-render\n\t\t\t */\n\t\t\tthrow new CKEditorError(\n\t\t\t\t'template-extend-render: Attempting to extend a template which has already been rendered.',\n\t\t\t\t[ this, template ]\n\t\t\t);\n\t\t}\n\n\t\textendTemplate( template, normalize( clone( def ) ) );\n\t}\n\n\t/**\n\t * Renders a DOM Node (either an HTML element or text) out of the template.\n\t *\n\t * @protected\n\t * @param {module:ui/template~RenderData} data Rendering data.\n\t */\n\t_renderNode( data ) {\n\t\tlet isInvalid;\n\n\t\tif ( data.node ) {\n\t\t\t// When applying, a definition cannot have \"tag\" and \"text\" at the same time.\n\t\t\tisInvalid = this.tag && this.text;\n\t\t} else {\n\t\t\t// When rendering, a definition must have either \"tag\" or \"text\": XOR( this.tag, this.text ).\n\t\t\tisInvalid = this.tag ? this.text : !this.text;\n\t\t}\n\n\t\tif ( isInvalid ) {\n\t\t\t/**\n\t\t\t * Node definition cannot have the \"tag\" and \"text\" properties at the same time.\n\t\t\t * Node definition must have either \"tag\" or \"text\" when rendering a new Node.\n\t\t\t *\n\t\t\t * @error ui-template-wrong-syntax\n\t\t\t */\n\t\t\tthrow new CKEditorError(\n\t\t\t\t'ui-template-wrong-syntax: Node definition must have either \"tag\" or \"text\" when rendering a new Node.',\n\t\t\t\tthis\n\t\t\t);\n\t\t}\n\n\t\tif ( this.text ) {\n\t\t\treturn this._renderText( data );\n\t\t} else {\n\t\t\treturn this._renderElement( data );\n\t\t}\n\t}\n\n\t/**\n\t * Renders an HTML element out of the template.\n\t *\n\t * @protected\n\t * @param {module:ui/template~RenderData} data Rendering data.\n\t */\n\t_renderElement( data ) {\n\t\tlet node = data.node;\n\n\t\tif ( !node ) {\n\t\t\tnode = data.node = document.createElementNS( this.ns || xhtmlNs, this.tag );\n\t\t}\n\n\t\tthis._renderAttributes( data );\n\t\tthis._renderElementChildren( data );\n\t\tthis._setUpListeners( data );\n\n\t\treturn node;\n\t}\n\n\t/**\n\t * Renders a text node out of {@link module:ui/template~Template#text}.\n\t *\n\t * @protected\n\t * @param {module:ui/template~RenderData} data Rendering data.\n\t */\n\t_renderText( data ) {\n\t\tlet node = data.node;\n\n\t\t// Save the original textContent to revert it in #revert().\n\t\tif ( node ) {\n\t\t\tdata.revertData.text = node.textContent;\n\t\t} else {\n\t\t\tnode = data.node = document.createTextNode( '' );\n\t\t}\n\n\t\t// Check if this Text Node is bound to Observable. Cases:\n\t\t//\n\t\t//\t\ttext: [ Template.bind( ... ).to( ... ) ]\n\t\t//\n\t\t//\t\ttext: [\n\t\t//\t\t\t'foo',\n\t\t//\t\t\tTemplate.bind( ... ).to( ... ),\n\t\t//\t\t\t...\n\t\t//\t\t]\n\t\t//\n\t\tif ( hasTemplateBinding( this.text ) ) {\n\t\t\tthis._bindToObservable( {\n\t\t\t\tschema: this.text,\n\t\t\t\tupdater: getTextUpdater( node ),\n\t\t\t\tdata\n\t\t\t} );\n\t\t}\n\t\t// Simply set text. Cases:\n\t\t//\n\t\t//\t\ttext: [ 'all', 'are', 'static' ]\n\t\t//\n\t\t//\t\ttext: [ 'foo' ]\n\t\t//\n\t\telse {\n\t\t\tnode.textContent = this.text.join( '' );\n\t\t}\n\n\t\treturn node;\n\t}\n\n\t/**\n\t * Renders HTML element attributes out of {@link module:ui/template~Template#attributes}.\n\t *\n\t * @protected\n\t * @param {module:ui/template~RenderData} data Rendering data.\n\t */\n\t_renderAttributes( data ) {\n\t\tlet attrName, attrValue, domAttrValue, attrNs;\n\n\t\tif ( !this.attributes ) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst node = data.node;\n\t\tconst revertData = data.revertData;\n\n\t\tfor ( attrName in this.attributes ) {\n\t\t\t// Current attribute value in DOM.\n\t\t\tdomAttrValue = node.getAttribute( attrName );\n\n\t\t\t// The value to be set.\n\t\t\tattrValue = this.attributes[ attrName ];\n\n\t\t\t// Save revert data.\n\t\t\tif ( revertData ) {\n\t\t\t\trevertData.attributes[ attrName ] = domAttrValue;\n\t\t\t}\n\n\t\t\t// Detect custom namespace:\n\t\t\t//\n\t\t\t//\t\tclass: {\n\t\t\t//\t\t\tns: 'abc',\n\t\t\t//\t\t\tvalue: Template.bind( ... ).to( ... )\n\t\t\t//\t\t}\n\t\t\t//\n\t\t\tattrNs = ( isObject( attrValue[ 0 ] ) && attrValue[ 0 ].ns ) ? attrValue[ 0 ].ns : null;\n\n\t\t\t// Activate binding if one is found. Cases:\n\t\t\t//\n\t\t\t//\t\tclass: [\n\t\t\t//\t\t\tTemplate.bind( ... ).to( ... )\n\t\t\t//\t\t]\n\t\t\t//\n\t\t\t//\t\tclass: [\n\t\t\t//\t\t\t'bar',\n\t\t\t//\t\t\tTemplate.bind( ... ).to( ... ),\n\t\t\t//\t\t\t'baz'\n\t\t\t//\t\t]\n\t\t\t//\n\t\t\t//\t\tclass: {\n\t\t\t//\t\t\tns: 'abc',\n\t\t\t//\t\t\tvalue: Template.bind( ... ).to( ... )\n\t\t\t//\t\t}\n\t\t\t//\n\t\t\tif ( hasTemplateBinding( attrValue ) ) {\n\t\t\t\t// Normalize attributes with additional data like namespace:\n\t\t\t\t//\n\t\t\t\t//\t\tclass: {\n\t\t\t\t//\t\t\tns: 'abc',\n\t\t\t\t//\t\t\tvalue: [ ... ]\n\t\t\t\t//\t\t}\n\t\t\t\t//\n\t\t\t\tconst valueToBind = attrNs ? attrValue[ 0 ].value : attrValue;\n\n\t\t\t\t// Extend the original value of attributes like \"style\" and \"class\",\n\t\t\t\t// don't override them.\n\t\t\t\tif ( revertData && shouldExtend( attrName ) ) {\n\t\t\t\t\tvalueToBind.unshift( domAttrValue );\n\t\t\t\t}\n\n\t\t\t\tthis._bindToObservable( {\n\t\t\t\t\tschema: valueToBind,\n\t\t\t\t\tupdater: getAttributeUpdater( node, attrName, attrNs ),\n\t\t\t\t\tdata\n\t\t\t\t} );\n\t\t\t}\n\n\t\t\t// Style attribute could be an Object so it needs to be parsed in a specific way.\n\t\t\t//\n\t\t\t//\t\tstyle: {\n\t\t\t//\t\t\twidth: '100px',\n\t\t\t//\t\t\theight: Template.bind( ... ).to( ... )\n\t\t\t//\t\t}\n\t\t\t//\n\t\t\telse if ( attrName == 'style' && typeof attrValue[ 0 ] !== 'string' ) {\n\t\t\t\tthis._renderStyleAttribute( attrValue[ 0 ], data );\n\t\t\t}\n\n\t\t\t// Otherwise simply set the static attribute:\n\t\t\t//\n\t\t\t//\t\tclass: [ 'foo' ]\n\t\t\t//\n\t\t\t//\t\tclass: [ 'all', 'are', 'static' ]\n\t\t\t//\n\t\t\t//\t\tclass: [\n\t\t\t//\t\t\t{\n\t\t\t//\t\t\t\tns: 'abc',\n\t\t\t//\t\t\t\tvalue: [ 'foo' ]\n\t\t\t//\t\t\t}\n\t\t\t//\t\t]\n\t\t\t//\n\t\t\telse {\n\t\t\t\t// Extend the original value of attributes like \"style\" and \"class\",\n\t\t\t\t// don't override them.\n\t\t\t\tif ( revertData && domAttrValue && shouldExtend( attrName ) ) {\n\t\t\t\t\tattrValue.unshift( domAttrValue );\n\t\t\t\t}\n\n\t\t\t\tattrValue = attrValue\n\t\t\t\t\t// Retrieve \"values\" from:\n\t\t\t\t\t//\n\t\t\t\t\t//\t\tclass: [\n\t\t\t\t\t//\t\t\t{\n\t\t\t\t\t//\t\t\t\tns: 'abc',\n\t\t\t\t\t//\t\t\t\tvalue: [ ... ]\n\t\t\t\t\t//\t\t\t}\n\t\t\t\t\t//\t\t]\n\t\t\t\t\t//\n\t\t\t\t\t.map( val => val ? ( val.value || val ) : val )\n\t\t\t\t\t// Flatten the array.\n\t\t\t\t\t.reduce( ( prev, next ) => prev.concat( next ), [] )\n\t\t\t\t\t// Convert into string.\n\t\t\t\t\t.reduce( arrayValueReducer, '' );\n\n\t\t\t\tif ( !isFalsy( attrValue ) ) {\n\t\t\t\t\tnode.setAttributeNS( attrNs, attrName, attrValue );\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Renders the `style` attribute of an HTML element based on\n\t * {@link module:ui/template~Template#attributes}.\n\t *\n\t * A style attribute is an {Object} with static values:\n\t *\n\t *\t\tattributes: {\n\t *\t\t\tstyle: {\n\t *\t\t\t\tcolor: 'red'\n\t *\t\t\t}\n\t *\t\t}\n\t *\n\t * or values bound to {@link module:ui/model~Model} properties:\n\t *\n\t *\t\tattributes: {\n\t *\t\t\tstyle: {\n\t *\t\t\t\tcolor: bind.to( ... )\n\t *\t\t\t}\n\t *\t\t}\n\t *\n\t * Note: The `style` attribute is rendered without setting the namespace. It does not seem to be\n\t * needed.\n\t *\n\t * @private\n\t * @param {Object} styles Styles located in `attributes.style` of {@link module:ui/template~TemplateDefinition}.\n\t * @param {module:ui/template~RenderData} data Rendering data.\n\t */\n\t_renderStyleAttribute( styles, data ) {\n\t\tconst node = data.node;\n\n\t\tfor ( const styleName in styles ) {\n\t\t\tconst styleValue = styles[ styleName ];\n\n\t\t\t// Cases:\n\t\t\t//\n\t\t\t//\t\tstyle: {\n\t\t\t//\t\t\tcolor: bind.to( 'attribute' )\n\t\t\t//\t\t}\n\t\t\t//\n\t\t\tif ( hasTemplateBinding( styleValue ) ) {\n\t\t\t\tthis._bindToObservable( {\n\t\t\t\t\tschema: [ styleValue ],\n\t\t\t\t\tupdater: getStyleUpdater( node, styleName ),\n\t\t\t\t\tdata\n\t\t\t\t} );\n\t\t\t}\n\n\t\t\t// Cases:\n\t\t\t//\n\t\t\t//\t\tstyle: {\n\t\t\t//\t\t\tcolor: 'red'\n\t\t\t//\t\t}\n\t\t\t//\n\t\t\telse {\n\t\t\t\tnode.style[ styleName ] = styleValue;\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Recursively renders HTML element's children from {@link module:ui/template~Template#children}.\n\t *\n\t * @protected\n\t * @param {module:ui/template~RenderData} data Rendering data.\n\t */\n\t_renderElementChildren( data ) {\n\t\tconst node = data.node;\n\t\tconst container = data.intoFragment ? document.createDocumentFragment() : node;\n\t\tconst isApplying = data.isApplying;\n\t\tlet childIndex = 0;\n\n\t\tfor ( const child of this.children ) {\n\t\t\tif ( isViewCollection( child ) ) {\n\t\t\t\tif ( !isApplying ) {\n\t\t\t\t\tchild.setParent( node );\n\n\t\t\t\t\t// Note: ViewCollection renders its children.\n\t\t\t\t\tfor ( const view of child ) {\n\t\t\t\t\t\tcontainer.appendChild( view.element );\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else if ( isView( child ) ) {\n\t\t\t\tif ( !isApplying ) {\n\t\t\t\t\tif ( !child.isRendered ) {\n\t\t\t\t\t\tchild.render();\n\t\t\t\t\t}\n\n\t\t\t\t\tcontainer.appendChild( child.element );\n\t\t\t\t}\n\t\t\t} else if ( isNode( child ) ) {\n\t\t\t\tcontainer.appendChild( child );\n\t\t\t} else {\n\t\t\t\tif ( isApplying ) {\n\t\t\t\t\tconst revertData = data.revertData;\n\t\t\t\t\tconst childRevertData = getEmptyRevertData();\n\n\t\t\t\t\trevertData.children.push( childRevertData );\n\n\t\t\t\t\tchild._renderNode( {\n\t\t\t\t\t\tnode: container.childNodes[ childIndex++ ],\n\t\t\t\t\t\tisApplying: true,\n\t\t\t\t\t\trevertData: childRevertData\n\t\t\t\t\t} );\n\t\t\t\t} else {\n\t\t\t\t\tcontainer.appendChild( child.render() );\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif ( data.intoFragment ) {\n\t\t\tnode.appendChild( container );\n\t\t}\n\t}\n\n\t/**\n\t * Activates `on` event listeners from the {@link module:ui/template~TemplateDefinition}\n\t * on an HTML element.\n\t *\n\t * @protected\n\t * @param {module:ui/template~RenderData} data Rendering data.\n\t */\n\t_setUpListeners( data ) {\n\t\tif ( !this.eventListeners ) {\n\t\t\treturn;\n\t\t}\n\n\t\tfor ( const key in this.eventListeners ) {\n\t\t\tconst revertBindings = this.eventListeners[ key ].map( schemaItem => {\n\t\t\t\tconst [ domEvtName, domSelector ] = key.split( '@' );\n\n\t\t\t\treturn schemaItem.activateDomEventListener( domEvtName, domSelector, data );\n\t\t\t} );\n\n\t\t\tif ( data.revertData ) {\n\t\t\t\tdata.revertData.bindings.push( revertBindings );\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * For a given {@link module:ui/template~TemplateValueSchema} containing {@link module:ui/template~TemplateBinding}\n\t * activates the binding and sets its initial value.\n\t *\n\t * Note: {@link module:ui/template~TemplateValueSchema} can be for HTML element attributes or\n\t * text node `textContent`.\n\t *\n\t * @protected\n\t * @param {Object} options Binding options.\n\t * @param {module:ui/template~TemplateValueSchema} options.schema\n\t * @param {Function} options.updater A function which updates the DOM (like attribute or text).\n\t * @param {module:ui/template~RenderData} options.data Rendering data.\n\t */\n\t_bindToObservable( { schema, updater, data } ) {\n\t\tconst revertData = data.revertData;\n\n\t\t// Set initial values.\n\t\tsyncValueSchemaValue( schema, updater, data );\n\n\t\tconst revertBindings = schema\n\t\t\t// Filter \"falsy\" (false, undefined, null, '') value schema components out.\n\t\t\t.filter( item => !isFalsy( item ) )\n\t\t\t// Filter inactive bindings from schema, like static strings ('foo'), numbers (42), etc.\n\t\t\t.filter( item => item.observable )\n\t\t\t// Once only the actual binding are left, let the emitter listen to observable change:attribute event.\n\t\t\t// TODO: Reduce the number of listeners attached as many bindings may listen\n\t\t\t// to the same observable attribute.\n\t\t\t.map( templateBinding => templateBinding.activateAttributeListener( schema, updater, data ) );\n\n\t\tif ( revertData ) {\n\t\t\trevertData.bindings.push( revertBindings );\n\t\t}\n\t}\n\n\t/**\n\t * Reverts {@link module:ui/template~RenderData#revertData template data} from a node to\n\t * return it to the original state.\n\t *\n\t * @protected\n\t * @param {HTMLElement|Text} node A node to be reverted.\n\t * @param {Object} revertData An object that stores information about what changes have been made by\n\t * {@link #apply} to the node. See {@link module:ui/template~RenderData#revertData} for more information.\n\t */\n\t_revertTemplateFromNode( node, revertData ) {\n\t\tfor ( const binding of revertData.bindings ) {\n\t\t\t// Each binding may consist of several observable+observable#attribute.\n\t\t\t// like the following has 2:\n\t\t\t//\n\t\t\t//\t\tclass: [\n\t\t\t//\t\t\t'x',\n\t\t\t//\t\t\tbind.to( 'foo' ),\n\t\t\t//\t\t\t'y',\n\t\t\t//\t\t\tbind.to( 'bar' )\n\t\t\t//\t\t]\n\t\t\t//\n\t\t\tfor ( const revertBinding of binding ) {\n\t\t\t\trevertBinding();\n\t\t\t}\n\t\t}\n\n\t\tif ( revertData.text ) {\n\t\t\tnode.textContent = revertData.text;\n\n\t\t\treturn;\n\t\t}\n\n\t\tfor ( const attrName in revertData.attributes ) {\n\t\t\tconst attrValue = revertData.attributes[ attrName ];\n\n\t\t\t// When the attribute has **not** been set before #apply().\n\t\t\tif ( attrValue === null ) {\n\t\t\t\tnode.removeAttribute( attrName );\n\t\t\t} else {\n\t\t\t\tnode.setAttribute( attrName, attrValue );\n\t\t\t}\n\t\t}\n\n\t\tfor ( let i = 0; i < revertData.children.length; ++i ) {\n\t\t\tthis._revertTemplateFromNode( node.childNodes[ i ], revertData.children[ i ] );\n\t\t}\n\t}\n}\n\nmix( Template, EmitterMixin );\n\n/**\n * Describes a binding created by the {@link module:ui/template~Template.bind} interface.\n *\n * @protected\n */\nexport class TemplateBinding {\n\t/**\n\t * Creates an instance of the {@link module:ui/template~TemplateBinding} class.\n\t *\n\t * @param {module:ui/template~TemplateDefinition} def The definition of the binding.\n\t */\n\tconstructor( def ) {\n\t\tObject.assign( this, def );\n\n\t\t/**\n\t\t * An observable instance of the binding. It either:\n\t\t *\n\t\t * * provides the attribute with the value,\n\t\t * * or passes the event when a corresponding DOM event is fired.\n\t\t *\n\t\t * @member {module:utils/observablemixin~ObservableMixin} module:ui/template~TemplateBinding#observable\n\t\t */\n\n\t\t/**\n\t\t * An {@link module:utils/emittermixin~Emitter} used by the binding to:\n\t\t *\n\t\t * * listen to the attribute change in the {@link module:ui/template~TemplateBinding#observable},\n\t\t * * or listen to the event in the DOM.\n\t\t *\n\t\t * @member {module:utils/emittermixin~EmitterMixin} module:ui/template~TemplateBinding#emitter\n\t\t */\n\n\t\t/**\n\t\t * The name of the {@link module:ui/template~TemplateBinding#observable observed attribute}.\n\t\t *\n\t\t * @member {String} module:ui/template~TemplateBinding#attribute\n\t\t */\n\n\t\t/**\n\t\t * A custom function to process the value of the {@link module:ui/template~TemplateBinding#attribute}.\n\t\t *\n\t\t * @member {Function} [module:ui/template~TemplateBinding#callback]\n\t\t */\n\t}\n\n\t/**\n\t * Returns the value of the binding. It is the value of the {@link module:ui/template~TemplateBinding#attribute} in\n\t * {@link module:ui/template~TemplateBinding#observable}. The value may be processed by the\n\t * {@link module:ui/template~TemplateBinding#callback}, if such has been passed to the binding.\n\t *\n\t * @param {Node} [node] A native DOM node, passed to the custom {@link module:ui/template~TemplateBinding#callback}.\n\t * @returns {*} The value of {@link module:ui/template~TemplateBinding#attribute} in\n\t * {@link module:ui/template~TemplateBinding#observable}.\n\t */\n\tgetValue( node ) {\n\t\tconst value = this.observable[ this.attribute ];\n\n\t\treturn this.callback ? this.callback( value, node ) : value;\n\t}\n\n\t/**\n\t * Activates the listener which waits for changes of the {@link module:ui/template~TemplateBinding#attribute} in\n\t * {@link module:ui/template~TemplateBinding#observable}, then updates the DOM with the aggregated\n\t * value of {@link module:ui/template~TemplateValueSchema}.\n\t *\n\t * @param {module:ui/template~TemplateValueSchema} schema A full schema to generate an attribute or text in the DOM.\n\t * @param {Function} updater A DOM updater function used to update the native DOM attribute or text.\n\t * @param {module:ui/template~RenderData} data Rendering data.\n\t * @returns {Function} A function to sever the listener binding.\n\t */\n\tactivateAttributeListener( schema, updater, data ) {\n\t\tconst callback = () => syncValueSchemaValue( schema, updater, data );\n\n\t\tthis.emitter.listenTo( this.observable, 'change:' + this.attribute, callback );\n\n\t\t// Allows revert of the listener.\n\t\treturn () => {\n\t\t\tthis.emitter.stopListening( this.observable, 'change:' + this.attribute, callback );\n\t\t};\n\t}\n}\n\n/**\n * Describes either:\n *\n * * a binding to an {@link module:utils/observablemixin~Observable},\n * * or a native DOM event binding.\n *\n * It is created by the {@link module:ui/template~BindChain#to} method.\n *\n * @protected\n */\nexport class TemplateToBinding extends TemplateBinding {\n\t/**\n\t * Activates the listener for the native DOM event, which when fired, is propagated by\n\t * the {@link module:ui/template~TemplateBinding#emitter}.\n\t *\n\t * @param {String} domEvtName The name of the native DOM event.\n\t * @param {String} domSelector The selector in the DOM to filter delegated events.\n\t * @param {module:ui/template~RenderData} data Rendering data.\n\t * @returns {Function} A function to sever the listener binding.\n\t */\n\tactivateDomEventListener( domEvtName, domSelector, data ) {\n\t\tconst callback = ( evt, domEvt ) => {\n\t\t\tif ( !domSelector || domEvt.target.matches( domSelector ) ) {\n\t\t\t\tif ( typeof this.eventNameOrFunction == 'function' ) {\n\t\t\t\t\tthis.eventNameOrFunction( domEvt );\n\t\t\t\t} else {\n\t\t\t\t\tthis.observable.fire( this.eventNameOrFunction, domEvt );\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tthis.emitter.listenTo( data.node, domEvtName, callback );\n\n\t\t// Allows revert of the listener.\n\t\treturn () => {\n\t\t\tthis.emitter.stopListening( data.node, domEvtName, callback );\n\t\t};\n\t}\n}\n\n/**\n * Describes a binding to {@link module:utils/observablemixin~ObservableMixin} created by the {@link module:ui/template~BindChain#if}\n * method.\n *\n * @protected\n */\nexport class TemplateIfBinding extends TemplateBinding {\n\t/**\n\t * @inheritDoc\n\t */\n\tgetValue( node ) {\n\t\tconst value = super.getValue( node );\n\n\t\treturn isFalsy( value ) ? false : ( this.valueIfTrue || true );\n\t}\n\n\t/**\n\t * The value of the DOM attribute or text to be set if the {@link module:ui/template~TemplateBinding#attribute} in\n\t * {@link module:ui/template~TemplateBinding#observable} is `true`.\n\t *\n\t * @member {String} [module:ui/template~TemplateIfBinding#valueIfTrue]\n\t */\n}\n\n// Checks whether given {@link module:ui/template~TemplateValueSchema} contains a\n// {@link module:ui/template~TemplateBinding}.\n//\n// @param {module:ui/template~TemplateValueSchema} schema\n// @returns {Boolean}\nfunction hasTemplateBinding( schema ) {\n\tif ( !schema ) {\n\t\treturn false;\n\t}\n\n\t// Normalize attributes with additional data like namespace:\n\t//\n\t//\t\tclass: {\n\t//\t\t\tns: 'abc',\n\t//\t\t\tvalue: [ ... ]\n\t//\t\t}\n\t//\n\tif ( schema.value ) {\n\t\tschema = schema.value;\n\t}\n\n\tif ( Array.isArray( schema ) ) {\n\t\treturn schema.some( hasTemplateBinding );\n\t} else if ( schema instanceof TemplateBinding ) {\n\t\treturn true;\n\t}\n\n\treturn false;\n}\n\n// Assembles the value using {@link module:ui/template~TemplateValueSchema} and stores it in a form of\n// an Array. Each entry of the Array corresponds to one of {@link module:ui/template~TemplateValueSchema}\n// items.\n//\n// @param {module:ui/template~TemplateValueSchema} schema\n// @param {Node} node DOM Node updated when {@link module:utils/observablemixin~ObservableMixin} changes.\n// @returns {Array}\nfunction getValueSchemaValue( schema, node ) {\n\treturn schema.map( schemaItem => {\n\t\t// Process {@link module:ui/template~TemplateBinding} bindings.\n\t\tif ( schemaItem instanceof TemplateBinding ) {\n\t\t\treturn schemaItem.getValue( node );\n\t\t}\n\n\t\t// All static values like strings, numbers, and \"falsy\" values (false, null, undefined, '', etc.) just pass.\n\t\treturn schemaItem;\n\t} );\n}\n\n// A function executed each time the bound Observable attribute changes, which updates the DOM with a value\n// constructed from {@link module:ui/template~TemplateValueSchema}.\n//\n// @param {module:ui/template~TemplateValueSchema} schema\n// @param {Function} updater A function which updates the DOM (like attribute or text).\n// @param {Node} node DOM Node updated when {@link module:utils/observablemixin~ObservableMixin} changes.\nfunction syncValueSchemaValue( schema, updater, { node } ) {\n\tlet value = getValueSchemaValue( schema, node );\n\n\t// Check if schema is a single Template.bind.if, like:\n\t//\n\t//\t\tclass: Template.bind.if( 'foo' )\n\t//\n\tif ( schema.length == 1 && schema[ 0 ] instanceof TemplateIfBinding ) {\n\t\tvalue = value[ 0 ];\n\t} else {\n\t\tvalue = value.reduce( arrayValueReducer, '' );\n\t}\n\n\tif ( isFalsy( value ) ) {\n\t\tupdater.remove();\n\t} else {\n\t\tupdater.set( value );\n\t}\n}\n\n// Returns an object consisting of `set` and `remove` functions, which\n// can be used in the context of DOM Node to set or reset `textContent`.\n// @see module:ui/view~View#_bindToObservable\n//\n// @param {Node} node DOM Node to be modified.\n// @returns {Object}\nfunction getTextUpdater( node ) {\n\treturn {\n\t\tset( value ) {\n\t\t\tnode.textContent = value;\n\t\t},\n\n\t\tremove() {\n\t\t\tnode.textContent = '';\n\t\t}\n\t};\n}\n\n// Returns an object consisting of `set` and `remove` functions, which\n// can be used in the context of DOM Node to set or reset an attribute.\n// @see module:ui/view~View#_bindToObservable\n//\n// @param {Node} node DOM Node to be modified.\n// @param {String} attrName Name of the attribute to be modified.\n// @param {String} [ns=null] Namespace to use.\n// @returns {Object}\nfunction getAttributeUpdater( el, attrName, ns ) {\n\treturn {\n\t\tset( value ) {\n\t\t\tel.setAttributeNS( ns, attrName, value );\n\t\t},\n\n\t\tremove() {\n\t\t\tel.removeAttributeNS( ns, attrName );\n\t\t}\n\t};\n}\n\n// Returns an object consisting of `set` and `remove` functions, which\n// can be used in the context of CSSStyleDeclaration to set or remove a style.\n// @see module:ui/view~View#_bindToObservable\n//\n// @param {Node} node DOM Node to be modified.\n// @param {String} styleName Name of the style to be modified.\n// @returns {Object}\nfunction getStyleUpdater( el, styleName ) {\n\treturn {\n\t\tset( value ) {\n\t\t\tel.style[ styleName ] = value;\n\t\t},\n\n\t\tremove() {\n\t\t\tel.style[ styleName ] = null;\n\t\t}\n\t};\n}\n\n// Clones definition of the template.\n//\n// @param {module:ui/template~TemplateDefinition} def\n// @returns {module:ui/template~TemplateDefinition}\nfunction clone( def ) {\n\tconst clone = cloneDeepWith( def, value => {\n\t\t// Don't clone the `Template.bind`* bindings because of the references to Observable\n\t\t// and DomEmitterMixin instances inside, which would also be traversed and cloned by greedy\n\t\t// cloneDeepWith algorithm. There's no point in cloning Observable/DomEmitterMixins\n\t\t// along with the definition.\n\t\t//\n\t\t// Don't clone Template instances if provided as a child. They're simply #render()ed\n\t\t// and nothing should interfere.\n\t\t//\n\t\t// Also don't clone View instances if provided as a child of the Template. The template\n\t\t// instance will be extracted from the View during the normalization and there's no need\n\t\t// to clone it.\n\t\tif ( value && ( value instanceof TemplateBinding || isTemplate( value ) || isView( value ) || isViewCollection( value ) ) ) {\n\t\t\treturn value;\n\t\t}\n\t} );\n\n\treturn clone;\n}\n\n// Normalizes given {@link module:ui/template~TemplateDefinition}.\n//\n// See:\n//  * {@link normalizeAttributes}\n//  * {@link normalizeListeners}\n//  * {@link normalizePlainTextDefinition}\n//  * {@link normalizeTextDefinition}\n//\n// @param {module:ui/template~TemplateDefinition} def\n// @returns {module:ui/template~TemplateDefinition} Normalized definition.\nfunction normalize( def ) {\n\tif ( typeof def == 'string' ) {\n\t\tdef = normalizePlainTextDefinition( def );\n\t} else if ( def.text ) {\n\t\tnormalizeTextDefinition( def );\n\t}\n\n\tif ( def.on ) {\n\t\tdef.eventListeners = normalizeListeners( def.on );\n\n\t\t// Template mixes EmitterMixin, so delete #on to avoid collision.\n\t\tdelete def.on;\n\t}\n\n\tif ( !def.text ) {\n\t\tif ( def.attributes ) {\n\t\t\tnormalizeAttributes( def.attributes );\n\t\t}\n\n\t\tconst children = [];\n\n\t\tif ( def.children ) {\n\t\t\tif ( isViewCollection( def.children ) ) {\n\t\t\t\tchildren.push( def.children );\n\t\t\t} else {\n\t\t\t\tfor ( const child of def.children ) {\n\t\t\t\t\tif ( isTemplate( child ) || isView( child ) || isNode( child ) ) {\n\t\t\t\t\t\tchildren.push( child );\n\t\t\t\t\t} else {\n\t\t\t\t\t\tchildren.push( new Template( child ) );\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tdef.children = children;\n\t}\n\n\treturn def;\n}\n\n// Normalizes \"attributes\" section of {@link module:ui/template~TemplateDefinition}.\n//\n//\t\tattributes: {\n//\t\t\ta: 'bar',\n//\t\t\tb: {@link module:ui/template~TemplateBinding},\n//\t\t\tc: {\n//\t\t\t\tvalue: 'bar'\n//\t\t\t}\n//\t\t}\n//\n// becomes\n//\n//\t\tattributes: {\n//\t\t\ta: [ 'bar' ],\n//\t\t\tb: [ {@link module:ui/template~TemplateBinding} ],\n//\t\t\tc: {\n//\t\t\t\tvalue: [ 'bar' ]\n//\t\t\t}\n//\t\t}\n//\n// @param {Object} attributes\nfunction normalizeAttributes( attributes ) {\n\tfor ( const a in attributes ) {\n\t\tif ( attributes[ a ].value ) {\n\t\t\tattributes[ a ].value = [].concat( attributes[ a ].value );\n\t\t}\n\n\t\tarrayify( attributes, a );\n\t}\n}\n\n// Normalizes \"on\" section of {@link module:ui/template~TemplateDefinition}.\n//\n//\t\ton: {\n//\t\t\ta: 'bar',\n//\t\t\tb: {@link module:ui/template~TemplateBinding},\n//\t\t\tc: [ {@link module:ui/template~TemplateBinding}, () => { ... } ]\n//\t\t}\n//\n// becomes\n//\n//\t\ton: {\n//\t\t\ta: [ 'bar' ],\n//\t\t\tb: [ {@link module:ui/template~TemplateBinding} ],\n//\t\t\tc: [ {@link module:ui/template~TemplateBinding}, () => { ... } ]\n//\t\t}\n//\n// @param {Object} listeners\n// @returns {Object} Object containing normalized listeners.\nfunction normalizeListeners( listeners ) {\n\tfor ( const l in listeners ) {\n\t\tarrayify( listeners, l );\n\t}\n\n\treturn listeners;\n}\n\n// Normalizes \"string\" {@link module:ui/template~TemplateDefinition}.\n//\n//\t\t\"foo\"\n//\n// becomes\n//\n//\t\t{ text: [ 'foo' ] },\n//\n// @param {String} def\n// @returns {module:ui/template~TemplateDefinition} Normalized template definition.\nfunction normalizePlainTextDefinition( def ) {\n\treturn {\n\t\ttext: [ def ]\n\t};\n}\n\n// Normalizes text {@link module:ui/template~TemplateDefinition}.\n//\n//\t\tchildren: [\n//\t\t\t{ text: 'def' },\n//\t\t\t{ text: {@link module:ui/template~TemplateBinding} }\n//\t\t]\n//\n// becomes\n//\n//\t\tchildren: [\n//\t\t\t{ text: [ 'def' ] },\n//\t\t\t{ text: [ {@link module:ui/template~TemplateBinding} ] }\n//\t\t]\n//\n// @param {module:ui/template~TemplateDefinition} def\nfunction normalizeTextDefinition( def ) {\n\tif ( !Array.isArray( def.text ) ) {\n\t\tdef.text = [ def.text ];\n\t}\n}\n\n// Wraps an entry in Object in an Array, if not already one.\n//\n//\t\t{\n//\t\t\tx: 'y',\n//\t\t\ta: [ 'b' ]\n//\t\t}\n//\n// becomes\n//\n//\t\t{\n//\t\t\tx: [ 'y' ],\n//\t\t\ta: [ 'b' ]\n//\t\t}\n//\n// @param {Object} obj\n// @param {String} key\nfunction arrayify( obj, key ) {\n\tif ( !Array.isArray( obj[ key ] ) ) {\n\t\tobj[ key ] = [ obj[ key ] ];\n\t}\n}\n\n// A helper which concatenates the value avoiding unwanted\n// leading white spaces.\n//\n// @param {String} prev\n// @param {String} cur\n// @returns {String}\nfunction arrayValueReducer( prev, cur ) {\n\tif ( isFalsy( cur ) ) {\n\t\treturn prev;\n\t} else if ( isFalsy( prev ) ) {\n\t\treturn cur;\n\t} else {\n\t\treturn `${ prev } ${ cur }`;\n\t}\n}\n\n// Extends one object defined in the following format:\n//\n//\t\t{\n//\t\t\tkey1: [Array1],\n//\t\t\tkey2: [Array2],\n//\t\t\t...\n//\t\t\tkeyN: [ArrayN]\n//\t\t}\n//\n// with another object of the same data format.\n//\n// @param {Object} obj Base object.\n// @param {Object} ext Object extending base.\n// @returns {String}\nfunction extendObjectValueArray( obj, ext ) {\n\tfor ( const a in ext ) {\n\t\tif ( obj[ a ] ) {\n\t\t\tobj[ a ].push( ...ext[ a ] );\n\t\t} else {\n\t\t\tobj[ a ] = ext[ a ];\n\t\t}\n\t}\n}\n\n// A helper for {@link module:ui/template~Template#extend}. Recursively extends {@link module:ui/template~Template} instance\n// with content from {@link module:ui/template~TemplateDefinition}. See {@link module:ui/template~Template#extend} to learn more.\n//\n// @param {module:ui/template~Template} def A template instance to be extended.\n// @param {module:ui/template~TemplateDefinition} def A definition which is to extend the template instance.\n// @param {Object} Error context.\nfunction extendTemplate( template, def ) {\n\tif ( def.attributes ) {\n\t\tif ( !template.attributes ) {\n\t\t\ttemplate.attributes = {};\n\t\t}\n\n\t\textendObjectValueArray( template.attributes, def.attributes );\n\t}\n\n\tif ( def.eventListeners ) {\n\t\tif ( !template.eventListeners ) {\n\t\t\ttemplate.eventListeners = {};\n\t\t}\n\n\t\textendObjectValueArray( template.eventListeners, def.eventListeners );\n\t}\n\n\tif ( def.text ) {\n\t\ttemplate.text.push( ...def.text );\n\t}\n\n\tif ( def.children && def.children.length ) {\n\t\tif ( template.children.length != def.children.length ) {\n\t\t\t/**\n\t\t\t * The number of children in extended definition does not match.\n\t\t\t *\n\t\t\t * @error ui-template-extend-children-mismatch\n\t\t\t */\n\t\t\tthrow new CKEditorError(\n\t\t\t\t'ui-template-extend-children-mismatch: The number of children in extended definition does not match.',\n\t\t\t\ttemplate\n\t\t\t);\n\t\t}\n\n\t\tlet childIndex = 0;\n\n\t\tfor ( const childDef of def.children ) {\n\t\t\textendTemplate( template.children[ childIndex++ ], childDef );\n\t\t}\n\t}\n}\n\n// Checks if value is \"falsy\".\n// Note: 0 (Number) is not \"falsy\" in this context.\n//\n// @private\n// @param {*} value Value to be checked.\nfunction isFalsy( value ) {\n\treturn !value && value !== 0;\n}\n\n// Checks if the item is an instance of {@link module:ui/view~View}\n//\n// @private\n// @param {*} value Value to be checked.\nfunction isView( item ) {\n\treturn item instanceof View;\n}\n\n// Checks if the item is an instance of {@link module:ui/template~Template}\n//\n// @private\n// @param {*} value Value to be checked.\nfunction isTemplate( item ) {\n\treturn item instanceof Template;\n}\n\n// Checks if the item is an instance of {@link module:ui/viewcollection~ViewCollection}\n//\n// @private\n// @param {*} value Value to be checked.\nfunction isViewCollection( item ) {\n\treturn item instanceof ViewCollection;\n}\n\n// Creates an empty skeleton for {@link module:ui/template~Template#revert}\n// data.\n//\n// @private\nfunction getEmptyRevertData() {\n\treturn {\n\t\tchildren: [],\n\t\tbindings: [],\n\t\tattributes: {}\n\t};\n}\n\n// Checks whether an attribute should be extended when\n// {@link module:ui/template~Template#apply} is called.\n//\n// @private\n// @param {String} attrName Attribute name to check.\nfunction shouldExtend( attrName ) {\n\treturn attrName == 'class' || attrName == 'style';\n}\n\n/**\n * A definition of the {@link module:ui/template~Template}. It describes what kind of\n * node a template will render (HTML element or text), attributes of an element, DOM event\n * listeners and children.\n *\n * Also see:\n * * {@link module:ui/template~TemplateValueSchema} to learn about HTML element attributes,\n * * {@link module:ui/template~TemplateListenerSchema} to learn about DOM event listeners.\n *\n * A sample definition on an HTML element can look like this:\n *\n *\t\tnew Template( {\n *\t\t\ttag: 'p',\n *\t\t\tchildren: [\n *\t\t\t\t{\n *\t\t\t\t\ttag: 'span',\n *\t\t\t\t\tattributes: { ... },\n *\t\t\t\t\tchildren: [ ... ],\n *\t\t\t\t},\n *\t\t\t\t{\n *\t\t\t\t\ttext: 'static–text'\n *\t\t\t\t},\n *\t\t\t\t'also-static–text',\n *\t\t\t],\n *\t\t\tattributes: {\n *\t\t\t\tclass: {@link module:ui/template~TemplateValueSchema},\n *\t\t\t\tid: {@link module:ui/template~TemplateValueSchema},\n *\t\t\t\tstyle: {@link module:ui/template~TemplateValueSchema}\n *\n *\t\t\t\t// ...\n *\t\t\t},\n *\t\t\ton: {\n *\t\t\t\t'click': {@link module:ui/template~TemplateListenerSchema}\n *\n *\t\t\t\t// Document.querySelector format is also accepted.\n *\t\t\t\t'keyup@a.some-class': {@link module:ui/template~TemplateListenerSchema}\n *\n *\t\t\t\t// ...\n *\t\t\t}\n *\t\t} );\n *\n * A {@link module:ui/view~View}, another {@link module:ui/template~Template} or a native DOM node\n * can also become a child of a template. When a view is passed, its {@link module:ui/view~View#element} is used:\n *\n *\t\tconst view = new SomeView();\n *\t\tconst childTemplate = new Template( { ... } );\n *\t\tconst childNode = document.createElement( 'b' );\n *\n *\t\tnew Template( {\n *\t\t\ttag: 'p',\n *\n *\t\t\tchildren: [\n *\t\t\t\t// view#element will be added as a child of this <p>.\n *\t\t\t\tview,\n *\n * \t\t\t\t// The output of childTemplate.render() will be added here.\n *\t\t\t\tchildTemplate,\n *\n *\t\t\t\t// Native DOM nodes are included directly in the rendered output.\n *\t\t\t\tchildNode\n *\t\t\t]\n *\t\t} );\n *\n * An entire {@link module:ui/viewcollection~ViewCollection} can be used as a child in the definition:\n *\n *\t\tconst collection = new ViewCollection();\n *\t\tcollection.add( someView );\n *\n *\t\tnew Template( {\n *\t\t\ttag: 'p',\n *\n *\t\t\tchildren: collection\n *\t\t} );\n *\n * @typedef module:ui/template~TemplateDefinition\n * @type Object\n *\n * @property {String} tag See the template {@link module:ui/template~Template#tag} property.\n *\n * @property {Array.<module:ui/template~TemplateDefinition>} [children]\n * See the template {@link module:ui/template~Template#children} property.\n *\n * @property {Object.<String, module:ui/template~TemplateValueSchema>} [attributes]\n * See the template {@link module:ui/template~Template#attributes} property.\n *\n * @property {String|module:ui/template~TemplateValueSchema|Array.<String|module:ui/template~TemplateValueSchema>} [text]\n * See the template {@link module:ui/template~Template#text} property.\n *\n * @property {Object.<String, module:ui/template~TemplateListenerSchema>} [on]\n * See the template {@link module:ui/template~Template#eventListeners} property.\n */\n\n/**\n * Describes a value of an HTML element attribute or `textContent`. It allows combining multiple\n * data sources like static values and {@link module:utils/observablemixin~Observable} attributes.\n *\n * Also see:\n * * {@link module:ui/template~TemplateDefinition} to learn where to use it,\n * * {@link module:ui/template~Template.bind} to learn how to configure\n * {@link module:utils/observablemixin~Observable} attribute bindings,\n * * {@link module:ui/template~Template#render} to learn how to render a template,\n * * {@link module:ui/template~BindChain#to `to()`} and {@link module:ui/template~BindChain#if `if()`}\n * methods to learn more about bindings.\n *\n * Attribute values can be described in many different ways:\n *\n *\t\t// Bind helper will create bindings to attributes of the observable.\n *\t\tconst bind = Template.bind( observable, emitter );\n *\n *\t\tnew Template( {\n *\t\t\ttag: 'p',\n *\t\t\tattributes: {\n *\t\t\t\t// A plain string schema.\n *\t\t\t\t'class': 'static-text',\n *\n *\t\t\t\t// An object schema, binds to the \"foo\" attribute of the\n *\t\t\t\t// observable and follows its value.\n *\t\t\t\t'class': bind.to( 'foo' ),\n *\n *\t\t\t\t// An array schema, combines the above.\n *\t\t\t\t'class': [\n *\t\t\t\t\t'static-text',\n *\t\t\t\t\tbind.to( 'bar', () => { ... } ),\n *\n * \t\t\t\t\t// Bindings can also be conditional.\n *\t\t\t\t\tbind.if( 'baz', 'class-when-baz-is-true' )\n *\t\t\t\t],\n *\n *\t\t\t\t// An array schema, with a custom namespace, e.g. useful for creating SVGs.\n *\t\t\t\t'class': {\n *\t\t\t\t\tns: 'http://ns.url',\n *\t\t\t\t\tvalue: [\n *\t\t\t\t\t\tbind.if( 'baz', 'value-when-true' ),\n *\t\t\t\t\t\t'static-text'\n *\t\t\t\t\t]\n *\t\t\t\t},\n *\n *\t\t\t\t// An object schema, specific for styles.\n *\t\t\t\tstyle: {\n *\t\t\t\t\tcolor: 'red',\n *\t\t\t\t\tbackgroundColor: bind.to( 'qux', () => { ... } )\n *\t\t\t\t}\n *\t\t\t}\n *\t\t} );\n *\n * Text nodes can also have complex values:\n *\n *\t\tconst bind = Template.bind( observable, emitter );\n *\n *\t\t// Will render a \"foo\" text node.\n *\t\tnew Template( {\n *\t\t\ttext: 'foo'\n *\t\t} );\n *\n *\t\t// Will render a \"static text: {observable.foo}\" text node.\n *\t\t// The text of the node will be updated as the \"foo\" attribute changes.\n *\t\tnew Template( {\n *\t\t\ttext: [\n *\t\t\t\t'static text: ',\n *\t\t\t\tbind.to( 'foo', () => { ... } )\n *\t\t\t]\n *\t\t} );\n *\n * @typedef module:ui/template~TemplateValueSchema\n * @type {Object|String|Array}\n */\n\n/**\n * Describes an event listener attached to an HTML element. Such listener can propagate DOM events\n * through an {@link module:utils/observablemixin~Observable} instance, execute custom callbacks\n * or both, if necessary.\n *\n * Also see:\n * * {@link module:ui/template~TemplateDefinition} to learn more about template definitions,\n * * {@link module:ui/template~BindChain#to `to()`} method to learn more about bindings.\n *\n * Check out different ways of attaching event listeners below:\n *\n *\t\t// Bind helper will propagate events through the observable.\n *\t\tconst bind = Template.bind( observable, emitter );\n *\n *\t\tnew Template( {\n *\t\t\ttag: 'p',\n *\t\t\ton: {\n *\t\t\t\t// An object schema. The observable will fire the \"clicked\" event upon DOM \"click\".\n *\t\t\t\tclick: bind.to( 'clicked' )\n *\n *\t\t\t\t// An object schema. It will work for \"click\" event on \"a.foo\" children only.\n *\t\t\t\t'click@a.foo': bind.to( 'clicked' )\n *\n *\t\t\t\t// An array schema, makes the observable propagate multiple events.\n *\t\t\t\tclick: [\n *\t\t\t\t\tbind.to( 'clicked' ),\n *\t\t\t\t\tbind.to( 'executed' )\n *\t\t\t\t],\n *\n *\t\t\t\t// An array schema with a custom callback.\n *\t\t\t\t'click@a.foo': {\n *\t\t\t\t\tbind.to( 'clicked' ),\n *\t\t\t\t\tbind.to( evt => {\n *\t\t\t\t\t\tconsole.log( `${ evt.target } has been clicked!` );\n *\t\t\t\t\t} }\n *\t\t\t\t}\n *\t\t\t}\n *\t\t} );\n *\n * @typedef module:ui/template~TemplateListenerSchema\n * @type {Object|String|Array}\n */\n\n/**\n * The return value of {@link ~Template.bind `Template.bind()`}. It provides `to()` and `if()`\n * methods to create the {@link module:utils/observablemixin~Observable observable} attribute and event bindings.\n *\n * @interface module:ui/template~BindChain\n */\n\n/**\n * Binds an {@link module:utils/observablemixin~Observable observable} to either:\n *\n * * an HTML element attribute or a text node `textContent`, so it remains in sync with the observable\n * attribute as it changes,\n * * or an HTML element DOM event, so the DOM events are propagated through an observable.\n *\n * Some common use cases of `to()` bindings are presented below:\n *\n *\t\tconst bind = Template.bind( observable, emitter );\n *\n *\t\tnew Template( {\n *\t\t\ttag: 'p',\n *\t\t\tattributes: {\n *\t\t\t\t// class=\"...\" attribute gets bound to `observable#a`\n *\t\t\t\tclass: bind.to( 'a' )\n *\t\t\t},\n *\t\t\tchildren: [\n *\t\t\t\t// <p>...</p> gets bound to observable#b; always `toUpperCase()`.\n *\t\t\t\t{\n *\t\t\t\t\ttext: bind.to( 'b', ( value, node ) => value.toUpperCase() )\n *\t\t\t\t}\n *\t\t\t],\n *\t\t\ton: {\n *\t\t\t\tclick: [\n *\t\t\t\t\t// An observable will fire \"clicked\" upon \"click\" in the DOM.\n *\t\t\t\t\tbind.to( 'clicked' ),\n *\n *\t\t\t\t\t// A custom callback will be executed upon \"click\" in the DOM.\n *\t\t\t\t\tbind.to( () => {\n *\t\t\t\t\t\t...\n *\t\t\t\t\t} )\n *\t\t\t\t]\n *\t\t\t}\n *\t\t} ).render();\n *\n * Learn more about using `to()` in the {@link module:ui/template~TemplateValueSchema} and\n * {@link module:ui/template~TemplateListenerSchema}.\n *\n * @method #to\n * @param {String|Function} eventNameOrFunctionOrAttribute An attribute name of\n * {@link module:utils/observablemixin~Observable} or a DOM event name or an event callback.\n * @param {Function} [callback] Allows for processing of the value. Accepts `Node` and `value` as arguments.\n * @returns {module:ui/template~TemplateBinding}\n */\n\n/**\n * Binds an {@link module:utils/observablemixin~Observable observable} to an HTML element attribute or a text\n * node `textContent` so it remains in sync with the observable attribute as it changes.\n *\n * Unlike {@link module:ui/template~BindChain#to}, it controls the presence of the attribute or `textContent`\n * depending on the \"falseness\" of an {@link module:utils/observablemixin~Observable} attribute.\n *\n *\t\tconst bind = Template.bind( observable, emitter );\n *\n *\t\tnew Template( {\n *\t\t\ttag: 'input',\n *\t\t\tattributes: {\n *\t\t\t\t// <input checked> when `observable#a` is not undefined/null/false/''\n *\t\t\t\t// <input> when `observable#a` is undefined/null/false\n *\t\t\t\tchecked: bind.if( 'a' )\n *\t\t\t},\n *\t\t\tchildren: [\n *\t\t\t\t{\n *\t\t\t\t\t// <input>\"b-is-not-set\"</input> when `observable#b` is undefined/null/false/''\n *\t\t\t\t\t// <input></input> when `observable#b` is not \"falsy\"\n *\t\t\t\t\ttext: bind.if( 'b', 'b-is-not-set', ( value, node ) => !value )\n *\t\t\t\t}\n *\t\t\t]\n *\t\t} ).render();\n *\n * Learn more about using `if()` in the {@link module:ui/template~TemplateValueSchema}.\n *\n * @method #if\n * @param {String} attribute An attribute name of {@link module:utils/observablemixin~Observable} used in the binding.\n * @param {String} [valueIfTrue] Value set when the {@link module:utils/observablemixin~Observable} attribute is not\n * undefined/null/false/'' (empty string).\n * @param {Function} [callback] Allows for processing of the value. Accepts `Node` and `value` as arguments.\n * @returns {module:ui/template~TemplateBinding}\n */\n\n/**\n * The {@link module:ui/template~Template#_renderNode} configuration.\n *\n * @private\n * @interface module:ui/template~RenderData\n */\n\n/**\n * Tells {@link module:ui/template~Template#_renderNode} to render\n * children into `DocumentFragment` first and then append the fragment\n * to the parent element. It is a speed optimization.\n *\n * @member {Boolean} #intoFragment\n */\n\n/**\n * A node which is being rendered.\n *\n * @member {HTMLElement|Text} #node\n */\n\n/**\n * Indicates whether the {@module:ui/template~RenderNodeOptions#node} has\n * been provided by {@module:ui/template~Template#apply}.\n *\n * @member {Boolean} #isApplying\n */\n\n/**\n * An object storing the data that helps {@module:ui/template~Template#revert}\n * bringing back an element to its initial state, i.e. before\n * {@module:ui/template~Template#apply} was called.\n *\n * @member {Object} #revertData\n */\n"]}]}
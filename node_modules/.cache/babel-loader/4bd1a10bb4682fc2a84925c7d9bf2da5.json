{"remainingRequest":"/Users/antonyching/Desktop/project/new-builder-demo/node_modules/babel-loader/lib/index.js!/Users/antonyching/Desktop/project/new-builder-demo/node_modules/@ckeditor/ckeditor5-engine/src/utils/bindtwostepcarettoattribute.js","dependencies":[{"path":"/Users/antonyching/Desktop/project/new-builder-demo/node_modules/@ckeditor/ckeditor5-engine/src/utils/bindtwostepcarettoattribute.js","mtime":499162500000},{"path":"/Users/antonyching/Desktop/project/new-builder-demo/node_modules/@ckeditor/ckeditor5-dev-webpack-plugin/lib/translatesourceloader.js","mtime":499162500000},{"path":"/Users/antonyching/Desktop/project/new-builder-demo/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/antonyching/Desktop/project/new-builder-demo/node_modules/babel-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:LyoqCiAqIEBsaWNlbnNlIENvcHlyaWdodCAoYykgMjAwMy0yMDE5LCBDS1NvdXJjZSAtIEZyZWRlcmljbyBLbmFiYmVuLiBBbGwgcmlnaHRzIHJlc2VydmVkLgogKiBGb3IgbGljZW5zaW5nLCBzZWUgTElDRU5TRS5tZCBvciBodHRwczovL2NrZWRpdG9yLmNvbS9sZWdhbC9ja2VkaXRvci1vc3MtbGljZW5zZQogKi8KCi8qKgogKiBAbW9kdWxlIGVuZ2luZS91dGlscy9iaW5kdHdvc3RlcGNhcmV0dG9hdHRyaWJ1dGUKICovCmltcG9ydCB7IGtleUNvZGVzIH0gZnJvbSAnQGNrZWRpdG9yL2NrZWRpdG9yNS11dGlscy9zcmMva2V5Ym9hcmQnOwppbXBvcnQgcHJpb3JpdGllcyBmcm9tICdAY2tlZGl0b3IvY2tlZGl0b3I1LXV0aWxzL3NyYy9wcmlvcml0aWVzJzsKLyoqCiAqIFRoaXMgaGVscGVyIGVuYWJsZXMgdGhlIHR3by1zdGVwIGNhcmV0IChwaGFudG9tKSBtb3ZlbWVudCBiZWhhdmlvciBmb3IgdGhlIGdpdmVuIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL21vZGVsfk1vZGVsfQogKiBhdHRyaWJ1dGUgb24gYXJyb3cgcmlnaHQgKDxrYmQ+4oaSPC9rYmQ+KSBhbmQgbGVmdCAoPGtiZD7ihpA8L2tiZD4pIGtleSBwcmVzcy4KICoKICogVGhhbmtzIHRvIHRoaXMgKHBoYW50b20pIGNhcmV0IG1vdmVtZW50IHRoZSB1c2VyIGlzIGFibGUgdG8gdHlwZSBiZWZvcmUvYWZ0ZXIgYXMgd2VsbCBhcyBhdCB0aGUKICogYmVnaW5uaW5nL2VuZCBvZiBhbiBhdHRyaWJ1dGUuCiAqCiAqICoqTm90ZToqKiBUaGlzIGhlbHBlciBzdXBwb3J0IHJpZ2h04oCTdG/igJNsZWZ0IChBcmFiaWMsIEhlYnJldywgZXRjLikgY29udGVudCBieSBtaXJyb3JpbmcgaXRzIGJlaGF2aW9yCiAqIGJ1dCBmb3IgdGhlIHNha2Ugb2Ygc2ltcGxpY2l0eSBleGFtcGxlcyBzaG93Y2FzZSBvbmx5IGxlZnTigJN0b+KAk3JpZ2h0IHVzZeKAk2Nhc2VzLgogKgogKiAjIEZvcndhcmQgbW92ZW1lbnQKICoKICogIyMgIkVudGVyaW5nIiBhbiBhdHRyaWJ1dGU6CiAqCiAqIFdoZW4gdGhpcyBiZWhhdmlvciBpcyBlbmFibGVkIGZvciB0aGUgYGFgIGF0dHJpYnV0ZSBhbmQgdGhlIHNlbGVjdGlvbiBpcyByaWdodCBiZWZvcmUgaXQKICogKGF0IHRoZSBhdHRyaWJ1dGUgYm91bmRhcnkpLCBwcmVzc2luZyB0aGUgcmlnaHQgYXJyb3cga2V5IHdpbGwgbm90IG1vdmUgdGhlIHNlbGVjdGlvbiBidXQgdXBkYXRlIGl0cwogKiBhdHRyaWJ1dGVzIGFjY29yZGluZ2x5OgogKgogKiAqIFdoZW4gZW5hYmxlZDoKICoKICogICAJCWZvb3t9PCR0ZXh0IGE9InRydWUiPmJhcjwvJHRleHQ+CiAqCiAqICAgIDxrYmQ+4oaSPC9rYmQ+CiAqCiAqICAgCQlmb288JHRleHQgYT0idHJ1ZSI+e31iYXI8LyR0ZXh0PgogKgogKiAqIFdoZW4gZGlzYWJsZWQ6CiAqCiAqICAgCQlmb297fTwkdGV4dCBhPSJ0cnVlIj5iYXI8LyR0ZXh0PgogKgogKiAgIDxrYmQ+4oaSPC9rYmQ+CiAqCiAqICAgCQlmb288JHRleHQgYT0idHJ1ZSI+Ynt9YXI8LyR0ZXh0PgogKgogKgogKiAjIyAiTGVhdmluZyIgYW4gYXR0cmlidXRlOgogKgogKiAqIFdoZW4gZW5hYmxlZDoKICoKICogICAJCTwkdGV4dCBhPSJ0cnVlIj5iYXJ7fTwvJHRleHQ+YmF6CiAqCiAqICAgIDxrYmQ+4oaSPC9rYmQ+CiAqCiAqICAgCQk8JHRleHQgYT0idHJ1ZSI+YmFyPC8kdGV4dD57fWJhegogKgogKiAqIFdoZW4gZGlzYWJsZWQ6CiAqCiAqICAgCQk8JHRleHQgYT0idHJ1ZSI+YmFye308LyR0ZXh0PmJhegogKgogKiAgIDxrYmQ+4oaSPC9rYmQ+CiAqCiAqICAgCQk8JHRleHQgYT0idHJ1ZSI+YmFyPC8kdGV4dD5ie31hegogKgogKiAjIEJhY2t3YXJkIG1vdmVtZW50CiAqCiAqICogV2hlbiBlbmFibGVkOgogKgogKiAgIAkJPCR0ZXh0IGE9InRydWUiPmJhcjwvJHRleHQ+e31iYXoKICoKICogICAgPGtiZD7ihpA8L2tiZD4KICoKICogICAJCTwkdGV4dCBhPSJ0cnVlIj5iYXJ7fTwvJHRleHQ+YmF6CiAqCiAqICogV2hlbiBkaXNhYmxlZDoKICoKICogICAJCTwkdGV4dCBhPSJ0cnVlIj5iYXI8LyR0ZXh0Pnt9YmF6CiAqCiAqICAgPGtiZD7ihpA8L2tiZD4KICoKICogICAJCTwkdGV4dCBhPSJ0cnVlIj5iYXt9cjwvJHRleHQ+Ynt9YXoKICoKICogQHBhcmFtIHtPYmplY3R9IG9wdGlvbnMgSGVscGVyIG9wdGlvbnMuCiAqIEBwYXJhbSB7bW9kdWxlOmVuZ2luZS92aWV3L3ZpZXd+Vmlld30gb3B0aW9ucy52aWV3IFZpZXcgY29udHJvbGxlciBpbnN0YW5jZS4KICogQHBhcmFtIHttb2R1bGU6ZW5naW5lL21vZGVsL21vZGVsfk1vZGVsfSBvcHRpb25zLm1vZGVsIERhdGEgbW9kZWwgaW5zdGFuY2UuCiAqIEBwYXJhbSB7bW9kdWxlOnV0aWxzL2RvbS9lbWl0dGVybWl4aW5+RW1pdHRlcn0gb3B0aW9ucy5lbWl0dGVyIFRoZSBlbWl0dGVyIHRvIHdoaWNoIHRoaXMgYmVoYXZpb3Igc2hvdWxkIGJlIGFkZGVkCiAqIChlLmcuIGEgcGx1Z2luIGluc3RhbmNlKS4KICogQHBhcmFtIHtTdHJpbmd9IG9wdGlvbnMuYXR0cmlidXRlIEF0dHJpYnV0ZSBmb3Igd2hpY2ggdGhpcyBiZWhhdmlvciB3aWxsIGJlIGFkZGVkLgogKiBAcGFyYW0ge21vZHVsZTp1dGlscy9sb2NhbGV+TG9jYWxlfSBvcHRpb25zLmxvY2FsZSBUaGUge0BsaW5rIG1vZHVsZTpjb3JlL2VkaXRvci9lZGl0b3J+RWRpdG9yI2xvY2FsZX0gaW5zdGFuY2UuCiAqLwoKZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gYmluZFR3b1N0ZXBDYXJldFRvQXR0cmlidXRlKHsKICB2aWV3LAogIG1vZGVsLAogIGVtaXR0ZXIsCiAgYXR0cmlidXRlLAogIGxvY2FsZQp9KSB7CiAgY29uc3QgdHdvU3RlcENhcmV0SGFuZGxlciA9IG5ldyBUd29TdGVwQ2FyZXRIYW5kbGVyKG1vZGVsLCBlbWl0dGVyLCBhdHRyaWJ1dGUpOwogIGNvbnN0IG1vZGVsU2VsZWN0aW9uID0gbW9kZWwuZG9jdW1lbnQuc2VsZWN0aW9uOyAvLyBMaXN0ZW4gdG8ga2V5Ym9hcmQgZXZlbnRzIGFuZCBoYW5kbGUgdGhlIGNhcmV0IG1vdmVtZW50IGFjY29yZGluZyB0byB0aGUgMi1zdGVwIGNhcmV0IGxvZ2ljLgogIC8vCiAgLy8gTm90ZTogVGhpcyBsaXN0ZW5lciBoYXMgdGhlICJoaWdoKzEiIHByaW9yaXR5OgogIC8vICogImhpZ2giIGJlY2F1c2Ugb2YgdGhlIGZpbGxlciBsb2dpYyBpbXBsZW1lbnRlZCBpbiB0aGUgcmVuZGVyZXIgd2hpY2ggYWxzbyBlbmdhZ2VzIG9uICNrZXlkb3duLgogIC8vIFdoZW4gdGhlIGdyYXZpdHkgaXMgb3ZlcnJpZGRlbiB0aGUgYXR0cmlidXRlcyBvZiB0aGUgKG1vZGVsKSBzZWxlY3Rpb24gYXR0cmlidXRlcyBhcmUgcmVzZXQuCiAgLy8gSXQgbWF5IGVuZCB1cCB3aXRoIHRoZSBmaWxsZXIga2lja2luZyBpbiBhbmQgYnJlYWtpbmcgdGhlIHNlbGVjdGlvbi4KICAvLyAqICIrMSIgYmVjYXVzZSB3ZSB3b3VsZCBsaWtlIHRvIGF2b2lkIGNvbGxpc2lvbnMgd2l0aCBvdGhlciBmZWF0dXJlcyAobGlrZSBXaWRnZXRzKSwgd2hpY2gKICAvLyB0YWtlIG92ZXIgdGhlIGtleWRvd24gZXZlbnRzIHdpdGggdGhlICJoaWdoIiBwcmlvcml0eS4gVHdvLXN0ZXAgY2FyZXQgbW92ZW1lbnQgdGFrZXMgcHJlY2VkZW5jZQogIC8vIG92ZXIgV2lkZ2V0cyBpbiB0aGF0IG1hdHRlci4KICAvLwogIC8vIEZpbmQgb3V0IG1vcmUgaW4gaHR0cHM6Ly9naXRodWIuY29tL2NrZWRpdG9yL2NrZWRpdG9yNS1lbmdpbmUvaXNzdWVzLzEzMDEuCgogIGVtaXR0ZXIubGlzdGVuVG8odmlldy5kb2N1bWVudCwgJ2tleWRvd24nLCAoZXZ0LCBkYXRhKSA9PiB7CiAgICAvLyBUaGlzIGltcGxlbWVudGF0aW9uIHdvcmtzIG9ubHkgZm9yIGNvbGxhcHNlZCBzZWxlY3Rpb24uCiAgICBpZiAoIW1vZGVsU2VsZWN0aW9uLmlzQ29sbGFwc2VkKSB7CiAgICAgIHJldHVybjsKICAgIH0gLy8gV2hlbiB1c2VyIHRyaWVzIHRvIGV4cGFuZCB0aGUgc2VsZWN0aW9uIG9yIGp1bXAgb3ZlciB0aGUgd2hvbGUgd29yZCBvciB0byB0aGUgYmVnaW5uaW5nL2VuZCB0aGVuCiAgICAvLyB0d28tc3RlcHMgbW92ZW1lbnQgaXMgbm90IG5lY2Vzc2FyeS4KCgogICAgaWYgKGRhdGEuc2hpZnRLZXkgfHwgZGF0YS5hbHRLZXkgfHwgZGF0YS5jdHJsS2V5KSB7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICBjb25zdCBhcnJvd1JpZ2h0UHJlc3NlZCA9IGRhdGEua2V5Q29kZSA9PSBrZXlDb2Rlcy5hcnJvd3JpZ2h0OwogICAgY29uc3QgYXJyb3dMZWZ0UHJlc3NlZCA9IGRhdGEua2V5Q29kZSA9PSBrZXlDb2Rlcy5hcnJvd2xlZnQ7IC8vIFdoZW4gbmVpdGhlciBsZWZ0IG9yIHJpZ2h0IGFycm93IGhhcyBiZWVuIHByZXNzZWQgdGhlbiBkbyBub3RpbmcuCgogICAgaWYgKCFhcnJvd1JpZ2h0UHJlc3NlZCAmJiAhYXJyb3dMZWZ0UHJlc3NlZCkgewogICAgICByZXR1cm47CiAgICB9CgogICAgY29uc3QgcG9zaXRpb24gPSBtb2RlbFNlbGVjdGlvbi5nZXRGaXJzdFBvc2l0aW9uKCk7CiAgICBjb25zdCBjb250ZW50RGlyZWN0aW9uID0gbG9jYWxlLmNvbnRlbnRMYW5ndWFnZURpcmVjdGlvbjsKICAgIGxldCBpc01vdmVtZW50SGFuZGxlZDsKCiAgICBpZiAoY29udGVudERpcmVjdGlvbiA9PT0gJ2x0cicgJiYgYXJyb3dSaWdodFByZXNzZWQgfHwgY29udGVudERpcmVjdGlvbiA9PT0gJ3J0bCcgJiYgYXJyb3dMZWZ0UHJlc3NlZCkgewogICAgICBpc01vdmVtZW50SGFuZGxlZCA9IHR3b1N0ZXBDYXJldEhhbmRsZXIuaGFuZGxlRm9yd2FyZE1vdmVtZW50KHBvc2l0aW9uLCBkYXRhKTsKICAgIH0gZWxzZSB7CiAgICAgIGlzTW92ZW1lbnRIYW5kbGVkID0gdHdvU3RlcENhcmV0SGFuZGxlci5oYW5kbGVCYWNrd2FyZE1vdmVtZW50KHBvc2l0aW9uLCBkYXRhKTsKICAgIH0gLy8gU3RvcCB0aGUga2V5ZG93biBldmVudCBpZiB0aGUgdHdvLXN0ZXAgY2FyZXQgbW92ZW1lbnQgaGFuZGxlZCBpdC4gQXZvaWQgY29sbGlzaW9ucwogICAgLy8gd2l0aCBvdGhlciBmZWF0dXJlcyB3aGljaCBtYXkgYWxzbyB0YWtlIG92ZXIgdGhlIGNhcmV0IG1vdmVtZW50IChlLmcuIFdpZGdldCkuCgoKICAgIGlmIChpc01vdmVtZW50SGFuZGxlZCkgewogICAgICBldnQuc3RvcCgpOwogICAgfQogIH0sIHsKICAgIHByaW9yaXR5OiBwcmlvcml0aWVzLmdldCgnaGlnaCcpICsgMQogIH0pOwp9Ci8qKgogKiBUaGlzIGlzIGEgcHJvdGVjdGVkIGhlbHBlcuKAk2NsYXNzIGZvciB7QGxpbmsgbW9kdWxlOmVuZ2luZS91dGlscy9iaW5kdHdvc3RlcGNhcmV0dG9hdHRyaWJ1dGV9LgogKiBJdCBoYW5kbGVzIHRoZSBzdGF0ZSBvZiB0aGUgMi1zdGVwIGNhcmV0IG1vdmVtZW50IGZvciBhIHNpbmdsZSB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9tb2RlbH5Nb2RlbH0KICogYXR0cmlidXRlIHVwb24gdGhlIGBrZXlwcmVzc2AgaW4gdGhlIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvdmlld35WaWV3fS4KICoKICogQHByb3RlY3RlZAogKi8KCmV4cG9ydCBjbGFzcyBUd29TdGVwQ2FyZXRIYW5kbGVyIHsKICAvKgogICAqIENyZWF0ZXMgdHdvIHN0ZXAgaGFuZGxlciBpbnN0YW5jZS4KICAgKgogICAqIEBwYXJhbSB7bW9kdWxlOmVuZ2luZS9tb2RlbC9tb2RlbH5Nb2RlbH0gbW9kZWwgRGF0YSBtb2RlbCBpbnN0YW5jZS4KICAgKiBAcGFyYW0ge21vZHVsZTp1dGlscy9kb20vZW1pdHRlcm1peGlufkVtaXR0ZXJ9IGVtaXR0ZXIgVGhlIGVtaXR0ZXIgdG8gd2hpY2ggdGhpcyBiZWhhdmlvciBzaG91bGQgYmUgYWRkZWQKICAgKiAoZS5nLiBhIHBsdWdpbiBpbnN0YW5jZSkuCiAgICogQHBhcmFtIHtTdHJpbmd9IGF0dHJpYnV0ZSBBdHRyaWJ1dGUgZm9yIHdoaWNoIHRoZSBiZWhhdmlvciB3aWxsIGJlIGFkZGVkLgogICAqLwogIGNvbnN0cnVjdG9yKG1vZGVsLCBlbWl0dGVyLCBhdHRyaWJ1dGUpIHsKICAgIC8qKgogICAgICogVGhlIG1vZGVsIGluc3RhbmNlIHRoaXMgY2xhc3MgaW5zdGFuY2Ugb3BlcmF0ZXMgb24uCiAgICAgKgogICAgICogQHJlYWRvbmx5CiAgICAgKiBAbWVtYmVyIHttb2R1bGU6ZW5naW5lL21vZGVsL21vZGVsfk1vZGVsI3NjaGVtYX0KICAgICAqLwogICAgdGhpcy5tb2RlbCA9IG1vZGVsOwogICAgLyoqCiAgICAgKiBUaGUgQXR0cmlidXRlIHRoaXMgY2xhc3MgaW5zdGFuY2Ugb3BlcmF0ZXMgb24uCiAgICAgKgogICAgICogQHJlYWRvbmx5CiAgICAgKiBAbWVtYmVyIHtTdHJpbmd9CiAgICAgKi8KCiAgICB0aGlzLmF0dHJpYnV0ZSA9IGF0dHJpYnV0ZTsKICAgIC8qKgogICAgICogQSByZWZlcmVuY2UgdG8gdGhlIGRvY3VtZW50IHNlbGVjdGlvbi4KICAgICAqCiAgICAgKiBAcHJpdmF0ZQogICAgICogQG1lbWJlciB7bW9kdWxlOmVuZ2luZS9tb2RlbC9zZWxlY3Rpb25+U2VsZWN0aW9ufQogICAgICovCgogICAgdGhpcy5fbW9kZWxTZWxlY3Rpb24gPSBtb2RlbC5kb2N1bWVudC5zZWxlY3Rpb247CiAgICAvKioKICAgICAqIFRoZSBjdXJyZW50IFVJRCBvZiB0aGUgb3ZlcnJpZGRlbiBncmF2aXR5LCBhcyByZXR1cm5lZCBieQogICAgICoge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvd3JpdGVyfldyaXRlciNvdmVycmlkZVNlbGVjdGlvbkdyYXZpdHl9LgogICAgICoKICAgICAqIEBwcml2YXRlCiAgICAgKiBAbWVtYmVyIHtTdHJpbmd9CiAgICAgKi8KCiAgICB0aGlzLl9vdmVycmlkZVVpZCA9IG51bGw7CiAgICAvKioKICAgICAqIEEgZmxhZyBpbmRpY2F0aW5nIHRoYXQgdGhlIGF1dG9tYXRpYyBncmF2aXR5IHJlc3RvcmF0aW9uIGZvciB0aGlzIGF0dHJpYnV0ZQogICAgICogc2hvdWxkIG5vdCBoYXBwZW4gdXBvbiB0aGUgbmV4dAogICAgICoge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvc2VsZWN0aW9uflNlbGVjdGlvbiNldmVudDpjaGFuZ2U6cmFuZ2V9IGV2ZW50LgogICAgICoKICAgICAqIEBwcml2YXRlCiAgICAgKiBAbWVtYmVyIHtTdHJpbmd9CiAgICAgKi8KCiAgICB0aGlzLl9pc05leHRHcmF2aXR5UmVzdG9yYXRpb25Ta2lwcGVkID0gZmFsc2U7IC8vIFRoZSBhdXRvbWF0aWMgZ3Jhdml0eSByZXN0b3JhdGlvbiBsb2dpYy4KCiAgICBlbWl0dGVyLmxpc3RlblRvKHRoaXMuX21vZGVsU2VsZWN0aW9uLCAnY2hhbmdlOnJhbmdlJywgKGV2dCwgZGF0YSkgPT4gewogICAgICAvLyBTa2lwcGluZyB0aGUgYXV0b21hdGljIHJlc3RvcmF0aW9uIGlzIG5lZWRlZCBpZiB0aGUgc2VsZWN0aW9uIHNob3VsZCBjaGFuZ2UKICAgICAgLy8gYnV0IHRoZSBncmF2aXR5IG11c3QgcmVtYWluIG92ZXJyaWRkZW4gYWZ0ZXJ3YXJkcy4gU2VlIHRoZSAjaGFuZGxlQmFja3dhcmRNb3ZlbWVudAogICAgICAvLyB0byBsZWFybiBtb3JlLgogICAgICBpZiAodGhpcy5faXNOZXh0R3Jhdml0eVJlc3RvcmF0aW9uU2tpcHBlZCkgewogICAgICAgIHRoaXMuX2lzTmV4dEdyYXZpdHlSZXN0b3JhdGlvblNraXBwZWQgPSBmYWxzZTsKICAgICAgICByZXR1cm47CiAgICAgIH0gLy8gU2tpcCBhdXRvbWF0aWMgcmVzdG9yZSB3aGVuIHRoZSBncmF2aXR5IGlzIG5vdCBvdmVycmlkZGVuIOKAlCBzaW1wbHksIHRoZXJlJ3Mgbm90aGluZyB0byByZXN0b3JlCiAgICAgIC8vIGF0IHRoaXMgbW9tZW50LgoKCiAgICAgIGlmICghdGhpcy5faXNHcmF2aXR5T3ZlcnJpZGRlbikgewogICAgICAgIHJldHVybjsKICAgICAgfSAvLyBTa2lwIGF1dG9tYXRpYyByZXN0b3JlIHdoZW4gdGhlIGNoYW5nZSBpcyBpbmRpcmVjdCBBTkQgdGhlIHNlbGVjdGlvbiBpcyBhdCB0aGUgYXR0cmlidXRlIGJvdW5kYXJ5LgogICAgICAvLyBJdCBtZWFucyB0aGF0IGUuZy4gaWYgdGhlIGNoYW5nZSB3YXMgZXh0ZXJuYWwgKGNvbGxhYm9yYXRpb24pIGFuZCB0aGUgdXNlciBoYWQgdGhlaXIKICAgICAgLy8gc2VsZWN0aW9uIGFyb3VuZCB0aGUgbGluaywgaXRzIGdyYXZpdHkgc2hvdWxkIHJlbWFpbiBpbnRhY3QgaW4gdGhpcyBjaGFuZ2U6cmFuZ2UgZXZlbnQuCgoKICAgICAgaWYgKCFkYXRhLmRpcmVjdENoYW5nZSAmJiBpc0F0Qm91bmRhcnkodGhpcy5fbW9kZWxTZWxlY3Rpb24uZ2V0Rmlyc3RQb3NpdGlvbigpLCBhdHRyaWJ1dGUpKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICB0aGlzLl9yZXN0b3JlR3Jhdml0eSgpOwogICAgfSk7CiAgfQogIC8qKgogICAqIFVwZGF0ZXMgdGhlIGRvY3VtZW50IHNlbGVjdGlvbiBhbmQgdGhlIHZpZXcgYWNjb3JkaW5nIHRvIHRoZSB0d2/igJNzdGVwIGNhcmV0IG1vdmVtZW50IHN0YXRlCiAgICogd2hlbiBtb3ZpbmcgKipmb3J3YXJkcyoqLiBFeGVjdXRlZCB1cG9uIGBrZXlwcmVzc2AgaW4gdGhlIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvdmlld35WaWV3fS4KICAgKgogICAqIEBwYXJhbSB7bW9kdWxlOmVuZ2luZS9tb2RlbC9wb3NpdGlvbn5Qb3NpdGlvbn0gcG9zaXRpb24gVGhlIG1vZGVsIHBvc2l0aW9uIGF0IHRoZSBtb21lbnQgb2YgdGhlIGtleSBwcmVzcy4KICAgKiBAcGFyYW0ge21vZHVsZTplbmdpbmUvdmlldy9vYnNlcnZlci9kb21ldmVudGRhdGF+RG9tRXZlbnREYXRhfSBkYXRhIERhdGEgb2YgdGhlIGtleSBwcmVzcy4KICAgKiBAcmV0dXJucyB7Qm9vbGVhbn0gYHRydWVgIHdoZW4gdGhlIGhhbmRsZXIgcHJldmVudGVkIGNhcmV0IG1vdmVtZW50CiAgICovCgoKICBoYW5kbGVGb3J3YXJkTW92ZW1lbnQocG9zaXRpb24sIGRhdGEpIHsKICAgIGNvbnN0IGF0dHJpYnV0ZSA9IHRoaXMuYXR0cmlidXRlOyAvLyBET04nVCBFTkdBR0UgMi1TQ00gaWYgZ3Jhdml0eSBpcyBhbHJlYWR5IG92ZXJyaWRkZW4uIEl0IG1lYW5zIHRoYXQgd2UganVzdCBlbnRlcmVkCiAgICAvLwogICAgLy8gCQk8cGFyYWdyYXBoPmZvbzwkdGV4dCBhdHRyaWJ1dGU+e31iYXI8LyR0ZXh0PmJhejwvcGFyYWdyYXBoPgogICAgLy8KICAgIC8vIG9yIGxlZnQgdGhlIGF0dHJpYnV0ZQogICAgLy8KICAgIC8vIAkJPHBhcmFncmFwaD5mb288JHRleHQgYXR0cmlidXRlPmJhcjwvJHRleHQ+e31iYXo8L3BhcmFncmFwaD4KICAgIC8vCiAgICAvLyBhbmQgdGhlIGdyYXZpdHkgd2lsbCBiZSByZXN0b3JlZCBhdXRvbWF0aWNhbGx5LgoKICAgIGlmICh0aGlzLl9pc0dyYXZpdHlPdmVycmlkZGVuKSB7CiAgICAgIHJldHVybjsKICAgIH0gLy8gRE9OJ1QgRU5HQUdFIDItU0NNIHdoZW4gdGhlIHNlbGVjdGlvbiBpcyBhdCB0aGUgYmVnaW5uaW5nIG9mIHRoZSBibG9jayBBTkQgYWxyZWFkeSBoYXMgdGhlCiAgICAvLyBhdHRyaWJ1dGU6CiAgICAvLyAqIHdoZW4gdGhlIHNlbGVjdGlvbiB3YXMgaW5pdGlhbGx5IHNldCB0aGVyZSB1c2luZyB0aGUgbW91c2UsCiAgICAvLyAqIHdoZW4gdGhlIGVkaXRvciBoYXMganVzdCBzdGFydGVkCiAgICAvLwogICAgLy8JCTxwYXJhZ3JhcGg+PCR0ZXh0IGF0dHJpYnV0ZT57fWJhcjwvJHRleHQ+YmF6PC9wYXJhZ3JhcGg+CiAgICAvLwoKCiAgICBpZiAocG9zaXRpb24uaXNBdFN0YXJ0ICYmIHRoaXMuX2hhc1NlbGVjdGlvbkF0dHJpYnV0ZSkgewogICAgICByZXR1cm47CiAgICB9IC8vIEVOR0FHRSAyLVNDTSB3aGVuIGFib3V0IHRvIGxlYXZlIG9uZSBhdHRyaWJ1dGUgdmFsdWUgYW5kIGVudGVyIGFub3RoZXI6CiAgICAvLwogICAgLy8gCQk8cGFyYWdyYXBoPjwkdGV4dCBhdHRyaWJ1dGU9IjEiPmZvb3t9PC8kdGV4dD48JHRleHQgYXR0cmlidXRlPSIyIj5iYXI8LyR0ZXh0PjwvcGFyYWdyYXBoPgogICAgLy8KICAgIC8vIGJ1dCBET04nVCB3aGVuIGFscmVhZHkgaW4gYmV0d2VlbiBvZiB0aGVtIChubyBhdHRyaWJ1dGUgc2VsZWN0aW9uKToKICAgIC8vCiAgICAvLyAJCTxwYXJhZ3JhcGg+PCR0ZXh0IGF0dHJpYnV0ZT0iMSI+Zm9vPC8kdGV4dD57fTwkdGV4dCBhdHRyaWJ1dGU9IjIiPmJhcjwvJHRleHQ+PC9wYXJhZ3JhcGg+CiAgICAvLwoKCiAgICBpZiAoaXNCZXR3ZWVuRGlmZmVyZW50VmFsdWVzKHBvc2l0aW9uLCBhdHRyaWJ1dGUpICYmIHRoaXMuX2hhc1NlbGVjdGlvbkF0dHJpYnV0ZSkgewogICAgICB0aGlzLl9wcmV2ZW50Q2FyZXRNb3ZlbWVudChkYXRhKTsKCiAgICAgIHRoaXMuX3JlbW92ZVNlbGVjdGlvbkF0dHJpYnV0ZSgpOwoKICAgICAgcmV0dXJuIHRydWU7CiAgICB9IC8vIEVOR0FHRSAyLVNDTSB3aGVuIGVudGVyaW5nIGFuIGF0dHJpYnV0ZToKICAgIC8vCiAgICAvLyAJCTxwYXJhZ3JhcGg+Zm9ve308JHRleHQgYXR0cmlidXRlPmJhcjwvJHRleHQ+YmF6PC9wYXJhZ3JhcGg+CiAgICAvLwoKCiAgICBpZiAoaXNBdFN0YXJ0Qm91bmRhcnkocG9zaXRpb24sIGF0dHJpYnV0ZSkpIHsKICAgICAgdGhpcy5fcHJldmVudENhcmV0TW92ZW1lbnQoZGF0YSk7CgogICAgICB0aGlzLl9vdmVycmlkZUdyYXZpdHkoKTsKCiAgICAgIHJldHVybiB0cnVlOwogICAgfSAvLyBFTkdBR0UgMi1TQ00gd2hlbiBsZWF2aW5nIGFuIGF0dHJpYnV0ZToKICAgIC8vCiAgICAvLwkJPHBhcmFncmFwaD5mb288JHRleHQgYXR0cmlidXRlPmJhcnt9PC8kdGV4dD5iYXo8L3BhcmFncmFwaD4KICAgIC8vCgoKICAgIGlmIChpc0F0RW5kQm91bmRhcnkocG9zaXRpb24sIGF0dHJpYnV0ZSkgJiYgdGhpcy5faGFzU2VsZWN0aW9uQXR0cmlidXRlKSB7CiAgICAgIHRoaXMuX3ByZXZlbnRDYXJldE1vdmVtZW50KGRhdGEpOwoKICAgICAgdGhpcy5fb3ZlcnJpZGVHcmF2aXR5KCk7CgogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICB9CiAgLyoqCiAgICogVXBkYXRlcyB0aGUgZG9jdW1lbnQgc2VsZWN0aW9uIGFuZCB0aGUgdmlldyBhY2NvcmRpbmcgdG8gdGhlIHR3b+KAk3N0ZXAgY2FyZXQgbW92ZW1lbnQgc3RhdGUKICAgKiB3aGVuIG1vdmluZyAqKmJhY2t3YXJkcyoqLiBFeGVjdXRlZCB1cG9uIGBrZXlwcmVzc2AgaW4gdGhlIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvdmlld35WaWV3fS4KICAgKgogICAqIEBwYXJhbSB7bW9kdWxlOmVuZ2luZS9tb2RlbC9wb3NpdGlvbn5Qb3NpdGlvbn0gcG9zaXRpb24gVGhlIG1vZGVsIHBvc2l0aW9uIGF0IHRoZSBtb21lbnQgb2YgdGhlIGtleSBwcmVzcy4KICAgKiBAcGFyYW0ge21vZHVsZTplbmdpbmUvdmlldy9vYnNlcnZlci9kb21ldmVudGRhdGF+RG9tRXZlbnREYXRhfSBkYXRhIERhdGEgb2YgdGhlIGtleSBwcmVzcy4KICAgKiBAcmV0dXJucyB7Qm9vbGVhbn0gYHRydWVgIHdoZW4gdGhlIGhhbmRsZXIgcHJldmVudGVkIGNhcmV0IG1vdmVtZW50CiAgICovCgoKICBoYW5kbGVCYWNrd2FyZE1vdmVtZW50KHBvc2l0aW9uLCBkYXRhKSB7CiAgICBjb25zdCBhdHRyaWJ1dGUgPSB0aGlzLmF0dHJpYnV0ZTsgLy8gV2hlbiB0aGUgZ3Jhdml0eSBpcyBhbHJlYWR5IG92ZXJyaWRkZW4uLi4KCiAgICBpZiAodGhpcy5faXNHcmF2aXR5T3ZlcnJpZGRlbikgewogICAgICAvLyBFTkdBR0UgMi1TQ00gJiBSRU1PVkUgU0VMRUNUSU9OIEFUVFJJQlVURQogICAgICAvLyB3aGVuIGFib3V0IHRvIGxlYXZlIG9uZSBhdHRyaWJ1dGUgdmFsdWUgYW5kIGVudGVyIGFub3RoZXI6CiAgICAgIC8vCiAgICAgIC8vIAkJPHBhcmFncmFwaD48JHRleHQgYXR0cmlidXRlPSIxIj5mb288LyR0ZXh0PjwkdGV4dCBhdHRyaWJ1dGU9IjIiPnt9YmFyPC8kdGV4dD48L3BhcmFncmFwaD4KICAgICAgLy8KICAgICAgLy8gYnV0IERPTidUIHdoZW4gYWxyZWFkeSBpbiBiZXR3ZWVuIG9mIHRoZW0gKG5vIGF0dHJpYnV0ZSBzZWxlY3Rpb24pOgogICAgICAvLwogICAgICAvLyAJCTxwYXJhZ3JhcGg+PCR0ZXh0IGF0dHJpYnV0ZT0iMSI+Zm9vPC8kdGV4dD57fTwkdGV4dCBhdHRyaWJ1dGU9IjIiPmJhcjwvJHRleHQ+PC9wYXJhZ3JhcGg+CiAgICAgIC8vCiAgICAgIGlmIChpc0JldHdlZW5EaWZmZXJlbnRWYWx1ZXMocG9zaXRpb24sIGF0dHJpYnV0ZSkgJiYgdGhpcy5faGFzU2VsZWN0aW9uQXR0cmlidXRlKSB7CiAgICAgICAgdGhpcy5fcHJldmVudENhcmV0TW92ZW1lbnQoZGF0YSk7CgogICAgICAgIHRoaXMuX3Jlc3RvcmVHcmF2aXR5KCk7CgogICAgICAgIHRoaXMuX3JlbW92ZVNlbGVjdGlvbkF0dHJpYnV0ZSgpOwoKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfSAvLyBFTkdBR0UgMi1TQ00gd2hlbiBhdCBhbnkgYm91bmRhcnkgb2YgdGhlIGF0dHJpYnV0ZToKICAgICAgLy8KICAgICAgLy8gCQk8cGFyYWdyYXBoPmZvbzwkdGV4dCBhdHRyaWJ1dGU+YmFyPC8kdGV4dD57fWJhejwvcGFyYWdyYXBoPgogICAgICAvLyAJCTxwYXJhZ3JhcGg+Zm9vPCR0ZXh0IGF0dHJpYnV0ZT57fWJhcjwvJHRleHQ+YmF6PC9wYXJhZ3JhcGg+CiAgICAgIC8vCiAgICAgIGVsc2UgewogICAgICAgICAgdGhpcy5fcHJldmVudENhcmV0TW92ZW1lbnQoZGF0YSk7CgogICAgICAgICAgdGhpcy5fcmVzdG9yZUdyYXZpdHkoKTsgLy8gUkVNT1ZFIFNFTEVDVElPTiBBVFJJQlVURSBhdCB0aGUgYmVnaW5uaW5nIG9mIHRoZSBibG9jay4KICAgICAgICAgIC8vIEl0J3MgbGlrZSByZXN0b3JpbmcgZ3Jhdml0eSBidXQgdG93YXJkcyBhIG5vbi1leGlzdGVudCBjb250ZW50IHdoZW4KICAgICAgICAgIC8vIHRoZSBncmF2aXR5IGlzIG92ZXJyaWRkZW46CiAgICAgICAgICAvLwogICAgICAgICAgLy8gCQk8cGFyYWdyYXBoPjwkdGV4dCBhdHRyaWJ1dGU+e31iYXI8LyR0ZXh0PjwvcGFyYWdyYXBoPgogICAgICAgICAgLy8KICAgICAgICAgIC8vIGJlY29tZXM6CiAgICAgICAgICAvLwogICAgICAgICAgLy8gCQk8cGFyYWdyYXBoPnt9PCR0ZXh0IGF0dHJpYnV0ZT5iYXI8LyR0ZXh0PjwvcGFyYWdyYXBoPgogICAgICAgICAgLy8KCgogICAgICAgICAgaWYgKHBvc2l0aW9uLmlzQXRTdGFydCkgewogICAgICAgICAgICB0aGlzLl9yZW1vdmVTZWxlY3Rpb25BdHRyaWJ1dGUoKTsKICAgICAgICAgIH0KCiAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICB9IGVsc2UgewogICAgICAvLyBFTkdBR0UgMi1TQ00gd2hlbiBiZXR3ZWVuIHR3byBkaWZmZXJlbnQgYXR0cmlidXRlIHZhbHVlcyBidXQgc2VsZWN0aW9uIGhhcyBubyBhdHRyaWJ1dGU6CiAgICAgIC8vCiAgICAgIC8vIAkJPHBhcmFncmFwaD48JHRleHQgYXR0cmlidXRlPSIxIj5mb288LyR0ZXh0Pnt9PCR0ZXh0IGF0dHJpYnV0ZT0iMiI+YmFyPC8kdGV4dD48L3BhcmFncmFwaD4KICAgICAgLy8KICAgICAgaWYgKGlzQmV0d2VlbkRpZmZlcmVudFZhbHVlcyhwb3NpdGlvbiwgYXR0cmlidXRlKSAmJiAhdGhpcy5faGFzU2VsZWN0aW9uQXR0cmlidXRlKSB7CiAgICAgICAgdGhpcy5fcHJldmVudENhcmV0TW92ZW1lbnQoZGF0YSk7CgogICAgICAgIHRoaXMuX3NldFNlbGVjdGlvbkF0dHJpYnV0ZUZyb21UaGVOb2RlQmVmb3JlKHBvc2l0aW9uKTsKCiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0gLy8gRW5kIG9mIGJsb2NrIGJvdW5kYXJ5IGNhc2VzOgogICAgICAvLwogICAgICAvLyAJCTxwYXJhZ3JhcGg+PCR0ZXh0IGF0dHJpYnV0ZT5iYXJ7fTwvJHRleHQ+PC9wYXJhZ3JhcGg+CiAgICAgIC8vIAkJPHBhcmFncmFwaD48JHRleHQgYXR0cmlidXRlPmJhcjwvJHRleHQ+e308L3BhcmFncmFwaD4KICAgICAgLy8KCgogICAgICBpZiAocG9zaXRpb24uaXNBdEVuZCAmJiBpc0F0RW5kQm91bmRhcnkocG9zaXRpb24sIGF0dHJpYnV0ZSkpIHsKICAgICAgICAvLyBET04nVCBFTkdBR0UgMi1TQ00gaWYgdGhlIHNlbGVjdGlvbiBoYXMgdGhlIGF0dHJpYnV0ZSBhbHJlYWR5LgogICAgICAgIC8vIFRoaXMgaXMgYSBjb21tb24gc2VsZWN0aW9uIGlmIHNldCB1c2luZyB0aGUgbW91c2UuCiAgICAgICAgLy8KICAgICAgICAvLyAJCTxwYXJhZ3JhcGg+PCR0ZXh0IGF0dHJpYnV0ZT5iYXJ7fTwvJHRleHQ+PC9wYXJhZ3JhcGg+CiAgICAgICAgLy8KICAgICAgICBpZiAodGhpcy5faGFzU2VsZWN0aW9uQXR0cmlidXRlKSB7CiAgICAgICAgICAvLyBET04nVCBFTkdBR0UgMi1TQ00gaWYgdGhlIGF0dHJpYnV0ZSBhdCB0aGUgZW5kIG9mIHRoZSBibG9jayB3aGljaCBoYXMgbGVuZ3RoID09IDEuCiAgICAgICAgICAvLyBNYWtlIHN1cmUgdGhlIHNlbGVjdGlvbiB3aWxsIG5vdCB0aGUgYXR0cmlidXRlIGFmdGVyIGl0IG1vdmVzIGJhY2t3YXJkcy4KICAgICAgICAgIC8vCiAgICAgICAgICAvLyAJCTxwYXJhZ3JhcGg+Zm9vPCR0ZXh0IGF0dHJpYnV0ZT5ie308LyR0ZXh0PjwvcGFyYWdyYXBoPgogICAgICAgICAgLy8KICAgICAgICAgIGlmIChpc1N0ZXBBZnRlclRoZUF0dHJpYnV0ZUJvdW5kYXJ5KHBvc2l0aW9uLCBhdHRyaWJ1dGUpKSB7CiAgICAgICAgICAgIC8vIFNraXAgdGhlIGF1dG9tYXRpYyBncmF2aXR5IHJlc3RvcmUgdXBvbiB0aGUgbmV4dCBzZWxlY3Rpb24jY2hhbmdlOnJhbmdlIGV2ZW50LgogICAgICAgICAgICAvLyBJZiBub3Qgc2tpcHBlZCwgaXQgd291bGQgYXV0b21hdGljYWxseSByZXN0b3JlIHRoZSBncmF2aXR5LCB3aGljaCBzaG91bGQgcmVtYWluCiAgICAgICAgICAgIC8vIG92ZXJyaWRkZW4uCiAgICAgICAgICAgIHRoaXMuX3NraXBOZXh0QXV0b21hdGljR3Jhdml0eVJlc3RvcmF0aW9uKCk7CgogICAgICAgICAgICB0aGlzLl9vdmVycmlkZUdyYXZpdHkoKTsgLy8gRG9uJ3QgcmV0dXJuICJ0cnVlIiBoZXJlIGJlY2F1c2Ugd2UgZGlkbid0IGNhbGwgX3ByZXZlbnRDYXJldE1vdmVtZW50LgogICAgICAgICAgICAvLyBSZXR1cm5pbmcgaGVyZSB3aWxsIGRlc3RhYmlsaXplIHRoZSBmaWxsZXIgbG9naWMsIHdoaWNoIGFsc28gbGlzdGVucyB0bwogICAgICAgICAgICAvLyBrZXlkb3duIChhbmQgdGhlIGV2ZW50IHdvdWxkIGJlIHN0b3BwZWQpLgoKICAgICAgICAgIH0KCiAgICAgICAgICByZXR1cm47CiAgICAgICAgfSAvLyBFTkdBR0UgMi1TQ00gaWYgdGhlIHNlbGVjdGlvbiBoYXMgbm8gYXR0cmlidXRlLiBUaGlzIG1heSBoYXBwZW4gd2hlbiB0aGUgdXNlcgogICAgICAgIC8vIGxlZnQgdGhlIGF0dHJpYnV0ZSB1c2luZyBhIEZPUldBUkQgMi1TQ00uCiAgICAgICAgLy8KICAgICAgICAvLyAJCTxwYXJhZ3JhcGg+PCR0ZXh0IGF0dHJpYnV0ZT5iYXI8LyR0ZXh0Pnt9PC9wYXJhZ3JhcGg+CiAgICAgICAgLy8KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgdGhpcy5fcHJldmVudENhcmV0TW92ZW1lbnQoZGF0YSk7CgogICAgICAgICAgICB0aGlzLl9zZXRTZWxlY3Rpb25BdHRyaWJ1dGVGcm9tVGhlTm9kZUJlZm9yZShwb3NpdGlvbik7CgogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgIH0KICAgICAgfSAvLyBSRU1PVkUgU0VMRUNUSU9OIEFUUklCVVRFIHdoZW4gcmVzdG9yaW5nIGdyYXZpdHkgdG93YXJkcyBhIG5vbi1leGlzdGVudCBjb250ZW50IGF0IHRoZQogICAgICAvLyBiZWdpbm5pbmcgb2YgdGhlIGJsb2NrLgogICAgICAvLwogICAgICAvLyAJCTxwYXJhZ3JhcGg+e308JHRleHQgYXR0cmlidXRlPmJhcjwvJHRleHQ+PC9wYXJhZ3JhcGg+CiAgICAgIC8vCgoKICAgICAgaWYgKHBvc2l0aW9uLmlzQXRTdGFydCkgewogICAgICAgIGlmICh0aGlzLl9oYXNTZWxlY3Rpb25BdHRyaWJ1dGUpIHsKICAgICAgICAgIHRoaXMuX3JlbW92ZVNlbGVjdGlvbkF0dHJpYnV0ZSgpOwoKICAgICAgICAgIHRoaXMuX3ByZXZlbnRDYXJldE1vdmVtZW50KGRhdGEpOwoKICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuOwogICAgICB9IC8vIERPTidUIEVOR0FHRSAyLVNDTSB3aGVuIGFib3V0IHRvIGVudGVyIG9mIGxlYXZlIGFuIGF0dHJpYnV0ZS4KICAgICAgLy8gV2UgbmVlZCB0byBjaGVjayBpZiB0aGUgY2FyZXQgaXMgYSBvbmUgcG9zaXRpb24gYmVmb3JlIHRoZSBhdHRyaWJ1dGUgYm91bmRhcnk6CiAgICAgIC8vCiAgICAgIC8vIAkJPHBhcmFncmFwaD5mb288JHRleHQgYXR0cmlidXRlPmJ7fWFyPC8kdGV4dD5iYXo8L3BhcmFncmFwaD4KICAgICAgLy8gCQk8cGFyYWdyYXBoPmZvbzwkdGV4dCBhdHRyaWJ1dGU+YmFyPC8kdGV4dD5ie31hejwvcGFyYWdyYXBoPgogICAgICAvLwoKCiAgICAgIGlmIChpc1N0ZXBBZnRlclRoZUF0dHJpYnV0ZUJvdW5kYXJ5KHBvc2l0aW9uLCBhdHRyaWJ1dGUpKSB7CiAgICAgICAgLy8gU2tpcCB0aGUgYXV0b21hdGljIGdyYXZpdHkgcmVzdG9yZSB1cG9uIHRoZSBuZXh0IHNlbGVjdGlvbiNjaGFuZ2U6cmFuZ2UgZXZlbnQuCiAgICAgICAgLy8gSWYgbm90IHNraXBwZWQsIGl0IHdvdWxkIGF1dG9tYXRpY2FsbHkgcmVzdG9yZSB0aGUgZ3Jhdml0eSwgd2hpY2ggc2hvdWxkIHJlbWFpbgogICAgICAgIC8vIG92ZXJyaWRkZW4uCiAgICAgICAgdGhpcy5fc2tpcE5leHRBdXRvbWF0aWNHcmF2aXR5UmVzdG9yYXRpb24oKTsKCiAgICAgICAgdGhpcy5fb3ZlcnJpZGVHcmF2aXR5KCk7IC8vIERvbid0IHJldHVybiAidHJ1ZSIgaGVyZSBiZWNhdXNlIHdlIGRpZG4ndCBjYWxsIF9wcmV2ZW50Q2FyZXRNb3ZlbWVudC4KICAgICAgICAvLyBSZXR1cm5pbmcgaGVyZSB3aWxsIGRlc3RhYmlsaXplIHRoZSBmaWxsZXIgbG9naWMsIHdoaWNoIGFsc28gbGlzdGVucyB0bwogICAgICAgIC8vIGtleWRvd24gKGFuZCB0aGUgZXZlbnQgd291bGQgYmUgc3RvcHBlZCkuCgogICAgICB9CiAgICB9CiAgfQogIC8qKgogICAqIGB0cnVlYCB3aGVuIHRoZSBncmF2aXR5IGlzIG92ZXJyaWRkZW4gZm9yIHRoZSB7QGxpbmsgI2F0dHJpYnV0ZX0uCiAgICoKICAgKiBAcmVhZG9ubHkKICAgKiBAcHJpdmF0ZQogICAqIEB0eXBlIHtCb29sZWFufQogICAqLwoKCiAgZ2V0IF9pc0dyYXZpdHlPdmVycmlkZGVuKCkgewogICAgcmV0dXJuICEhdGhpcy5fb3ZlcnJpZGVVaWQ7CiAgfQogIC8qKgogICAqIGB0cnVlYCB3aGVuIHRoZSB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9zZWxlY3Rpb25+U2VsZWN0aW9ufSBoYXMgdGhlIHtAbGluayAjYXR0cmlidXRlfS4KICAgKgogICAqIEByZWFkb25seQogICAqIEBwcml2YXRlCiAgICogQHR5cGUge0Jvb2xlYW59CiAgICovCgoKICBnZXQgX2hhc1NlbGVjdGlvbkF0dHJpYnV0ZSgpIHsKICAgIHJldHVybiB0aGlzLl9tb2RlbFNlbGVjdGlvbi5oYXNBdHRyaWJ1dGUodGhpcy5hdHRyaWJ1dGUpOwogIH0KICAvKioKICAgKiBPdmVycmlkZXMgdGhlIGdyYXZpdHkgdXNpbmcgdGhlIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL3dyaXRlcn5Xcml0ZXIgbW9kZWwgd3JpdGVyfQogICAqIGFuZCBzdG9yZXMgdGhlIGluZm9ybWF0aW9uIGFib3V0IHRoaXMgZmFjdCBpbiB0aGUge0BsaW5rICNfb3ZlcnJpZGVVaWR9LgogICAqCiAgICogQSBzaG9ydGhhbmQgZm9yIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL3dyaXRlcn5Xcml0ZXIjb3ZlcnJpZGVTZWxlY3Rpb25HcmF2aXR5fS4KICAgKgogICAqIEBwcml2YXRlCiAgICovCgoKICBfb3ZlcnJpZGVHcmF2aXR5KCkgewogICAgdGhpcy5fb3ZlcnJpZGVVaWQgPSB0aGlzLm1vZGVsLmNoYW5nZSh3cml0ZXIgPT4gd3JpdGVyLm92ZXJyaWRlU2VsZWN0aW9uR3Jhdml0eSgpKTsKICB9CiAgLyoqCiAgICogUmVzdG9yZXMgdGhlIGdyYXZpdHkgdXNpbmcgdGhlIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL3dyaXRlcn5Xcml0ZXIgbW9kZWwgd3JpdGVyfS4KICAgKgogICAqIEEgc2hvcnRoYW5kIGZvciB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC93cml0ZXJ+V3JpdGVyI3Jlc3RvcmVTZWxlY3Rpb25HcmF2aXR5fS4KICAgKgogICAqIEBwcml2YXRlCiAgICovCgoKICBfcmVzdG9yZUdyYXZpdHkoKSB7CiAgICB0aGlzLm1vZGVsLmNoYW5nZSh3cml0ZXIgPT4gewogICAgICB3cml0ZXIucmVzdG9yZVNlbGVjdGlvbkdyYXZpdHkodGhpcy5fb3ZlcnJpZGVVaWQpOwogICAgICB0aGlzLl9vdmVycmlkZVVpZCA9IG51bGw7CiAgICB9KTsKICB9CiAgLyoqCiAgICogUHJldmVudHMgdGhlIGNhcmV0IG1vdmVtZW50IGluIHRoZSB2aWV3IGJ5IGNhbGxpbmcgYHByZXZlbnREZWZhdWx0YCBvbiB0aGUgZXZlbnQgZGF0YS4KICAgKgogICAqIEBwcml2YXRlCiAgICovCgoKICBfcHJldmVudENhcmV0TW92ZW1lbnQoZGF0YSkgewogICAgZGF0YS5wcmV2ZW50RGVmYXVsdCgpOwogIH0KICAvKioKICAgKiBSZW1vdmVzIHRoZSB7QGxpbmsgI2F0dHJpYnV0ZX0gZnJvbSB0aGUgc2VsZWN0aW9uIHVzaW5nIHVzaW5nIHRoZQogICAqIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL3dyaXRlcn5Xcml0ZXIgbW9kZWwgd3JpdGVyfS4KICAgKgogICAqIEBwcml2YXRlCiAgICovCgoKICBfcmVtb3ZlU2VsZWN0aW9uQXR0cmlidXRlKCkgewogICAgdGhpcy5tb2RlbC5jaGFuZ2Uod3JpdGVyID0+IHsKICAgICAgd3JpdGVyLnJlbW92ZVNlbGVjdGlvbkF0dHJpYnV0ZSh0aGlzLmF0dHJpYnV0ZSk7CiAgICB9KTsKICB9CiAgLyoqCiAgICogQXBwbGllcyB0aGUge0BsaW5rICNhdHRyaWJ1dGV9IHRvIHRoZSBjdXJyZW50IHNlbGVjdGlvbiB1c2luZyB1c2luZyB0aGUKICAgKiB2YWx1ZSBmcm9tIHRoZSBub2RlIGJlZm9yZSB0aGUgY3VycmVudCBwb3NpdGlvbi4gVXNlcwogICAqIHRoZSB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC93cml0ZXJ+V3JpdGVyIG1vZGVsIHdyaXRlcn0uCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBwYXJhbSB7bW9kdWxlOmVuZ2luZS9tb2RlbC9wb3NpdGlvbn5Qb3NpdGlvbn0gcG9zaXRpb24KICAgKi8KCgogIF9zZXRTZWxlY3Rpb25BdHRyaWJ1dGVGcm9tVGhlTm9kZUJlZm9yZShwb3NpdGlvbikgewogICAgY29uc3QgYXR0cmlidXRlID0gdGhpcy5hdHRyaWJ1dGU7CiAgICB0aGlzLm1vZGVsLmNoYW5nZSh3cml0ZXIgPT4gewogICAgICB3cml0ZXIuc2V0U2VsZWN0aW9uQXR0cmlidXRlKHRoaXMuYXR0cmlidXRlLCBwb3NpdGlvbi5ub2RlQmVmb3JlLmdldEF0dHJpYnV0ZShhdHRyaWJ1dGUpKTsKICAgIH0pOwogIH0KICAvKioKICAgKiBTa2lwcyB0aGUgbmV4dCBhdXRvbWF0aWMgc2VsZWN0aW9uIGdyYXZpdHkgcmVzdG9yYXRpb24gdXBvbiB0aGUKICAgKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9zZWxlY3Rpb25+U2VsZWN0aW9uI2V2ZW50OmNoYW5nZTpyYW5nZX0gZXZlbnQuCiAgICoKICAgKiBTZWUge0BsaW5rICNfaXNOZXh0R3Jhdml0eVJlc3RvcmF0aW9uU2tpcHBlZH0uCiAgICoKICAgKiBAcHJpdmF0ZQogICAqLwoKCiAgX3NraXBOZXh0QXV0b21hdGljR3Jhdml0eVJlc3RvcmF0aW9uKCkgewogICAgdGhpcy5faXNOZXh0R3Jhdml0eVJlc3RvcmF0aW9uU2tpcHBlZCA9IHRydWU7CiAgfQoKfSAvLyBAcGFyYW0ge21vZHVsZTplbmdpbmUvbW9kZWwvcG9zaXRpb25+UG9zaXRpb259IHBvc2l0aW9uCi8vIEBwYXJhbSB7U3RyaW5nfSBhdHRyaWJ1dGUKLy8gQHJldHVybnMge0Jvb2xlYW59IGB0cnVlYCB3aGVuIHBvc2l0aW9uIGJldHdlZW4gdGhlIG5vZGVzIHN0aWNrcyB0byB0aGUgYm91bmQgb2YgdGV4dCB3aXRoIGdpdmVuIGF0dHJpYnV0ZS4KCmZ1bmN0aW9uIGlzQXRCb3VuZGFyeShwb3NpdGlvbiwgYXR0cmlidXRlKSB7CiAgcmV0dXJuIGlzQXRTdGFydEJvdW5kYXJ5KHBvc2l0aW9uLCBhdHRyaWJ1dGUpIHx8IGlzQXRFbmRCb3VuZGFyeShwb3NpdGlvbiwgYXR0cmlidXRlKTsKfSAvLyBAcGFyYW0ge21vZHVsZTplbmdpbmUvbW9kZWwvcG9zaXRpb25+UG9zaXRpb259IHBvc2l0aW9uCi8vIEBwYXJhbSB7U3RyaW5nfSBhdHRyaWJ1dGUKCgpmdW5jdGlvbiBpc0F0U3RhcnRCb3VuZGFyeShwb3NpdGlvbiwgYXR0cmlidXRlKSB7CiAgY29uc3QgewogICAgbm9kZUJlZm9yZSwKICAgIG5vZGVBZnRlcgogIH0gPSBwb3NpdGlvbjsKICBjb25zdCBpc0F0dHJCZWZvcmUgPSBub2RlQmVmb3JlID8gbm9kZUJlZm9yZS5oYXNBdHRyaWJ1dGUoYXR0cmlidXRlKSA6IGZhbHNlOwogIGNvbnN0IGlzQXR0ckFmdGVyID0gbm9kZUFmdGVyID8gbm9kZUFmdGVyLmhhc0F0dHJpYnV0ZShhdHRyaWJ1dGUpIDogZmFsc2U7CiAgcmV0dXJuIGlzQXR0ckFmdGVyICYmICghaXNBdHRyQmVmb3JlIHx8IG5vZGVCZWZvcmUuZ2V0QXR0cmlidXRlKGF0dHJpYnV0ZSkgIT09IG5vZGVBZnRlci5nZXRBdHRyaWJ1dGUoYXR0cmlidXRlKSk7Cn0gLy8gQHBhcmFtIHttb2R1bGU6ZW5naW5lL21vZGVsL3Bvc2l0aW9uflBvc2l0aW9ufSBwb3NpdGlvbgovLyBAcGFyYW0ge1N0cmluZ30gYXR0cmlidXRlCgoKZnVuY3Rpb24gaXNBdEVuZEJvdW5kYXJ5KHBvc2l0aW9uLCBhdHRyaWJ1dGUpIHsKICBjb25zdCB7CiAgICBub2RlQmVmb3JlLAogICAgbm9kZUFmdGVyCiAgfSA9IHBvc2l0aW9uOwogIGNvbnN0IGlzQXR0ckJlZm9yZSA9IG5vZGVCZWZvcmUgPyBub2RlQmVmb3JlLmhhc0F0dHJpYnV0ZShhdHRyaWJ1dGUpIDogZmFsc2U7CiAgY29uc3QgaXNBdHRyQWZ0ZXIgPSBub2RlQWZ0ZXIgPyBub2RlQWZ0ZXIuaGFzQXR0cmlidXRlKGF0dHJpYnV0ZSkgOiBmYWxzZTsKICByZXR1cm4gaXNBdHRyQmVmb3JlICYmICghaXNBdHRyQWZ0ZXIgfHwgbm9kZUJlZm9yZS5nZXRBdHRyaWJ1dGUoYXR0cmlidXRlKSAhPT0gbm9kZUFmdGVyLmdldEF0dHJpYnV0ZShhdHRyaWJ1dGUpKTsKfSAvLyBAcGFyYW0ge21vZHVsZTplbmdpbmUvbW9kZWwvcG9zaXRpb25+UG9zaXRpb259IHBvc2l0aW9uCi8vIEBwYXJhbSB7U3RyaW5nfSBhdHRyaWJ1dGUKCgpmdW5jdGlvbiBpc0JldHdlZW5EaWZmZXJlbnRWYWx1ZXMocG9zaXRpb24sIGF0dHJpYnV0ZSkgewogIGNvbnN0IHsKICAgIG5vZGVCZWZvcmUsCiAgICBub2RlQWZ0ZXIKICB9ID0gcG9zaXRpb247CiAgY29uc3QgaXNBdHRyQmVmb3JlID0gbm9kZUJlZm9yZSA/IG5vZGVCZWZvcmUuaGFzQXR0cmlidXRlKGF0dHJpYnV0ZSkgOiBmYWxzZTsKICBjb25zdCBpc0F0dHJBZnRlciA9IG5vZGVBZnRlciA/IG5vZGVBZnRlci5oYXNBdHRyaWJ1dGUoYXR0cmlidXRlKSA6IGZhbHNlOwoKICBpZiAoIWlzQXR0ckFmdGVyIHx8ICFpc0F0dHJCZWZvcmUpIHsKICAgIHJldHVybjsKICB9CgogIHJldHVybiBub2RlQWZ0ZXIuZ2V0QXR0cmlidXRlKGF0dHJpYnV0ZSkgIT09IG5vZGVCZWZvcmUuZ2V0QXR0cmlidXRlKGF0dHJpYnV0ZSk7Cn0gLy8gQHBhcmFtIHttb2R1bGU6ZW5naW5lL21vZGVsL3Bvc2l0aW9uflBvc2l0aW9ufSBwb3NpdGlvbgovLyBAcGFyYW0ge1N0cmluZ30gYXR0cmlidXRlCgoKZnVuY3Rpb24gaXNTdGVwQWZ0ZXJUaGVBdHRyaWJ1dGVCb3VuZGFyeShwb3NpdGlvbiwgYXR0cmlidXRlKSB7CiAgcmV0dXJuIGlzQXRCb3VuZGFyeShwb3NpdGlvbi5nZXRTaGlmdGVkQnkoLTEpLCBhdHRyaWJ1dGUpOwp9"},{"version":3,"sources":["/Users/antonyching/Desktop/project/new-builder-demo/node_modules/@ckeditor/ckeditor5-engine/src/utils/bindtwostepcarettoattribute.js"],"names":["keyCodes","priorities","bindTwoStepCaretToAttribute","view","model","emitter","attribute","locale","twoStepCaretHandler","TwoStepCaretHandler","modelSelection","document","selection","listenTo","evt","data","isCollapsed","shiftKey","altKey","ctrlKey","arrowRightPressed","keyCode","arrowright","arrowLeftPressed","arrowleft","position","getFirstPosition","contentDirection","contentLanguageDirection","isMovementHandled","handleForwardMovement","handleBackwardMovement","stop","priority","get","constructor","_modelSelection","_overrideUid","_isNextGravityRestorationSkipped","_isGravityOverridden","directChange","isAtBoundary","_restoreGravity","isAtStart","_hasSelectionAttribute","isBetweenDifferentValues","_preventCaretMovement","_removeSelectionAttribute","isAtStartBoundary","_overrideGravity","isAtEndBoundary","_setSelectionAttributeFromTheNodeBefore","isAtEnd","isStepAfterTheAttributeBoundary","_skipNextAutomaticGravityRestoration","hasAttribute","change","writer","overrideSelectionGravity","restoreSelectionGravity","preventDefault","removeSelectionAttribute","setSelectionAttribute","nodeBefore","getAttribute","nodeAfter","isAttrBefore","isAttrAfter","getShiftedBy"],"mappings":"AAAA;;;;;AAKA;;;AAIA,SAASA,QAAT,QAAyB,wCAAzB;AACA,OAAOC,UAAP,MAAuB,0CAAvB;AAEA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA+EA,eAAe,SAASC,2BAAT,CAAsC;AAAEC,EAAAA,IAAF;AAAQC,EAAAA,KAAR;AAAeC,EAAAA,OAAf;AAAwBC,EAAAA,SAAxB;AAAmCC,EAAAA;AAAnC,CAAtC,EAAoF;AAClG,QAAMC,mBAAmB,GAAG,IAAIC,mBAAJ,CAAyBL,KAAzB,EAAgCC,OAAhC,EAAyCC,SAAzC,CAA5B;AACA,QAAMI,cAAc,GAAGN,KAAK,CAACO,QAAN,CAAeC,SAAtC,CAFkG,CAIlG;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACAP,EAAAA,OAAO,CAACQ,QAAR,CAAkBV,IAAI,CAACQ,QAAvB,EAAiC,SAAjC,EAA4C,CAAEG,GAAF,EAAOC,IAAP,KAAiB;AAC5D;AACA,QAAK,CAACL,cAAc,CAACM,WAArB,EAAmC;AAClC;AACA,KAJ2D,CAM5D;AACA;;;AACA,QAAKD,IAAI,CAACE,QAAL,IAAiBF,IAAI,CAACG,MAAtB,IAAgCH,IAAI,CAACI,OAA1C,EAAoD;AACnD;AACA;;AAED,UAAMC,iBAAiB,GAAGL,IAAI,CAACM,OAAL,IAAgBrB,QAAQ,CAACsB,UAAnD;AACA,UAAMC,gBAAgB,GAAGR,IAAI,CAACM,OAAL,IAAgBrB,QAAQ,CAACwB,SAAlD,CAb4D,CAe5D;;AACA,QAAK,CAACJ,iBAAD,IAAsB,CAACG,gBAA5B,EAA+C;AAC9C;AACA;;AAED,UAAME,QAAQ,GAAGf,cAAc,CAACgB,gBAAf,EAAjB;AACA,UAAMC,gBAAgB,GAAGpB,MAAM,CAACqB,wBAAhC;AACA,QAAIC,iBAAJ;;AAEA,QAAOF,gBAAgB,KAAK,KAArB,IAA8BP,iBAAhC,IAAyDO,gBAAgB,KAAK,KAArB,IAA8BJ,gBAA5F,EAAiH;AAChHM,MAAAA,iBAAiB,GAAGrB,mBAAmB,CAACsB,qBAApB,CAA2CL,QAA3C,EAAqDV,IAArD,CAApB;AACA,KAFD,MAEO;AACNc,MAAAA,iBAAiB,GAAGrB,mBAAmB,CAACuB,sBAApB,CAA4CN,QAA5C,EAAsDV,IAAtD,CAApB;AACA,KA5B2D,CA8B5D;AACA;;;AACA,QAAKc,iBAAL,EAAyB;AACxBf,MAAAA,GAAG,CAACkB,IAAJ;AACA;AACD,GAnCD,EAmCG;AAAEC,IAAAA,QAAQ,EAAEhC,UAAU,CAACiC,GAAX,CAAgB,MAAhB,IAA2B;AAAvC,GAnCH;AAoCA;AAED;;;;;;;;AAOA,OAAO,MAAMzB,mBAAN,CAA0B;AAChC;;;;;;;;AAQA0B,EAAAA,WAAW,CAAE/B,KAAF,EAASC,OAAT,EAAkBC,SAAlB,EAA8B;AACxC;;;;;;AAMA,SAAKF,KAAL,GAAaA,KAAb;AAEA;;;;;;;AAMA,SAAKE,SAAL,GAAiBA,SAAjB;AAEA;;;;;;;AAMA,SAAK8B,eAAL,GAAuBhC,KAAK,CAACO,QAAN,CAAeC,SAAtC;AAEA;;;;;;;;AAOA,SAAKyB,YAAL,GAAoB,IAApB;AAEA;;;;;;;;;AAQA,SAAKC,gCAAL,GAAwC,KAAxC,CA1CwC,CA4CxC;;AACAjC,IAAAA,OAAO,CAACQ,QAAR,CAAkB,KAAKuB,eAAvB,EAAwC,cAAxC,EAAwD,CAAEtB,GAAF,EAAOC,IAAP,KAAiB;AACxE;AACA;AACA;AACA,UAAK,KAAKuB,gCAAV,EAA6C;AAC5C,aAAKA,gCAAL,GAAwC,KAAxC;AAEA;AACA,OARuE,CAUxE;AACA;;;AACA,UAAK,CAAC,KAAKC,oBAAX,EAAkC;AACjC;AACA,OAduE,CAgBxE;AACA;AACA;;;AACA,UAAK,CAACxB,IAAI,CAACyB,YAAN,IAAsBC,YAAY,CAAE,KAAKL,eAAL,CAAqBV,gBAArB,EAAF,EAA2CpB,SAA3C,CAAvC,EAAgG;AAC/F;AACA;;AAED,WAAKoC,eAAL;AACA,KAxBD;AAyBA;AAED;;;;;;;;;;AAQAZ,EAAAA,qBAAqB,CAAEL,QAAF,EAAYV,IAAZ,EAAmB;AACvC,UAAMT,SAAS,GAAG,KAAKA,SAAvB,CADuC,CAGvC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACA,QAAK,KAAKiC,oBAAV,EAAiC;AAChC;AACA,KAdsC,CAgBvC;AACA;AACA;AACA;AACA;AACA;AACA;;;AACA,QAAKd,QAAQ,CAACkB,SAAT,IAAsB,KAAKC,sBAAhC,EAAyD;AACxD;AACA,KAzBsC,CA2BvC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACA,QAAKC,wBAAwB,CAAEpB,QAAF,EAAYnB,SAAZ,CAAxB,IAAmD,KAAKsC,sBAA7D,EAAsF;AACrF,WAAKE,qBAAL,CAA4B/B,IAA5B;;AACA,WAAKgC,yBAAL;;AAEA,aAAO,IAAP;AACA,KAxCsC,CA0CvC;AACA;AACA;AACA;;;AACA,QAAKC,iBAAiB,CAAEvB,QAAF,EAAYnB,SAAZ,CAAtB,EAAgD;AAC/C,WAAKwC,qBAAL,CAA4B/B,IAA5B;;AACA,WAAKkC,gBAAL;;AAEA,aAAO,IAAP;AACA,KAnDsC,CAqDvC;AACA;AACA;AACA;;;AACA,QAAKC,eAAe,CAAEzB,QAAF,EAAYnB,SAAZ,CAAf,IAA0C,KAAKsC,sBAApD,EAA6E;AAC5E,WAAKE,qBAAL,CAA4B/B,IAA5B;;AACA,WAAKkC,gBAAL;;AAEA,aAAO,IAAP;AACA;AACD;AAED;;;;;;;;;;AAQAlB,EAAAA,sBAAsB,CAAEN,QAAF,EAAYV,IAAZ,EAAmB;AACxC,UAAMT,SAAS,GAAG,KAAKA,SAAvB,CADwC,CAGxC;;AACA,QAAK,KAAKiC,oBAAV,EAAiC;AAChC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAKM,wBAAwB,CAAEpB,QAAF,EAAYnB,SAAZ,CAAxB,IAAmD,KAAKsC,sBAA7D,EAAsF;AACrF,aAAKE,qBAAL,CAA4B/B,IAA5B;;AACA,aAAK2B,eAAL;;AACA,aAAKK,yBAAL;;AAEA,eAAO,IAAP;AACA,OAND,CAQA;AACA;AACA;AACA;AACA;AAZA,WAaK;AACJ,eAAKD,qBAAL,CAA4B/B,IAA5B;;AACA,eAAK2B,eAAL,GAFI,CAIJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACA,cAAKjB,QAAQ,CAACkB,SAAd,EAA0B;AACzB,iBAAKI,yBAAL;AACA;;AAED,iBAAO,IAAP;AACA;AACD,KA3CD,MA2CO;AACN;AACA;AACA;AACA;AACA,UAAKF,wBAAwB,CAAEpB,QAAF,EAAYnB,SAAZ,CAAxB,IAAmD,CAAC,KAAKsC,sBAA9D,EAAuF;AACtF,aAAKE,qBAAL,CAA4B/B,IAA5B;;AACA,aAAKoC,uCAAL,CAA8C1B,QAA9C;;AAEA,eAAO,IAAP;AACA,OAVK,CAYN;AACA;AACA;AACA;AACA;;;AACA,UAAKA,QAAQ,CAAC2B,OAAT,IAAoBF,eAAe,CAAEzB,QAAF,EAAYnB,SAAZ,CAAxC,EAAkE;AACjE;AACA;AACA;AACA;AACA;AACA,YAAK,KAAKsC,sBAAV,EAAmC;AAClC;AACA;AACA;AACA;AACA;AACA,cAAKS,+BAA+B,CAAE5B,QAAF,EAAYnB,SAAZ,CAApC,EAA8D;AAC7D;AACA;AACA;AACA,iBAAKgD,oCAAL;;AACA,iBAAKL,gBAAL,GAL6D,CAO7D;AACA;AACA;;AACA;;AAED;AACA,SAnBD,CAoBA;AACA;AACA;AACA;AACA;AAxBA,aAyBK;AACJ,iBAAKH,qBAAL,CAA4B/B,IAA5B;;AACA,iBAAKoC,uCAAL,CAA8C1B,QAA9C;;AAEA,mBAAO,IAAP;AACA;AACD,OAtDK,CAwDN;AACA;AACA;AACA;AACA;;;AACA,UAAKA,QAAQ,CAACkB,SAAd,EAA0B;AACzB,YAAK,KAAKC,sBAAV,EAAmC;AAClC,eAAKG,yBAAL;;AACA,eAAKD,qBAAL,CAA4B/B,IAA5B;;AAEA,iBAAO,IAAP;AACA;;AAED;AACA,OAtEK,CAwEN;AACA;AACA;AACA;AACA;AACA;;;AACA,UAAKsC,+BAA+B,CAAE5B,QAAF,EAAYnB,SAAZ,CAApC,EAA8D;AAC7D;AACA;AACA;AACA,aAAKgD,oCAAL;;AACA,aAAKL,gBAAL,GAL6D,CAO7D;AACA;AACA;;AACA;AACD;AACD;AAED;;;;;;;;;AAOA,MAAIV,oBAAJ,GAA2B;AAC1B,WAAO,CAAC,CAAC,KAAKF,YAAd;AACA;AAED;;;;;;;;;AAOA,MAAIO,sBAAJ,GAA6B;AAC5B,WAAO,KAAKR,eAAL,CAAqBmB,YAArB,CAAmC,KAAKjD,SAAxC,CAAP;AACA;AAED;;;;;;;;;;AAQA2C,EAAAA,gBAAgB,GAAG;AAClB,SAAKZ,YAAL,GAAoB,KAAKjC,KAAL,CAAWoD,MAAX,CAAmBC,MAAM,IAAIA,MAAM,CAACC,wBAAP,EAA7B,CAApB;AACA;AAED;;;;;;;;;AAOAhB,EAAAA,eAAe,GAAG;AACjB,SAAKtC,KAAL,CAAWoD,MAAX,CAAmBC,MAAM,IAAI;AAC5BA,MAAAA,MAAM,CAACE,uBAAP,CAAgC,KAAKtB,YAArC;AACA,WAAKA,YAAL,GAAoB,IAApB;AACA,KAHD;AAIA;AAED;;;;;;;AAKAS,EAAAA,qBAAqB,CAAE/B,IAAF,EAAS;AAC7BA,IAAAA,IAAI,CAAC6C,cAAL;AACA;AAED;;;;;;;;AAMAb,EAAAA,yBAAyB,GAAG;AAC3B,SAAK3C,KAAL,CAAWoD,MAAX,CAAmBC,MAAM,IAAI;AAC5BA,MAAAA,MAAM,CAACI,wBAAP,CAAiC,KAAKvD,SAAtC;AACA,KAFD;AAGA;AAED;;;;;;;;;;AAQA6C,EAAAA,uCAAuC,CAAE1B,QAAF,EAAa;AACnD,UAAMnB,SAAS,GAAG,KAAKA,SAAvB;AAEA,SAAKF,KAAL,CAAWoD,MAAX,CAAmBC,MAAM,IAAI;AAC5BA,MAAAA,MAAM,CAACK,qBAAP,CAA8B,KAAKxD,SAAnC,EAA8CmB,QAAQ,CAACsC,UAAT,CAAoBC,YAApB,CAAkC1D,SAAlC,CAA9C;AACA,KAFD;AAGA;AAED;;;;;;;;;;AAQAgD,EAAAA,oCAAoC,GAAG;AACtC,SAAKhB,gCAAL,GAAwC,IAAxC;AACA;;AA5Y+B,C,CA+YjC;AACA;AACA;;AACA,SAASG,YAAT,CAAuBhB,QAAvB,EAAiCnB,SAAjC,EAA6C;AAC5C,SAAO0C,iBAAiB,CAAEvB,QAAF,EAAYnB,SAAZ,CAAjB,IAA4C4C,eAAe,CAAEzB,QAAF,EAAYnB,SAAZ,CAAlE;AACA,C,CAED;AACA;;;AACA,SAAS0C,iBAAT,CAA4BvB,QAA5B,EAAsCnB,SAAtC,EAAkD;AACjD,QAAM;AAAEyD,IAAAA,UAAF;AAAcE,IAAAA;AAAd,MAA4BxC,QAAlC;AACA,QAAMyC,YAAY,GAAGH,UAAU,GAAGA,UAAU,CAACR,YAAX,CAAyBjD,SAAzB,CAAH,GAA0C,KAAzE;AACA,QAAM6D,WAAW,GAAGF,SAAS,GAAGA,SAAS,CAACV,YAAV,CAAwBjD,SAAxB,CAAH,GAAyC,KAAtE;AAEA,SAAO6D,WAAW,KAAM,CAACD,YAAD,IAAiBH,UAAU,CAACC,YAAX,CAAyB1D,SAAzB,MAAyC2D,SAAS,CAACD,YAAV,CAAwB1D,SAAxB,CAAhE,CAAlB;AACA,C,CAED;AACA;;;AACA,SAAS4C,eAAT,CAA0BzB,QAA1B,EAAoCnB,SAApC,EAAgD;AAC/C,QAAM;AAAEyD,IAAAA,UAAF;AAAcE,IAAAA;AAAd,MAA4BxC,QAAlC;AACA,QAAMyC,YAAY,GAAGH,UAAU,GAAGA,UAAU,CAACR,YAAX,CAAyBjD,SAAzB,CAAH,GAA0C,KAAzE;AACA,QAAM6D,WAAW,GAAGF,SAAS,GAAGA,SAAS,CAACV,YAAV,CAAwBjD,SAAxB,CAAH,GAAyC,KAAtE;AAEA,SAAO4D,YAAY,KAAM,CAACC,WAAD,IAAgBJ,UAAU,CAACC,YAAX,CAAyB1D,SAAzB,MAAyC2D,SAAS,CAACD,YAAV,CAAwB1D,SAAxB,CAA/D,CAAnB;AACA,C,CAED;AACA;;;AACA,SAASuC,wBAAT,CAAmCpB,QAAnC,EAA6CnB,SAA7C,EAAyD;AACxD,QAAM;AAAEyD,IAAAA,UAAF;AAAcE,IAAAA;AAAd,MAA4BxC,QAAlC;AACA,QAAMyC,YAAY,GAAGH,UAAU,GAAGA,UAAU,CAACR,YAAX,CAAyBjD,SAAzB,CAAH,GAA0C,KAAzE;AACA,QAAM6D,WAAW,GAAGF,SAAS,GAAGA,SAAS,CAACV,YAAV,CAAwBjD,SAAxB,CAAH,GAAyC,KAAtE;;AAEA,MAAK,CAAC6D,WAAD,IAAgB,CAACD,YAAtB,EAAqC;AACpC;AACA;;AAED,SAAOD,SAAS,CAACD,YAAV,CAAwB1D,SAAxB,MAAwCyD,UAAU,CAACC,YAAX,CAAyB1D,SAAzB,CAA/C;AACA,C,CAED;AACA;;;AACA,SAAS+C,+BAAT,CAA0C5B,QAA1C,EAAoDnB,SAApD,EAAgE;AAC/D,SAAOmC,YAAY,CAAEhB,QAAQ,CAAC2C,YAAT,CAAuB,CAAC,CAAxB,CAAF,EAA+B9D,SAA/B,CAAnB;AACA","sourcesContent":["/**\n * @license Copyright (c) 2003-2019, CKSource - Frederico Knabben. All rights reserved.\n * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license\n */\n\n/**\n * @module engine/utils/bindtwostepcarettoattribute\n */\n\nimport { keyCodes } from '@ckeditor/ckeditor5-utils/src/keyboard';\nimport priorities from '@ckeditor/ckeditor5-utils/src/priorities';\n\n/**\n * This helper enables the two-step caret (phantom) movement behavior for the given {@link module:engine/model/model~Model}\n * attribute on arrow right (<kbd>→</kbd>) and left (<kbd>←</kbd>) key press.\n *\n * Thanks to this (phantom) caret movement the user is able to type before/after as well as at the\n * beginning/end of an attribute.\n *\n * **Note:** This helper support right–to–left (Arabic, Hebrew, etc.) content by mirroring its behavior\n * but for the sake of simplicity examples showcase only left–to–right use–cases.\n *\n * # Forward movement\n *\n * ## \"Entering\" an attribute:\n *\n * When this behavior is enabled for the `a` attribute and the selection is right before it\n * (at the attribute boundary), pressing the right arrow key will not move the selection but update its\n * attributes accordingly:\n *\n * * When enabled:\n *\n *   \t\tfoo{}<$text a=\"true\">bar</$text>\n *\n *    <kbd>→</kbd>\n *\n *   \t\tfoo<$text a=\"true\">{}bar</$text>\n *\n * * When disabled:\n *\n *   \t\tfoo{}<$text a=\"true\">bar</$text>\n *\n *   <kbd>→</kbd>\n *\n *   \t\tfoo<$text a=\"true\">b{}ar</$text>\n *\n *\n * ## \"Leaving\" an attribute:\n *\n * * When enabled:\n *\n *   \t\t<$text a=\"true\">bar{}</$text>baz\n *\n *    <kbd>→</kbd>\n *\n *   \t\t<$text a=\"true\">bar</$text>{}baz\n *\n * * When disabled:\n *\n *   \t\t<$text a=\"true\">bar{}</$text>baz\n *\n *   <kbd>→</kbd>\n *\n *   \t\t<$text a=\"true\">bar</$text>b{}az\n *\n * # Backward movement\n *\n * * When enabled:\n *\n *   \t\t<$text a=\"true\">bar</$text>{}baz\n *\n *    <kbd>←</kbd>\n *\n *   \t\t<$text a=\"true\">bar{}</$text>baz\n *\n * * When disabled:\n *\n *   \t\t<$text a=\"true\">bar</$text>{}baz\n *\n *   <kbd>←</kbd>\n *\n *   \t\t<$text a=\"true\">ba{}r</$text>b{}az\n *\n * @param {Object} options Helper options.\n * @param {module:engine/view/view~View} options.view View controller instance.\n * @param {module:engine/model/model~Model} options.model Data model instance.\n * @param {module:utils/dom/emittermixin~Emitter} options.emitter The emitter to which this behavior should be added\n * (e.g. a plugin instance).\n * @param {String} options.attribute Attribute for which this behavior will be added.\n * @param {module:utils/locale~Locale} options.locale The {@link module:core/editor/editor~Editor#locale} instance.\n */\nexport default function bindTwoStepCaretToAttribute( { view, model, emitter, attribute, locale } ) {\n\tconst twoStepCaretHandler = new TwoStepCaretHandler( model, emitter, attribute );\n\tconst modelSelection = model.document.selection;\n\n\t// Listen to keyboard events and handle the caret movement according to the 2-step caret logic.\n\t//\n\t// Note: This listener has the \"high+1\" priority:\n\t// * \"high\" because of the filler logic implemented in the renderer which also engages on #keydown.\n\t// When the gravity is overridden the attributes of the (model) selection attributes are reset.\n\t// It may end up with the filler kicking in and breaking the selection.\n\t// * \"+1\" because we would like to avoid collisions with other features (like Widgets), which\n\t// take over the keydown events with the \"high\" priority. Two-step caret movement takes precedence\n\t// over Widgets in that matter.\n\t//\n\t// Find out more in https://github.com/ckeditor/ckeditor5-engine/issues/1301.\n\temitter.listenTo( view.document, 'keydown', ( evt, data ) => {\n\t\t// This implementation works only for collapsed selection.\n\t\tif ( !modelSelection.isCollapsed ) {\n\t\t\treturn;\n\t\t}\n\n\t\t// When user tries to expand the selection or jump over the whole word or to the beginning/end then\n\t\t// two-steps movement is not necessary.\n\t\tif ( data.shiftKey || data.altKey || data.ctrlKey ) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst arrowRightPressed = data.keyCode == keyCodes.arrowright;\n\t\tconst arrowLeftPressed = data.keyCode == keyCodes.arrowleft;\n\n\t\t// When neither left or right arrow has been pressed then do noting.\n\t\tif ( !arrowRightPressed && !arrowLeftPressed ) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst position = modelSelection.getFirstPosition();\n\t\tconst contentDirection = locale.contentLanguageDirection;\n\t\tlet isMovementHandled;\n\n\t\tif ( ( contentDirection === 'ltr' && arrowRightPressed ) || ( contentDirection === 'rtl' && arrowLeftPressed ) ) {\n\t\t\tisMovementHandled = twoStepCaretHandler.handleForwardMovement( position, data );\n\t\t} else {\n\t\t\tisMovementHandled = twoStepCaretHandler.handleBackwardMovement( position, data );\n\t\t}\n\n\t\t// Stop the keydown event if the two-step caret movement handled it. Avoid collisions\n\t\t// with other features which may also take over the caret movement (e.g. Widget).\n\t\tif ( isMovementHandled ) {\n\t\t\tevt.stop();\n\t\t}\n\t}, { priority: priorities.get( 'high' ) + 1 } );\n}\n\n/**\n * This is a protected helper–class for {@link module:engine/utils/bindtwostepcarettoattribute}.\n * It handles the state of the 2-step caret movement for a single {@link module:engine/model/model~Model}\n * attribute upon the `keypress` in the {@link module:engine/view/view~View}.\n *\n * @protected\n */\nexport class TwoStepCaretHandler {\n\t/*\n\t * Creates two step handler instance.\n\t *\n\t * @param {module:engine/model/model~Model} model Data model instance.\n\t * @param {module:utils/dom/emittermixin~Emitter} emitter The emitter to which this behavior should be added\n\t * (e.g. a plugin instance).\n\t * @param {String} attribute Attribute for which the behavior will be added.\n\t */\n\tconstructor( model, emitter, attribute ) {\n\t\t/**\n\t\t * The model instance this class instance operates on.\n\t\t *\n\t\t * @readonly\n\t\t * @member {module:engine/model/model~Model#schema}\n\t\t */\n\t\tthis.model = model;\n\n\t\t/**\n\t\t * The Attribute this class instance operates on.\n\t\t *\n\t\t * @readonly\n\t\t * @member {String}\n\t\t */\n\t\tthis.attribute = attribute;\n\n\t\t/**\n\t\t * A reference to the document selection.\n\t\t *\n\t\t * @private\n\t\t * @member {module:engine/model/selection~Selection}\n\t\t */\n\t\tthis._modelSelection = model.document.selection;\n\n\t\t/**\n\t\t * The current UID of the overridden gravity, as returned by\n\t\t * {@link module:engine/model/writer~Writer#overrideSelectionGravity}.\n\t\t *\n\t\t * @private\n\t\t * @member {String}\n\t\t */\n\t\tthis._overrideUid = null;\n\n\t\t/**\n\t\t * A flag indicating that the automatic gravity restoration for this attribute\n\t\t * should not happen upon the next\n\t\t * {@link module:engine/model/selection~Selection#event:change:range} event.\n\t\t *\n\t\t * @private\n\t\t * @member {String}\n\t\t */\n\t\tthis._isNextGravityRestorationSkipped = false;\n\n\t\t// The automatic gravity restoration logic.\n\t\temitter.listenTo( this._modelSelection, 'change:range', ( evt, data ) => {\n\t\t\t// Skipping the automatic restoration is needed if the selection should change\n\t\t\t// but the gravity must remain overridden afterwards. See the #handleBackwardMovement\n\t\t\t// to learn more.\n\t\t\tif ( this._isNextGravityRestorationSkipped ) {\n\t\t\t\tthis._isNextGravityRestorationSkipped = false;\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Skip automatic restore when the gravity is not overridden — simply, there's nothing to restore\n\t\t\t// at this moment.\n\t\t\tif ( !this._isGravityOverridden ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Skip automatic restore when the change is indirect AND the selection is at the attribute boundary.\n\t\t\t// It means that e.g. if the change was external (collaboration) and the user had their\n\t\t\t// selection around the link, its gravity should remain intact in this change:range event.\n\t\t\tif ( !data.directChange && isAtBoundary( this._modelSelection.getFirstPosition(), attribute ) ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis._restoreGravity();\n\t\t} );\n\t}\n\n\t/**\n\t * Updates the document selection and the view according to the two–step caret movement state\n\t * when moving **forwards**. Executed upon `keypress` in the {@link module:engine/view/view~View}.\n\t *\n\t * @param {module:engine/model/position~Position} position The model position at the moment of the key press.\n\t * @param {module:engine/view/observer/domeventdata~DomEventData} data Data of the key press.\n\t * @returns {Boolean} `true` when the handler prevented caret movement\n\t */\n\thandleForwardMovement( position, data ) {\n\t\tconst attribute = this.attribute;\n\n\t\t// DON'T ENGAGE 2-SCM if gravity is already overridden. It means that we just entered\n\t\t//\n\t\t// \t\t<paragraph>foo<$text attribute>{}bar</$text>baz</paragraph>\n\t\t//\n\t\t// or left the attribute\n\t\t//\n\t\t// \t\t<paragraph>foo<$text attribute>bar</$text>{}baz</paragraph>\n\t\t//\n\t\t// and the gravity will be restored automatically.\n\t\tif ( this._isGravityOverridden ) {\n\t\t\treturn;\n\t\t}\n\n\t\t// DON'T ENGAGE 2-SCM when the selection is at the beginning of the block AND already has the\n\t\t// attribute:\n\t\t// * when the selection was initially set there using the mouse,\n\t\t// * when the editor has just started\n\t\t//\n\t\t//\t\t<paragraph><$text attribute>{}bar</$text>baz</paragraph>\n\t\t//\n\t\tif ( position.isAtStart && this._hasSelectionAttribute ) {\n\t\t\treturn;\n\t\t}\n\n\t\t// ENGAGE 2-SCM when about to leave one attribute value and enter another:\n\t\t//\n\t\t// \t\t<paragraph><$text attribute=\"1\">foo{}</$text><$text attribute=\"2\">bar</$text></paragraph>\n\t\t//\n\t\t// but DON'T when already in between of them (no attribute selection):\n\t\t//\n\t\t// \t\t<paragraph><$text attribute=\"1\">foo</$text>{}<$text attribute=\"2\">bar</$text></paragraph>\n\t\t//\n\t\tif ( isBetweenDifferentValues( position, attribute ) && this._hasSelectionAttribute ) {\n\t\t\tthis._preventCaretMovement( data );\n\t\t\tthis._removeSelectionAttribute();\n\n\t\t\treturn true;\n\t\t}\n\n\t\t// ENGAGE 2-SCM when entering an attribute:\n\t\t//\n\t\t// \t\t<paragraph>foo{}<$text attribute>bar</$text>baz</paragraph>\n\t\t//\n\t\tif ( isAtStartBoundary( position, attribute ) ) {\n\t\t\tthis._preventCaretMovement( data );\n\t\t\tthis._overrideGravity();\n\n\t\t\treturn true;\n\t\t}\n\n\t\t// ENGAGE 2-SCM when leaving an attribute:\n\t\t//\n\t\t//\t\t<paragraph>foo<$text attribute>bar{}</$text>baz</paragraph>\n\t\t//\n\t\tif ( isAtEndBoundary( position, attribute ) && this._hasSelectionAttribute ) {\n\t\t\tthis._preventCaretMovement( data );\n\t\t\tthis._overrideGravity();\n\n\t\t\treturn true;\n\t\t}\n\t}\n\n\t/**\n\t * Updates the document selection and the view according to the two–step caret movement state\n\t * when moving **backwards**. Executed upon `keypress` in the {@link module:engine/view/view~View}.\n\t *\n\t * @param {module:engine/model/position~Position} position The model position at the moment of the key press.\n\t * @param {module:engine/view/observer/domeventdata~DomEventData} data Data of the key press.\n\t * @returns {Boolean} `true` when the handler prevented caret movement\n\t */\n\thandleBackwardMovement( position, data ) {\n\t\tconst attribute = this.attribute;\n\n\t\t// When the gravity is already overridden...\n\t\tif ( this._isGravityOverridden ) {\n\t\t\t// ENGAGE 2-SCM & REMOVE SELECTION ATTRIBUTE\n\t\t\t// when about to leave one attribute value and enter another:\n\t\t\t//\n\t\t\t// \t\t<paragraph><$text attribute=\"1\">foo</$text><$text attribute=\"2\">{}bar</$text></paragraph>\n\t\t\t//\n\t\t\t// but DON'T when already in between of them (no attribute selection):\n\t\t\t//\n\t\t\t// \t\t<paragraph><$text attribute=\"1\">foo</$text>{}<$text attribute=\"2\">bar</$text></paragraph>\n\t\t\t//\n\t\t\tif ( isBetweenDifferentValues( position, attribute ) && this._hasSelectionAttribute ) {\n\t\t\t\tthis._preventCaretMovement( data );\n\t\t\t\tthis._restoreGravity();\n\t\t\t\tthis._removeSelectionAttribute();\n\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\t// ENGAGE 2-SCM when at any boundary of the attribute:\n\t\t\t//\n\t\t\t// \t\t<paragraph>foo<$text attribute>bar</$text>{}baz</paragraph>\n\t\t\t// \t\t<paragraph>foo<$text attribute>{}bar</$text>baz</paragraph>\n\t\t\t//\n\t\t\telse {\n\t\t\t\tthis._preventCaretMovement( data );\n\t\t\t\tthis._restoreGravity();\n\n\t\t\t\t// REMOVE SELECTION ATRIBUTE at the beginning of the block.\n\t\t\t\t// It's like restoring gravity but towards a non-existent content when\n\t\t\t\t// the gravity is overridden:\n\t\t\t\t//\n\t\t\t\t// \t\t<paragraph><$text attribute>{}bar</$text></paragraph>\n\t\t\t\t//\n\t\t\t\t// becomes:\n\t\t\t\t//\n\t\t\t\t// \t\t<paragraph>{}<$text attribute>bar</$text></paragraph>\n\t\t\t\t//\n\t\t\t\tif ( position.isAtStart ) {\n\t\t\t\t\tthis._removeSelectionAttribute();\n\t\t\t\t}\n\n\t\t\t\treturn true;\n\t\t\t}\n\t\t} else {\n\t\t\t// ENGAGE 2-SCM when between two different attribute values but selection has no attribute:\n\t\t\t//\n\t\t\t// \t\t<paragraph><$text attribute=\"1\">foo</$text>{}<$text attribute=\"2\">bar</$text></paragraph>\n\t\t\t//\n\t\t\tif ( isBetweenDifferentValues( position, attribute ) && !this._hasSelectionAttribute ) {\n\t\t\t\tthis._preventCaretMovement( data );\n\t\t\t\tthis._setSelectionAttributeFromTheNodeBefore( position );\n\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\t// End of block boundary cases:\n\t\t\t//\n\t\t\t// \t\t<paragraph><$text attribute>bar{}</$text></paragraph>\n\t\t\t// \t\t<paragraph><$text attribute>bar</$text>{}</paragraph>\n\t\t\t//\n\t\t\tif ( position.isAtEnd && isAtEndBoundary( position, attribute ) ) {\n\t\t\t\t// DON'T ENGAGE 2-SCM if the selection has the attribute already.\n\t\t\t\t// This is a common selection if set using the mouse.\n\t\t\t\t//\n\t\t\t\t// \t\t<paragraph><$text attribute>bar{}</$text></paragraph>\n\t\t\t\t//\n\t\t\t\tif ( this._hasSelectionAttribute ) {\n\t\t\t\t\t// DON'T ENGAGE 2-SCM if the attribute at the end of the block which has length == 1.\n\t\t\t\t\t// Make sure the selection will not the attribute after it moves backwards.\n\t\t\t\t\t//\n\t\t\t\t\t// \t\t<paragraph>foo<$text attribute>b{}</$text></paragraph>\n\t\t\t\t\t//\n\t\t\t\t\tif ( isStepAfterTheAttributeBoundary( position, attribute ) ) {\n\t\t\t\t\t\t// Skip the automatic gravity restore upon the next selection#change:range event.\n\t\t\t\t\t\t// If not skipped, it would automatically restore the gravity, which should remain\n\t\t\t\t\t\t// overridden.\n\t\t\t\t\t\tthis._skipNextAutomaticGravityRestoration();\n\t\t\t\t\t\tthis._overrideGravity();\n\n\t\t\t\t\t\t// Don't return \"true\" here because we didn't call _preventCaretMovement.\n\t\t\t\t\t\t// Returning here will destabilize the filler logic, which also listens to\n\t\t\t\t\t\t// keydown (and the event would be stopped).\n\t\t\t\t\t}\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\t// ENGAGE 2-SCM if the selection has no attribute. This may happen when the user\n\t\t\t\t// left the attribute using a FORWARD 2-SCM.\n\t\t\t\t//\n\t\t\t\t// \t\t<paragraph><$text attribute>bar</$text>{}</paragraph>\n\t\t\t\t//\n\t\t\t\telse {\n\t\t\t\t\tthis._preventCaretMovement( data );\n\t\t\t\t\tthis._setSelectionAttributeFromTheNodeBefore( position );\n\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// REMOVE SELECTION ATRIBUTE when restoring gravity towards a non-existent content at the\n\t\t\t// beginning of the block.\n\t\t\t//\n\t\t\t// \t\t<paragraph>{}<$text attribute>bar</$text></paragraph>\n\t\t\t//\n\t\t\tif ( position.isAtStart ) {\n\t\t\t\tif ( this._hasSelectionAttribute ) {\n\t\t\t\t\tthis._removeSelectionAttribute();\n\t\t\t\t\tthis._preventCaretMovement( data );\n\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// DON'T ENGAGE 2-SCM when about to enter of leave an attribute.\n\t\t\t// We need to check if the caret is a one position before the attribute boundary:\n\t\t\t//\n\t\t\t// \t\t<paragraph>foo<$text attribute>b{}ar</$text>baz</paragraph>\n\t\t\t// \t\t<paragraph>foo<$text attribute>bar</$text>b{}az</paragraph>\n\t\t\t//\n\t\t\tif ( isStepAfterTheAttributeBoundary( position, attribute ) ) {\n\t\t\t\t// Skip the automatic gravity restore upon the next selection#change:range event.\n\t\t\t\t// If not skipped, it would automatically restore the gravity, which should remain\n\t\t\t\t// overridden.\n\t\t\t\tthis._skipNextAutomaticGravityRestoration();\n\t\t\t\tthis._overrideGravity();\n\n\t\t\t\t// Don't return \"true\" here because we didn't call _preventCaretMovement.\n\t\t\t\t// Returning here will destabilize the filler logic, which also listens to\n\t\t\t\t// keydown (and the event would be stopped).\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * `true` when the gravity is overridden for the {@link #attribute}.\n\t *\n\t * @readonly\n\t * @private\n\t * @type {Boolean}\n\t */\n\tget _isGravityOverridden() {\n\t\treturn !!this._overrideUid;\n\t}\n\n\t/**\n\t * `true` when the {@link module:engine/model/selection~Selection} has the {@link #attribute}.\n\t *\n\t * @readonly\n\t * @private\n\t * @type {Boolean}\n\t */\n\tget _hasSelectionAttribute() {\n\t\treturn this._modelSelection.hasAttribute( this.attribute );\n\t}\n\n\t/**\n\t * Overrides the gravity using the {@link module:engine/model/writer~Writer model writer}\n\t * and stores the information about this fact in the {@link #_overrideUid}.\n\t *\n\t * A shorthand for {@link module:engine/model/writer~Writer#overrideSelectionGravity}.\n\t *\n\t * @private\n\t */\n\t_overrideGravity() {\n\t\tthis._overrideUid = this.model.change( writer => writer.overrideSelectionGravity() );\n\t}\n\n\t/**\n\t * Restores the gravity using the {@link module:engine/model/writer~Writer model writer}.\n\t *\n\t * A shorthand for {@link module:engine/model/writer~Writer#restoreSelectionGravity}.\n\t *\n\t * @private\n\t */\n\t_restoreGravity() {\n\t\tthis.model.change( writer => {\n\t\t\twriter.restoreSelectionGravity( this._overrideUid );\n\t\t\tthis._overrideUid = null;\n\t\t} );\n\t}\n\n\t/**\n\t * Prevents the caret movement in the view by calling `preventDefault` on the event data.\n\t *\n\t * @private\n\t */\n\t_preventCaretMovement( data ) {\n\t\tdata.preventDefault();\n\t}\n\n\t/**\n\t * Removes the {@link #attribute} from the selection using using the\n\t * {@link module:engine/model/writer~Writer model writer}.\n\t *\n\t * @private\n\t */\n\t_removeSelectionAttribute() {\n\t\tthis.model.change( writer => {\n\t\t\twriter.removeSelectionAttribute( this.attribute );\n\t\t} );\n\t}\n\n\t/**\n\t * Applies the {@link #attribute} to the current selection using using the\n\t * value from the node before the current position. Uses\n\t * the {@link module:engine/model/writer~Writer model writer}.\n\t *\n\t * @private\n\t * @param {module:engine/model/position~Position} position\n\t */\n\t_setSelectionAttributeFromTheNodeBefore( position ) {\n\t\tconst attribute = this.attribute;\n\n\t\tthis.model.change( writer => {\n\t\t\twriter.setSelectionAttribute( this.attribute, position.nodeBefore.getAttribute( attribute ) );\n\t\t} );\n\t}\n\n\t/**\n\t * Skips the next automatic selection gravity restoration upon the\n\t * {@link module:engine/model/selection~Selection#event:change:range} event.\n\t *\n\t * See {@link #_isNextGravityRestorationSkipped}.\n\t *\n\t * @private\n\t */\n\t_skipNextAutomaticGravityRestoration() {\n\t\tthis._isNextGravityRestorationSkipped = true;\n\t}\n}\n\n// @param {module:engine/model/position~Position} position\n// @param {String} attribute\n// @returns {Boolean} `true` when position between the nodes sticks to the bound of text with given attribute.\nfunction isAtBoundary( position, attribute ) {\n\treturn isAtStartBoundary( position, attribute ) || isAtEndBoundary( position, attribute );\n}\n\n// @param {module:engine/model/position~Position} position\n// @param {String} attribute\nfunction isAtStartBoundary( position, attribute ) {\n\tconst { nodeBefore, nodeAfter } = position;\n\tconst isAttrBefore = nodeBefore ? nodeBefore.hasAttribute( attribute ) : false;\n\tconst isAttrAfter = nodeAfter ? nodeAfter.hasAttribute( attribute ) : false;\n\n\treturn isAttrAfter && ( !isAttrBefore || nodeBefore.getAttribute( attribute ) !== nodeAfter.getAttribute( attribute ) );\n}\n\n// @param {module:engine/model/position~Position} position\n// @param {String} attribute\nfunction isAtEndBoundary( position, attribute ) {\n\tconst { nodeBefore, nodeAfter } = position;\n\tconst isAttrBefore = nodeBefore ? nodeBefore.hasAttribute( attribute ) : false;\n\tconst isAttrAfter = nodeAfter ? nodeAfter.hasAttribute( attribute ) : false;\n\n\treturn isAttrBefore && ( !isAttrAfter || nodeBefore.getAttribute( attribute ) !== nodeAfter.getAttribute( attribute ) );\n}\n\n// @param {module:engine/model/position~Position} position\n// @param {String} attribute\nfunction isBetweenDifferentValues( position, attribute ) {\n\tconst { nodeBefore, nodeAfter } = position;\n\tconst isAttrBefore = nodeBefore ? nodeBefore.hasAttribute( attribute ) : false;\n\tconst isAttrAfter = nodeAfter ? nodeAfter.hasAttribute( attribute ) : false;\n\n\tif ( !isAttrAfter || !isAttrBefore ) {\n\t\treturn;\n\t}\n\n\treturn nodeAfter.getAttribute( attribute ) !== nodeBefore.getAttribute( attribute );\n}\n\n// @param {module:engine/model/position~Position} position\n// @param {String} attribute\nfunction isStepAfterTheAttributeBoundary( position, attribute ) {\n\treturn isAtBoundary( position.getShiftedBy( -1 ), attribute );\n}\n"]}]}
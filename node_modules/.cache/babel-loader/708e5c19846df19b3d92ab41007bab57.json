{"remainingRequest":"/Users/antonyching/Desktop/project/new-builder-demo/node_modules/babel-loader/lib/index.js!/Users/antonyching/Desktop/project/new-builder-demo/node_modules/@ckeditor/ckeditor5-engine/src/model/utils/deletecontent.js","dependencies":[{"path":"/Users/antonyching/Desktop/project/new-builder-demo/node_modules/@ckeditor/ckeditor5-engine/src/model/utils/deletecontent.js","mtime":499162500000},{"path":"/Users/antonyching/Desktop/project/new-builder-demo/node_modules/@ckeditor/ckeditor5-dev-webpack-plugin/lib/translatesourceloader.js","mtime":499162500000},{"path":"/Users/antonyching/Desktop/project/new-builder-demo/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/antonyching/Desktop/project/new-builder-demo/node_modules/babel-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:LyoqCiAqIEBsaWNlbnNlIENvcHlyaWdodCAoYykgMjAwMy0yMDE5LCBDS1NvdXJjZSAtIEZyZWRlcmljbyBLbmFiYmVuLiBBbGwgcmlnaHRzIHJlc2VydmVkLgogKiBGb3IgbGljZW5zaW5nLCBzZWUgTElDRU5TRS5tZCBvciBodHRwczovL2NrZWRpdG9yLmNvbS9sZWdhbC9ja2VkaXRvci1vc3MtbGljZW5zZQogKi8KCi8qKgogKiBAbW9kdWxlIGVuZ2luZS9tb2RlbC91dGlscy9kZWxldGVjb250ZW50CiAqLwppbXBvcnQgTGl2ZVBvc2l0aW9uIGZyb20gJy4uL2xpdmVwb3NpdGlvbic7CmltcG9ydCBSYW5nZSBmcm9tICcuLi9yYW5nZSc7CmltcG9ydCBEb2N1bWVudFNlbGVjdGlvbiBmcm9tICcuLi9kb2N1bWVudHNlbGVjdGlvbic7Ci8qKgogKiBEZWxldGVzIGNvbnRlbnQgb2YgdGhlIHNlbGVjdGlvbiBhbmQgbWVyZ2Ugc2libGluZ3MuIFRoZSByZXN1bHRpbmcgc2VsZWN0aW9uIGlzIGFsd2F5cyBjb2xsYXBzZWQuCiAqCiAqICoqTm90ZToqKiBVc2Uge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvbW9kZWx+TW9kZWwjZGVsZXRlQ29udGVudH0gaW5zdGVhZCBvZiB0aGlzIGZ1bmN0aW9uLgogKiBUaGlzIGZ1bmN0aW9uIGlzIG9ubHkgZXhwb3NlZCB0byBiZSByZXVzYWJsZSBpbiBhbGdvcml0aG1zCiAqIHdoaWNoIGNoYW5nZSB0aGUge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvbW9kZWx+TW9kZWwjZGVsZXRlQ29udGVudH0KICogbWV0aG9kJ3MgYmVoYXZpb3IuCiAqCiAqIEBwYXJhbSB7bW9kdWxlOmVuZ2luZS9tb2RlbC9tb2RlbH5Nb2RlbH0gbW9kZWwgVGhlIG1vZGVsIGluIGNvbnRleHQgb2Ygd2hpY2ggdGhlIGluc2VydGlvbgogKiBzaG91bGQgYmUgcGVyZm9ybWVkLgogKiBAcGFyYW0ge21vZHVsZTplbmdpbmUvbW9kZWwvc2VsZWN0aW9uflNlbGVjdGlvbnxtb2R1bGU6ZW5naW5lL21vZGVsL2RvY3VtZW50c2VsZWN0aW9ufkRvY3VtZW50U2VsZWN0aW9ufSBzZWxlY3Rpb24KICogU2VsZWN0aW9uIG9mIHdoaWNoIHRoZSBjb250ZW50IHNob3VsZCBiZSBkZWxldGVkLgogKiBAcGFyYW0ge09iamVjdH0gW29wdGlvbnNdCiAqIEBwYXJhbSB7Qm9vbGVhbn0gW29wdGlvbnMubGVhdmVVbm1lcmdlZD1mYWxzZV0gV2hldGhlciB0byBtZXJnZSBlbGVtZW50cyBhZnRlciByZW1vdmluZyB0aGUgY29udGVudCBvZiB0aGUgc2VsZWN0aW9uLgogKgogKiBGb3IgZXhhbXBsZSBgPGhlYWRpbmc+eFt4PC9oZWFkaW5nPjxwYXJhZ3JhcGg+eV15PC9wYXJhZ3JhcGg+YCB3aWxsIGJlY29tZToKICoKICogKiBgPGhlYWRpbmc+eF55PC9oZWFkaW5nPmAgd2l0aCB0aGUgb3B0aW9uIGRpc2FibGVkIChgbGVhdmVVbm1lcmdlZCA9PSBmYWxzZWApCiAqICogYDxoZWFkaW5nPnhePC9oZWFkaW5nPjxwYXJhZ3JhcGg+eTwvcGFyYWdyYXBoPmAgd2l0aCBlbmFibGVkIChgbGVhdmVVbm1lcmdlZCA9PSB0cnVlYCkuCiAqCiAqIE5vdGU6IHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL3NjaGVtYX5TY2hlbWEjaXNPYmplY3Qgb2JqZWN0fSBhbmQge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvc2NoZW1hflNjaGVtYSNpc0xpbWl0IGxpbWl0fQogKiBlbGVtZW50cyB3aWxsIG5vdCBiZSBtZXJnZWQuCiAqCiAqIEBwYXJhbSB7Qm9vbGVhbn0gW29wdGlvbnMuZG9Ob3RSZXNldEVudGlyZUNvbnRlbnQ9ZmFsc2VdIFdoZXRoZXIgdG8gc2tpcCByZXBsYWNpbmcgdGhlIGVudGlyZSBjb250ZW50IHdpdGggYQogKiBwYXJhZ3JhcGggd2hlbiB0aGUgZW50aXJlIGNvbnRlbnQgd2FzIHNlbGVjdGVkLgogKgogKiBGb3IgZXhhbXBsZSBgPGhlYWRpbmc+W3g8L2hlYWRpbmc+PHBhcmFncmFwaD55XTwvcGFyYWdyYXBoPmAgd2lsbCBiZWNvbWU6CiAqCiAqICogYDxwYXJhZ3JhcGg+XjwvcGFyYWdyYXBoPmAgd2l0aCB0aGUgb3B0aW9uIGRpc2FibGVkIChgZG9Ob3RSZXNldEVudGlyZUNvbnRlbnQgPT0gZmFsc2VgKQogKiAqIGA8aGVhZGluZz5ePC9oZWFkaW5nPmAgd2l0aCBlbmFibGVkIChgZG9Ob3RSZXNldEVudGlyZUNvbnRlbnQgPT0gdHJ1ZWApLgogKgogKiBAcGFyYW0ge0Jvb2xlYW59IFtvcHRpb25zLmRvTm90QXV0b3BhcmFncmFwaD1mYWxzZV0gV2hldGhlciB0byBjcmVhdGUgYSBwYXJhZ3JhcGggaWYgYWZ0ZXIgY29udGVudCBkZWxldGlvbiBzZWxlY3Rpb24gaXMgbW92ZWQKICogdG8gYSBwbGFjZSB3aGVyZSB0ZXh0IGNhbm5vdCBiZSBpbnNlcnRlZC4KICoKICogRm9yIGV4YW1wbGUgYDxwYXJhZ3JhcGg+eDwvcGFyYWdyYXBoPls8aW1hZ2Ugc3JjPSJmb28uanBnIj48L2ltYWdlPl1gIHdpbGwgYmVjb21lOgogKgogKiAqIGA8cGFyYWdyYXBoPng8L3BhcmFncmFwaD48cGFyYWdyYXBoPltdPC9wYXJhZ3JhcGg+YCB3aXRoIHRoZSBvcHRpb24gZGlzYWJsZWQgKGBkb05vdEF1dG9wYXJhZ3JhcGggPT0gZmFsc2VgKQogKiAqIGA8cGFyYWdyYXBoPnhbXTwvcGFyYWdyYXBoPmAgd2l0aCB0aGUgb3B0aW9uIGVuYWJsZWQgKGBkb05vdEF1dG9wYXJhZ3JhcGggPT0gdHJ1ZWApLgogKgogKiAqKk5vdGU6KiogaWYgdGhlcmUgaXMgbm8gdmFsaWQgcG9zaXRpb24gZm9yIHRoZSBzZWxlY3Rpb24sIHRoZSBwYXJhZ3JhcGggd2lsbCBhbHdheXMgYmUgY3JlYXRlZDoKICoKICogYFs8aW1hZ2Ugc3JjPSJmb28uanBnIj48L2ltYWdlPl1gIC0+IGA8cGFyYWdyYXBoPltdPC9wYXJhZ3JhcGg+YC4KICovCgpleHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBkZWxldGVDb250ZW50KG1vZGVsLCBzZWxlY3Rpb24sIG9wdGlvbnMgPSB7fSkgewogIGlmIChzZWxlY3Rpb24uaXNDb2xsYXBzZWQpIHsKICAgIHJldHVybjsKICB9CgogIGNvbnN0IHNlbFJhbmdlID0gc2VsZWN0aW9uLmdldEZpcnN0UmFuZ2UoKTsgLy8gSWYgdGhlIHNlbGVjdGlvbiBpcyBhbHJlYWR5IHJlbW92ZWQsIGRvbid0IGRvIGFueXRoaW5nLgoKICBpZiAoc2VsUmFuZ2Uucm9vdC5yb290TmFtZSA9PSAnJGdyYXZleWFyZCcpIHsKICAgIHJldHVybjsKICB9CgogIGNvbnN0IHNjaGVtYSA9IG1vZGVsLnNjaGVtYTsKICBtb2RlbC5jaGFuZ2Uod3JpdGVyID0+IHsKICAgIC8vIDEuIFJlcGxhY2UgdGhlIGVudGlyZSBjb250ZW50IHdpdGggcGFyYWdyYXBoLgogICAgLy8gU2VlOiBodHRwczovL2dpdGh1Yi5jb20vY2tlZGl0b3IvY2tlZGl0b3I1LWVuZ2luZS9pc3N1ZXMvMTAxMiNpc3N1ZWNvbW1lbnQtMzE1MDE3NTk0LgogICAgaWYgKCFvcHRpb25zLmRvTm90UmVzZXRFbnRpcmVDb250ZW50ICYmIHNob3VsZEVudGlyZUNvbnRlbnRCZVJlcGxhY2VkV2l0aFBhcmFncmFwaChzY2hlbWEsIHNlbGVjdGlvbikpIHsKICAgICAgcmVwbGFjZUVudGlyZUNvbnRlbnRXaXRoUGFyYWdyYXBoKHdyaXRlciwgc2VsZWN0aW9uLCBzY2hlbWEpOwogICAgICByZXR1cm47CiAgICB9CgogICAgY29uc3Qgc3RhcnRQb3MgPSBzZWxSYW5nZS5zdGFydDsKICAgIGNvbnN0IGVuZFBvcyA9IExpdmVQb3NpdGlvbi5mcm9tUG9zaXRpb24oc2VsUmFuZ2UuZW5kLCAndG9OZXh0Jyk7IC8vIDIuIFJlbW92ZSB0aGUgY29udGVudCBpZiB0aGVyZSBpcyBhbnkuCgogICAgaWYgKCFzZWxSYW5nZS5zdGFydC5pc1RvdWNoaW5nKHNlbFJhbmdlLmVuZCkpIHsKICAgICAgd3JpdGVyLnJlbW92ZShzZWxSYW5nZSk7CiAgICB9IC8vIDMuIE1lcmdlIGVsZW1lbnRzIGluIHRoZSByaWdodCBicmFuY2ggdG8gdGhlIGVsZW1lbnRzIGluIHRoZSBsZWZ0IGJyYW5jaC4KICAgIC8vIFRoZSBvbmx5IHJlYXNvbmFibGUgKGluIHRlcm1zIG9mIGRhdGEgYW5kIHNlbGVjdGlvbiBjb3JyZWN0bmVzcykgY2FzZSBpbiB3aGljaCB3ZSBuZWVkIHRvIGRvIHRoYXQgaXM6CiAgICAvLwogICAgLy8gPGhlYWRpbmcgdHlwZT0xPkZvWzwvaGVhZGluZz48cGFyYWdyYXBoPl1hcjwvcGFyYWdyYXBoPiA9PiA8aGVhZGluZyB0eXBlPTE+Rm9eYXI8L2hlYWRpbmc+CiAgICAvLwogICAgLy8gSG93ZXZlciwgdGhlIGFsZ29yaXRobSBzdXBwb3J0cyBhbHNvIG1lcmdpbmcgZGVlcGVyIHN0cnVjdHVyZXMgKHVwIHRvIHRoZSBkZXB0aCBvZiB0aGUgc2hhbGxvd2VyIGJyYW5jaCksCiAgICAvLyBhcyBpdCdzIGhhcmQgdG8gaW1hZ2luZSB3aGF0IHNob3VsZCBhY3R1YWxseSBiZSB0aGUgZGVmYXVsdCBiZWhhdmlvci4gVXN1YWxseSwgc3BlY2lmaWMgZmVhdHVyZXMgd2lsbAogICAgLy8gd2FudCB0byBvdmVycmlkZSB0aGF0IGJlaGF2aW9yIGFueXdheS4KCgogICAgaWYgKCFvcHRpb25zLmxlYXZlVW5tZXJnZWQpIHsKICAgICAgbWVyZ2VCcmFuY2hlcyh3cml0ZXIsIHN0YXJ0UG9zLCBlbmRQb3MpOyAvLyBUTVAgdGhpcyB3aWxsIGJlIHJlcGxhY2VkIHdpdGggYSBwb3N0Zml4ZXIuCiAgICAgIC8vIFdlIG5lZWQgdG8gY2hlY2sgYW5kIHN0cmlwIGRpc2FsbG93ZWQgYXR0cmlidXRlcyBpbiBhbGwgbmVzdGVkIG5vZGVzIGJlY2F1c2UgYWZ0ZXIgbWVyZ2UKICAgICAgLy8gc29tZSBhdHRyaWJ1dGVzIGNvdWxkIGVuZCB1cCBpbiBhIHBhdGggd2hlcmUgYXJlIGRpc2FsbG93ZWQuCiAgICAgIC8vCiAgICAgIC8vIGUuZy4gYm9sZCBpcyBkaXNhbGxvd2VkIGZvciA8SDE+CiAgICAgIC8vIDxoMT5Gb3tvPC9oMT48cD5ifWE8Yj5yPC9iPjxwPiAtPiA8aDE+Rm97fWE8Yj5yPC9iPjxoMT4gLT4gPGgxPkZve31hcjxoMT4uCgogICAgICBzY2hlbWEucmVtb3ZlRGlzYWxsb3dlZEF0dHJpYnV0ZXMoc3RhcnRQb3MucGFyZW50LmdldENoaWxkcmVuKCksIHdyaXRlcik7CiAgICB9CgogICAgY29sbGFwc2VTZWxlY3Rpb25BdCh3cml0ZXIsIHNlbGVjdGlvbiwgc3RhcnRQb3MpOyAvLyA0LiBBZGQgYSBwYXJhZ3JhcGggdG8gc2V0IHNlbGVjdGlvbiBpbiBpdC4KICAgIC8vIENoZWNrIGlmIGEgdGV4dCBpcyBhbGxvd2VkIGluIHRoZSBuZXcgY29udGFpbmVyLiBJZiBub3QsIHRyeSB0byBjcmVhdGUgYSBuZXcgcGFyYWdyYXBoIChpZiBpdCdzIGFsbG93ZWQgaGVyZSkuCgogICAgaWYgKHNob3VsZEF1dG9wYXJhZ3JhcGgoc2NoZW1hLCBzdGFydFBvcykpIHsKICAgICAgLy8gSWYgYXV0by1wYXJhZ3JhcGhpbmcgaXMgb2ZmLCBmaW5kIHRoZSBjbG9zZXN0IHZhbGlkIHNlbGVjdGlvbiByYW5nZSBhbmQgY29sbGFwc2UgdGhlIHNlbGVjdGlvbiB0aGVyZS4KICAgICAgLy8gSWYgdGhlcmUgaXMgbm8gdmFsaWQgc2VsZWN0aW9uIHJhbmdlLCBjcmVhdGUgcGFyYWdyYXBoIGFueXdheSBhbmQgc2V0IHNlbGVjdGlvbiB0aGVyZS4KICAgICAgY29uc3QgdmFsaWRTZWxlY3Rpb25SYW5nZSA9IHNjaGVtYS5nZXROZWFyZXN0U2VsZWN0aW9uUmFuZ2Uoc3RhcnRQb3MpOwoKICAgICAgaWYgKG9wdGlvbnMuZG9Ob3RBdXRvcGFyYWdyYXBoICYmIHZhbGlkU2VsZWN0aW9uUmFuZ2UpIHsKICAgICAgICBjb2xsYXBzZVNlbGVjdGlvbkF0KHdyaXRlciwgc2VsZWN0aW9uLCB2YWxpZFNlbGVjdGlvblJhbmdlKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBpbnNlcnRQYXJhZ3JhcGgod3JpdGVyLCBzdGFydFBvcywgc2VsZWN0aW9uKTsKICAgICAgfQogICAgfQoKICAgIGVuZFBvcy5kZXRhY2goKTsKICB9KTsKfSAvLyBUaGlzIGZ1bmN0aW9uIGlzIGEgcmVzdWx0IG9mIHJlYWNoaW5nIHRoZSBCYWxsbWVyJ3MgcGVhayBmb3IganVzdCB0aGUgcmlnaHQgYW1vdW50IG9mIHRpbWUuCi8vIEV2ZW4gSSBoYWQgdHJvdWJsZXMgZG9jdW1lbnRpbmcgaXQgYWZ0ZXIgYSB3aGlsZSBhbmQgYWZ0ZXIgcmVhZGluZyBpdCBhZ2FpbiBJIGNvdWxkbid0IGJlbGlldmUgdGhhdCBpdCByZWFsbHkgd29ya3MuCgpmdW5jdGlvbiBtZXJnZUJyYW5jaGVzKHdyaXRlciwgc3RhcnRQb3MsIGVuZFBvcykgewogIGNvbnN0IHN0YXJ0UGFyZW50ID0gc3RhcnRQb3MucGFyZW50OwogIGNvbnN0IGVuZFBhcmVudCA9IGVuZFBvcy5wYXJlbnQ7IC8vIElmIGJvdGggcG9zaXRpb25zIGVuZGVkIHVwIGluIHRoZSBzYW1lIHBhcmVudCwgdGhlbiB0aGVyZSdzIG5vdGhpbmcgbW9yZSB0byBtZXJnZToKICAvLyA8JHJvb3Q+PHA+eFtdPC9wPjxwPnt9eTwvcD48LyRyb290PiA9PiA8JHJvb3Q+PHA+eHk8L3A+W117fTwvJHJvb3Q+CgogIGlmIChzdGFydFBhcmVudCA9PSBlbmRQYXJlbnQpIHsKICAgIHJldHVybjsKICB9IC8vIElmIG9uZSBvZiB0aGUgcG9zaXRpb25zIGlzIGEgbGltaXQgZWxlbWVudCwgdGhlbiB0aGVyZSdzIG5vdGhpbmcgdG8gbWVyZ2UgYmVjYXVzZSB3ZSBkb24ndCB3YW50IHRvIGNyb3NzIHRoZSBsaW1pdCBib3VuZGFyaWVzLgoKCiAgaWYgKHdyaXRlci5tb2RlbC5zY2hlbWEuaXNMaW1pdChzdGFydFBhcmVudCkgfHwgd3JpdGVyLm1vZGVsLnNjaGVtYS5pc0xpbWl0KGVuZFBhcmVudCkpIHsKICAgIHJldHVybjsKICB9IC8vIENoZWNrIGlmIG9wZXJhdGlvbnMgd2UnbGwgbmVlZCB0byBkbyB3b24ndCBuZWVkIHRvIGNyb3NzIG9iamVjdCBvciBsaW1pdCBib3VuZGFyaWVzLgogIC8vIEUuZy4sIHdlIGNhbid0IG1lcmdlIGVuZFBhcmVudCBpbnRvIHN0YXJ0UGFyZW50IGluIHRoaXMgY2FzZToKICAvLyA8bGltaXQ+PHN0YXJ0UGFyZW50PnhbXTwvc3RhcnRQYXJlbnQ+PC9saW1pdD48ZW5kUGFyZW50Pnt9PC9lbmRQYXJlbnQ+CgoKICBpZiAoIWNoZWNrQ2FuQmVNZXJnZWQoc3RhcnRQb3MsIGVuZFBvcywgd3JpdGVyLm1vZGVsLnNjaGVtYSkpIHsKICAgIHJldHVybjsKICB9IC8vIFJlbWVtYmVyIG5leHQgcG9zaXRpb25zIHRvIG1lcmdlLiBGb3IgZXhhbXBsZToKICAvLyA8YT48Yj54W108L2I+PC9hPjxjPjxkPnt9eTwvZD48L2M+CiAgLy8gd2lsbCBiZWNvbWU6CiAgLy8gPGE+PGI+eHk8L2I+W108L2E+PGM+e308L2M+CgoKICBzdGFydFBvcyA9IHdyaXRlci5jcmVhdGVQb3NpdGlvbkFmdGVyKHN0YXJ0UGFyZW50KTsKICBlbmRQb3MgPSB3cml0ZXIuY3JlYXRlUG9zaXRpb25CZWZvcmUoZW5kUGFyZW50KTsKCiAgaWYgKCFlbmRQb3MuaXNFcXVhbChzdGFydFBvcykpIHsKICAgIC8vIEluIHRoaXMgY2FzZSwgYmVmb3JlIHdlIG1lcmdlLCB3ZSBuZWVkIHRvIG1vdmUgYGVuZFBhcmVudGAgdG8gdGhlIGBzdGFydFBvc2A6CiAgICAvLyA8YT48Yj54W108L2I+PC9hPjxjPjxkPnt9eTwvZD48L2M+CiAgICAvLyBiZWNvbWVzOgogICAgLy8gPGE+PGI+eDwvYj5bXTxkPnk8L2Q+PC9hPjxjPnt9PC9jPgogICAgd3JpdGVyLmluc2VydChlbmRQYXJlbnQsIHN0YXJ0UG9zKTsKICB9IC8vIE1lcmdlIHR3byBzaWJsaW5nczoKICAvLyA8YT54PC9hPltdPGI+eTwvYj4gLT4gPGE+eHk8L2E+ICh0aGUgdXN1YWwgY2FzZSkKICAvLyA8YT48Yj54PC9iPltdPGQ+eTwvZD48L2E+PGM+PC9jPiAtPiA8YT48Yj54eTwvYj5bXTwvYT48Yz48L2M+ICh0aGlzIGlzIHRoZSAibW92ZSBwYXJlbnQiIGNhc2Ugc2hvd24gYWJvdmUpCgoKICB3cml0ZXIubWVyZ2Uoc3RhcnRQb3MpOyAvLyBSZW1vdmUgZW1wdHkgZW5kIGFuY2VzdG9yczoKICAvLyA8YT5mb1tvPC9hPjxiPjxhPjxjPmJhcl08L2M+PC9hPjwvYj4KICAvLyBiZWNvbWVzOgogIC8vIDxhPmZvW108L2E+PGI+PGE+e308L2E+PC9iPgogIC8vIFNvIHdlIGNhbiByZW1vdmUgPGE+IGFuZCA8Yj4uCgogIHdoaWxlIChlbmRQb3MucGFyZW50LmlzRW1wdHkpIHsKICAgIGNvbnN0IHBhcmVudFRvUmVtb3ZlID0gZW5kUG9zLnBhcmVudDsKICAgIGVuZFBvcyA9IHdyaXRlci5jcmVhdGVQb3NpdGlvbkJlZm9yZShwYXJlbnRUb1JlbW92ZSk7CiAgICB3cml0ZXIucmVtb3ZlKHBhcmVudFRvUmVtb3ZlKTsKICB9IC8vIENvbnRpbnVlIG1lcmdpbmcgbmV4dCBsZXZlbC4KCgogIG1lcmdlQnJhbmNoZXMod3JpdGVyLCBzdGFydFBvcywgZW5kUG9zKTsKfQoKZnVuY3Rpb24gc2hvdWxkQXV0b3BhcmFncmFwaChzY2hlbWEsIHBvc2l0aW9uKSB7CiAgY29uc3QgaXNUZXh0QWxsb3dlZCA9IHNjaGVtYS5jaGVja0NoaWxkKHBvc2l0aW9uLCAnJHRleHQnKTsKICBjb25zdCBpc1BhcmFncmFwaEFsbG93ZWQgPSBzY2hlbWEuY2hlY2tDaGlsZChwb3NpdGlvbiwgJ3BhcmFncmFwaCcpOwogIHJldHVybiAhaXNUZXh0QWxsb3dlZCAmJiBpc1BhcmFncmFwaEFsbG93ZWQ7Cn0gLy8gQ2hlY2sgaWYgcGFyZW50cyBvZiB0d28gcG9zaXRpb25zIGNhbiBiZSBtZXJnZWQgYnkgY2hlY2tpbmcgaWYgdGhlcmUgYXJlIG5vIGxpbWl0L29iamVjdAovLyBib3VuZGFyaWVzIGJldHdlZW4gdGhvc2UgdHdvIHBvc2l0aW9ucy4KLy8KLy8gRS5nLiBpbiA8YlE+PHA+eFtdPC9wPjwvYlE+PHdpZGdldD48Y2FwdGlvbj57fTwvY2FwdGlvbj48L3dpZGdldD4KLy8gd2UnbGwgY2hlY2sgPHA+LCA8YlE+LCA8d2lkZ2V0PiBhbmQgPGNhcHRpb24+LgovLyBVc3VhbGx5LCB3aWRnZXQgYW5kIGNhcHRpb24gYXJlIG1hcmtlZCBhcyBvYmplY3RzL2xpbWl0cyBpbiB0aGUgc2NoZW1hLCBzbyBpbiB0aGlzIGNhc2UgbWVyZ2luZyB3aWxsIGJlIGJsb2NrZWQuCgoKZnVuY3Rpb24gY2hlY2tDYW5CZU1lcmdlZChsZWZ0UG9zLCByaWdodFBvcywgc2NoZW1hKSB7CiAgY29uc3QgcmFuZ2VUb0NoZWNrID0gbmV3IFJhbmdlKGxlZnRQb3MsIHJpZ2h0UG9zKTsKCiAgZm9yIChjb25zdCB2YWx1ZSBvZiByYW5nZVRvQ2hlY2suZ2V0V2Fsa2VyKCkpIHsKICAgIGlmIChzY2hlbWEuaXNMaW1pdCh2YWx1ZS5pdGVtKSkgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgfQoKICByZXR1cm4gdHJ1ZTsKfQoKZnVuY3Rpb24gaW5zZXJ0UGFyYWdyYXBoKHdyaXRlciwgcG9zaXRpb24sIHNlbGVjdGlvbikgewogIGNvbnN0IHBhcmFncmFwaCA9IHdyaXRlci5jcmVhdGVFbGVtZW50KCdwYXJhZ3JhcGgnKTsKICB3cml0ZXIuaW5zZXJ0KHBhcmFncmFwaCwgcG9zaXRpb24pOwogIGNvbGxhcHNlU2VsZWN0aW9uQXQod3JpdGVyLCBzZWxlY3Rpb24sIHdyaXRlci5jcmVhdGVQb3NpdGlvbkF0KHBhcmFncmFwaCwgMCkpOwp9CgpmdW5jdGlvbiByZXBsYWNlRW50aXJlQ29udGVudFdpdGhQYXJhZ3JhcGgod3JpdGVyLCBzZWxlY3Rpb24pIHsKICBjb25zdCBsaW1pdEVsZW1lbnQgPSB3cml0ZXIubW9kZWwuc2NoZW1hLmdldExpbWl0RWxlbWVudChzZWxlY3Rpb24pOwogIHdyaXRlci5yZW1vdmUod3JpdGVyLmNyZWF0ZVJhbmdlSW4obGltaXRFbGVtZW50KSk7CiAgaW5zZXJ0UGFyYWdyYXBoKHdyaXRlciwgd3JpdGVyLmNyZWF0ZVBvc2l0aW9uQXQobGltaXRFbGVtZW50LCAwKSwgc2VsZWN0aW9uKTsKfSAvLyBXZSB3YW50IHRvIHJlcGxhY2UgdGhlIGVudGlyZSBjb250ZW50IHdpdGggYSBwYXJhZ3JhcGggd2hlbjoKLy8gKiB0aGUgZW50aXJlIGNvbnRlbnQgaXMgc2VsZWN0ZWQsCi8vICogc2VsZWN0aW9uIGNvbnRhaW5zIGF0IGxlYXN0IHR3byBlbGVtZW50cywKLy8gKiB3aGV0aGVyIHRoZSBwYXJhZ3JhcGggaXMgYWxsb3dlZCBpbiBzY2hlbWEgaW4gdGhlIGNvbW1vbiBhbmNlc3Rvci4KCgpmdW5jdGlvbiBzaG91bGRFbnRpcmVDb250ZW50QmVSZXBsYWNlZFdpdGhQYXJhZ3JhcGgoc2NoZW1hLCBzZWxlY3Rpb24pIHsKICBjb25zdCBsaW1pdEVsZW1lbnQgPSBzY2hlbWEuZ2V0TGltaXRFbGVtZW50KHNlbGVjdGlvbik7CgogIGlmICghc2VsZWN0aW9uLmNvbnRhaW5zRW50aXJlQ29udGVudChsaW1pdEVsZW1lbnQpKSB7CiAgICByZXR1cm4gZmFsc2U7CiAgfQoKICBjb25zdCByYW5nZSA9IHNlbGVjdGlvbi5nZXRGaXJzdFJhbmdlKCk7CgogIGlmIChyYW5nZS5zdGFydC5wYXJlbnQgPT0gcmFuZ2UuZW5kLnBhcmVudCkgewogICAgcmV0dXJuIGZhbHNlOwogIH0KCiAgcmV0dXJuIHNjaGVtYS5jaGVja0NoaWxkKGxpbWl0RWxlbWVudCwgJ3BhcmFncmFwaCcpOwp9IC8vIEhlbHBlciBmdW5jdGlvbiB0aGF0IHNldHMgdGhlIHNlbGVjdGlvbi4gRGVwZW5kaW5nIHdoZXRoZXIgZ2l2ZW4gYHNlbGVjdGlvbmAgaXMgYSBkb2N1bWVudCBzZWxlY3Rpb24gb3Igbm90LAovLyB1c2VzIGEgZGlmZmVyZW50IG1ldGhvZCB0byBzZXQgaXQuCgoKZnVuY3Rpb24gY29sbGFwc2VTZWxlY3Rpb25BdCh3cml0ZXIsIHNlbGVjdGlvbiwgcG9zaXRpb25PclJhbmdlKSB7CiAgaWYgKHNlbGVjdGlvbiBpbnN0YW5jZW9mIERvY3VtZW50U2VsZWN0aW9uKSB7CiAgICB3cml0ZXIuc2V0U2VsZWN0aW9uKHBvc2l0aW9uT3JSYW5nZSk7CiAgfSBlbHNlIHsKICAgIHNlbGVjdGlvbi5zZXRUbyhwb3NpdGlvbk9yUmFuZ2UpOwogIH0KfQ=="},{"version":3,"sources":["/Users/antonyching/Desktop/project/new-builder-demo/node_modules/@ckeditor/ckeditor5-engine/src/model/utils/deletecontent.js"],"names":["LivePosition","Range","DocumentSelection","deleteContent","model","selection","options","isCollapsed","selRange","getFirstRange","root","rootName","schema","change","writer","doNotResetEntireContent","shouldEntireContentBeReplacedWithParagraph","replaceEntireContentWithParagraph","startPos","start","endPos","fromPosition","end","isTouching","remove","leaveUnmerged","mergeBranches","removeDisallowedAttributes","parent","getChildren","collapseSelectionAt","shouldAutoparagraph","validSelectionRange","getNearestSelectionRange","doNotAutoparagraph","insertParagraph","detach","startParent","endParent","isLimit","checkCanBeMerged","createPositionAfter","createPositionBefore","isEqual","insert","merge","isEmpty","parentToRemove","position","isTextAllowed","checkChild","isParagraphAllowed","leftPos","rightPos","rangeToCheck","value","getWalker","item","paragraph","createElement","createPositionAt","limitElement","getLimitElement","createRangeIn","containsEntireContent","range","positionOrRange","setSelection","setTo"],"mappings":"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","sourcesContent":["/**\n * @license Copyright (c) 2003-2019, CKSource - Frederico Knabben. All rights reserved.\n * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license\n */\n\n/**\n * @module engine/model/utils/deletecontent\n */\n\nimport LivePosition from '../liveposition';\nimport Range from '../range';\nimport DocumentSelection from '../documentselection';\n\n/**\n * Deletes content of the selection and merge siblings. The resulting selection is always collapsed.\n *\n * **Note:** Use {@link module:engine/model/model~Model#deleteContent} instead of this function.\n * This function is only exposed to be reusable in algorithms\n * which change the {@link module:engine/model/model~Model#deleteContent}\n * method's behavior.\n *\n * @param {module:engine/model/model~Model} model The model in context of which the insertion\n * should be performed.\n * @param {module:engine/model/selection~Selection|module:engine/model/documentselection~DocumentSelection} selection\n * Selection of which the content should be deleted.\n * @param {Object} [options]\n * @param {Boolean} [options.leaveUnmerged=false] Whether to merge elements after removing the content of the selection.\n *\n * For example `<heading>x[x</heading><paragraph>y]y</paragraph>` will become:\n *\n * * `<heading>x^y</heading>` with the option disabled (`leaveUnmerged == false`)\n * * `<heading>x^</heading><paragraph>y</paragraph>` with enabled (`leaveUnmerged == true`).\n *\n * Note: {@link module:engine/model/schema~Schema#isObject object} and {@link module:engine/model/schema~Schema#isLimit limit}\n * elements will not be merged.\n *\n * @param {Boolean} [options.doNotResetEntireContent=false] Whether to skip replacing the entire content with a\n * paragraph when the entire content was selected.\n *\n * For example `<heading>[x</heading><paragraph>y]</paragraph>` will become:\n *\n * * `<paragraph>^</paragraph>` with the option disabled (`doNotResetEntireContent == false`)\n * * `<heading>^</heading>` with enabled (`doNotResetEntireContent == true`).\n *\n * @param {Boolean} [options.doNotAutoparagraph=false] Whether to create a paragraph if after content deletion selection is moved\n * to a place where text cannot be inserted.\n *\n * For example `<paragraph>x</paragraph>[<image src=\"foo.jpg\"></image>]` will become:\n *\n * * `<paragraph>x</paragraph><paragraph>[]</paragraph>` with the option disabled (`doNotAutoparagraph == false`)\n * * `<paragraph>x[]</paragraph>` with the option enabled (`doNotAutoparagraph == true`).\n *\n * **Note:** if there is no valid position for the selection, the paragraph will always be created:\n *\n * `[<image src=\"foo.jpg\"></image>]` -> `<paragraph>[]</paragraph>`.\n */\nexport default function deleteContent( model, selection, options = {} ) {\n\tif ( selection.isCollapsed ) {\n\t\treturn;\n\t}\n\n\tconst selRange = selection.getFirstRange();\n\n\t// If the selection is already removed, don't do anything.\n\tif ( selRange.root.rootName == '$graveyard' ) {\n\t\treturn;\n\t}\n\n\tconst schema = model.schema;\n\n\tmodel.change( writer => {\n\t\t// 1. Replace the entire content with paragraph.\n\t\t// See: https://github.com/ckeditor/ckeditor5-engine/issues/1012#issuecomment-315017594.\n\t\tif ( !options.doNotResetEntireContent && shouldEntireContentBeReplacedWithParagraph( schema, selection ) ) {\n\t\t\treplaceEntireContentWithParagraph( writer, selection, schema );\n\n\t\t\treturn;\n\t\t}\n\n\t\tconst startPos = selRange.start;\n\t\tconst endPos = LivePosition.fromPosition( selRange.end, 'toNext' );\n\n\t\t// 2. Remove the content if there is any.\n\t\tif ( !selRange.start.isTouching( selRange.end ) ) {\n\t\t\twriter.remove( selRange );\n\t\t}\n\n\t\t// 3. Merge elements in the right branch to the elements in the left branch.\n\t\t// The only reasonable (in terms of data and selection correctness) case in which we need to do that is:\n\t\t//\n\t\t// <heading type=1>Fo[</heading><paragraph>]ar</paragraph> => <heading type=1>Fo^ar</heading>\n\t\t//\n\t\t// However, the algorithm supports also merging deeper structures (up to the depth of the shallower branch),\n\t\t// as it's hard to imagine what should actually be the default behavior. Usually, specific features will\n\t\t// want to override that behavior anyway.\n\t\tif ( !options.leaveUnmerged ) {\n\t\t\tmergeBranches( writer, startPos, endPos );\n\n\t\t\t// TMP this will be replaced with a postfixer.\n\t\t\t// We need to check and strip disallowed attributes in all nested nodes because after merge\n\t\t\t// some attributes could end up in a path where are disallowed.\n\t\t\t//\n\t\t\t// e.g. bold is disallowed for <H1>\n\t\t\t// <h1>Fo{o</h1><p>b}a<b>r</b><p> -> <h1>Fo{}a<b>r</b><h1> -> <h1>Fo{}ar<h1>.\n\t\t\tschema.removeDisallowedAttributes( startPos.parent.getChildren(), writer );\n\t\t}\n\n\t\tcollapseSelectionAt( writer, selection, startPos );\n\n\t\t// 4. Add a paragraph to set selection in it.\n\t\t// Check if a text is allowed in the new container. If not, try to create a new paragraph (if it's allowed here).\n\t\tif ( shouldAutoparagraph( schema, startPos ) ) {\n\t\t\t// If auto-paragraphing is off, find the closest valid selection range and collapse the selection there.\n\t\t\t// If there is no valid selection range, create paragraph anyway and set selection there.\n\t\t\tconst validSelectionRange = schema.getNearestSelectionRange( startPos );\n\n\t\t\tif ( options.doNotAutoparagraph && validSelectionRange ) {\n\t\t\t\tcollapseSelectionAt( writer, selection, validSelectionRange );\n\t\t\t} else {\n\t\t\t\tinsertParagraph( writer, startPos, selection );\n\t\t\t}\n\t\t}\n\n\t\tendPos.detach();\n\t} );\n}\n\n// This function is a result of reaching the Ballmer's peak for just the right amount of time.\n// Even I had troubles documenting it after a while and after reading it again I couldn't believe that it really works.\nfunction mergeBranches( writer, startPos, endPos ) {\n\tconst startParent = startPos.parent;\n\tconst endParent = endPos.parent;\n\n\t// If both positions ended up in the same parent, then there's nothing more to merge:\n\t// <$root><p>x[]</p><p>{}y</p></$root> => <$root><p>xy</p>[]{}</$root>\n\tif ( startParent == endParent ) {\n\t\treturn;\n\t}\n\n\t// If one of the positions is a limit element, then there's nothing to merge because we don't want to cross the limit boundaries.\n\tif ( writer.model.schema.isLimit( startParent ) || writer.model.schema.isLimit( endParent ) ) {\n\t\treturn;\n\t}\n\n\t// Check if operations we'll need to do won't need to cross object or limit boundaries.\n\t// E.g., we can't merge endParent into startParent in this case:\n\t// <limit><startParent>x[]</startParent></limit><endParent>{}</endParent>\n\tif ( !checkCanBeMerged( startPos, endPos, writer.model.schema ) ) {\n\t\treturn;\n\t}\n\n\t// Remember next positions to merge. For example:\n\t// <a><b>x[]</b></a><c><d>{}y</d></c>\n\t// will become:\n\t// <a><b>xy</b>[]</a><c>{}</c>\n\tstartPos = writer.createPositionAfter( startParent );\n\tendPos = writer.createPositionBefore( endParent );\n\n\tif ( !endPos.isEqual( startPos ) ) {\n\t\t// In this case, before we merge, we need to move `endParent` to the `startPos`:\n\t\t// <a><b>x[]</b></a><c><d>{}y</d></c>\n\t\t// becomes:\n\t\t// <a><b>x</b>[]<d>y</d></a><c>{}</c>\n\t\twriter.insert( endParent, startPos );\n\t}\n\n\t// Merge two siblings:\n\t// <a>x</a>[]<b>y</b> -> <a>xy</a> (the usual case)\n\t// <a><b>x</b>[]<d>y</d></a><c></c> -> <a><b>xy</b>[]</a><c></c> (this is the \"move parent\" case shown above)\n\twriter.merge( startPos );\n\n\t// Remove empty end ancestors:\n\t// <a>fo[o</a><b><a><c>bar]</c></a></b>\n\t// becomes:\n\t// <a>fo[]</a><b><a>{}</a></b>\n\t// So we can remove <a> and <b>.\n\twhile ( endPos.parent.isEmpty ) {\n\t\tconst parentToRemove = endPos.parent;\n\n\t\tendPos = writer.createPositionBefore( parentToRemove );\n\n\t\twriter.remove( parentToRemove );\n\t}\n\n\t// Continue merging next level.\n\tmergeBranches( writer, startPos, endPos );\n}\n\nfunction shouldAutoparagraph( schema, position ) {\n\tconst isTextAllowed = schema.checkChild( position, '$text' );\n\tconst isParagraphAllowed = schema.checkChild( position, 'paragraph' );\n\n\treturn !isTextAllowed && isParagraphAllowed;\n}\n\n// Check if parents of two positions can be merged by checking if there are no limit/object\n// boundaries between those two positions.\n//\n// E.g. in <bQ><p>x[]</p></bQ><widget><caption>{}</caption></widget>\n// we'll check <p>, <bQ>, <widget> and <caption>.\n// Usually, widget and caption are marked as objects/limits in the schema, so in this case merging will be blocked.\nfunction checkCanBeMerged( leftPos, rightPos, schema ) {\n\tconst rangeToCheck = new Range( leftPos, rightPos );\n\n\tfor ( const value of rangeToCheck.getWalker() ) {\n\t\tif ( schema.isLimit( value.item ) ) {\n\t\t\treturn false;\n\t\t}\n\t}\n\n\treturn true;\n}\n\nfunction insertParagraph( writer, position, selection ) {\n\tconst paragraph = writer.createElement( 'paragraph' );\n\n\twriter.insert( paragraph, position );\n\n\tcollapseSelectionAt( writer, selection, writer.createPositionAt( paragraph, 0 ) );\n}\n\nfunction replaceEntireContentWithParagraph( writer, selection ) {\n\tconst limitElement = writer.model.schema.getLimitElement( selection );\n\n\twriter.remove( writer.createRangeIn( limitElement ) );\n\tinsertParagraph( writer, writer.createPositionAt( limitElement, 0 ), selection );\n}\n\n// We want to replace the entire content with a paragraph when:\n// * the entire content is selected,\n// * selection contains at least two elements,\n// * whether the paragraph is allowed in schema in the common ancestor.\nfunction shouldEntireContentBeReplacedWithParagraph( schema, selection ) {\n\tconst limitElement = schema.getLimitElement( selection );\n\n\tif ( !selection.containsEntireContent( limitElement ) ) {\n\t\treturn false;\n\t}\n\n\tconst range = selection.getFirstRange();\n\n\tif ( range.start.parent == range.end.parent ) {\n\t\treturn false;\n\t}\n\n\treturn schema.checkChild( limitElement, 'paragraph' );\n}\n\n// Helper function that sets the selection. Depending whether given `selection` is a document selection or not,\n// uses a different method to set it.\nfunction collapseSelectionAt( writer, selection, positionOrRange ) {\n\tif ( selection instanceof DocumentSelection ) {\n\t\twriter.setSelection( positionOrRange );\n\t} else {\n\t\tselection.setTo( positionOrRange );\n\t}\n}\n"]}]}
{"remainingRequest":"/Users/antonyching/Desktop/project/new-builder-demo/node_modules/babel-loader/lib/index.js!/Users/antonyching/Desktop/project/new-builder-demo/node_modules/@ckeditor/ckeditor5-upload/src/filerepository.js","dependencies":[{"path":"/Users/antonyching/Desktop/project/new-builder-demo/node_modules/@ckeditor/ckeditor5-upload/src/filerepository.js","mtime":499162500000},{"path":"/Users/antonyching/Desktop/project/new-builder-demo/node_modules/@ckeditor/ckeditor5-dev-webpack-plugin/lib/translatesourceloader.js","mtime":499162500000},{"path":"/Users/antonyching/Desktop/project/new-builder-demo/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/antonyching/Desktop/project/new-builder-demo/node_modules/babel-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:LyoqCiAqIEBsaWNlbnNlIENvcHlyaWdodCAoYykgMjAwMy0yMDE5LCBDS1NvdXJjZSAtIEZyZWRlcmljbyBLbmFiYmVuLiBBbGwgcmlnaHRzIHJlc2VydmVkLgogKiBGb3IgbGljZW5zaW5nLCBzZWUgTElDRU5TRS5tZCBvciBodHRwczovL2NrZWRpdG9yLmNvbS9sZWdhbC9ja2VkaXRvci1vc3MtbGljZW5zZQogKi8KCi8qKgogKiBAbW9kdWxlIHVwbG9hZC9maWxlcmVwb3NpdG9yeQogKi8KCi8qIGdsb2JhbHMgY29uc29sZSAqLwppbXBvcnQgUGx1Z2luIGZyb20gJ0Bja2VkaXRvci9ja2VkaXRvcjUtY29yZS9zcmMvcGx1Z2luJzsKaW1wb3J0IFBlbmRpbmdBY3Rpb25zIGZyb20gJ0Bja2VkaXRvci9ja2VkaXRvcjUtY29yZS9zcmMvcGVuZGluZ2FjdGlvbnMnOwppbXBvcnQgQ0tFZGl0b3JFcnJvciwgeyBhdHRhY2hMaW5rVG9Eb2N1bWVudGF0aW9uIH0gZnJvbSAnQGNrZWRpdG9yL2NrZWRpdG9yNS11dGlscy9zcmMvY2tlZGl0b3JlcnJvcic7CmltcG9ydCBPYnNlcnZhYmxlTWl4aW4gZnJvbSAnQGNrZWRpdG9yL2NrZWRpdG9yNS11dGlscy9zcmMvb2JzZXJ2YWJsZW1peGluJzsKaW1wb3J0IENvbGxlY3Rpb24gZnJvbSAnQGNrZWRpdG9yL2NrZWRpdG9yNS11dGlscy9zcmMvY29sbGVjdGlvbic7CmltcG9ydCBtaXggZnJvbSAnQGNrZWRpdG9yL2NrZWRpdG9yNS11dGlscy9zcmMvbWl4JzsKaW1wb3J0IEZpbGVSZWFkZXIgZnJvbSAnLi9maWxlcmVhZGVyLmpzJzsKaW1wb3J0IHVpZCBmcm9tICdAY2tlZGl0b3IvY2tlZGl0b3I1LXV0aWxzL3NyYy91aWQuanMnOwovKioKICogRmlsZSByZXBvc2l0b3J5IHBsdWdpbi4gQSBjZW50cmFsIHBvaW50IGZvciBtYW5hZ2luZyBmaWxlIHVwbG9hZC4KICoKICogVG8gdXNlIGl0LCBmaXJzdCB5b3UgbmVlZCBhbiB1cGxvYWQgYWRhcHRlci4gVXBsb2FkIGFkYXB0ZXIncyBqb2IgaXMgdG8gaGFuZGxlIGNvbW11bmljYXRpb24gd2l0aCB0aGUgc2VydmVyCiAqIChzZW5kaW5nIHRoZSBmaWxlIGFuZCBoYW5kbGluZyBzZXJ2ZXIncyByZXNwb25zZSkuIFlvdSBjYW4gdXNlIG9uZSBvZiB0aGUgZXhpc3RpbmcgcGx1Z2lucyBpbnRyb2R1Y2luZyB1cGxvYWQgYWRhcHRlcnMKICogKGUuZy4ge0BsaW5rIG1vZHVsZTplYXN5LWltYWdlL2Nsb3Vkc2VydmljZXN1cGxvYWRhZGFwdGVyfkNsb3VkU2VydmljZXNVcGxvYWRBZGFwdGVyfSBvcgogKiB7QGxpbmsgbW9kdWxlOmFkYXB0ZXItY2tmaW5kZXIvdXBsb2FkYWRhcHRlcn5DS0ZpbmRlclVwbG9hZEFkYXB0ZXJ9KSBvciB3cml0ZSB5b3VyIG93biBvbmUg4oCTIHNlZQogKiB0aGUge0BnbGluayBmcmFtZXdvcmsvZ3VpZGVzL2RlZXAtZGl2ZS91cGxvYWQtYWRhcHRlciAiQ3VzdG9tIGltYWdlIHVwbG9hZCBhZGFwdGVyIiBkZWVwIGRpdmUgZ3VpZGV9LgogKgogKiBUaGVuLCB5b3UgY2FuIHVzZSB7QGxpbmsgbW9kdWxlOnVwbG9hZC9maWxlcmVwb3NpdG9yeX5GaWxlUmVwb3NpdG9yeSNjcmVhdGVMb2FkZXIgYGNyZWF0ZUxvYWRlcigpYH0gYW5kIHRoZSByZXR1cm5lZAogKiB7QGxpbmsgbW9kdWxlOnVwbG9hZC9maWxlcmVwb3NpdG9yeX5GaWxlTG9hZGVyfSBpbnN0YW5jZSB0byBsb2FkIGFuZCB1cGxvYWQgZmlsZXMuCiAqCiAqIEBleHRlbmRzIG1vZHVsZTpjb3JlL3BsdWdpbn5QbHVnaW4KICovCgpleHBvcnQgZGVmYXVsdCBjbGFzcyBGaWxlUmVwb3NpdG9yeSBleHRlbmRzIFBsdWdpbiB7CiAgLyoqCiAgICogQGluaGVyaXREb2MKICAgKi8KICBzdGF0aWMgZ2V0IHBsdWdpbk5hbWUoKSB7CiAgICByZXR1cm4gJ0ZpbGVSZXBvc2l0b3J5JzsKICB9CiAgLyoqCiAgICogQGluaGVyaXREb2MKICAgKi8KCgogIHN0YXRpYyBnZXQgcmVxdWlyZXMoKSB7CiAgICByZXR1cm4gW1BlbmRpbmdBY3Rpb25zXTsKICB9CiAgLyoqCiAgICogQGluaGVyaXREb2MKICAgKi8KCgogIGluaXQoKSB7CiAgICAvKioKICAgICAqIENvbGxlY3Rpb24gb2YgbG9hZGVycyBhc3NvY2lhdGVkIHdpdGggdGhpcyByZXBvc2l0b3J5LgogICAgICoKICAgICAqIEBtZW1iZXIge21vZHVsZTp1dGlscy9jb2xsZWN0aW9ufkNvbGxlY3Rpb259ICNsb2FkZXJzCiAgICAgKi8KICAgIHRoaXMubG9hZGVycyA9IG5ldyBDb2xsZWN0aW9uKCk7IC8vIEtlZXBzIHVwbG9hZCBpbiBhIHN5bmMgd2l0aCBwZW5kaW5nIGFjdGlvbnMuCgogICAgdGhpcy5sb2FkZXJzLm9uKCdhZGQnLCAoKSA9PiB0aGlzLl91cGRhdGVQZW5kaW5nQWN0aW9uKCkpOwogICAgdGhpcy5sb2FkZXJzLm9uKCdyZW1vdmUnLCAoKSA9PiB0aGlzLl91cGRhdGVQZW5kaW5nQWN0aW9uKCkpOwogICAgLyoqCiAgICAgKiBMb2FkZXJzIG1hcHBpbmdzIHVzZWQgdG8gcmV0cmlldmUgbG9hZGVycyByZWZlcmVuY2VzLgogICAgICoKICAgICAqIEBwcml2YXRlCiAgICAgKiBAbWVtYmVyIHtNYXA8RmlsZXxQcm9taXNlLCBGaWxlTG9hZGVyPn0gI19sb2FkZXJzTWFwCiAgICAgKi8KCiAgICB0aGlzLl9sb2FkZXJzTWFwID0gbmV3IE1hcCgpOwogICAgLyoqCiAgICAgKiBSZWZlcmVuY2UgdG8gYSBwZW5kaW5nIGFjdGlvbiByZWdpc3RlcmVkIGluIGEge0BsaW5rIG1vZHVsZTpjb3JlL3BlbmRpbmdhY3Rpb25zflBlbmRpbmdBY3Rpb25zfSBwbHVnaW4KICAgICAqIHdoaWxlIHVwbG9hZCBpcyBpbiBwcm9ncmVzcy4gV2hlbiB0aGVyZSBpcyBubyB1cGxvYWQgdGhlbiB2YWx1ZSBpcyBgbnVsbGAuCiAgICAgKgogICAgICogQHByaXZhdGUKICAgICAqIEBtZW1iZXIge09iamVjdH0gI19wZW5kaW5nQWN0aW9uCiAgICAgKi8KCiAgICB0aGlzLl9wZW5kaW5nQWN0aW9uID0gbnVsbDsKICAgIC8qKgogICAgICogQSBmYWN0b3J5IGZ1bmN0aW9uIHdoaWNoIHNob3VsZCBiZSBkZWZpbmVkIGJlZm9yZSB1c2luZyBgRmlsZVJlcG9zaXRvcnlgLgogICAgICoKICAgICAqIEl0IHNob3VsZCByZXR1cm4gYSBuZXcgaW5zdGFuY2Ugb2Yge0BsaW5rIG1vZHVsZTp1cGxvYWQvZmlsZXJlcG9zaXRvcnl+VXBsb2FkQWRhcHRlcn0gdGhhdCB3aWxsIGJlIHVzZWQgdG8gdXBsb2FkIGZpbGVzLgogICAgICoge0BsaW5rIG1vZHVsZTp1cGxvYWQvZmlsZXJlcG9zaXRvcnl+RmlsZUxvYWRlcn0gaW5zdGFuY2UgYXNzb2NpYXRlZCB3aXRoIHRoZSBhZGFwdGVyCiAgICAgKiB3aWxsIGJlIHBhc3NlZCB0byB0aGF0IGZ1bmN0aW9uLgogICAgICoKICAgICAqIEZvciBtb3JlIGluZm9ybWF0aW9uIGFuZCBleGFtcGxlIHNlZSB7QGxpbmsgbW9kdWxlOnVwbG9hZC9maWxlcmVwb3NpdG9yeX5VcGxvYWRBZGFwdGVyfS4KICAgICAqCiAgICAgKiBAbWVtYmVyIHtGdW5jdGlvbn0gI2NyZWF0ZVVwbG9hZEFkYXB0ZXIKICAgICAqLwoKICAgIC8qKgogICAgICogTnVtYmVyIG9mIGJ5dGVzIHVwbG9hZGVkLgogICAgICoKICAgICAqIEByZWFkb25seQogICAgICogQG9ic2VydmFibGUKICAgICAqIEBtZW1iZXIge051bWJlcn0gI3VwbG9hZGVkCiAgICAgKi8KCiAgICB0aGlzLnNldCgndXBsb2FkZWQnLCAwKTsKICAgIC8qKgogICAgICogTnVtYmVyIG9mIHRvdGFsIGJ5dGVzIHRvIHVwbG9hZC4KICAgICAqCiAgICAgKiBJdCBtaWdodCBiZSBkaWZmZXJlbnQgdGhhbiB0aGUgZmlsZSBzaXplIGJlY2F1c2Ugb2YgaGVhZGVycyBhbmQgYWRkaXRpb25hbCBkYXRhLgogICAgICogSXQgY29udGFpbnMgYG51bGxgIGlmIHZhbHVlIGlzIG5vdCBhdmFpbGFibGUgeWV0LCBzbyBpdCdzIGJldHRlciB0byB1c2Uge0BsaW5rICN1cGxvYWRlZFBlcmNlbnR9IHRvIG1vbml0b3IKICAgICAqIHRoZSBwcm9ncmVzcy4KICAgICAqCiAgICAgKiBAcmVhZG9ubHkKICAgICAqIEBvYnNlcnZhYmxlCiAgICAgKiBAbWVtYmVyIHtOdW1iZXJ8bnVsbH0gI3VwbG9hZFRvdGFsCiAgICAgKi8KCiAgICB0aGlzLnNldCgndXBsb2FkVG90YWwnLCBudWxsKTsKICAgIC8qKgogICAgICogVXBsb2FkIHByb2dyZXNzIGluIHBlcmNlbnRzLgogICAgICoKICAgICAqIEByZWFkb25seQogICAgICogQG9ic2VydmFibGUKICAgICAqIEBtZW1iZXIge051bWJlcn0gI3VwbG9hZGVkUGVyY2VudAogICAgICovCgogICAgdGhpcy5iaW5kKCd1cGxvYWRlZFBlcmNlbnQnKS50byh0aGlzLCAndXBsb2FkZWQnLCB0aGlzLCAndXBsb2FkVG90YWwnLCAodXBsb2FkZWQsIHRvdGFsKSA9PiB7CiAgICAgIHJldHVybiB0b3RhbCA/IHVwbG9hZGVkIC8gdG90YWwgKiAxMDAgOiAwOwogICAgfSk7CiAgfQogIC8qKgogICAqIFJldHVybnMgdGhlIGxvYWRlciBhc3NvY2lhdGVkIHdpdGggc3BlY2lmaWVkIGZpbGUgb3IgcHJvbWlzZS4KICAgKgogICAqIFRvIGdldCBsb2FkZXIgYnkgaWQgdXNlIGBmaWxlUmVwb3NpdG9yeS5sb2FkZXJzLmdldCggaWQgKWAuCiAgICoKICAgKiBAcGFyYW0ge0ZpbGV8UHJvbWlzZS48RmlsZT59IGZpbGVPclByb21pc2UgTmF0aXZlIGZpbGUgb3IgcHJvbWlzZSBoYW5kbGUuCiAgICogQHJldHVybnMge21vZHVsZTp1cGxvYWQvZmlsZXJlcG9zaXRvcnl+RmlsZUxvYWRlcnxudWxsfQogICAqLwoKCiAgZ2V0TG9hZGVyKGZpbGVPclByb21pc2UpIHsKICAgIHJldHVybiB0aGlzLl9sb2FkZXJzTWFwLmdldChmaWxlT3JQcm9taXNlKSB8fCBudWxsOwogIH0KICAvKioKICAgKiBDcmVhdGVzIGEgbG9hZGVyIGluc3RhbmNlIGZvciB0aGUgZ2l2ZW4gZmlsZS4KICAgKgogICAqIFJlcXVpcmVzIHtAbGluayAjY3JlYXRlVXBsb2FkQWRhcHRlcn0gZmFjdG9yeSB0byBiZSBkZWZpbmVkLgogICAqCiAgICogQHBhcmFtIHtGaWxlfFByb21pc2UuPEZpbGU+fSBmaWxlT3JQcm9taXNlIE5hdGl2ZSBGaWxlIG9iamVjdCBvciBuYXRpdmUgUHJvbWlzZSBvYmplY3Qgd2hpY2ggcmVzb2x2ZXMgdG8gYSBGaWxlLgogICAqIEByZXR1cm5zIHttb2R1bGU6dXBsb2FkL2ZpbGVyZXBvc2l0b3J5fkZpbGVMb2FkZXJ8bnVsbH0KICAgKi8KCgogIGNyZWF0ZUxvYWRlcihmaWxlT3JQcm9taXNlKSB7CiAgICBpZiAoIXRoaXMuY3JlYXRlVXBsb2FkQWRhcHRlcikgewogICAgICAvKioKICAgICAgICogWW91IG5lZWQgdG8gZW5hYmxlIGFuIHVwbG9hZCBhZGFwdGVyIGluIG9yZGVyIHRvIGJlIGFibGUgdG8gdXBsb2FkIGZpbGVzLgogICAgICAgKgogICAgICAgKiBUaGlzIHdhcm5pbmcgc2hvd3MgdXAgd2hlbiB7QGxpbmsgbW9kdWxlOnVwbG9hZC9maWxlcmVwb3NpdG9yeX5GaWxlUmVwb3NpdG9yeX0gaXMgYmVpbmcgdXNlZAogICAgICAgKiB3aXRob3V0IHtAbGluayAjY3JlYXRlVXBsb2FkQWRhcHRlciBkZWZpbmluaW5nIGFuIHVwbG9hZCBhZGFwdGVyfS4KICAgICAgICoKICAgICAgICogKipJZiB5b3Ugc2VlIHRoaXMgd2FybmluZyB3aGVuIHVzaW5nIG9uZSBvZiB0aGUge0BnbGluayBidWlsZHMvaW5kZXggQ0tFZGl0b3IgNSBCdWlsZHN9KioKICAgICAgICogaXQgbWVhbnMgdGhhdCB5b3UgZGlkIG5vdCBjb25maWd1cmUgYW55IG9mIHRoZSB1cGxvYWQgYWRhcHRlcnMgYXZhaWxhYmxlIGJ5IGRlZmF1bHQgaW4gdGhvc2UgYnVpbGRzLgogICAgICAgKgogICAgICAgKiBTZWUgdGhlIHtAZ2xpbmsgZmVhdHVyZXMvaW1hZ2UtdXBsb2FkL2ltYWdlLXVwbG9hZCBjb21wcmVoZW5zaXZlICJJbWFnZSB1cGxvYWQgb3ZlcnZpZXcifSB0byBsZWFybiB3aGljaCB1cGxvYWQKICAgICAgICogYWRhcHRlcnMgYXJlIGF2YWlsYWJsZSBpbiB0aGUgYnVpbGRzIGFuZCBob3cgdG8gY29uZmlndXJlIHRoZW0uCiAgICAgICAqCiAgICAgICAqICoqSWYgeW91IHNlZSB0aGlzIHdhcm5pbmcgd2hlbiB1c2luZyBhIGN1c3RvbSBidWlsZCoqIHRoZXJlIGlzIGEgY2hhbmNlIHRoYXQgeW91IGVuYWJsZWQKICAgICAgICogYSBmZWF0dXJlIGxpa2Uge0BsaW5rIG1vZHVsZTppbWFnZS9pbWFnZXVwbG9hZH5JbWFnZVVwbG9hZH0sCiAgICAgICAqIG9yIHtAbGluayBtb2R1bGU6aW1hZ2UvaW1hZ2V1cGxvYWQvaW1hZ2V1cGxvYWR1aX5JbWFnZVVwbG9hZFVJfSBidXQgeW91IGRpZCBub3QgZW5hYmxlIGFueSB1cGxvYWQgYWRhcHRlci4KICAgICAgICogWW91IGNhbiBjaG9vc2Ugb25lIG9mIHRoZSBleGlzdGluZyB1cGxvYWQgYWRhcHRlcnMgbGlzdGVkIGluIHRoZQogICAgICAgKiB7QGdsaW5rIGZlYXR1cmVzL2ltYWdlLXVwbG9hZC9pbWFnZS11cGxvYWQgIkltYWdlIHVwbG9hZCBvdmVydmlldyJ9LgogICAgICAgKgogICAgICAgKiBZb3UgY2FuIGFsc28gaW1wbGVtZW50IHlvdXIge0BnbGluayBmcmFtZXdvcmsvZ3VpZGVzL2RlZXAtZGl2ZS91cGxvYWQtYWRhcHRlciBvd24gaW1hZ2UgdXBsb2FkIGFkYXB0ZXJ9LgogICAgICAgKgogICAgICAgKiBAZXJyb3IgZmlsZXJlcG9zaXRvcnktbm8tdXBsb2FkLWFkYXB0ZXIKICAgICAgICovCiAgICAgIGNvbnNvbGUud2FybihhdHRhY2hMaW5rVG9Eb2N1bWVudGF0aW9uKCdmaWxlcmVwb3NpdG9yeS1uby11cGxvYWQtYWRhcHRlcjogVXBsb2FkIGFkYXB0ZXIgaXMgbm90IGRlZmluZWQuJykpOwogICAgICByZXR1cm4gbnVsbDsKICAgIH0KCiAgICBjb25zdCBsb2FkZXIgPSBuZXcgRmlsZUxvYWRlcihQcm9taXNlLnJlc29sdmUoZmlsZU9yUHJvbWlzZSksIHRoaXMuY3JlYXRlVXBsb2FkQWRhcHRlcik7CiAgICB0aGlzLmxvYWRlcnMuYWRkKGxvYWRlcik7CgogICAgdGhpcy5fbG9hZGVyc01hcC5zZXQoZmlsZU9yUHJvbWlzZSwgbG9hZGVyKTsgLy8gU3RvcmUgYWxzbyBmaWxlID0+IGxvYWRlciBtYXBwaW5nIHNvIGxvYWRlciBjYW4gYmUgcmV0cmlldmVkIGJ5IGZpbGUgaW5zdGFuY2UgcmV0dXJuZWQgdXBvbiBQcm9taXNlIHJlc29sdXRpb24uCgoKICAgIGlmIChmaWxlT3JQcm9taXNlIGluc3RhbmNlb2YgUHJvbWlzZSkgewogICAgICBsb2FkZXIuZmlsZS50aGVuKGZpbGUgPT4gewogICAgICAgIHRoaXMuX2xvYWRlcnNNYXAuc2V0KGZpbGUsIGxvYWRlcik7CiAgICAgIH0pIC8vIEV2ZXJ5IHRoZW4oKSBtdXN0IGhhdmUgYSBjYXRjaCgpLgogICAgICAvLyBGaWxlIGxvYWRlciBzdGF0ZSAoYW5kIHJlamVjdGlvbnMpIGFyZSBoYW5kbGVkIGluIHJlYWQoKSBhbmQgdXBsb2FkKCkuCiAgICAgIC8vIEFsc28sIHNlZSB0aGUgImRvZXMgbm90IHN3YWxsb3cgdGhlIGZpbGUgcHJvbWlzZSByZWplY3Rpb24iIHRlc3QuCiAgICAgIC5jYXRjaCgoKSA9PiB7fSk7CiAgICB9CgogICAgbG9hZGVyLm9uKCdjaGFuZ2U6dXBsb2FkZWQnLCAoKSA9PiB7CiAgICAgIGxldCBhZ2dyZWdhdGVkVXBsb2FkZWQgPSAwOwoKICAgICAgZm9yIChjb25zdCBsb2FkZXIgb2YgdGhpcy5sb2FkZXJzKSB7CiAgICAgICAgYWdncmVnYXRlZFVwbG9hZGVkICs9IGxvYWRlci51cGxvYWRlZDsKICAgICAgfQoKICAgICAgdGhpcy51cGxvYWRlZCA9IGFnZ3JlZ2F0ZWRVcGxvYWRlZDsKICAgIH0pOwogICAgbG9hZGVyLm9uKCdjaGFuZ2U6dXBsb2FkVG90YWwnLCAoKSA9PiB7CiAgICAgIGxldCBhZ2dyZWdhdGVkVG90YWwgPSAwOwoKICAgICAgZm9yIChjb25zdCBsb2FkZXIgb2YgdGhpcy5sb2FkZXJzKSB7CiAgICAgICAgaWYgKGxvYWRlci51cGxvYWRUb3RhbCkgewogICAgICAgICAgYWdncmVnYXRlZFRvdGFsICs9IGxvYWRlci51cGxvYWRUb3RhbDsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRoaXMudXBsb2FkVG90YWwgPSBhZ2dyZWdhdGVkVG90YWw7CiAgICB9KTsKICAgIHJldHVybiBsb2FkZXI7CiAgfQogIC8qKgogICAqIERlc3Ryb3lzIHRoZSBnaXZlbiBsb2FkZXIuCiAgICoKICAgKiBAcGFyYW0ge0ZpbGV8UHJvbWlzZXxtb2R1bGU6dXBsb2FkL2ZpbGVyZXBvc2l0b3J5fkZpbGVMb2FkZXJ9IGZpbGVPclByb21pc2VPckxvYWRlciBGaWxlIG9yIFByb21pc2UgYXNzb2NpYXRlZAogICAqIHdpdGggdGhhdCBsb2FkZXIgb3IgbG9hZGVyIGl0c2VsZi4KICAgKi8KCgogIGRlc3Ryb3lMb2FkZXIoZmlsZU9yUHJvbWlzZU9yTG9hZGVyKSB7CiAgICBjb25zdCBsb2FkZXIgPSBmaWxlT3JQcm9taXNlT3JMb2FkZXIgaW5zdGFuY2VvZiBGaWxlTG9hZGVyID8gZmlsZU9yUHJvbWlzZU9yTG9hZGVyIDogdGhpcy5nZXRMb2FkZXIoZmlsZU9yUHJvbWlzZU9yTG9hZGVyKTsKCiAgICBsb2FkZXIuX2Rlc3Ryb3koKTsKCiAgICB0aGlzLmxvYWRlcnMucmVtb3ZlKGxvYWRlcik7CgogICAgdGhpcy5fbG9hZGVyc01hcC5mb3JFYWNoKCh2YWx1ZSwga2V5KSA9PiB7CiAgICAgIGlmICh2YWx1ZSA9PT0gbG9hZGVyKSB7CiAgICAgICAgdGhpcy5fbG9hZGVyc01hcC5kZWxldGUoa2V5KTsKICAgICAgfQogICAgfSk7CiAgfQogIC8qKgogICAqIFJlZ2lzdGVycyBvciBkZXJlZ2lzdGVycyBwZW5kaW5nIGFjdGlvbiBib3VuZCB3aXRoIHVwbG9hZCBwcm9ncmVzcy4KICAgKgogICAqIEBwcml2YXRlCiAgICovCgoKICBfdXBkYXRlUGVuZGluZ0FjdGlvbigpIHsKICAgIGNvbnN0IHBlbmRpbmdBY3Rpb25zID0gdGhpcy5lZGl0b3IucGx1Z2lucy5nZXQoUGVuZGluZ0FjdGlvbnMpOwoKICAgIGlmICh0aGlzLmxvYWRlcnMubGVuZ3RoKSB7CiAgICAgIGlmICghdGhpcy5fcGVuZGluZ0FjdGlvbikgewogICAgICAgIGNvbnN0IHQgPSB0aGlzLmVkaXRvci50OwoKICAgICAgICBjb25zdCBnZXRNZXNzYWdlID0gdmFsdWUgPT4gYCR7dCgnVXBsb2FkIGluIHByb2dyZXNzJyl9ICR7cGFyc2VJbnQodmFsdWUpfSUuYDsKCiAgICAgICAgdGhpcy5fcGVuZGluZ0FjdGlvbiA9IHBlbmRpbmdBY3Rpb25zLmFkZChnZXRNZXNzYWdlKHRoaXMudXBsb2FkZWRQZXJjZW50KSk7CgogICAgICAgIHRoaXMuX3BlbmRpbmdBY3Rpb24uYmluZCgnbWVzc2FnZScpLnRvKHRoaXMsICd1cGxvYWRlZFBlcmNlbnQnLCBnZXRNZXNzYWdlKTsKICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgcGVuZGluZ0FjdGlvbnMucmVtb3ZlKHRoaXMuX3BlbmRpbmdBY3Rpb24pOwogICAgICB0aGlzLl9wZW5kaW5nQWN0aW9uID0gbnVsbDsKICAgIH0KICB9Cgp9Cm1peChGaWxlUmVwb3NpdG9yeSwgT2JzZXJ2YWJsZU1peGluKTsKLyoqCiAqIEZpbGUgbG9hZGVyIGNsYXNzLgogKgogKiBJdCBpcyB1c2VkIHRvIGNvbnRyb2wgdGhlIHByb2Nlc3Mgb2YgcmVhZGluZyB0aGUgZmlsZSBhbmQgdXBsb2FkaW5nIGl0IHVzaW5nIHRoZSBzcGVjaWZpZWQgdXBsb2FkIGFkYXB0ZXIuCiAqLwoKY2xhc3MgRmlsZUxvYWRlciB7CiAgLyoqCiAgICogQ3JlYXRlcyBhIG5ldyBpbnN0YW5jZSBvZiBgRmlsZUxvYWRlcmAuCiAgICoKICAgKiBAcGFyYW0ge1Byb21pc2UuPEZpbGU+fSBmaWxlUHJvbWlzZSBBIHByb21pc2Ugd2hpY2ggcmVzb2x2ZXMgdG8gYSBmaWxlIGluc3RhbmNlLgogICAqIEBwYXJhbSB7RnVuY3Rpb259IHVwbG9hZEFkYXB0ZXJDcmVhdG9yIFRoZSBmdW5jdGlvbiB3aGljaCByZXR1cm5zIHtAbGluayBtb2R1bGU6dXBsb2FkL2ZpbGVyZXBvc2l0b3J5flVwbG9hZEFkYXB0ZXJ9IGluc3RhbmNlLgogICAqLwogIGNvbnN0cnVjdG9yKGZpbGVQcm9taXNlLCB1cGxvYWRBZGFwdGVyQ3JlYXRvcikgewogICAgLyoqCiAgICAgKiBVbmlxdWUgaWQgb2YgRmlsZUxvYWRlciBpbnN0YW5jZS4KICAgICAqCiAgICAgKiBAcmVhZG9ubHkKICAgICAqIEBtZW1iZXIge051bWJlcn0KICAgICAqLwogICAgdGhpcy5pZCA9IHVpZCgpOwogICAgLyoqCiAgICAgKiBBZGRpdGlvbmFsIHdyYXBwZXIgb3ZlciB0aGUgaW5pdGlhbCBmaWxlIHByb21pc2UgcGFzc2VkIHRvIHRoaXMgbG9hZGVyLgogICAgICoKICAgICAqIEBwcm90ZWN0ZWQKICAgICAqIEBtZW1iZXIge21vZHVsZTp1cGxvYWQvZmlsZXJlcG9zaXRvcnl+RmlsZVByb21pc2VXcmFwcGVyfQogICAgICovCgogICAgdGhpcy5fZmlsZVByb21pc2VXcmFwcGVyID0gdGhpcy5fY3JlYXRlRmlsZVByb21pc2VXcmFwcGVyKGZpbGVQcm9taXNlKTsKICAgIC8qKgogICAgICogQWRhcHRlciBpbnN0YW5jZSBhc3NvY2lhdGVkIHdpdGggdGhpcyBmaWxlIGxvYWRlci4KICAgICAqCiAgICAgKiBAcHJpdmF0ZQogICAgICogQG1lbWJlciB7bW9kdWxlOnVwbG9hZC9maWxlcmVwb3NpdG9yeX5VcGxvYWRBZGFwdGVyfQogICAgICovCgogICAgdGhpcy5fYWRhcHRlciA9IHVwbG9hZEFkYXB0ZXJDcmVhdG9yKHRoaXMpOwogICAgLyoqCiAgICAgKiBGaWxlUmVhZGVyIHVzZWQgYnkgRmlsZUxvYWRlci4KICAgICAqCiAgICAgKiBAcHJvdGVjdGVkCiAgICAgKiBAbWVtYmVyIHttb2R1bGU6dXBsb2FkL2ZpbGVyZWFkZXJ+RmlsZVJlYWRlcn0KICAgICAqLwoKICAgIHRoaXMuX3JlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCk7CiAgICAvKioKICAgICAqIEN1cnJlbnQgc3RhdHVzIG9mIEZpbGVMb2FkZXIuIEl0IGNhbiBiZSBvbmUgb2YgdGhlIGZvbGxvd2luZzoKICAgICAqCiAgICAgKiAqICdpZGxlJywKICAgICAqICogJ3JlYWRpbmcnLAogICAgICogKiAndXBsb2FkaW5nJywKICAgICAqICogJ2Fib3J0ZWQnLAogICAgICogKiAnZXJyb3InLgogICAgICoKICAgICAqIFdoZW4gcmVhZGluZyBzdGF0dXMgY2FuIGNoYW5nZSBpbiBhIGZvbGxvd2luZyB3YXk6CiAgICAgKgogICAgICogYGlkbGVgIC0+IGByZWFkaW5nYCAtPiBgaWRsZWAKICAgICAqIGBpZGxlYCAtPiBgcmVhZGluZyAtPiBgYWJvcnRlZGAKICAgICAqIGBpZGxlYCAtPiBgcmVhZGluZyAtPiBgZXJyb3JgCiAgICAgKgogICAgICogV2hlbiB1cGxvYWRpbmcgc3RhdHVzIGNhbiBjaGFuZ2UgaW4gYSBmb2xsb3dpbmcgd2F5OgogICAgICoKICAgICAqIGBpZGxlYCAtPiBgdXBsb2FkaW5nYCAtPiBgaWRsZWAKICAgICAqIGBpZGxlYCAtPiBgdXBsb2FkaW5nYCAtPiBgYWJvcnRlZGAKICAgICAqIGBpZGxlYCAtPiBgdXBsb2FkaW5nYCAtPiBgZXJyb3JgCiAgICAgKgogICAgICogQHJlYWRvbmx5CiAgICAgKiBAb2JzZXJ2YWJsZQogICAgICogQG1lbWJlciB7U3RyaW5nfSAjc3RhdHVzCiAgICAgKi8KCiAgICB0aGlzLnNldCgnc3RhdHVzJywgJ2lkbGUnKTsKICAgIC8qKgogICAgICogTnVtYmVyIG9mIGJ5dGVzIHVwbG9hZGVkLgogICAgICoKICAgICAqIEByZWFkb25seQogICAgICogQG9ic2VydmFibGUKICAgICAqIEBtZW1iZXIge051bWJlcn0gI3VwbG9hZGVkCiAgICAgKi8KCiAgICB0aGlzLnNldCgndXBsb2FkZWQnLCAwKTsKICAgIC8qKgogICAgICogTnVtYmVyIG9mIHRvdGFsIGJ5dGVzIHRvIHVwbG9hZC4KICAgICAqCiAgICAgKiBAcmVhZG9ubHkKICAgICAqIEBvYnNlcnZhYmxlCiAgICAgKiBAbWVtYmVyIHtOdW1iZXJ8bnVsbH0gI3VwbG9hZFRvdGFsCiAgICAgKi8KCiAgICB0aGlzLnNldCgndXBsb2FkVG90YWwnLCBudWxsKTsKICAgIC8qKgogICAgICogVXBsb2FkIHByb2dyZXNzIGluIHBlcmNlbnRzLgogICAgICoKICAgICAqIEByZWFkb25seQogICAgICogQG9ic2VydmFibGUKICAgICAqIEBtZW1iZXIge051bWJlcn0gI3VwbG9hZGVkUGVyY2VudAogICAgICovCgogICAgdGhpcy5iaW5kKCd1cGxvYWRlZFBlcmNlbnQnKS50byh0aGlzLCAndXBsb2FkZWQnLCB0aGlzLCAndXBsb2FkVG90YWwnLCAodXBsb2FkZWQsIHRvdGFsKSA9PiB7CiAgICAgIHJldHVybiB0b3RhbCA/IHVwbG9hZGVkIC8gdG90YWwgKiAxMDAgOiAwOwogICAgfSk7CiAgICAvKioKICAgICAqIFJlc3BvbnNlIG9mIHRoZSB1cGxvYWQuCiAgICAgKgogICAgICogQHJlYWRvbmx5CiAgICAgKiBAb2JzZXJ2YWJsZQogICAgICogQG1lbWJlciB7T2JqZWN0fG51bGx9ICN1cGxvYWRSZXNwb25zZQogICAgICovCgogICAgdGhpcy5zZXQoJ3VwbG9hZFJlc3BvbnNlJywgbnVsbCk7CiAgfQogIC8qKgogICAqIEEgYFByb21pc2VgIHdoaWNoIHJlc29sdmVzIHRvIGEgYEZpbGVgIGluc3RhbmNlIGFzc29jaWF0ZWQgd2l0aCB0aGlzIGZpbGUgbG9hZGVyLgogICAqCiAgICogQHR5cGUge1Byb21pc2UuPEZpbGV8bnVsbD59CiAgICovCgoKICBnZXQgZmlsZSgpIHsKICAgIGlmICghdGhpcy5fZmlsZVByb21pc2VXcmFwcGVyKSB7CiAgICAgIC8vIExvYWRlciB3YXMgZGVzdHJveWVkLCByZXR1cm4gcHJvbWlzZSB3aGljaCByZXNvbHZlcyB0byBudWxsLgogICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKG51bGwpOwogICAgfSBlbHNlIHsKICAgICAgLy8gVGhlIGB0aGlzLl9maWxlUHJvbWlzZVdyYXBwZXIucHJvbWlzZWAgaXMgY2hhaW5lZCBhbmQgbm90IHNpbXBseSByZXR1cm5lZCB0byBoYW5kbGUgYSBjYXNlIHdoZW46CiAgICAgIC8vCiAgICAgIC8vCQkqIFRoZSBgbG9hZGVyLmZpbGUudGhlbiggLi4uIClgIGlzIGNhbGxlZCBieSBleHRlcm5hbCBjb2RlIChyZXR1cm5lZCBwcm9taXNlIGlzIHBlbmRpbmcpLgogICAgICAvLwkJKiBUaGVuIGBsb2FkZXIuX2Rlc3Ryb3koKWAgaXMgY2FsbGVkIChjYWxsIGlzIHN5bmNocm9ub3VzKSB3aGljaCBkZXN0cm95cyB0aGUgYGxvYWRlcmAuCiAgICAgIC8vCQkqIFByb21pc2UgcmV0dXJuZWQgYnkgdGhlIGZpcnN0IGBsb2FkZXIuZmlsZS50aGVuKCAuLi4gKWAgY2FsbCBpcyByZXNvbHZlZC4KICAgICAgLy8KICAgICAgLy8gUmV0dXJuaW5nIGB0aGlzLl9maWxlUHJvbWlzZVdyYXBwZXIucHJvbWlzZWAgd2lsbCBzdGlsbCByZXNvbHZlIHRvIGEgYEZpbGVgIGluc3RhbmNlIHNvIHRoZXJlCiAgICAgIC8vIGlzIGFuIGFkZGl0aW9uYWwgY2hlY2sgbmVlZGVkIGluIHRoZSBjaGFpbiB0byBzZWUgaWYgYGxvYWRlcmAgd2FzIGRlc3Ryb3llZCBpbiB0aGUgbWVhbnRpbWUuCiAgICAgIHJldHVybiB0aGlzLl9maWxlUHJvbWlzZVdyYXBwZXIucHJvbWlzZS50aGVuKGZpbGUgPT4gdGhpcy5fZmlsZVByb21pc2VXcmFwcGVyID8gZmlsZSA6IG51bGwpOwogICAgfQogIH0KICAvKioKICAgKiBSZXR1cm5zIHRoZSBmaWxlIGRhdGEuIFRvIHJlYWQgaXRzIGRhdGEsIHlvdSBuZWVkIGZvciBmaXJzdCBsb2FkIHRoZSBmaWxlCiAgICogYnkgdXNpbmcgdGhlIHtAbGluayBtb2R1bGU6dXBsb2FkL2ZpbGVyZXBvc2l0b3J5fkZpbGVMb2FkZXIjcmVhZCBgcmVhZCgpYH0gbWV0aG9kLgogICAqCiAgICogQHR5cGUge0ZpbGV8dW5kZWZpbmVkfQogICAqLwoKCiAgZ2V0IGRhdGEoKSB7CiAgICByZXR1cm4gdGhpcy5fcmVhZGVyLmRhdGE7CiAgfQogIC8qKgogICAqIFJlYWRzIGZpbGUgdXNpbmcge0BsaW5rIG1vZHVsZTp1cGxvYWQvZmlsZXJlYWRlcn5GaWxlUmVhZGVyfS4KICAgKgogICAqIFRocm93cyB7QGxpbmsgbW9kdWxlOnV0aWxzL2NrZWRpdG9yZXJyb3J+Q0tFZGl0b3JFcnJvciBDS0VkaXRvckVycm9yfSBgZmlsZXJlcG9zaXRvcnktcmVhZC13cm9uZy1zdGF0dXNgIHdoZW4gc3RhdHVzCiAgICogaXMgZGlmZmVyZW50IHRoYW4gYGlkbGVgLgogICAqCiAgICogRXhhbXBsZSB1c2FnZToKICAgKgogICAqCWZpbGVMb2FkZXIucmVhZCgpCiAgICoJCS50aGVuKCBkYXRhID0+IHsgLi4uIH0gKQogICAqCQkuY2F0Y2goIGVyciA9PiB7CiAgICoJCQlpZiAoIGVyciA9PT0gJ2Fib3J0ZWQnICkgewogICAqCQkJCWNvbnNvbGUubG9nKCAnUmVhZGluZyBhYm9ydGVkLicgKTsKICAgKgkJCX0gZWxzZSB7CiAgICoJCQkJY29uc29sZS5sb2coICdSZWFkaW5nIGVycm9yLicsIGVyciApOwogICAqCQkJfQogICAqCQl9ICk7CiAgICoKICAgKiBAcmV0dXJucyB7UHJvbWlzZS48U3RyaW5nPn0gUmV0dXJucyBwcm9taXNlIHRoYXQgd2lsbCBiZSByZXNvbHZlZCB3aXRoIHJlYWQgZGF0YS4gUHJvbWlzZSB3aWxsIGJlIHJlamVjdGVkIGlmIGVycm9yCiAgICogb2NjdXJzIG9yIGlmIHJlYWQgcHJvY2VzcyBpcyBhYm9ydGVkLgogICAqLwoKCiAgcmVhZCgpIHsKICAgIGlmICh0aGlzLnN0YXR1cyAhPSAnaWRsZScpIHsKICAgICAgdGhyb3cgbmV3IENLRWRpdG9yRXJyb3IoJ2ZpbGVyZXBvc2l0b3J5LXJlYWQtd3Jvbmctc3RhdHVzOiBZb3UgY2Fubm90IGNhbGwgcmVhZCBpZiB0aGUgc3RhdHVzIGlzIGRpZmZlcmVudCB0aGFuIGlkbGUuJywgdGhpcyk7CiAgICB9CgogICAgdGhpcy5zdGF0dXMgPSAncmVhZGluZyc7CiAgICByZXR1cm4gdGhpcy5maWxlLnRoZW4oZmlsZSA9PiB0aGlzLl9yZWFkZXIucmVhZChmaWxlKSkudGhlbihkYXRhID0+IHsKICAgICAgLy8gRWRnZSBjYXNlOiByZWFkZXIgd2FzIGFib3J0ZWQgYWZ0ZXIgZmlsZSB3YXMgcmVhZCAtIGRvdWJsZSBjaGVjayBmb3IgcHJvcGVyIHN0YXR1cy4KICAgICAgaWYgKHRoaXMuc3RhdHVzICE9PSAncmVhZGluZycpIHsKICAgICAgICB0aHJvdyB0aGlzLnN0YXR1czsKICAgICAgfQoKICAgICAgdGhpcy5zdGF0dXMgPSAnaWRsZSc7CiAgICAgIHJldHVybiBkYXRhOwogICAgfSkuY2F0Y2goZXJyID0+IHsKICAgICAgaWYgKGVyciA9PT0gJ2Fib3J0ZWQnKSB7CiAgICAgICAgdGhpcy5zdGF0dXMgPSAnYWJvcnRlZCc7CiAgICAgICAgdGhyb3cgJ2Fib3J0ZWQnOwogICAgICB9CgogICAgICB0aGlzLnN0YXR1cyA9ICdlcnJvcic7CiAgICAgIHRocm93IHRoaXMuX3JlYWRlci5lcnJvciA/IHRoaXMuX3JlYWRlci5lcnJvciA6IGVycjsKICAgIH0pOwogIH0KICAvKioKICAgKiBSZWFkcyBmaWxlIHVzaW5nIHRoZSBwcm92aWRlZCB7QGxpbmsgbW9kdWxlOnVwbG9hZC9maWxlcmVwb3NpdG9yeX5VcGxvYWRBZGFwdGVyfS4KICAgKgogICAqIFRocm93cyB7QGxpbmsgbW9kdWxlOnV0aWxzL2NrZWRpdG9yZXJyb3J+Q0tFZGl0b3JFcnJvciBDS0VkaXRvckVycm9yfSBgZmlsZXJlcG9zaXRvcnktdXBsb2FkLXdyb25nLXN0YXR1c2Agd2hlbiBzdGF0dXMKICAgKiBpcyBkaWZmZXJlbnQgdGhhbiBgaWRsZWAuCiAgICogRXhhbXBsZSB1c2FnZToKICAgKgogICAqCWZpbGVMb2FkZXIudXBsb2FkKCkKICAgKgkJLnRoZW4oIGRhdGEgPT4geyAuLi4gfSApCiAgICoJCS5jYXRjaCggZSA9PiB7CiAgICoJCQlpZiAoIGUgPT09ICdhYm9ydGVkJyApIHsKICAgKgkJCQljb25zb2xlLmxvZyggJ1VwbG9hZGluZyBhYm9ydGVkLicgKTsKICAgKgkJCX0gZWxzZSB7CiAgICoJCQkJY29uc29sZS5sb2coICdVcGxvYWRpbmcgZXJyb3IuJywgZSApOwogICAqCQkJfQogICAqCQl9ICk7CiAgICoKICAgKiBAcmV0dXJucyB7UHJvbWlzZS48T2JqZWN0Pn0gUmV0dXJucyBwcm9taXNlIHRoYXQgd2lsbCBiZSByZXNvbHZlZCB3aXRoIHJlc3BvbnNlIGRhdGEuIFByb21pc2Ugd2lsbCBiZSByZWplY3RlZCBpZiBlcnJvcgogICAqIG9jY3VycyBvciBpZiByZWFkIHByb2Nlc3MgaXMgYWJvcnRlZC4KICAgKi8KCgogIHVwbG9hZCgpIHsKICAgIGlmICh0aGlzLnN0YXR1cyAhPSAnaWRsZScpIHsKICAgICAgdGhyb3cgbmV3IENLRWRpdG9yRXJyb3IoJ2ZpbGVyZXBvc2l0b3J5LXVwbG9hZC13cm9uZy1zdGF0dXM6IFlvdSBjYW5ub3QgY2FsbCB1cGxvYWQgaWYgdGhlIHN0YXR1cyBpcyBkaWZmZXJlbnQgdGhhbiBpZGxlLicsIHRoaXMpOwogICAgfQoKICAgIHRoaXMuc3RhdHVzID0gJ3VwbG9hZGluZyc7CiAgICByZXR1cm4gdGhpcy5maWxlLnRoZW4oKCkgPT4gdGhpcy5fYWRhcHRlci51cGxvYWQoKSkudGhlbihkYXRhID0+IHsKICAgICAgdGhpcy51cGxvYWRSZXNwb25zZSA9IGRhdGE7CiAgICAgIHRoaXMuc3RhdHVzID0gJ2lkbGUnOwogICAgICByZXR1cm4gZGF0YTsKICAgIH0pLmNhdGNoKGVyciA9PiB7CiAgICAgIGlmICh0aGlzLnN0YXR1cyA9PT0gJ2Fib3J0ZWQnKSB7CiAgICAgICAgdGhyb3cgJ2Fib3J0ZWQnOwogICAgICB9CgogICAgICB0aGlzLnN0YXR1cyA9ICdlcnJvcic7CiAgICAgIHRocm93IGVycjsKICAgIH0pOwogIH0KICAvKioKICAgKiBBYm9ydHMgbG9hZGluZyBwcm9jZXNzLgogICAqLwoKCiAgYWJvcnQoKSB7CiAgICBjb25zdCBzdGF0dXMgPSB0aGlzLnN0YXR1czsKICAgIHRoaXMuc3RhdHVzID0gJ2Fib3J0ZWQnOwoKICAgIGlmICghdGhpcy5fZmlsZVByb21pc2VXcmFwcGVyLmlzRnVsZmlsbGVkKSB7CiAgICAgIC8vIEVkZ2UgY2FzZTogZmlsZSBsb2FkZXIgaXMgYWJvcnRlZCBiZWZvcmUgcmVhZCgpIGlzIGNhbGxlZAogICAgICAvLyBzbyBpdCBtaWdodCBoYXBwZW4gdGhhdCBubyBvbmUgaGFuZGxlZCB0aGUgcmVqZWN0aW9uIG9mIHRoaXMgcHJvbWlzZS4KICAgICAgLy8gU2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9ja2VkaXRvci9ja2VkaXRvcjUtdXBsb2FkL3B1bGwvMTAwCiAgICAgIHRoaXMuX2ZpbGVQcm9taXNlV3JhcHBlci5wcm9taXNlLmNhdGNoKCgpID0+IHt9KTsKCiAgICAgIHRoaXMuX2ZpbGVQcm9taXNlV3JhcHBlci5yZWplY3RlcignYWJvcnRlZCcpOwogICAgfSBlbHNlIGlmIChzdGF0dXMgPT0gJ3JlYWRpbmcnKSB7CiAgICAgIHRoaXMuX3JlYWRlci5hYm9ydCgpOwogICAgfSBlbHNlIGlmIChzdGF0dXMgPT0gJ3VwbG9hZGluZycgJiYgdGhpcy5fYWRhcHRlci5hYm9ydCkgewogICAgICB0aGlzLl9hZGFwdGVyLmFib3J0KCk7CiAgICB9CgogICAgdGhpcy5fZGVzdHJveSgpOwogIH0KICAvKioKICAgKiBQZXJmb3JtcyBjbGVhbnVwLgogICAqCiAgICogQHByaXZhdGUKICAgKi8KCgogIF9kZXN0cm95KCkgewogICAgdGhpcy5fZmlsZVByb21pc2VXcmFwcGVyID0gdW5kZWZpbmVkOwogICAgdGhpcy5fcmVhZGVyID0gdW5kZWZpbmVkOwogICAgdGhpcy5fYWRhcHRlciA9IHVuZGVmaW5lZDsKICAgIHRoaXMudXBsb2FkUmVzcG9uc2UgPSB1bmRlZmluZWQ7CiAgfQogIC8qKgogICAqIFdyYXBzIGEgZ2l2ZW4gZmlsZSBwcm9taXNlIGludG8gYW5vdGhlciBwcm9taXNlIGdpdmluZyBhZGRpdGlvbmFsCiAgICogY29udHJvbCAocmVzb2x2aW5nLCByZWplY3RpbmcsIGNoZWNraW5nIGlmIGZ1bGZpbGxlZCkgb3ZlciBpdC4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIGZpbGVQcm9taXNlIFRoZSBpbml0aWFsIGZpbGUgcHJvbWlzZSB0byBiZSB3cmFwcGVkLgogICAqIEByZXR1cm5zIHttb2R1bGU6dXBsb2FkL2ZpbGVyZXBvc2l0b3J5fkZpbGVQcm9taXNlV3JhcHBlcn0KICAgKi8KCgogIF9jcmVhdGVGaWxlUHJvbWlzZVdyYXBwZXIoZmlsZVByb21pc2UpIHsKICAgIGNvbnN0IHdyYXBwZXIgPSB7fTsKICAgIHdyYXBwZXIucHJvbWlzZSA9IG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHsKICAgICAgd3JhcHBlci5yZWplY3RlciA9IHJlamVjdDsKICAgICAgd3JhcHBlci5pc0Z1bGZpbGxlZCA9IGZhbHNlOwogICAgICBmaWxlUHJvbWlzZS50aGVuKGZpbGUgPT4gewogICAgICAgIHdyYXBwZXIuaXNGdWxmaWxsZWQgPSB0cnVlOwogICAgICAgIHJlc29sdmUoZmlsZSk7CiAgICAgIH0pLmNhdGNoKGVyciA9PiB7CiAgICAgICAgd3JhcHBlci5pc0Z1bGZpbGxlZCA9IHRydWU7CiAgICAgICAgcmVqZWN0KGVycik7CiAgICAgIH0pOwogICAgfSk7CiAgICByZXR1cm4gd3JhcHBlcjsKICB9Cgp9CgptaXgoRmlsZUxvYWRlciwgT2JzZXJ2YWJsZU1peGluKTsKLyoqCiAqIFVwbG9hZCBhZGFwdGVyIGludGVyZmFjZSB1c2VkIGJ5IHRoZSB7QGxpbmsgbW9kdWxlOnVwbG9hZC9maWxlcmVwb3NpdG9yeX5GaWxlUmVwb3NpdG9yeSBmaWxlIHJlcG9zaXRvcnl9CiAqIHRvIGhhbmRsZSBmaWxlIHVwbG9hZC4gQW4gdXBsb2FkIGFkYXB0ZXIgaXMgYSBicmlkZ2UgYmV0d2VlbiB0aGUgZWRpdG9yIGFuZCBzZXJ2ZXIgdGhhdCBoYW5kbGVzIGZpbGUgdXBsb2Fkcy4KICogSXQgc2hvdWxkIGNvbnRhaW4gYSBsb2dpYyBuZWNlc3NhcnkgdG8gaW5pdGlhdGUgYW4gdXBsb2FkIHByb2Nlc3MgYW5kIG1vbml0b3IgaXRzIHByb2dyZXNzLgogKgogKiBMZWFybiBob3cgdG8gZGV2ZWxvcCB5b3VyIG93biB1cGxvYWQgYWRhcHRlciBmb3IgQ0tFZGl0b3IgNSBpbiB0aGUKICoge0BnbGluayBmcmFtZXdvcmsvZ3VpZGVzL2RlZXAtZGl2ZS91cGxvYWQtYWRhcHRlciAiQ3VzdG9tIHVwbG9hZCBhZGFwdGVyIiBndWlkZX0uCiAqCiAqIEBpbnRlcmZhY2UgVXBsb2FkQWRhcHRlcgogKi8KCi8qKgogKiBFeGVjdXRlcyB0aGUgdXBsb2FkIHByb2Nlc3MuCiAqIFRoaXMgbWV0aG9kIHNob3VsZCByZXR1cm4gYSBwcm9taXNlIHRoYXQgd2lsbCByZXNvbHZlIHdoZW4gZGF0YSB3aWxsIGJlIHVwbG9hZGVkIHRvIHNlcnZlci4gUHJvbWlzZSBzaG91bGQgYmUKICogcmVzb2x2ZWQgd2l0aCBhbiBvYmplY3QgY29udGFpbmluZyBpbmZvcm1hdGlvbiBhYm91dCB1cGxvYWRlZCBmaWxlOgogKgogKgkJewogKgkJCWRlZmF1bHQ6ICdodHRwOi8vc2VydmVyL2RlZmF1bHQtc2l6ZS5pbWFnZS5wbmcnCiAqCQl9CiAqCiAqIEFkZGl0aW9uYWxseSwgb3RoZXIgaW1hZ2Ugc2l6ZXMgY2FuIGJlIHByb3ZpZGVkOgogKgogKgkJewogKgkJCWRlZmF1bHQ6ICdodHRwOi8vc2VydmVyL2RlZmF1bHQtc2l6ZS5pbWFnZS5wbmcnLAogKgkJCScxNjAnOiAnaHR0cDovL3NlcnZlci9zaXplLTE2MC5pbWFnZS5wbmcnLAogKgkJCSc1MDAnOiAnaHR0cDovL3NlcnZlci9zaXplLTUwMC5pbWFnZS5wbmcnLAogKgkJCScxMDAwJzogJ2h0dHA6Ly9zZXJ2ZXIvc2l6ZS0xMDAwLmltYWdlLnBuZycsCiAqCQkJJzEwNTInOiAnaHR0cDovL3NlcnZlci9kZWZhdWx0LXNpemUuaW1hZ2UucG5nJwogKgkJfQogKgogKiBOT1RFOiBXaGVuIHJldHVybmluZyBtdWx0aXBsZSBpbWFnZXMsIHRoZSB3aWRlc3QgcmV0dXJuZWQgb25lIHNob3VsZCBlcXVhbCB0aGUgZGVmYXVsdCBvbmUuIEl0IGlzIGVzc2VudGlhbCB0bwogKiBjb3JyZWN0bHkgc2V0IGB3aWR0aGAgYXR0cmlidXRlIG9mIHRoZSBpbWFnZS4gU2VlIHRoaXMgZGlzY3Vzc2lvbjoKICogaHR0cHM6Ly9naXRodWIuY29tL2NrZWRpdG9yL2NrZWRpdG9yNS1lYXN5LWltYWdlL2lzc3Vlcy80IGZvciBtb3JlIGluZm9ybWF0aW9uLgogKgogKiBUYWtlIGEgbG9vayBhdCB7QGxpbmsgbW9kdWxlOnVwbG9hZC9maWxlcmVwb3NpdG9yeX5VcGxvYWRBZGFwdGVyIGV4YW1wbGUgQWRhcHRlciBpbXBsZW1lbnRhdGlvbn0gYW5kCiAqIHtAbGluayBtb2R1bGU6dXBsb2FkL2ZpbGVyZXBvc2l0b3J5fkZpbGVSZXBvc2l0b3J5I2NyZWF0ZVVwbG9hZEFkYXB0ZXIgY3JlYXRlVXBsb2FkQWRhcHRlciBtZXRob2R9LgogKgogKiBAbWV0aG9kIG1vZHVsZTp1cGxvYWQvZmlsZXJlcG9zaXRvcnl+VXBsb2FkQWRhcHRlciN1cGxvYWQKICogQHJldHVybnMge1Byb21pc2UuPE9iamVjdD59IFByb21pc2UgdGhhdCBzaG91bGQgYmUgcmVzb2x2ZWQgd2hlbiBkYXRhIGlzIHVwbG9hZGVkLgogKi8KCi8qKgogKiBBYm9ydHMgdGhlIHVwbG9hZCBwcm9jZXNzLgogKiBBZnRlciBhYm9ydGluZyBpdCBzaG91bGQgcmVqZWN0IHByb21pc2UgcmV0dXJuZWQgZnJvbSB7QGxpbmsgI3VwbG9hZCB1cGxvYWQoKX0uCiAqCiAqIFRha2UgYSBsb29rIGF0IHtAbGluayBtb2R1bGU6dXBsb2FkL2ZpbGVyZXBvc2l0b3J5flVwbG9hZEFkYXB0ZXIgZXhhbXBsZSBBZGFwdGVyIGltcGxlbWVudGF0aW9ufSBhbmQKICoge0BsaW5rIG1vZHVsZTp1cGxvYWQvZmlsZXJlcG9zaXRvcnl+RmlsZVJlcG9zaXRvcnkjY3JlYXRlVXBsb2FkQWRhcHRlciBjcmVhdGVVcGxvYWRBZGFwdGVyIG1ldGhvZH0uCiAqCiAqIEBtZXRob2QgbW9kdWxlOnVwbG9hZC9maWxlcmVwb3NpdG9yeX5VcGxvYWRBZGFwdGVyI2Fib3J0CiAqLwoKLyoqCiAqIE9iamVjdCByZXR1cm5lZCBieSB7QGxpbmsgbW9kdWxlOnVwbG9hZC9maWxlcmVwb3NpdG9yeX5GaWxlTG9hZGVyI19jcmVhdGVGaWxlUHJvbWlzZVdyYXBwZXJ9IG1ldGhvZAogKiB0byBhZGQgbW9yZSBjb250cm9sIG92ZXIgdGhlIGluaXRpYWwgZmlsZSBwcm9taXNlIHBhc3NlZCB0byB7QGxpbmsgbW9kdWxlOnVwbG9hZC9maWxlcmVwb3NpdG9yeX5GaWxlTG9hZGVyfS4KICoKICogQHByb3RlY3RlZAogKiBAdHlwZWRlZiB7T2JqZWN0fSBtb2R1bGU6dXBsb2FkL2ZpbGVyZXBvc2l0b3J5fkZpbGVQcm9taXNlV3JhcHBlcgogKiBAcHJvcGVydHkge1Byb21pc2UuPEZpbGU+fSBwcm9taXNlIFdyYXBwZXIgcHJvbWlzZSB3aGljaCBjYW4gYmUgY2hhaW5lZCBmb3IgZnVydGhlciBwcm9jZXNzaW5nLgogKiBAcHJvcGVydHkge0Z1bmN0aW9ufSByZWplY3RlciBSZWplY3RzIHRoZSBwcm9taXNlIHdoZW4gY2FsbGVkLgogKiBAcHJvcGVydHkge0Jvb2xlYW59IGlzRnVsZmlsbGVkIFdoZXRoZXIgb3JpZ2luYWwgcHJvbWlzZSBpcyBhbHJlYWR5IGZ1bGZpbGxlZC4KICov"},{"version":3,"sources":["/Users/antonyching/Desktop/project/new-builder-demo/node_modules/@ckeditor/ckeditor5-upload/src/filerepository.js"],"names":["Plugin","PendingActions","CKEditorError","attachLinkToDocumentation","ObservableMixin","Collection","mix","FileReader","uid","FileRepository","pluginName","requires","init","loaders","on","_updatePendingAction","_loadersMap","Map","_pendingAction","set","bind","to","uploaded","total","getLoader","fileOrPromise","get","createLoader","createUploadAdapter","console","warn","loader","FileLoader","Promise","resolve","add","file","then","catch","aggregatedUploaded","aggregatedTotal","uploadTotal","destroyLoader","fileOrPromiseOrLoader","_destroy","remove","forEach","value","key","delete","pendingActions","editor","plugins","length","t","getMessage","parseInt","uploadedPercent","constructor","filePromise","uploadAdapterCreator","id","_filePromiseWrapper","_createFilePromiseWrapper","_adapter","_reader","promise","data","read","status","err","error","upload","uploadResponse","abort","isFulfilled","rejecter","undefined","wrapper","reject"],"mappings":"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","sourcesContent":["/**\n * @license Copyright (c) 2003-2019, CKSource - Frederico Knabben. All rights reserved.\n * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license\n */\n\n/**\n * @module upload/filerepository\n */\n\n/* globals console */\n\nimport Plugin from '@ckeditor/ckeditor5-core/src/plugin';\n\nimport PendingActions from '@ckeditor/ckeditor5-core/src/pendingactions';\nimport CKEditorError, { attachLinkToDocumentation } from '@ckeditor/ckeditor5-utils/src/ckeditorerror';\nimport ObservableMixin from '@ckeditor/ckeditor5-utils/src/observablemixin';\nimport Collection from '@ckeditor/ckeditor5-utils/src/collection';\nimport mix from '@ckeditor/ckeditor5-utils/src/mix';\n\nimport FileReader from './filereader.js';\n\nimport uid from '@ckeditor/ckeditor5-utils/src/uid.js';\n\n/**\n * File repository plugin. A central point for managing file upload.\n *\n * To use it, first you need an upload adapter. Upload adapter's job is to handle communication with the server\n * (sending the file and handling server's response). You can use one of the existing plugins introducing upload adapters\n * (e.g. {@link module:easy-image/cloudservicesuploadadapter~CloudServicesUploadAdapter} or\n * {@link module:adapter-ckfinder/uploadadapter~CKFinderUploadAdapter}) or write your own one – see\n * the {@glink framework/guides/deep-dive/upload-adapter \"Custom image upload adapter\" deep dive guide}.\n *\n * Then, you can use {@link module:upload/filerepository~FileRepository#createLoader `createLoader()`} and the returned\n * {@link module:upload/filerepository~FileLoader} instance to load and upload files.\n *\n * @extends module:core/plugin~Plugin\n */\nexport default class FileRepository extends Plugin {\n\t/**\n\t * @inheritDoc\n\t */\n\tstatic get pluginName() {\n\t\treturn 'FileRepository';\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tstatic get requires() {\n\t\treturn [ PendingActions ];\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tinit() {\n\t\t/**\n\t\t * Collection of loaders associated with this repository.\n\t\t *\n\t\t * @member {module:utils/collection~Collection} #loaders\n\t\t */\n\t\tthis.loaders = new Collection();\n\n\t\t// Keeps upload in a sync with pending actions.\n\t\tthis.loaders.on( 'add', () => this._updatePendingAction() );\n\t\tthis.loaders.on( 'remove', () => this._updatePendingAction() );\n\n\t\t/**\n\t\t * Loaders mappings used to retrieve loaders references.\n\t\t *\n\t\t * @private\n\t\t * @member {Map<File|Promise, FileLoader>} #_loadersMap\n\t\t */\n\t\tthis._loadersMap = new Map();\n\n\t\t/**\n\t\t * Reference to a pending action registered in a {@link module:core/pendingactions~PendingActions} plugin\n\t\t * while upload is in progress. When there is no upload then value is `null`.\n\t\t *\n\t\t * @private\n\t\t * @member {Object} #_pendingAction\n\t\t */\n\t\tthis._pendingAction = null;\n\n\t\t/**\n\t\t * A factory function which should be defined before using `FileRepository`.\n\t\t *\n\t\t * It should return a new instance of {@link module:upload/filerepository~UploadAdapter} that will be used to upload files.\n\t\t * {@link module:upload/filerepository~FileLoader} instance associated with the adapter\n\t\t * will be passed to that function.\n\t\t *\n\t\t * For more information and example see {@link module:upload/filerepository~UploadAdapter}.\n\t\t *\n\t\t * @member {Function} #createUploadAdapter\n\t\t */\n\n\t\t/**\n\t\t * Number of bytes uploaded.\n\t\t *\n\t\t * @readonly\n\t\t * @observable\n\t\t * @member {Number} #uploaded\n\t\t */\n\t\tthis.set( 'uploaded', 0 );\n\n\t\t/**\n\t\t * Number of total bytes to upload.\n\t\t *\n\t\t * It might be different than the file size because of headers and additional data.\n\t\t * It contains `null` if value is not available yet, so it's better to use {@link #uploadedPercent} to monitor\n\t\t * the progress.\n\t\t *\n\t\t * @readonly\n\t\t * @observable\n\t\t * @member {Number|null} #uploadTotal\n\t\t */\n\t\tthis.set( 'uploadTotal', null );\n\n\t\t/**\n\t\t * Upload progress in percents.\n\t\t *\n\t\t * @readonly\n\t\t * @observable\n\t\t * @member {Number} #uploadedPercent\n\t\t */\n\t\tthis.bind( 'uploadedPercent' ).to( this, 'uploaded', this, 'uploadTotal', ( uploaded, total ) => {\n\t\t\treturn total ? ( uploaded / total * 100 ) : 0;\n\t\t} );\n\t}\n\n\t/**\n\t * Returns the loader associated with specified file or promise.\n\t *\n\t * To get loader by id use `fileRepository.loaders.get( id )`.\n\t *\n\t * @param {File|Promise.<File>} fileOrPromise Native file or promise handle.\n\t * @returns {module:upload/filerepository~FileLoader|null}\n\t */\n\tgetLoader( fileOrPromise ) {\n\t\treturn this._loadersMap.get( fileOrPromise ) || null;\n\t}\n\n\t/**\n\t * Creates a loader instance for the given file.\n\t *\n\t * Requires {@link #createUploadAdapter} factory to be defined.\n\t *\n\t * @param {File|Promise.<File>} fileOrPromise Native File object or native Promise object which resolves to a File.\n\t * @returns {module:upload/filerepository~FileLoader|null}\n\t */\n\tcreateLoader( fileOrPromise ) {\n\t\tif ( !this.createUploadAdapter ) {\n\t\t\t/**\n\t\t\t * You need to enable an upload adapter in order to be able to upload files.\n\t\t\t *\n\t\t\t * This warning shows up when {@link module:upload/filerepository~FileRepository} is being used\n\t\t\t * without {@link #createUploadAdapter definining an upload adapter}.\n\t\t\t *\n\t\t\t * **If you see this warning when using one of the {@glink builds/index CKEditor 5 Builds}**\n\t\t\t * it means that you did not configure any of the upload adapters available by default in those builds.\n\t\t\t *\n\t\t\t * See the {@glink features/image-upload/image-upload comprehensive \"Image upload overview\"} to learn which upload\n\t\t\t * adapters are available in the builds and how to configure them.\n\t\t\t *\n\t\t\t * **If you see this warning when using a custom build** there is a chance that you enabled\n\t\t\t * a feature like {@link module:image/imageupload~ImageUpload},\n\t\t\t * or {@link module:image/imageupload/imageuploadui~ImageUploadUI} but you did not enable any upload adapter.\n\t\t\t * You can choose one of the existing upload adapters listed in the\n\t\t\t * {@glink features/image-upload/image-upload \"Image upload overview\"}.\n\t\t\t *\n\t\t\t * You can also implement your {@glink framework/guides/deep-dive/upload-adapter own image upload adapter}.\n\t\t\t *\n\t\t\t * @error filerepository-no-upload-adapter\n\t\t\t */\n\t\t\tconsole.warn( attachLinkToDocumentation(\n\t\t\t\t'filerepository-no-upload-adapter: Upload adapter is not defined.'\n\t\t\t) );\n\n\t\t\treturn null;\n\t\t}\n\n\t\tconst loader = new FileLoader( Promise.resolve( fileOrPromise ), this.createUploadAdapter );\n\n\t\tthis.loaders.add( loader );\n\t\tthis._loadersMap.set( fileOrPromise, loader );\n\n\t\t// Store also file => loader mapping so loader can be retrieved by file instance returned upon Promise resolution.\n\t\tif ( fileOrPromise instanceof Promise ) {\n\t\t\tloader.file\n\t\t\t\t.then( file => {\n\t\t\t\t\tthis._loadersMap.set( file, loader );\n\t\t\t\t} )\n\t\t\t\t// Every then() must have a catch().\n\t\t\t\t// File loader state (and rejections) are handled in read() and upload().\n\t\t\t\t// Also, see the \"does not swallow the file promise rejection\" test.\n\t\t\t\t.catch( () => {} );\n\t\t}\n\n\t\tloader.on( 'change:uploaded', () => {\n\t\t\tlet aggregatedUploaded = 0;\n\n\t\t\tfor ( const loader of this.loaders ) {\n\t\t\t\taggregatedUploaded += loader.uploaded;\n\t\t\t}\n\n\t\t\tthis.uploaded = aggregatedUploaded;\n\t\t} );\n\n\t\tloader.on( 'change:uploadTotal', () => {\n\t\t\tlet aggregatedTotal = 0;\n\n\t\t\tfor ( const loader of this.loaders ) {\n\t\t\t\tif ( loader.uploadTotal ) {\n\t\t\t\t\taggregatedTotal += loader.uploadTotal;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.uploadTotal = aggregatedTotal;\n\t\t} );\n\n\t\treturn loader;\n\t}\n\n\t/**\n\t * Destroys the given loader.\n\t *\n\t * @param {File|Promise|module:upload/filerepository~FileLoader} fileOrPromiseOrLoader File or Promise associated\n\t * with that loader or loader itself.\n\t */\n\tdestroyLoader( fileOrPromiseOrLoader ) {\n\t\tconst loader = fileOrPromiseOrLoader instanceof FileLoader ? fileOrPromiseOrLoader : this.getLoader( fileOrPromiseOrLoader );\n\n\t\tloader._destroy();\n\n\t\tthis.loaders.remove( loader );\n\n\t\tthis._loadersMap.forEach( ( value, key ) => {\n\t\t\tif ( value === loader ) {\n\t\t\t\tthis._loadersMap.delete( key );\n\t\t\t}\n\t\t} );\n\t}\n\n\t/**\n\t * Registers or deregisters pending action bound with upload progress.\n\t *\n\t * @private\n\t */\n\t_updatePendingAction() {\n\t\tconst pendingActions = this.editor.plugins.get( PendingActions );\n\n\t\tif ( this.loaders.length ) {\n\t\t\tif ( !this._pendingAction ) {\n\t\t\t\tconst t = this.editor.t;\n\t\t\t\tconst getMessage = value => `${ t( 'Upload in progress' ) } ${ parseInt( value ) }%.`;\n\n\t\t\t\tthis._pendingAction = pendingActions.add( getMessage( this.uploadedPercent ) );\n\t\t\t\tthis._pendingAction.bind( 'message' ).to( this, 'uploadedPercent', getMessage );\n\t\t\t}\n\t\t} else {\n\t\t\tpendingActions.remove( this._pendingAction );\n\t\t\tthis._pendingAction = null;\n\t\t}\n\t}\n}\n\nmix( FileRepository, ObservableMixin );\n\n/**\n * File loader class.\n *\n * It is used to control the process of reading the file and uploading it using the specified upload adapter.\n */\nclass FileLoader {\n\t/**\n\t * Creates a new instance of `FileLoader`.\n\t *\n\t * @param {Promise.<File>} filePromise A promise which resolves to a file instance.\n\t * @param {Function} uploadAdapterCreator The function which returns {@link module:upload/filerepository~UploadAdapter} instance.\n\t */\n\tconstructor( filePromise, uploadAdapterCreator ) {\n\t\t/**\n\t\t * Unique id of FileLoader instance.\n\t\t *\n\t\t * @readonly\n\t\t * @member {Number}\n\t\t */\n\t\tthis.id = uid();\n\n\t\t/**\n\t\t * Additional wrapper over the initial file promise passed to this loader.\n\t\t *\n\t\t * @protected\n\t\t * @member {module:upload/filerepository~FilePromiseWrapper}\n\t\t */\n\t\tthis._filePromiseWrapper = this._createFilePromiseWrapper( filePromise );\n\n\t\t/**\n\t\t * Adapter instance associated with this file loader.\n\t\t *\n\t\t * @private\n\t\t * @member {module:upload/filerepository~UploadAdapter}\n\t\t */\n\t\tthis._adapter = uploadAdapterCreator( this );\n\n\t\t/**\n\t\t * FileReader used by FileLoader.\n\t\t *\n\t\t * @protected\n\t\t * @member {module:upload/filereader~FileReader}\n\t\t */\n\t\tthis._reader = new FileReader();\n\n\t\t/**\n\t\t * Current status of FileLoader. It can be one of the following:\n\t\t *\n\t\t * * 'idle',\n\t\t * * 'reading',\n\t\t * * 'uploading',\n\t\t * * 'aborted',\n\t\t * * 'error'.\n\t\t *\n\t\t * When reading status can change in a following way:\n\t\t *\n\t\t * `idle` -> `reading` -> `idle`\n\t\t * `idle` -> `reading -> `aborted`\n\t\t * `idle` -> `reading -> `error`\n\t\t *\n\t\t * When uploading status can change in a following way:\n\t\t *\n\t\t * `idle` -> `uploading` -> `idle`\n\t\t * `idle` -> `uploading` -> `aborted`\n\t\t * `idle` -> `uploading` -> `error`\n\t\t *\n\t\t * @readonly\n\t\t * @observable\n\t\t * @member {String} #status\n\t\t */\n\t\tthis.set( 'status', 'idle' );\n\n\t\t/**\n\t\t * Number of bytes uploaded.\n\t\t *\n\t\t * @readonly\n\t\t * @observable\n\t\t * @member {Number} #uploaded\n\t\t */\n\t\tthis.set( 'uploaded', 0 );\n\n\t\t/**\n\t\t * Number of total bytes to upload.\n\t\t *\n\t\t * @readonly\n\t\t * @observable\n\t\t * @member {Number|null} #uploadTotal\n\t\t */\n\t\tthis.set( 'uploadTotal', null );\n\n\t\t/**\n\t\t * Upload progress in percents.\n\t\t *\n\t\t * @readonly\n\t\t * @observable\n\t\t * @member {Number} #uploadedPercent\n\t\t */\n\t\tthis.bind( 'uploadedPercent' ).to( this, 'uploaded', this, 'uploadTotal', ( uploaded, total ) => {\n\t\t\treturn total ? ( uploaded / total * 100 ) : 0;\n\t\t} );\n\n\t\t/**\n\t\t * Response of the upload.\n\t\t *\n\t\t * @readonly\n\t\t * @observable\n\t\t * @member {Object|null} #uploadResponse\n\t\t */\n\t\tthis.set( 'uploadResponse', null );\n\t}\n\n\t/**\n\t * A `Promise` which resolves to a `File` instance associated with this file loader.\n\t *\n\t * @type {Promise.<File|null>}\n\t */\n\tget file() {\n\t\tif ( !this._filePromiseWrapper ) {\n\t\t\t// Loader was destroyed, return promise which resolves to null.\n\t\t\treturn Promise.resolve( null );\n\t\t} else {\n\t\t\t// The `this._filePromiseWrapper.promise` is chained and not simply returned to handle a case when:\n\t\t\t//\n\t\t\t//\t\t* The `loader.file.then( ... )` is called by external code (returned promise is pending).\n\t\t\t//\t\t* Then `loader._destroy()` is called (call is synchronous) which destroys the `loader`.\n\t\t\t//\t\t* Promise returned by the first `loader.file.then( ... )` call is resolved.\n\t\t\t//\n\t\t\t// Returning `this._filePromiseWrapper.promise` will still resolve to a `File` instance so there\n\t\t\t// is an additional check needed in the chain to see if `loader` was destroyed in the meantime.\n\t\t\treturn this._filePromiseWrapper.promise.then( file => this._filePromiseWrapper ? file : null );\n\t\t}\n\t}\n\n\t/**\n\t * Returns the file data. To read its data, you need for first load the file\n\t * by using the {@link module:upload/filerepository~FileLoader#read `read()`} method.\n\t *\n\t * @type {File|undefined}\n\t */\n\tget data() {\n\t\treturn this._reader.data;\n\t}\n\n\t/**\n\t * Reads file using {@link module:upload/filereader~FileReader}.\n\t *\n\t * Throws {@link module:utils/ckeditorerror~CKEditorError CKEditorError} `filerepository-read-wrong-status` when status\n\t * is different than `idle`.\n\t *\n\t * Example usage:\n\t *\n\t *\tfileLoader.read()\n\t *\t\t.then( data => { ... } )\n\t *\t\t.catch( err => {\n\t *\t\t\tif ( err === 'aborted' ) {\n\t *\t\t\t\tconsole.log( 'Reading aborted.' );\n\t *\t\t\t} else {\n\t *\t\t\t\tconsole.log( 'Reading error.', err );\n\t *\t\t\t}\n\t *\t\t} );\n\t *\n\t * @returns {Promise.<String>} Returns promise that will be resolved with read data. Promise will be rejected if error\n\t * occurs or if read process is aborted.\n\t */\n\tread() {\n\t\tif ( this.status != 'idle' ) {\n\t\t\tthrow new CKEditorError( 'filerepository-read-wrong-status: You cannot call read if the status is different than idle.', this );\n\t\t}\n\n\t\tthis.status = 'reading';\n\n\t\treturn this.file\n\t\t\t.then( file => this._reader.read( file ) )\n\t\t\t.then( data => {\n\t\t\t\t// Edge case: reader was aborted after file was read - double check for proper status.\n\t\t\t\tif ( this.status !== 'reading' ) {\n\t\t\t\t\tthrow this.status;\n\t\t\t\t}\n\n\t\t\t\tthis.status = 'idle';\n\n\t\t\t\treturn data;\n\t\t\t} )\n\t\t\t.catch( err => {\n\t\t\t\tif ( err === 'aborted' ) {\n\t\t\t\t\tthis.status = 'aborted';\n\t\t\t\t\tthrow 'aborted';\n\t\t\t\t}\n\n\t\t\t\tthis.status = 'error';\n\t\t\t\tthrow this._reader.error ? this._reader.error : err;\n\t\t\t} );\n\t}\n\n\t/**\n\t * Reads file using the provided {@link module:upload/filerepository~UploadAdapter}.\n\t *\n\t * Throws {@link module:utils/ckeditorerror~CKEditorError CKEditorError} `filerepository-upload-wrong-status` when status\n\t * is different than `idle`.\n\t * Example usage:\n\t *\n\t *\tfileLoader.upload()\n\t *\t\t.then( data => { ... } )\n\t *\t\t.catch( e => {\n\t *\t\t\tif ( e === 'aborted' ) {\n\t *\t\t\t\tconsole.log( 'Uploading aborted.' );\n\t *\t\t\t} else {\n\t *\t\t\t\tconsole.log( 'Uploading error.', e );\n\t *\t\t\t}\n\t *\t\t} );\n\t *\n\t * @returns {Promise.<Object>} Returns promise that will be resolved with response data. Promise will be rejected if error\n\t * occurs or if read process is aborted.\n\t */\n\tupload() {\n\t\tif ( this.status != 'idle' ) {\n\t\t\tthrow new CKEditorError(\n\t\t\t\t'filerepository-upload-wrong-status: You cannot call upload if the status is different than idle.',\n\t\t\t\tthis\n\t\t\t);\n\t\t}\n\n\t\tthis.status = 'uploading';\n\n\t\treturn this.file\n\t\t\t.then( () => this._adapter.upload() )\n\t\t\t.then( data => {\n\t\t\t\tthis.uploadResponse = data;\n\t\t\t\tthis.status = 'idle';\n\n\t\t\t\treturn data;\n\t\t\t} )\n\t\t\t.catch( err => {\n\t\t\t\tif ( this.status === 'aborted' ) {\n\t\t\t\t\tthrow 'aborted';\n\t\t\t\t}\n\n\t\t\t\tthis.status = 'error';\n\t\t\t\tthrow err;\n\t\t\t} );\n\t}\n\n\t/**\n\t * Aborts loading process.\n\t */\n\tabort() {\n\t\tconst status = this.status;\n\t\tthis.status = 'aborted';\n\n\t\tif ( !this._filePromiseWrapper.isFulfilled ) {\n\t\t\t// Edge case: file loader is aborted before read() is called\n\t\t\t// so it might happen that no one handled the rejection of this promise.\n\t\t\t// See https://github.com/ckeditor/ckeditor5-upload/pull/100\n\t\t\tthis._filePromiseWrapper.promise.catch( () => {} );\n\n\t\t\tthis._filePromiseWrapper.rejecter( 'aborted' );\n\t\t} else if ( status == 'reading' ) {\n\t\t\tthis._reader.abort();\n\t\t} else if ( status == 'uploading' && this._adapter.abort ) {\n\t\t\tthis._adapter.abort();\n\t\t}\n\n\t\tthis._destroy();\n\t}\n\n\t/**\n\t * Performs cleanup.\n\t *\n\t * @private\n\t */\n\t_destroy() {\n\t\tthis._filePromiseWrapper = undefined;\n\t\tthis._reader = undefined;\n\t\tthis._adapter = undefined;\n\t\tthis.uploadResponse = undefined;\n\t}\n\n\t/**\n\t * Wraps a given file promise into another promise giving additional\n\t * control (resolving, rejecting, checking if fulfilled) over it.\n\t *\n\t * @private\n\t * @param filePromise The initial file promise to be wrapped.\n\t * @returns {module:upload/filerepository~FilePromiseWrapper}\n\t */\n\t_createFilePromiseWrapper( filePromise ) {\n\t\tconst wrapper = {};\n\n\t\twrapper.promise = new Promise( ( resolve, reject ) => {\n\t\t\twrapper.rejecter = reject;\n\t\t\twrapper.isFulfilled = false;\n\n\t\t\tfilePromise\n\t\t\t\t.then( file => {\n\t\t\t\t\twrapper.isFulfilled = true;\n\t\t\t\t\tresolve( file );\n\t\t\t\t} )\n\t\t\t\t.catch( err => {\n\t\t\t\t\twrapper.isFulfilled = true;\n\t\t\t\t\treject( err );\n\t\t\t\t} );\n\t\t} );\n\n\t\treturn wrapper;\n\t}\n}\n\nmix( FileLoader, ObservableMixin );\n\n/**\n * Upload adapter interface used by the {@link module:upload/filerepository~FileRepository file repository}\n * to handle file upload. An upload adapter is a bridge between the editor and server that handles file uploads.\n * It should contain a logic necessary to initiate an upload process and monitor its progress.\n *\n * Learn how to develop your own upload adapter for CKEditor 5 in the\n * {@glink framework/guides/deep-dive/upload-adapter \"Custom upload adapter\" guide}.\n *\n * @interface UploadAdapter\n */\n\n/**\n * Executes the upload process.\n * This method should return a promise that will resolve when data will be uploaded to server. Promise should be\n * resolved with an object containing information about uploaded file:\n *\n *\t\t{\n *\t\t\tdefault: 'http://server/default-size.image.png'\n *\t\t}\n *\n * Additionally, other image sizes can be provided:\n *\n *\t\t{\n *\t\t\tdefault: 'http://server/default-size.image.png',\n *\t\t\t'160': 'http://server/size-160.image.png',\n *\t\t\t'500': 'http://server/size-500.image.png',\n *\t\t\t'1000': 'http://server/size-1000.image.png',\n *\t\t\t'1052': 'http://server/default-size.image.png'\n *\t\t}\n *\n * NOTE: When returning multiple images, the widest returned one should equal the default one. It is essential to\n * correctly set `width` attribute of the image. See this discussion:\n * https://github.com/ckeditor/ckeditor5-easy-image/issues/4 for more information.\n *\n * Take a look at {@link module:upload/filerepository~UploadAdapter example Adapter implementation} and\n * {@link module:upload/filerepository~FileRepository#createUploadAdapter createUploadAdapter method}.\n *\n * @method module:upload/filerepository~UploadAdapter#upload\n * @returns {Promise.<Object>} Promise that should be resolved when data is uploaded.\n */\n\n/**\n * Aborts the upload process.\n * After aborting it should reject promise returned from {@link #upload upload()}.\n *\n * Take a look at {@link module:upload/filerepository~UploadAdapter example Adapter implementation} and\n * {@link module:upload/filerepository~FileRepository#createUploadAdapter createUploadAdapter method}.\n *\n * @method module:upload/filerepository~UploadAdapter#abort\n */\n\n/**\n * Object returned by {@link module:upload/filerepository~FileLoader#_createFilePromiseWrapper} method\n * to add more control over the initial file promise passed to {@link module:upload/filerepository~FileLoader}.\n *\n * @protected\n * @typedef {Object} module:upload/filerepository~FilePromiseWrapper\n * @property {Promise.<File>} promise Wrapper promise which can be chained for further processing.\n * @property {Function} rejecter Rejects the promise when called.\n * @property {Boolean} isFulfilled Whether original promise is already fulfilled.\n */\n"]}]}
{"remainingRequest":"/Users/antonyching/Desktop/project/new-builder-demo/node_modules/babel-loader/lib/index.js!/Users/antonyching/Desktop/project/new-builder-demo/node_modules/@ckeditor/ckeditor5-engine/src/view/element.js","dependencies":[{"path":"/Users/antonyching/Desktop/project/new-builder-demo/node_modules/@ckeditor/ckeditor5-engine/src/view/element.js","mtime":499162500000},{"path":"/Users/antonyching/Desktop/project/new-builder-demo/node_modules/@ckeditor/ckeditor5-dev-webpack-plugin/lib/translatesourceloader.js","mtime":499162500000},{"path":"/Users/antonyching/Desktop/project/new-builder-demo/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/antonyching/Desktop/project/new-builder-demo/node_modules/babel-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:LyoqCiAqIEBsaWNlbnNlIENvcHlyaWdodCAoYykgMjAwMy0yMDE5LCBDS1NvdXJjZSAtIEZyZWRlcmljbyBLbmFiYmVuLiBBbGwgcmlnaHRzIHJlc2VydmVkLgogKiBGb3IgbGljZW5zaW5nLCBzZWUgTElDRU5TRS5tZCBvciBodHRwczovL2NrZWRpdG9yLmNvbS9sZWdhbC9ja2VkaXRvci1vc3MtbGljZW5zZQogKi8KCi8qKgogKiBAbW9kdWxlIGVuZ2luZS92aWV3L2VsZW1lbnQKICovCmltcG9ydCBOb2RlIGZyb20gJy4vbm9kZSc7CmltcG9ydCBUZXh0IGZyb20gJy4vdGV4dCc7CmltcG9ydCBUZXh0UHJveHkgZnJvbSAnLi90ZXh0cHJveHknOwppbXBvcnQgb2JqZWN0VG9NYXAgZnJvbSAnQGNrZWRpdG9yL2NrZWRpdG9yNS11dGlscy9zcmMvb2JqZWN0dG9tYXAnOwppbXBvcnQgaXNJdGVyYWJsZSBmcm9tICdAY2tlZGl0b3IvY2tlZGl0b3I1LXV0aWxzL3NyYy9pc2l0ZXJhYmxlJzsKaW1wb3J0IE1hdGNoZXIgZnJvbSAnLi9tYXRjaGVyJzsKaW1wb3J0IHsgaXNQbGFpbk9iamVjdCB9IGZyb20gJ2xvZGFzaC1lcyc7IC8vIEBpZiBDS19ERUJVR19FTkdJTkUgLy8gY29uc3QgeyBjb252ZXJ0TWFwVG9UYWdzIH0gPSByZXF1aXJlKCAnLi4vZGV2LXV0aWxzL3V0aWxzJyApOwoKLyoqCiAqIFZpZXcgZWxlbWVudC4KICoKICogVGhlIGVkaXRpbmcgZW5naW5lIGRvZXMgbm90IGRlZmluZSBhIGZpeGVkIHNlbWFudGljcyBvZiBpdHMgZWxlbWVudHMgKGl0IGlzICJEVEQtZnJlZSIpLgogKiBUaGlzIGlzIHdoeSB0aGUgdHlwZSBvZiB0aGUge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9lbGVtZW50fkVsZW1lbnR9IG5lZWQgdG8KICogYmUgZGVmaW5lZCBieSB0aGUgZmVhdHVyZSBkZXZlbG9wZXIuIFdoZW4gY3JlYXRpbmcgYW4gZWxlbWVudCB5b3Ugc2hvdWxkIHVzZSBvbmUgb2YgdGhlIGZvbGxvd2luZyBtZXRob2RzOgogKgogKiAqIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvZG93bmNhc3R3cml0ZXJ+RG93bmNhc3RXcml0ZXIjY3JlYXRlQ29udGFpbmVyRWxlbWVudCBgZG93bmNhc3RXcml0ZXIjY3JlYXRlQ29udGFpbmVyRWxlbWVudCgpYH0KICogaW4gb3JkZXIgdG8gY3JlYXRlIGEge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9jb250YWluZXJlbGVtZW50fkNvbnRhaW5lckVsZW1lbnR9LAogKiAqIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvZG93bmNhc3R3cml0ZXJ+RG93bmNhc3RXcml0ZXIjY3JlYXRlQXR0cmlidXRlRWxlbWVudCBgZG93bmNhc3RXcml0ZXIjY3JlYXRlQXR0cmlidXRlRWxlbWVudCgpYH0KICogaW4gb3JkZXIgdG8gY3JlYXRlIGEge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9hdHRyaWJ1dGVlbGVtZW50fkF0dHJpYnV0ZUVsZW1lbnR9LAogKiAqIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvZG93bmNhc3R3cml0ZXJ+RG93bmNhc3RXcml0ZXIjY3JlYXRlRW1wdHlFbGVtZW50IGBkb3duY2FzdFdyaXRlciNjcmVhdGVFbXB0eUVsZW1lbnQoKWB9CiAqIGluIG9yZGVyIHRvIGNyZWF0ZSBhIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvZW1wdHllbGVtZW50fkVtcHR5RWxlbWVudH0uCiAqICoge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9kb3duY2FzdHdyaXRlcn5Eb3duY2FzdFdyaXRlciNjcmVhdGVVSUVsZW1lbnQgYGRvd25jYXN0V3JpdGVyI2NyZWF0ZVVJRWxlbWVudCgpYH0KICogaW4gb3JkZXIgdG8gY3JlYXRlIGEge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy91aWVsZW1lbnR+VUlFbGVtZW50fS4KICogKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2Rvd25jYXN0d3JpdGVyfkRvd25jYXN0V3JpdGVyI2NyZWF0ZUVkaXRhYmxlRWxlbWVudCBgZG93bmNhc3RXcml0ZXIjY3JlYXRlRWRpdGFibGVFbGVtZW50KClgfQogKiBpbiBvcmRlciB0byBjcmVhdGUgYSB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2VkaXRhYmxlZWxlbWVudH5FZGl0YWJsZUVsZW1lbnR9LgogKgogKiBOb3RlIHRoYXQgZm9yIHZpZXcgZWxlbWVudHMgd2hpY2ggYXJlIG5vdCBjcmVhdGVkIGZyb20gdGhlIG1vZGVsLCBsaWtlIGVsZW1lbnRzIGZyb20gbXV0YXRpb25zLCBwYXN0ZSBvcgogKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS9jb250cm9sbGVyL2RhdGFjb250cm9sbGVyfkRhdGFDb250cm9sbGVyI3NldCBkYXRhLnNldH0gaXQgaXMgbm90IHBvc3NpYmxlIHRvIGRlZmluZSB0aGUgdHlwZSBvZiB0aGUgZWxlbWVudC4KICogSW4gc3VjaCBjYXNlcyB0aGUge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy91cGNhc3R3cml0ZXJ+VXBjYXN0V3JpdGVyI2NyZWF0ZUVsZW1lbnQgYFVwY2FzdFdyaXRlciNjcmVhdGVFbGVtZW50KClgfSBtZXRob2QKICogc2hvdWxkIGJlIHVzZWQgdG8gY3JlYXRlIGdlbmVyaWMgdmlldyBlbGVtZW50cy4KICoKICogQGV4dGVuZHMgbW9kdWxlOmVuZ2luZS92aWV3L25vZGV+Tm9kZQogKi8KCmV4cG9ydCBkZWZhdWx0IGNsYXNzIEVsZW1lbnQgZXh0ZW5kcyBOb2RlIHsKICAvKioKICAgKiBDcmVhdGVzIGEgdmlldyBlbGVtZW50LgogICAqCiAgICogQXR0cmlidXRlcyBjYW4gYmUgcGFzc2VkIGluIHZhcmlvdXMgZm9ybWF0czoKICAgKgogICAqCQluZXcgRWxlbWVudCggJ2RpdicsIHsgY2xhc3M6ICdlZGl0b3InLCBjb250ZW50RWRpdGFibGU6ICd0cnVlJyB9ICk7IC8vIG9iamVjdAogICAqCQluZXcgRWxlbWVudCggJ2RpdicsIFsgWyAnY2xhc3MnLCAnZWRpdG9yJyBdLCBbICdjb250ZW50RWRpdGFibGUnLCAndHJ1ZScgXSBdICk7IC8vIG1hcC1saWtlIGl0ZXJhdG9yCiAgICoJCW5ldyBFbGVtZW50KCAnZGl2JywgbWFwT2ZBdHRyaWJ1dGVzICk7IC8vIG1hcAogICAqCiAgICogQHByb3RlY3RlZAogICAqIEBwYXJhbSB7U3RyaW5nfSBuYW1lIE5vZGUgbmFtZS4KICAgKiBAcGFyYW0ge09iamVjdHxJdGVyYWJsZX0gW2F0dHJzXSBDb2xsZWN0aW9uIG9mIGF0dHJpYnV0ZXMuCiAgICogQHBhcmFtIHttb2R1bGU6ZW5naW5lL3ZpZXcvbm9kZX5Ob2RlfEl0ZXJhYmxlLjxtb2R1bGU6ZW5naW5lL3ZpZXcvbm9kZX5Ob2RlPn0gW2NoaWxkcmVuXQogICAqIEEgbGlzdCBvZiBub2RlcyB0byBiZSBpbnNlcnRlZCBpbnRvIGNyZWF0ZWQgZWxlbWVudC4KICAgKi8KICBjb25zdHJ1Y3RvcihuYW1lLCBhdHRycywgY2hpbGRyZW4pIHsKICAgIHN1cGVyKCk7CiAgICAvKioKICAgICAqIE5hbWUgb2YgdGhlIGVsZW1lbnQuCiAgICAgKgogICAgICogQHJlYWRvbmx5CiAgICAgKiBAbWVtYmVyIHtTdHJpbmd9CiAgICAgKi8KCiAgICB0aGlzLm5hbWUgPSBuYW1lOwogICAgLyoqCiAgICAgKiBNYXAgb2YgYXR0cmlidXRlcywgd2hlcmUgYXR0cmlidXRlcyBuYW1lcyBhcmUga2V5cyBhbmQgYXR0cmlidXRlcyB2YWx1ZXMgYXJlIHZhbHVlcy4KICAgICAqCiAgICAgKiBAcHJvdGVjdGVkCiAgICAgKiBAbWVtYmVyIHtNYXB9ICNfYXR0cnMKICAgICAqLwoKICAgIHRoaXMuX2F0dHJzID0gcGFyc2VBdHRyaWJ1dGVzKGF0dHJzKTsKICAgIC8qKgogICAgICogQXJyYXkgb2YgY2hpbGQgbm9kZXMuCiAgICAgKgogICAgICogQHByb3RlY3RlZAogICAgICogQG1lbWJlciB7QXJyYXkuPG1vZHVsZTplbmdpbmUvdmlldy9ub2Rlfk5vZGU+fQogICAgICovCgogICAgdGhpcy5fY2hpbGRyZW4gPSBbXTsKCiAgICBpZiAoY2hpbGRyZW4pIHsKICAgICAgdGhpcy5faW5zZXJ0Q2hpbGQoMCwgY2hpbGRyZW4pOwogICAgfQogICAgLyoqCiAgICAgKiBTZXQgb2YgY2xhc3NlcyBhc3NvY2lhdGVkIHdpdGggZWxlbWVudCBpbnN0YW5jZS4KICAgICAqCiAgICAgKiBAcHJvdGVjdGVkCiAgICAgKiBAbWVtYmVyIHtTZXR9CiAgICAgKi8KCgogICAgdGhpcy5fY2xhc3NlcyA9IG5ldyBTZXQoKTsKCiAgICBpZiAodGhpcy5fYXR0cnMuaGFzKCdjbGFzcycpKSB7CiAgICAgIC8vIFJlbW92ZSBjbGFzcyBhdHRyaWJ1dGUgYW5kIGhhbmRsZSBpdCBieSBjbGFzcyBzZXQuCiAgICAgIGNvbnN0IGNsYXNzU3RyaW5nID0gdGhpcy5fYXR0cnMuZ2V0KCdjbGFzcycpOwoKICAgICAgcGFyc2VDbGFzc2VzKHRoaXMuX2NsYXNzZXMsIGNsYXNzU3RyaW5nKTsKCiAgICAgIHRoaXMuX2F0dHJzLmRlbGV0ZSgnY2xhc3MnKTsKICAgIH0KICAgIC8qKgogICAgICogTWFwIG9mIHN0eWxlcy4KICAgICAqCiAgICAgKiBAcHJvdGVjdGVkCiAgICAgKiBAbWVtYmVyIHtNYXB9IG1vZHVsZTplbmdpbmUvdmlldy9lbGVtZW50fkVsZW1lbnQjX3N0eWxlcwogICAgICovCgoKICAgIHRoaXMuX3N0eWxlcyA9IG5ldyBNYXAoKTsKCiAgICBpZiAodGhpcy5fYXR0cnMuaGFzKCdzdHlsZScpKSB7CiAgICAgIC8vIFJlbW92ZSBzdHlsZSBhdHRyaWJ1dGUgYW5kIGhhbmRsZSBpdCBieSBzdHlsZXMgbWFwLgogICAgICBwYXJzZUlubGluZVN0eWxlcyh0aGlzLl9zdHlsZXMsIHRoaXMuX2F0dHJzLmdldCgnc3R5bGUnKSk7CgogICAgICB0aGlzLl9hdHRycy5kZWxldGUoJ3N0eWxlJyk7CiAgICB9CiAgICAvKioKICAgICAqIE1hcCBvZiBjdXN0b20gcHJvcGVydGllcy4KICAgICAqIEN1c3RvbSBwcm9wZXJ0aWVzIGNhbiBiZSBhZGRlZCB0byBlbGVtZW50IGluc3RhbmNlLCB3aWxsIGJlIGNsb25lZCBidXQgbm90IHJlbmRlcmVkIGludG8gRE9NLgogICAgICoKICAgICAqIEBwcm90ZWN0ZWQKICAgICAqIEBtZW1iZXIge01hcH0KICAgICAqLwoKCiAgICB0aGlzLl9jdXN0b21Qcm9wZXJ0aWVzID0gbmV3IE1hcCgpOwogIH0KICAvKioKICAgKiBOdW1iZXIgb2YgZWxlbWVudCdzIGNoaWxkcmVuLgogICAqCiAgICogQHJlYWRvbmx5CiAgICogQHR5cGUge051bWJlcn0KICAgKi8KCgogIGdldCBjaGlsZENvdW50KCkgewogICAgcmV0dXJuIHRoaXMuX2NoaWxkcmVuLmxlbmd0aDsKICB9CiAgLyoqCiAgICogSXMgYHRydWVgIGlmIHRoZXJlIGFyZSBubyBub2RlcyBpbnNpZGUgdGhpcyBlbGVtZW50LCBgZmFsc2VgIG90aGVyd2lzZS4KICAgKgogICAqIEByZWFkb25seQogICAqIEB0eXBlIHtCb29sZWFufQogICAqLwoKCiAgZ2V0IGlzRW1wdHkoKSB7CiAgICByZXR1cm4gdGhpcy5fY2hpbGRyZW4ubGVuZ3RoID09PSAwOwogIH0KICAvKioKICAgKiBDaGVja3Mgd2hldGhlciB0aGlzIG9iamVjdCBpcyBvZiB0aGUgZ2l2ZW4uCiAgICoKICAgKgkJZWxlbWVudC5pcyggJ2VsZW1lbnQnICk7IC8vIC0+IHRydWUKICAgKgkJZWxlbWVudC5pcyggJ25vZGUnICk7IC8vIC0+IHRydWUKICAgKgkJZWxlbWVudC5pcyggJ3ZpZXc6ZWxlbWVudCcgKTsgLy8gLT4gdHJ1ZQogICAqCQllbGVtZW50LmlzKCAndmlldzpub2RlJyApOyAvLyAtPiB0cnVlCiAgICoKICAgKgkJZWxlbWVudC5pcyggJ21vZGVsOmVsZW1lbnQnICk7IC8vIC0+IGZhbHNlCiAgICoJCWVsZW1lbnQuaXMoICdkb2N1bWVudFNlbGVjdGlvbicgKTsgLy8gLT4gZmFsc2UKICAgKgogICAqIEFzc3VtaW5nIHRoYXQgdGhlIG9iamVjdCBiZWluZyBjaGVja2VkIGlzIGFuIGVsZW1lbnQsIHlvdSBjYW4gYWxzbyBjaGVjayBpdHMKICAgKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2VsZW1lbnR+RWxlbWVudCNuYW1lIG5hbWV9OgogICAqCiAgICoJCWVsZW1lbnQuaXMoICdpbWcnICk7IC8vIC0+IHRydWUgaWYgdGhpcyBpcyBhbiA8aW1nPiBlbGVtZW50CiAgICoJCWVsZW1lbnQuaXMoICdlbGVtZW50JywgJ2ltZycgKTsgLy8gLT4gc2FtZSBhcyBhYm92ZQogICAqCQl0ZXh0LmlzKCAnaW1nJyApOyAtPiBmYWxzZQogICAqCiAgICoge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9ub2Rlfk5vZGUjaXMgQ2hlY2sgdGhlIGVudGlyZSBsaXN0IG9mIHZpZXcgb2JqZWN0c30gd2hpY2ggaW1wbGVtZW50IHRoZSBgaXMoKWAgbWV0aG9kLgogICAqCiAgICogQHBhcmFtIHtTdHJpbmd9IHR5cGUgVHlwZSB0byBjaGVjayB3aGVuIGBuYW1lYCBwYXJhbWV0ZXIgaXMgcHJlc2VudC4KICAgKiBPdGhlcndpc2UsIGl0IGFjdHMgbGlrZSB0aGUgYG5hbWVgIHBhcmFtZXRlci4KICAgKiBAcGFyYW0ge1N0cmluZ30gW25hbWVdIEVsZW1lbnQgbmFtZS4KICAgKiBAcmV0dXJucyB7Qm9vbGVhbn0KICAgKi8KCgogIGlzKHR5cGUsIG5hbWUgPSBudWxsKSB7CiAgICBjb25zdCBjdXRUeXBlID0gdHlwZS5yZXBsYWNlKC9edmlldzovLCAnJyk7CgogICAgaWYgKCFuYW1lKSB7CiAgICAgIHJldHVybiBjdXRUeXBlID09ICdlbGVtZW50JyB8fCBjdXRUeXBlID09IHRoaXMubmFtZSB8fCBzdXBlci5pcyh0eXBlKTsKICAgIH0gZWxzZSB7CiAgICAgIHJldHVybiBjdXRUeXBlID09ICdlbGVtZW50JyAmJiBuYW1lID09IHRoaXMubmFtZTsKICAgIH0KICB9CiAgLyoqCiAgICogR2V0cyBjaGlsZCBhdCB0aGUgZ2l2ZW4gaW5kZXguCiAgICoKICAgKiBAcGFyYW0ge051bWJlcn0gaW5kZXggSW5kZXggb2YgY2hpbGQuCiAgICogQHJldHVybnMge21vZHVsZTplbmdpbmUvdmlldy9ub2Rlfk5vZGV9IENoaWxkIG5vZGUuCiAgICovCgoKICBnZXRDaGlsZChpbmRleCkgewogICAgcmV0dXJuIHRoaXMuX2NoaWxkcmVuW2luZGV4XTsKICB9CiAgLyoqCiAgICogR2V0cyBpbmRleCBvZiB0aGUgZ2l2ZW4gY2hpbGQgbm9kZS4gUmV0dXJucyBgLTFgIGlmIGNoaWxkIG5vZGUgaXMgbm90IGZvdW5kLgogICAqCiAgICogQHBhcmFtIHttb2R1bGU6ZW5naW5lL3ZpZXcvbm9kZX5Ob2RlfSBub2RlIENoaWxkIG5vZGUuCiAgICogQHJldHVybnMge051bWJlcn0gSW5kZXggb2YgdGhlIGNoaWxkIG5vZGUuCiAgICovCgoKICBnZXRDaGlsZEluZGV4KG5vZGUpIHsKICAgIHJldHVybiB0aGlzLl9jaGlsZHJlbi5pbmRleE9mKG5vZGUpOwogIH0KICAvKioKICAgKiBHZXRzIGNoaWxkIG5vZGVzIGl0ZXJhdG9yLgogICAqCiAgICogQHJldHVybnMge0l0ZXJhYmxlLjxtb2R1bGU6ZW5naW5lL3ZpZXcvbm9kZX5Ob2RlPn0gQ2hpbGQgbm9kZXMgaXRlcmF0b3IuCiAgICovCgoKICBnZXRDaGlsZHJlbigpIHsKICAgIHJldHVybiB0aGlzLl9jaGlsZHJlbltTeW1ib2wuaXRlcmF0b3JdKCk7CiAgfQogIC8qKgogICAqIFJldHVybnMgYW4gaXRlcmF0b3IgdGhhdCBjb250YWlucyB0aGUga2V5cyBmb3IgYXR0cmlidXRlcy4gT3JkZXIgb2YgaW5zZXJ0aW5nIGF0dHJpYnV0ZXMgaXMgbm90IHByZXNlcnZlZC4KICAgKgogICAqIEByZXR1cm5zIHtJdGVyYWJsZS48U3RyaW5nPn0gS2V5cyBmb3IgYXR0cmlidXRlcy4KICAgKi8KCgogICpnZXRBdHRyaWJ1dGVLZXlzKCkgewogICAgaWYgKHRoaXMuX2NsYXNzZXMuc2l6ZSA+IDApIHsKICAgICAgeWllbGQgJ2NsYXNzJzsKICAgIH0KCiAgICBpZiAodGhpcy5fc3R5bGVzLnNpemUgPiAwKSB7CiAgICAgIHlpZWxkICdzdHlsZSc7CiAgICB9CgogICAgeWllbGQqIHRoaXMuX2F0dHJzLmtleXMoKTsKICB9CiAgLyoqCiAgICogUmV0dXJucyBpdGVyYXRvciB0aGF0IGl0ZXJhdGVzIG92ZXIgdGhpcyBlbGVtZW50J3MgYXR0cmlidXRlcy4KICAgKgogICAqIEF0dHJpYnV0ZXMgYXJlIHJldHVybmVkIGFzIGFycmF5cyBjb250YWluaW5nIHR3byBpdGVtcy4gRmlyc3Qgb25lIGlzIGF0dHJpYnV0ZSBrZXkgYW5kIHNlY29uZCBpcyBhdHRyaWJ1dGUgdmFsdWUuCiAgICogVGhpcyBmb3JtYXQgaXMgYWNjZXB0ZWQgYnkgbmF0aXZlIGBNYXBgIG9iamVjdCBhbmQgYWxzbyBjYW4gYmUgcGFzc2VkIGluIGBOb2RlYCBjb25zdHJ1Y3Rvci4KICAgKgogICAqIEByZXR1cm5zIHtJdGVyYWJsZS48Kj59CiAgICovCgoKICAqZ2V0QXR0cmlidXRlcygpIHsKICAgIHlpZWxkKiB0aGlzLl9hdHRycy5lbnRyaWVzKCk7CgogICAgaWYgKHRoaXMuX2NsYXNzZXMuc2l6ZSA+IDApIHsKICAgICAgeWllbGQgWydjbGFzcycsIHRoaXMuZ2V0QXR0cmlidXRlKCdjbGFzcycpXTsKICAgIH0KCiAgICBpZiAodGhpcy5fc3R5bGVzLnNpemUgPiAwKSB7CiAgICAgIHlpZWxkIFsnc3R5bGUnLCB0aGlzLmdldEF0dHJpYnV0ZSgnc3R5bGUnKV07CiAgICB9CiAgfQogIC8qKgogICAqIEdldHMgYXR0cmlidXRlIGJ5IGtleS4gSWYgYXR0cmlidXRlIGlzIG5vdCBwcmVzZW50IC0gcmV0dXJucyB1bmRlZmluZWQuCiAgICoKICAgKiBAcGFyYW0ge1N0cmluZ30ga2V5IEF0dHJpYnV0ZSBrZXkuCiAgICogQHJldHVybnMge1N0cmluZ3x1bmRlZmluZWR9IEF0dHJpYnV0ZSB2YWx1ZS4KICAgKi8KCgogIGdldEF0dHJpYnV0ZShrZXkpIHsKICAgIGlmIChrZXkgPT0gJ2NsYXNzJykgewogICAgICBpZiAodGhpcy5fY2xhc3Nlcy5zaXplID4gMCkgewogICAgICAgIHJldHVybiBbLi4udGhpcy5fY2xhc3Nlc10uam9pbignICcpOwogICAgICB9CgogICAgICByZXR1cm4gdW5kZWZpbmVkOwogICAgfQoKICAgIGlmIChrZXkgPT0gJ3N0eWxlJykgewogICAgICBpZiAodGhpcy5fc3R5bGVzLnNpemUgPiAwKSB7CiAgICAgICAgbGV0IHN0eWxlU3RyaW5nID0gJyc7CgogICAgICAgIGZvciAoY29uc3QgW3Byb3BlcnR5LCB2YWx1ZV0gb2YgdGhpcy5fc3R5bGVzKSB7CiAgICAgICAgICBzdHlsZVN0cmluZyArPSBgJHtwcm9wZXJ0eX06JHt2YWx1ZX07YDsKICAgICAgICB9CgogICAgICAgIHJldHVybiBzdHlsZVN0cmluZzsKICAgICAgfQoKICAgICAgcmV0dXJuIHVuZGVmaW5lZDsKICAgIH0KCiAgICByZXR1cm4gdGhpcy5fYXR0cnMuZ2V0KGtleSk7CiAgfQogIC8qKgogICAqIFJldHVybnMgYSBib29sZWFuIGluZGljYXRpbmcgd2hldGhlciBhbiBhdHRyaWJ1dGUgd2l0aCB0aGUgc3BlY2lmaWVkIGtleSBleGlzdHMgaW4gdGhlIGVsZW1lbnQuCiAgICoKICAgKiBAcGFyYW0ge1N0cmluZ30ga2V5IEF0dHJpYnV0ZSBrZXkuCiAgICogQHJldHVybnMge0Jvb2xlYW59IGB0cnVlYCBpZiBhdHRyaWJ1dGUgd2l0aCB0aGUgc3BlY2lmaWVkIGtleSBleGlzdHMgaW4gdGhlIGVsZW1lbnQsIGZhbHNlIG90aGVyd2lzZS4KICAgKi8KCgogIGhhc0F0dHJpYnV0ZShrZXkpIHsKICAgIGlmIChrZXkgPT0gJ2NsYXNzJykgewogICAgICByZXR1cm4gdGhpcy5fY2xhc3Nlcy5zaXplID4gMDsKICAgIH0KCiAgICBpZiAoa2V5ID09ICdzdHlsZScpIHsKICAgICAgcmV0dXJuIHRoaXMuX3N0eWxlcy5zaXplID4gMDsKICAgIH0KCiAgICByZXR1cm4gdGhpcy5fYXR0cnMuaGFzKGtleSk7CiAgfQogIC8qKgogICAqIENoZWNrcyBpZiB0aGlzIGVsZW1lbnQgaXMgc2ltaWxhciB0byBvdGhlciBlbGVtZW50LgogICAqIEJvdGggZWxlbWVudHMgc2hvdWxkIGhhdmUgdGhlIHNhbWUgbmFtZSBhbmQgYXR0cmlidXRlcyB0byBiZSBjb25zaWRlcmVkIGFzIHNpbWlsYXIuIFR3byBzaW1pbGFyIGVsZW1lbnRzCiAgICogY2FuIGNvbnRhaW4gZGlmZmVyZW50IHNldCBvZiBjaGlsZHJlbiBub2Rlcy4KICAgKgogICAqIEBwYXJhbSB7bW9kdWxlOmVuZ2luZS92aWV3L2VsZW1lbnR+RWxlbWVudH0gb3RoZXJFbGVtZW50CiAgICogQHJldHVybnMge0Jvb2xlYW59CiAgICovCgoKICBpc1NpbWlsYXIob3RoZXJFbGVtZW50KSB7CiAgICBpZiAoIShvdGhlckVsZW1lbnQgaW5zdGFuY2VvZiBFbGVtZW50KSkgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9IC8vIElmIGV4YWN0bHkgdGhlIHNhbWUgRWxlbWVudCBpcyBwcm92aWRlZCAtIHJldHVybiB0cnVlIGltbWVkaWF0ZWx5LgoKCiAgICBpZiAodGhpcyA9PT0gb3RoZXJFbGVtZW50KSB7CiAgICAgIHJldHVybiB0cnVlOwogICAgfSAvLyBDaGVjayBlbGVtZW50IG5hbWUuCgoKICAgIGlmICh0aGlzLm5hbWUgIT0gb3RoZXJFbGVtZW50Lm5hbWUpIHsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfSAvLyBDaGVjayBudW1iZXIgb2YgYXR0cmlidXRlcywgY2xhc3NlcyBhbmQgc3R5bGVzLgoKCiAgICBpZiAodGhpcy5fYXR0cnMuc2l6ZSAhPT0gb3RoZXJFbGVtZW50Ll9hdHRycy5zaXplIHx8IHRoaXMuX2NsYXNzZXMuc2l6ZSAhPT0gb3RoZXJFbGVtZW50Ll9jbGFzc2VzLnNpemUgfHwgdGhpcy5fc3R5bGVzLnNpemUgIT09IG90aGVyRWxlbWVudC5fc3R5bGVzLnNpemUpIHsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfSAvLyBDaGVjayBpZiBhdHRyaWJ1dGVzIGFyZSB0aGUgc2FtZS4KCgogICAgZm9yIChjb25zdCBba2V5LCB2YWx1ZV0gb2YgdGhpcy5fYXR0cnMpIHsKICAgICAgaWYgKCFvdGhlckVsZW1lbnQuX2F0dHJzLmhhcyhrZXkpIHx8IG90aGVyRWxlbWVudC5fYXR0cnMuZ2V0KGtleSkgIT09IHZhbHVlKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CiAgICB9IC8vIENoZWNrIGlmIGNsYXNzZXMgYXJlIHRoZSBzYW1lLgoKCiAgICBmb3IgKGNvbnN0IGNsYXNzTmFtZSBvZiB0aGlzLl9jbGFzc2VzKSB7CiAgICAgIGlmICghb3RoZXJFbGVtZW50Ll9jbGFzc2VzLmhhcyhjbGFzc05hbWUpKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CiAgICB9IC8vIENoZWNrIGlmIHN0eWxlcyBhcmUgdGhlIHNhbWUuCgoKICAgIGZvciAoY29uc3QgW3Byb3BlcnR5LCB2YWx1ZV0gb2YgdGhpcy5fc3R5bGVzKSB7CiAgICAgIGlmICghb3RoZXJFbGVtZW50Ll9zdHlsZXMuaGFzKHByb3BlcnR5KSB8fCBvdGhlckVsZW1lbnQuX3N0eWxlcy5nZXQocHJvcGVydHkpICE9PSB2YWx1ZSkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgfQoKICAgIHJldHVybiB0cnVlOwogIH0KICAvKioKICAgKiBSZXR1cm5zIHRydWUgaWYgY2xhc3MgaXMgcHJlc2VudC4KICAgKiBJZiBtb3JlIHRoZW4gb25lIGNsYXNzIGlzIHByb3ZpZGVkIC0gcmV0dXJucyB0cnVlIG9ubHkgd2hlbiBhbGwgY2xhc3NlcyBhcmUgcHJlc2VudC4KICAgKgogICAqCQllbGVtZW50Lmhhc0NsYXNzKCAnZm9vJyApOyAvLyBSZXR1cm5zIHRydWUgaWYgJ2ZvbycgY2xhc3MgaXMgcHJlc2VudC4KICAgKgkJZWxlbWVudC5oYXNDbGFzcyggJ2ZvbycsICdiYXInICk7IC8vIFJldHVybnMgdHJ1ZSBpZiAnZm9vJyBhbmQgJ2JhcicgY2xhc3NlcyBhcmUgYm90aCBwcmVzZW50LgogICAqCiAgICogQHBhcmFtIHsuLi5TdHJpbmd9IGNsYXNzTmFtZQogICAqLwoKCiAgaGFzQ2xhc3MoLi4uY2xhc3NOYW1lKSB7CiAgICBmb3IgKGNvbnN0IG5hbWUgb2YgY2xhc3NOYW1lKSB7CiAgICAgIGlmICghdGhpcy5fY2xhc3Nlcy5oYXMobmFtZSkpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gdHJ1ZTsKICB9CiAgLyoqCiAgICogUmV0dXJucyBpdGVyYXRvciB0aGF0IGNvbnRhaW5zIGFsbCBjbGFzcyBuYW1lcy4KICAgKgogICAqIEByZXR1cm5zIHtJdGVyYWJsZS48U3RyaW5nPn0KICAgKi8KCgogIGdldENsYXNzTmFtZXMoKSB7CiAgICByZXR1cm4gdGhpcy5fY2xhc3Nlcy5rZXlzKCk7CiAgfQogIC8qKgogICAqIFJldHVybnMgc3R5bGUgdmFsdWUgZm9yIGdpdmVuIHByb3BlcnR5LgogICAqIFVuZGVmaW5lZCBpcyByZXR1cm5lZCBpZiBzdHlsZSBkb2VzIG5vdCBleGlzdC4KICAgKgogICAqIEBwYXJhbSB7U3RyaW5nfSBwcm9wZXJ0eQogICAqIEByZXR1cm5zIHtTdHJpbmd8dW5kZWZpbmVkfQogICAqLwoKCiAgZ2V0U3R5bGUocHJvcGVydHkpIHsKICAgIHJldHVybiB0aGlzLl9zdHlsZXMuZ2V0KHByb3BlcnR5KTsKICB9CiAgLyoqCiAgICogUmV0dXJucyBpdGVyYXRvciB0aGF0IGNvbnRhaW5zIGFsbCBzdHlsZSBuYW1lcy4KICAgKgogICAqIEByZXR1cm5zIHtJdGVyYWJsZS48U3RyaW5nPn0KICAgKi8KCgogIGdldFN0eWxlTmFtZXMoKSB7CiAgICByZXR1cm4gdGhpcy5fc3R5bGVzLmtleXMoKTsKICB9CiAgLyoqCiAgICogUmV0dXJucyB0cnVlIGlmIHN0eWxlIGtleXMgYXJlIHByZXNlbnQuCiAgICogSWYgbW9yZSB0aGVuIG9uZSBzdHlsZSBwcm9wZXJ0eSBpcyBwcm92aWRlZCAtIHJldHVybnMgdHJ1ZSBvbmx5IHdoZW4gYWxsIHByb3BlcnRpZXMgYXJlIHByZXNlbnQuCiAgICoKICAgKgkJZWxlbWVudC5oYXNTdHlsZSggJ2NvbG9yJyApOyAvLyBSZXR1cm5zIHRydWUgaWYgJ2JvcmRlci10b3AnIHN0eWxlIGlzIHByZXNlbnQuCiAgICoJCWVsZW1lbnQuaGFzU3R5bGUoICdjb2xvcicsICdib3JkZXItdG9wJyApOyAvLyBSZXR1cm5zIHRydWUgaWYgJ2NvbG9yJyBhbmQgJ2JvcmRlci10b3AnIHN0eWxlcyBhcmUgYm90aCBwcmVzZW50LgogICAqCiAgICogQHBhcmFtIHsuLi5TdHJpbmd9IHByb3BlcnR5CiAgICovCgoKICBoYXNTdHlsZSguLi5wcm9wZXJ0eSkgewogICAgZm9yIChjb25zdCBuYW1lIG9mIHByb3BlcnR5KSB7CiAgICAgIGlmICghdGhpcy5fc3R5bGVzLmhhcyhuYW1lKSkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgfQoKICAgIHJldHVybiB0cnVlOwogIH0KICAvKioKICAgKiBSZXR1cm5zIGFuY2VzdG9yIGVsZW1lbnQgdGhhdCBtYXRjaCBzcGVjaWZpZWQgcGF0dGVybi4KICAgKiBQcm92aWRlZCBwYXR0ZXJucyBzaG91bGQgYmUgY29tcGF0aWJsZSB3aXRoIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvbWF0Y2hlcn5NYXRjaGVyIE1hdGNoZXJ9IGFzIGl0IGlzIHVzZWQgaW50ZXJuYWxseS4KICAgKgogICAqIEBzZWUgbW9kdWxlOmVuZ2luZS92aWV3L21hdGNoZXJ+TWF0Y2hlcgogICAqIEBwYXJhbSB7T2JqZWN0fFN0cmluZ3xSZWdFeHB8RnVuY3Rpb259IHBhdHRlcm5zIFBhdHRlcm5zIHVzZWQgdG8gbWF0Y2ggY29ycmVjdCBhbmNlc3Rvci4KICAgKiBTZWUge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9tYXRjaGVyfk1hdGNoZXJ9LgogICAqIEByZXR1cm5zIHttb2R1bGU6ZW5naW5lL3ZpZXcvZWxlbWVudH5FbGVtZW50fG51bGx9IEZvdW5kIGVsZW1lbnQgb3IgYG51bGxgIGlmIG5vIG1hdGNoaW5nIGFuY2VzdG9yIHdhcyBmb3VuZC4KICAgKi8KCgogIGZpbmRBbmNlc3RvciguLi5wYXR0ZXJucykgewogICAgY29uc3QgbWF0Y2hlciA9IG5ldyBNYXRjaGVyKC4uLnBhdHRlcm5zKTsKICAgIGxldCBwYXJlbnQgPSB0aGlzLnBhcmVudDsKCiAgICB3aGlsZSAocGFyZW50KSB7CiAgICAgIGlmIChtYXRjaGVyLm1hdGNoKHBhcmVudCkpIHsKICAgICAgICByZXR1cm4gcGFyZW50OwogICAgICB9CgogICAgICBwYXJlbnQgPSBwYXJlbnQucGFyZW50OwogICAgfQoKICAgIHJldHVybiBudWxsOwogIH0KICAvKioKICAgKiBSZXR1cm5zIHRoZSBjdXN0b20gcHJvcGVydHkgdmFsdWUgZm9yIHRoZSBnaXZlbiBrZXkuCiAgICoKICAgKiBAcGFyYW0ge1N0cmluZ3xTeW1ib2x9IGtleQogICAqIEByZXR1cm5zIHsqfQogICAqLwoKCiAgZ2V0Q3VzdG9tUHJvcGVydHkoa2V5KSB7CiAgICByZXR1cm4gdGhpcy5fY3VzdG9tUHJvcGVydGllcy5nZXQoa2V5KTsKICB9CiAgLyoqCiAgICogUmV0dXJucyBhbiBpdGVyYXRvciB3aGljaCBpdGVyYXRlcyBvdmVyIHRoaXMgZWxlbWVudCdzIGN1c3RvbSBwcm9wZXJ0aWVzLgogICAqIEl0ZXJhdG9yIHByb3ZpZGVzIGBbIGtleSwgdmFsdWUgXWAgcGFpcnMgZm9yIGVhY2ggc3RvcmVkIHByb3BlcnR5LgogICAqCiAgICogQHJldHVybnMge0l0ZXJhYmxlLjwqPn0KICAgKi8KCgogICpnZXRDdXN0b21Qcm9wZXJ0aWVzKCkgewogICAgeWllbGQqIHRoaXMuX2N1c3RvbVByb3BlcnRpZXMuZW50cmllcygpOwogIH0KICAvKioKICAgKiBSZXR1cm5zIGlkZW50aXR5IHN0cmluZyBiYXNlZCBvbiBlbGVtZW50J3MgbmFtZSwgc3R5bGVzLCBjbGFzc2VzIGFuZCBvdGhlciBhdHRyaWJ1dGVzLgogICAqIFR3byBlbGVtZW50cyB0aGF0IHtAbGluayAjaXNTaW1pbGFyIGFyZSBzaW1pbGFyfSB3aWxsIGhhdmUgc2FtZSBpZGVudGl0eSBzdHJpbmcuCiAgICogSXQgaGFzIHRoZSBmb2xsb3dpbmcgZm9ybWF0OgogICAqCiAgICoJCSduYW1lIGNsYXNzPSJjbGFzczEsY2xhc3MyIiBzdHlsZT0ic3R5bGUxOnZhbHVlMTtzdHlsZTI6dmFsdWUyIiBhdHRyMT0idmFsMSIgYXR0cjI9InZhbDIiJwogIAkgKgogICAqIEZvciBleGFtcGxlOgogICAqCiAgICoJCWNvbnN0IGVsZW1lbnQgPSB3cml0ZXIuY3JlYXRlQ29udGFpbmVyRWxlbWVudCggJ2ZvbycsIHsKICAgKgkJCWJhbmFuYTogJzEwJywKICAgKgkJCWFwcGxlOiAnMjAnLAogICAqCQkJc3R5bGU6ICdjb2xvcjogcmVkOyBib3JkZXItY29sb3I6IHdoaXRlOycsCiAgICoJCQljbGFzczogJ2JheicKICAgKgkJfSApOwogICAqCiAgICoJCS8vIHJldHVybnMgJ2ZvbyBjbGFzcz0iYmF6IiBzdHlsZT0iYm9yZGVyLWNvbG9yOndoaXRlO2NvbG9yOnJlZCIgYXBwbGU9IjIwIiBiYW5hbmE9IjEwIicKICAgKgkJZWxlbWVudC5nZXRJZGVudGl0eSgpOwogICAqCiAgICogTk9URTogQ2xhc3Nlcywgc3R5bGVzIGFuZCBvdGhlciBhdHRyaWJ1dGVzIGFyZSBzb3J0ZWQgYWxwaGFiZXRpY2FsbHkuCiAgICoKICAgKiBAcmV0dXJucyB7U3RyaW5nfQogICAqLwoKCiAgZ2V0SWRlbnRpdHkoKSB7CiAgICBjb25zdCBjbGFzc2VzID0gQXJyYXkuZnJvbSh0aGlzLl9jbGFzc2VzKS5zb3J0KCkuam9pbignLCcpOwogICAgY29uc3Qgc3R5bGVzID0gQXJyYXkuZnJvbSh0aGlzLl9zdHlsZXMpLm1hcChpID0+IGAke2lbMF19OiR7aVsxXX1gKS5zb3J0KCkuam9pbignOycpOwogICAgY29uc3QgYXR0cmlidXRlcyA9IEFycmF5LmZyb20odGhpcy5fYXR0cnMpLm1hcChpID0+IGAke2lbMF19PSIke2lbMV19ImApLnNvcnQoKS5qb2luKCcgJyk7CiAgICByZXR1cm4gdGhpcy5uYW1lICsgKGNsYXNzZXMgPT0gJycgPyAnJyA6IGAgY2xhc3M9IiR7Y2xhc3Nlc30iYCkgKyAoc3R5bGVzID09ICcnID8gJycgOiBgIHN0eWxlPSIke3N0eWxlc30iYCkgKyAoYXR0cmlidXRlcyA9PSAnJyA/ICcnIDogYCAke2F0dHJpYnV0ZXN9YCk7CiAgfQogIC8qKgogICAqIENsb25lcyBwcm92aWRlZCBlbGVtZW50LgogICAqCiAgICogQHByb3RlY3RlZAogICAqIEBwYXJhbSB7Qm9vbGVhbn0gW2RlZXA9ZmFsc2VdIElmIHNldCB0byBgdHJ1ZWAgY2xvbmVzIGVsZW1lbnQgYW5kIGFsbCBpdHMgY2hpbGRyZW4gcmVjdXJzaXZlbHkuIFdoZW4gc2V0IHRvIGBmYWxzZWAsCiAgICogZWxlbWVudCB3aWxsIGJlIGNsb25lZCB3aXRob3V0IGFueSBjaGlsZHJlbi4KICAgKiBAcmV0dXJucyB7bW9kdWxlOmVuZ2luZS92aWV3L2VsZW1lbnR+RWxlbWVudH0gQ2xvbmUgb2YgdGhpcyBlbGVtZW50LgogICAqLwoKCiAgX2Nsb25lKGRlZXAgPSBmYWxzZSkgewogICAgY29uc3QgY2hpbGRyZW5DbG9uZSA9IFtdOwoKICAgIGlmIChkZWVwKSB7CiAgICAgIGZvciAoY29uc3QgY2hpbGQgb2YgdGhpcy5nZXRDaGlsZHJlbigpKSB7CiAgICAgICAgY2hpbGRyZW5DbG9uZS5wdXNoKGNoaWxkLl9jbG9uZShkZWVwKSk7CiAgICAgIH0KICAgIH0gLy8gQ29udGFpbmVyRWxlbWVudCBhbmQgQXR0cmlidXRlRWxlbWVudCBzaG91bGQgYmUgYWxzbyBjbG9uZWQgcHJvcGVybHkuCgoKICAgIGNvbnN0IGNsb25lZCA9IG5ldyB0aGlzLmNvbnN0cnVjdG9yKHRoaXMubmFtZSwgdGhpcy5fYXR0cnMsIGNoaWxkcmVuQ2xvbmUpOyAvLyBDbGFzc2VzIGFuZCBzdHlsZXMgYXJlIGNsb25lZCBzZXBhcmF0ZWx5IC0gdGhpcyBzb2x1dGlvbiBpcyBmYXN0ZXIgdGhhbiBhZGRpbmcgdGhlbSBiYWNrIHRvIGF0dHJpYnV0ZXMgYW5kCiAgICAvLyBwYXJzZSBvbmNlIGFnYWluIGluIGNvbnN0cnVjdG9yLgoKICAgIGNsb25lZC5fY2xhc3NlcyA9IG5ldyBTZXQodGhpcy5fY2xhc3Nlcyk7CiAgICBjbG9uZWQuX3N0eWxlcyA9IG5ldyBNYXAodGhpcy5fc3R5bGVzKTsgLy8gQ2xvbmUgY3VzdG9tIHByb3BlcnRpZXMuCgogICAgY2xvbmVkLl9jdXN0b21Qcm9wZXJ0aWVzID0gbmV3IE1hcCh0aGlzLl9jdXN0b21Qcm9wZXJ0aWVzKTsgLy8gQ2xvbmUgZmlsbGVyIG9mZnNldCBtZXRob2QuCiAgICAvLyBXZSBjYW4ndCBkZWZpbmUgdGhpcyBtZXRob2QgaW4gYSBwcm90b3R5cGUgYmVjYXVzZSBpdCdzIGJlaGF2aW9yIHdoaWNoCiAgICAvLyBpcyBjaGFuZ2VkIGJ5IGUuZy4gdG9XaWRnZXQoKSBmdW5jdGlvbiBmcm9tIGNrZWRpdG9yNS13aWRnZXQuIFBlcmhhcHMgdGhpcyBzaG91bGQgYmUgb25lIG9mIGN1c3RvbSBwcm9wcy4KCiAgICBjbG9uZWQuZ2V0RmlsbGVyT2Zmc2V0ID0gdGhpcy5nZXRGaWxsZXJPZmZzZXQ7CiAgICByZXR1cm4gY2xvbmVkOwogIH0KICAvKioKICAgKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2VsZW1lbnR+RWxlbWVudCNfaW5zZXJ0Q2hpbGQgSW5zZXJ0fSBhIGNoaWxkIG5vZGUgb3IgYSBsaXN0IG9mIGNoaWxkIG5vZGVzIGF0IHRoZSBlbmQgb2YgdGhpcyBub2RlCiAgICogYW5kIHNldHMgdGhlIHBhcmVudCBvZiB0aGVzZSBub2RlcyB0byB0aGlzIGVsZW1lbnQuCiAgICoKICAgKiBAc2VlIG1vZHVsZTplbmdpbmUvdmlldy9kb3duY2FzdHdyaXRlcn5Eb3duY2FzdFdyaXRlciNpbnNlcnQKICAgKiBAcHJvdGVjdGVkCiAgICogQHBhcmFtIHttb2R1bGU6ZW5naW5lL3ZpZXcvaXRlbX5JdGVtfEl0ZXJhYmxlLjxtb2R1bGU6ZW5naW5lL3ZpZXcvaXRlbX5JdGVtPn0gaXRlbXMgSXRlbXMgdG8gYmUgaW5zZXJ0ZWQuCiAgICogQGZpcmVzIG1vZHVsZTplbmdpbmUvdmlldy9ub2Rlfk5vZGUjY2hhbmdlCiAgICogQHJldHVybnMge051bWJlcn0gTnVtYmVyIG9mIGFwcGVuZGVkIG5vZGVzLgogICAqLwoKCiAgX2FwcGVuZENoaWxkKGl0ZW1zKSB7CiAgICByZXR1cm4gdGhpcy5faW5zZXJ0Q2hpbGQodGhpcy5jaGlsZENvdW50LCBpdGVtcyk7CiAgfQogIC8qKgogICAqIEluc2VydHMgYSBjaGlsZCBub2RlIG9yIGEgbGlzdCBvZiBjaGlsZCBub2RlcyBvbiB0aGUgZ2l2ZW4gaW5kZXggYW5kIHNldHMgdGhlIHBhcmVudCBvZiB0aGVzZSBub2RlcyB0bwogICAqIHRoaXMgZWxlbWVudC4KICAgKgogICAqIEBzZWUgbW9kdWxlOmVuZ2luZS92aWV3L2Rvd25jYXN0d3JpdGVyfkRvd25jYXN0V3JpdGVyI2luc2VydAogICAqIEBwcm90ZWN0ZWQKICAgKiBAcGFyYW0ge051bWJlcn0gaW5kZXggUG9zaXRpb24gd2hlcmUgbm9kZXMgc2hvdWxkIGJlIGluc2VydGVkLgogICAqIEBwYXJhbSB7bW9kdWxlOmVuZ2luZS92aWV3L2l0ZW1+SXRlbXxJdGVyYWJsZS48bW9kdWxlOmVuZ2luZS92aWV3L2l0ZW1+SXRlbT59IGl0ZW1zIEl0ZW1zIHRvIGJlIGluc2VydGVkLgogICAqIEBmaXJlcyBtb2R1bGU6ZW5naW5lL3ZpZXcvbm9kZX5Ob2RlI2NoYW5nZQogICAqIEByZXR1cm5zIHtOdW1iZXJ9IE51bWJlciBvZiBpbnNlcnRlZCBub2Rlcy4KICAgKi8KCgogIF9pbnNlcnRDaGlsZChpbmRleCwgaXRlbXMpIHsKICAgIHRoaXMuX2ZpcmVDaGFuZ2UoJ2NoaWxkcmVuJywgdGhpcyk7CgogICAgbGV0IGNvdW50ID0gMDsKICAgIGNvbnN0IG5vZGVzID0gbm9ybWFsaXplKGl0ZW1zKTsKCiAgICBmb3IgKGNvbnN0IG5vZGUgb2Ygbm9kZXMpIHsKICAgICAgLy8gSWYgbm9kZSB0aGF0IGlzIGJlaW5nIGFkZGVkIHRvIHRoaXMgZWxlbWVudCBpcyBhbHJlYWR5IGluc2lkZSBhbm90aGVyIGVsZW1lbnQsIGZpcnN0IHJlbW92ZSBpdCBmcm9tIHRoZSBvbGQgcGFyZW50LgogICAgICBpZiAobm9kZS5wYXJlbnQgIT09IG51bGwpIHsKICAgICAgICBub2RlLl9yZW1vdmUoKTsKICAgICAgfQoKICAgICAgbm9kZS5wYXJlbnQgPSB0aGlzOwoKICAgICAgdGhpcy5fY2hpbGRyZW4uc3BsaWNlKGluZGV4LCAwLCBub2RlKTsKCiAgICAgIGluZGV4Kys7CiAgICAgIGNvdW50Kys7CiAgICB9CgogICAgcmV0dXJuIGNvdW50OwogIH0KICAvKioKICAgKiBSZW1vdmVzIG51bWJlciBvZiBjaGlsZCBub2RlcyBzdGFydGluZyBhdCB0aGUgZ2l2ZW4gaW5kZXggYW5kIHNldCB0aGUgcGFyZW50IG9mIHRoZXNlIG5vZGVzIHRvIGBudWxsYC4KICAgKgogICAqIEBzZWUgbW9kdWxlOmVuZ2luZS92aWV3L2Rvd25jYXN0d3JpdGVyfkRvd25jYXN0V3JpdGVyI3JlbW92ZQogICAqIEBwcm90ZWN0ZWQKICAgKiBAcGFyYW0ge051bWJlcn0gaW5kZXggTnVtYmVyIG9mIHRoZSBmaXJzdCBub2RlIHRvIHJlbW92ZS4KICAgKiBAcGFyYW0ge051bWJlcn0gW2hvd01hbnk9MV0gTnVtYmVyIG9mIG5vZGVzIHRvIHJlbW92ZS4KICAgKiBAZmlyZXMgbW9kdWxlOmVuZ2luZS92aWV3L25vZGV+Tm9kZSNjaGFuZ2UKICAgKiBAcmV0dXJucyB7QXJyYXkuPG1vZHVsZTplbmdpbmUvdmlldy9ub2Rlfk5vZGU+fSBUaGUgYXJyYXkgb2YgcmVtb3ZlZCBub2Rlcy4KICAgKi8KCgogIF9yZW1vdmVDaGlsZHJlbihpbmRleCwgaG93TWFueSA9IDEpIHsKICAgIHRoaXMuX2ZpcmVDaGFuZ2UoJ2NoaWxkcmVuJywgdGhpcyk7CgogICAgZm9yIChsZXQgaSA9IGluZGV4OyBpIDwgaW5kZXggKyBob3dNYW55OyBpKyspIHsKICAgICAgdGhpcy5fY2hpbGRyZW5baV0ucGFyZW50ID0gbnVsbDsKICAgIH0KCiAgICByZXR1cm4gdGhpcy5fY2hpbGRyZW4uc3BsaWNlKGluZGV4LCBob3dNYW55KTsKICB9CiAgLyoqCiAgICogQWRkcyBvciBvdmVyd3JpdGUgYXR0cmlidXRlIHdpdGggYSBzcGVjaWZpZWQga2V5IGFuZCB2YWx1ZS4KICAgKgogICAqIEBzZWUgbW9kdWxlOmVuZ2luZS92aWV3L2Rvd25jYXN0d3JpdGVyfkRvd25jYXN0V3JpdGVyI3NldEF0dHJpYnV0ZQogICAqIEBwcm90ZWN0ZWQKICAgKiBAcGFyYW0ge1N0cmluZ30ga2V5IEF0dHJpYnV0ZSBrZXkuCiAgICogQHBhcmFtIHtTdHJpbmd9IHZhbHVlIEF0dHJpYnV0ZSB2YWx1ZS4KICAgKiBAZmlyZXMgbW9kdWxlOmVuZ2luZS92aWV3L25vZGV+Tm9kZSNjaGFuZ2UKICAgKi8KCgogIF9zZXRBdHRyaWJ1dGUoa2V5LCB2YWx1ZSkgewogICAgdmFsdWUgPSBTdHJpbmcodmFsdWUpOwoKICAgIHRoaXMuX2ZpcmVDaGFuZ2UoJ2F0dHJpYnV0ZXMnLCB0aGlzKTsKCiAgICBpZiAoa2V5ID09ICdjbGFzcycpIHsKICAgICAgcGFyc2VDbGFzc2VzKHRoaXMuX2NsYXNzZXMsIHZhbHVlKTsKICAgIH0gZWxzZSBpZiAoa2V5ID09ICdzdHlsZScpIHsKICAgICAgcGFyc2VJbmxpbmVTdHlsZXModGhpcy5fc3R5bGVzLCB2YWx1ZSk7CiAgICB9IGVsc2UgewogICAgICB0aGlzLl9hdHRycy5zZXQoa2V5LCB2YWx1ZSk7CiAgICB9CiAgfQogIC8qKgogICAqIFJlbW92ZXMgYXR0cmlidXRlIGZyb20gdGhlIGVsZW1lbnQuCiAgICoKICAgKiBAc2VlIG1vZHVsZTplbmdpbmUvdmlldy9kb3duY2FzdHdyaXRlcn5Eb3duY2FzdFdyaXRlciNyZW1vdmVBdHRyaWJ1dGUKICAgKiBAcHJvdGVjdGVkCiAgICogQHBhcmFtIHtTdHJpbmd9IGtleSBBdHRyaWJ1dGUga2V5LgogICAqIEByZXR1cm5zIHtCb29sZWFufSBSZXR1cm5zIHRydWUgaWYgYW4gYXR0cmlidXRlIGV4aXN0ZWQgYW5kIGhhcyBiZWVuIHJlbW92ZWQuCiAgICogQGZpcmVzIG1vZHVsZTplbmdpbmUvdmlldy9ub2Rlfk5vZGUjY2hhbmdlCiAgICovCgoKICBfcmVtb3ZlQXR0cmlidXRlKGtleSkgewogICAgdGhpcy5fZmlyZUNoYW5nZSgnYXR0cmlidXRlcycsIHRoaXMpOyAvLyBSZW1vdmUgY2xhc3MgYXR0cmlidXRlLgoKCiAgICBpZiAoa2V5ID09ICdjbGFzcycpIHsKICAgICAgaWYgKHRoaXMuX2NsYXNzZXMuc2l6ZSA+IDApIHsKICAgICAgICB0aGlzLl9jbGFzc2VzLmNsZWFyKCk7CgogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9CgogICAgICByZXR1cm4gZmFsc2U7CiAgICB9IC8vIFJlbW92ZSBzdHlsZSBhdHRyaWJ1dGUuCgoKICAgIGlmIChrZXkgPT0gJ3N0eWxlJykgewogICAgICBpZiAodGhpcy5fc3R5bGVzLnNpemUgPiAwKSB7CiAgICAgICAgdGhpcy5fc3R5bGVzLmNsZWFyKCk7CgogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9CgogICAgICByZXR1cm4gZmFsc2U7CiAgICB9IC8vIFJlbW92ZSBvdGhlciBhdHRyaWJ1dGVzLgoKCiAgICByZXR1cm4gdGhpcy5fYXR0cnMuZGVsZXRlKGtleSk7CiAgfQogIC8qKgogICAqIEFkZHMgc3BlY2lmaWVkIGNsYXNzLgogICAqCiAgICoJCWVsZW1lbnQuX2FkZENsYXNzKCAnZm9vJyApOyAvLyBBZGRzICdmb28nIGNsYXNzLgogICAqCQllbGVtZW50Ll9hZGRDbGFzcyggWyAnZm9vJywgJ2JhcicgXSApOyAvLyBBZGRzICdmb28nIGFuZCAnYmFyJyBjbGFzc2VzLgogICAqCiAgICogQHNlZSBtb2R1bGU6ZW5naW5lL3ZpZXcvZG93bmNhc3R3cml0ZXJ+RG93bmNhc3RXcml0ZXIjYWRkQ2xhc3MKICAgKiBAcHJvdGVjdGVkCiAgICogQHBhcmFtIHtBcnJheS48U3RyaW5nPnxTdHJpbmd9IGNsYXNzTmFtZQogICAqIEBmaXJlcyBtb2R1bGU6ZW5naW5lL3ZpZXcvbm9kZX5Ob2RlI2NoYW5nZQogICAqLwoKCiAgX2FkZENsYXNzKGNsYXNzTmFtZSkgewogICAgdGhpcy5fZmlyZUNoYW5nZSgnYXR0cmlidXRlcycsIHRoaXMpOwoKICAgIGNsYXNzTmFtZSA9IEFycmF5LmlzQXJyYXkoY2xhc3NOYW1lKSA/IGNsYXNzTmFtZSA6IFtjbGFzc05hbWVdOwogICAgY2xhc3NOYW1lLmZvckVhY2gobmFtZSA9PiB0aGlzLl9jbGFzc2VzLmFkZChuYW1lKSk7CiAgfQogIC8qKgogICAqIFJlbW92ZXMgc3BlY2lmaWVkIGNsYXNzLgogICAqCiAgICoJCWVsZW1lbnQuX3JlbW92ZUNsYXNzKCAnZm9vJyApOyAgLy8gUmVtb3ZlcyAnZm9vJyBjbGFzcy4KICAgKgkJZWxlbWVudC5fcmVtb3ZlQ2xhc3MoIFsgJ2ZvbycsICdiYXInIF0gKTsgLy8gUmVtb3ZlcyBib3RoICdmb28nIGFuZCAnYmFyJyBjbGFzc2VzLgogICAqCiAgICogQHNlZSBtb2R1bGU6ZW5naW5lL3ZpZXcvZG93bmNhc3R3cml0ZXJ+RG93bmNhc3RXcml0ZXIjcmVtb3ZlQ2xhc3MKICAgKiBAcHJvdGVjdGVkCiAgICogQHBhcmFtIHtBcnJheS48U3RyaW5nPnxTdHJpbmd9IGNsYXNzTmFtZQogICAqIEBmaXJlcyBtb2R1bGU6ZW5naW5lL3ZpZXcvbm9kZX5Ob2RlI2NoYW5nZQogICAqLwoKCiAgX3JlbW92ZUNsYXNzKGNsYXNzTmFtZSkgewogICAgdGhpcy5fZmlyZUNoYW5nZSgnYXR0cmlidXRlcycsIHRoaXMpOwoKICAgIGNsYXNzTmFtZSA9IEFycmF5LmlzQXJyYXkoY2xhc3NOYW1lKSA/IGNsYXNzTmFtZSA6IFtjbGFzc05hbWVdOwogICAgY2xhc3NOYW1lLmZvckVhY2gobmFtZSA9PiB0aGlzLl9jbGFzc2VzLmRlbGV0ZShuYW1lKSk7CiAgfQogIC8qKgogICAqIEFkZHMgc3R5bGUgdG8gdGhlIGVsZW1lbnQuCiAgICoKICAgKgkJZWxlbWVudC5fc2V0U3R5bGUoICdjb2xvcicsICdyZWQnICk7CiAgICoJCWVsZW1lbnQuX3NldFN0eWxlKCB7CiAgICoJCQljb2xvcjogJ3JlZCcsCiAgICoJCQlwb3NpdGlvbjogJ2ZpeGVkJwogICAqCQl9ICk7CiAgICoKICAgKiBAc2VlIG1vZHVsZTplbmdpbmUvdmlldy9kb3duY2FzdHdyaXRlcn5Eb3duY2FzdFdyaXRlciNzZXRTdHlsZQogICAqIEBwcm90ZWN0ZWQKICAgKiBAcGFyYW0ge1N0cmluZ3xPYmplY3R9IHByb3BlcnR5IFByb3BlcnR5IG5hbWUgb3Igb2JqZWN0IHdpdGgga2V5IC0gdmFsdWUgcGFpcnMuCiAgICogQHBhcmFtIHtTdHJpbmd9IFt2YWx1ZV0gVmFsdWUgdG8gc2V0LiBUaGlzIHBhcmFtZXRlciBpcyBpZ25vcmVkIGlmIG9iamVjdCBpcyBwcm92aWRlZCBhcyB0aGUgZmlyc3QgcGFyYW1ldGVyLgogICAqIEBmaXJlcyBtb2R1bGU6ZW5naW5lL3ZpZXcvbm9kZX5Ob2RlI2NoYW5nZQogICAqLwoKCiAgX3NldFN0eWxlKHByb3BlcnR5LCB2YWx1ZSkgewogICAgdGhpcy5fZmlyZUNoYW5nZSgnYXR0cmlidXRlcycsIHRoaXMpOwoKICAgIGlmIChpc1BsYWluT2JqZWN0KHByb3BlcnR5KSkgewogICAgICBjb25zdCBrZXlzID0gT2JqZWN0LmtleXMocHJvcGVydHkpOwoKICAgICAgZm9yIChjb25zdCBrZXkgb2Yga2V5cykgewogICAgICAgIHRoaXMuX3N0eWxlcy5zZXQoa2V5LCBwcm9wZXJ0eVtrZXldKTsKICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgdGhpcy5fc3R5bGVzLnNldChwcm9wZXJ0eSwgdmFsdWUpOwogICAgfQogIH0KICAvKioKICAgKiBSZW1vdmVzIHNwZWNpZmllZCBzdHlsZS4KICAgKgogICAqCQllbGVtZW50Ll9yZW1vdmVTdHlsZSggJ2NvbG9yJyApOyAgLy8gUmVtb3ZlcyAnY29sb3InIHN0eWxlLgogICAqCQllbGVtZW50Ll9yZW1vdmVTdHlsZSggWyAnY29sb3InLCAnYm9yZGVyLXRvcCcgXSApOyAvLyBSZW1vdmVzIGJvdGggJ2NvbG9yJyBhbmQgJ2JvcmRlci10b3AnIHN0eWxlcy4KICAgKgogICAqIEBzZWUgbW9kdWxlOmVuZ2luZS92aWV3L2Rvd25jYXN0d3JpdGVyfkRvd25jYXN0V3JpdGVyI3JlbW92ZVN0eWxlCiAgICogQHByb3RlY3RlZAogICAqIEBwYXJhbSB7QXJyYXkuPFN0cmluZz58U3RyaW5nfSBwcm9wZXJ0eQogICAqIEBmaXJlcyBtb2R1bGU6ZW5naW5lL3ZpZXcvbm9kZX5Ob2RlI2NoYW5nZQogICAqLwoKCiAgX3JlbW92ZVN0eWxlKHByb3BlcnR5KSB7CiAgICB0aGlzLl9maXJlQ2hhbmdlKCdhdHRyaWJ1dGVzJywgdGhpcyk7CgogICAgcHJvcGVydHkgPSBBcnJheS5pc0FycmF5KHByb3BlcnR5KSA/IHByb3BlcnR5IDogW3Byb3BlcnR5XTsKICAgIHByb3BlcnR5LmZvckVhY2gobmFtZSA9PiB0aGlzLl9zdHlsZXMuZGVsZXRlKG5hbWUpKTsKICB9CiAgLyoqCiAgICogU2V0cyBhIGN1c3RvbSBwcm9wZXJ0eS4gVW5saWtlIGF0dHJpYnV0ZXMsIGN1c3RvbSBwcm9wZXJ0aWVzIGFyZSBub3QgcmVuZGVyZWQgdG8gdGhlIERPTSwKICAgKiBzbyB0aGV5IGNhbiBiZSB1c2VkIHRvIGFkZCBzcGVjaWFsIGRhdGEgdG8gZWxlbWVudHMuCiAgICoKICAgKiBAc2VlIG1vZHVsZTplbmdpbmUvdmlldy9kb3duY2FzdHdyaXRlcn5Eb3duY2FzdFdyaXRlciNzZXRDdXN0b21Qcm9wZXJ0eQogICAqIEBwcm90ZWN0ZWQKICAgKiBAcGFyYW0ge1N0cmluZ3xTeW1ib2x9IGtleQogICAqIEBwYXJhbSB7Kn0gdmFsdWUKICAgKi8KCgogIF9zZXRDdXN0b21Qcm9wZXJ0eShrZXksIHZhbHVlKSB7CiAgICB0aGlzLl9jdXN0b21Qcm9wZXJ0aWVzLnNldChrZXksIHZhbHVlKTsKICB9CiAgLyoqCiAgICogUmVtb3ZlcyB0aGUgY3VzdG9tIHByb3BlcnR5IHN0b3JlZCB1bmRlciB0aGUgZ2l2ZW4ga2V5LgogICAqCiAgICogQHNlZSBtb2R1bGU6ZW5naW5lL3ZpZXcvZG93bmNhc3R3cml0ZXJ+RG93bmNhc3RXcml0ZXIjcmVtb3ZlQ3VzdG9tUHJvcGVydHkKICAgKiBAcHJvdGVjdGVkCiAgICogQHBhcmFtIHtTdHJpbmd8U3ltYm9sfSBrZXkKICAgKiBAcmV0dXJucyB7Qm9vbGVhbn0gUmV0dXJucyB0cnVlIGlmIHByb3BlcnR5IHdhcyByZW1vdmVkLgogICAqLwoKCiAgX3JlbW92ZUN1c3RvbVByb3BlcnR5KGtleSkgewogICAgcmV0dXJuIHRoaXMuX2N1c3RvbVByb3BlcnRpZXMuZGVsZXRlKGtleSk7CiAgfQogIC8qKgogICAqIFJldHVybnMgYmxvY2sge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9maWxsZXIgZmlsbGVyfSBvZmZzZXQgb3IgYG51bGxgIGlmIGJsb2NrIGZpbGxlciBpcyBub3QgbmVlZGVkLgogICAqCiAgICogQGFic3RyYWN0CiAgICogQG1ldGhvZCBtb2R1bGU6ZW5naW5lL3ZpZXcvZWxlbWVudH5FbGVtZW50I2dldEZpbGxlck9mZnNldAogICAqLwogIC8vIEBpZiBDS19ERUJVR19FTkdJTkUgLy8gcHJpbnRUcmVlKCBsZXZlbCA9IDApIHsKICAvLyBAaWYgQ0tfREVCVUdfRU5HSU5FIC8vIAlsZXQgc3RyaW5nID0gJyc7CiAgLy8gQGlmIENLX0RFQlVHX0VOR0lORSAvLwlzdHJpbmcgKz0gJ1x0Jy5yZXBlYXQoIGxldmVsICkgKyBgPCR7IHRoaXMubmFtZSB9JHsgY29udmVydE1hcFRvVGFncyggdGhpcy5nZXRBdHRyaWJ1dGVzKCkgKSB9PmA7CiAgLy8gQGlmIENLX0RFQlVHX0VOR0lORSAvLwlmb3IgKCBjb25zdCBjaGlsZCBvZiB0aGlzLmdldENoaWxkcmVuKCkgKSB7CiAgLy8gQGlmIENLX0RFQlVHX0VOR0lORSAvLwkJaWYgKCBjaGlsZC5pcyggJ3RleHQnICkgKSB7CiAgLy8gQGlmIENLX0RFQlVHX0VOR0lORSAvLwkJCXN0cmluZyArPSAnXG4nICsgJ1x0Jy5yZXBlYXQoIGxldmVsICsgMSApICsgY2hpbGQuZGF0YTsKICAvLyBAaWYgQ0tfREVCVUdfRU5HSU5FIC8vCQl9IGVsc2UgewogIC8vIEBpZiBDS19ERUJVR19FTkdJTkUgLy8JCQlzdHJpbmcgKz0gJ1xuJyArIGNoaWxkLnByaW50VHJlZSggbGV2ZWwgKyAxICk7CiAgLy8gQGlmIENLX0RFQlVHX0VOR0lORSAvLwkJfQogIC8vIEBpZiBDS19ERUJVR19FTkdJTkUgLy8JfQogIC8vIEBpZiBDS19ERUJVR19FTkdJTkUgLy8JaWYgKCB0aGlzLmNoaWxkQ291bnQgKSB7CiAgLy8gQGlmIENLX0RFQlVHX0VOR0lORSAvLwkJc3RyaW5nICs9ICdcbicgKyAnXHQnLnJlcGVhdCggbGV2ZWwgKTsKICAvLyBAaWYgQ0tfREVCVUdfRU5HSU5FIC8vCX0KICAvLyBAaWYgQ0tfREVCVUdfRU5HSU5FIC8vCXN0cmluZyArPSBgPC8keyB0aGlzLm5hbWUgfT5gOwogIC8vIEBpZiBDS19ERUJVR19FTkdJTkUgLy8JcmV0dXJuIHN0cmluZzsKICAvLyBAaWYgQ0tfREVCVUdfRU5HSU5FIC8vIH0KICAvLyBAaWYgQ0tfREVCVUdfRU5HSU5FIC8vIGxvZ1RyZWUoKSB7CiAgLy8gQGlmIENLX0RFQlVHX0VOR0lORSAvLyAJY29uc29sZS5sb2coIHRoaXMucHJpbnRUcmVlKCkgKTsKICAvLyBAaWYgQ0tfREVCVUdfRU5HSU5FIC8vIH0KCgp9IC8vIFBhcnNlcyBhdHRyaWJ1dGVzIHByb3ZpZGVkIHRvIHRoZSBlbGVtZW50IGNvbnN0cnVjdG9yIGJlZm9yZSB0aGV5IGFyZSBhcHBsaWVkIHRvIGFuIGVsZW1lbnQuIElmIGF0dHJpYnV0ZXMgYXJlIHBhc3NlZAovLyBhcyBhbiBvYmplY3QgKGluc3RlYWQgb2YgYE1hcGApLCB0aGUgb2JqZWN0IGlzIHRyYW5zZm9ybWVkIHRvIHRoZSBtYXAuIEF0dHJpYnV0ZXMgd2l0aCBgbnVsbGAgdmFsdWUgYXJlIHJlbW92ZWQuCi8vIEF0dHJpYnV0ZXMgd2l0aCBub24tYFN0cmluZ2AgdmFsdWUgYXJlIGNvbnZlcnRlZCB0byBgU3RyaW5nYC4KLy8KLy8gQHBhcmFtIHtPYmplY3R8TWFwfSBhdHRycyBBdHRyaWJ1dGVzIHRvIHBhcnNlLgovLyBAcmV0dXJucyB7TWFwfSBQYXJzZWQgYXR0cmlidXRlcy4KCmZ1bmN0aW9uIHBhcnNlQXR0cmlidXRlcyhhdHRycykgewogIGlmIChpc1BsYWluT2JqZWN0KGF0dHJzKSkgewogICAgYXR0cnMgPSBvYmplY3RUb01hcChhdHRycyk7CiAgfSBlbHNlIHsKICAgIGF0dHJzID0gbmV3IE1hcChhdHRycyk7CiAgfQoKICBmb3IgKGNvbnN0IFtrZXksIHZhbHVlXSBvZiBhdHRycykgewogICAgaWYgKHZhbHVlID09PSBudWxsKSB7CiAgICAgIGF0dHJzLmRlbGV0ZShrZXkpOwogICAgfSBlbHNlIGlmICh0eXBlb2YgdmFsdWUgIT0gJ3N0cmluZycpIHsKICAgICAgYXR0cnMuc2V0KGtleSwgU3RyaW5nKHZhbHVlKSk7CiAgICB9CiAgfQoKICByZXR1cm4gYXR0cnM7Cn0gLy8gUGFyc2VzIGlubGluZSBzdHlsZXMgYW5kIHB1dHMgcHJvcGVydHkgLSB2YWx1ZSBwYWlycyBpbnRvIHN0eWxlcyBtYXAuCi8vIFN0eWxlcyBtYXAgaXMgY2xlYXJlZCBiZWZvcmUgaW5zZXJ0aW9uLgovLwovLyBAcGFyYW0ge01hcC48U3RyaW5nLCBTdHJpbmc+fSBzdHlsZXNNYXAgTWFwIHRvIGluc2VydCBwYXJzZWQgcHJvcGVydGllcyBhbmQgdmFsdWVzLgovLyBAcGFyYW0ge1N0cmluZ30gc3R5bGVzU3RyaW5nIFN0eWxlcyB0byBwYXJzZS4KCgpmdW5jdGlvbiBwYXJzZUlubGluZVN0eWxlcyhzdHlsZXNNYXAsIHN0eWxlc1N0cmluZykgewogIC8vIGBudWxsYCBpZiBubyBxdW90ZSB3YXMgZm91bmQgaW4gaW5wdXQgc3RyaW5nIG9yIGxhc3QgZm91bmQgcXVvdGUgd2FzIGEgY2xvc2luZyBxdW90ZS4gU2VlIGJlbG93LgogIGxldCBxdW90ZVR5cGUgPSBudWxsOwogIGxldCBwcm9wZXJ0eU5hbWVTdGFydCA9IDA7CiAgbGV0IHByb3BlcnR5VmFsdWVTdGFydCA9IDA7CiAgbGV0IHByb3BlcnR5TmFtZSA9IG51bGw7CiAgc3R5bGVzTWFwLmNsZWFyKCk7IC8vIERvIG5vdCBzZXQgYW55dGhpbmcgaWYgaW5wdXQgc3RyaW5nIGlzIGVtcHR5LgoKICBpZiAoc3R5bGVzU3RyaW5nID09PSAnJykgewogICAgcmV0dXJuOwogIH0gLy8gRml4IGlubGluZSBzdHlsZXMgdGhhdCBkbyBub3QgZW5kIHdpdGggYDtgIHNvIHRoZXkgYXJlIGNvbXBhdGlibGUgd2l0aCBhbGdvcml0aG0gYmVsb3cuCgoKICBpZiAoc3R5bGVzU3RyaW5nLmNoYXJBdChzdHlsZXNTdHJpbmcubGVuZ3RoIC0gMSkgIT0gJzsnKSB7CiAgICBzdHlsZXNTdHJpbmcgPSBzdHlsZXNTdHJpbmcgKyAnOyc7CiAgfSAvLyBTZWVrIHRoZSB3aG9sZSBzdHJpbmcgZm9yICJzcGVjaWFsIGNoYXJhY3RlcnMiLgoKCiAgZm9yIChsZXQgaSA9IDA7IGkgPCBzdHlsZXNTdHJpbmcubGVuZ3RoOyBpKyspIHsKICAgIGNvbnN0IGNoYXIgPSBzdHlsZXNTdHJpbmcuY2hhckF0KGkpOwoKICAgIGlmIChxdW90ZVR5cGUgPT09IG51bGwpIHsKICAgICAgLy8gTm8gcXVvdGUgZm91bmQgeWV0IG9yIGxhc3QgZm91bmQgcXVvdGUgd2FzIGEgY2xvc2luZyBxdW90ZS4KICAgICAgc3dpdGNoIChjaGFyKSB7CiAgICAgICAgY2FzZSAnOic6CiAgICAgICAgICAvLyBNb3N0IG9mIHRpbWUgY29sb24gbWVhbnMgdGhhdCBwcm9wZXJ0eSBuYW1lIGp1c3QgZW5kZWQuCiAgICAgICAgICAvLyBTb21ldGltZXMgaG93ZXZlciBgOmAgaXMgZm91bmQgaW5zaWRlIHByb3BlcnR5IHZhbHVlIChmb3IgZXhhbXBsZSBpbiBiYWNrZ3JvdW5kIGltYWdlIHVybCkuCiAgICAgICAgICBpZiAoIXByb3BlcnR5TmFtZSkgewogICAgICAgICAgICAvLyBUcmVhdCB0aGlzIGFzIGVuZCBvZiBwcm9wZXJ0eSBvbmx5IGlmIHByb3BlcnR5IG5hbWUgaXMgbm90IGFscmVhZHkgc2F2ZWQuCiAgICAgICAgICAgIC8vIFNhdmUgcHJvcGVydHkgbmFtZS4KICAgICAgICAgICAgcHJvcGVydHlOYW1lID0gc3R5bGVzU3RyaW5nLnN1YnN0cihwcm9wZXJ0eU5hbWVTdGFydCwgaSAtIHByb3BlcnR5TmFtZVN0YXJ0KTsgLy8gU2F2ZSB0aGlzIHBvaW50IGFzIHRoZSBzdGFydCBvZiBwcm9wZXJ0eSB2YWx1ZS4KCiAgICAgICAgICAgIHByb3BlcnR5VmFsdWVTdGFydCA9IGkgKyAxOwogICAgICAgICAgfQoKICAgICAgICAgIGJyZWFrOwoKICAgICAgICBjYXNlICciJzoKICAgICAgICBjYXNlICdcJyc6CiAgICAgICAgICAvLyBPcGVuaW5nIHF1b3RlIGZvdW5kICh0aGlzIGlzIGFuIG9wZW5pbmcgcXVvdGUsIGJlY2F1c2UgYHF1b3RlVHlwZWAgaXMgYG51bGxgKS4KICAgICAgICAgIHF1b3RlVHlwZSA9IGNoYXI7CiAgICAgICAgICBicmVhazsKCiAgICAgICAgY2FzZSAnOyc6CiAgICAgICAgICB7CiAgICAgICAgICAgIC8vIFByb3BlcnR5IHZhbHVlIGp1c3QgZW5kZWQuCiAgICAgICAgICAgIC8vIFVzZSBwcmV2aW91c2x5IHN0b3JlZCBwcm9wZXJ0eSB2YWx1ZSBzdGFydCB0byBvYnRhaW4gcHJvcGVydHkgdmFsdWUuCiAgICAgICAgICAgIGNvbnN0IHByb3BlcnR5VmFsdWUgPSBzdHlsZXNTdHJpbmcuc3Vic3RyKHByb3BlcnR5VmFsdWVTdGFydCwgaSAtIHByb3BlcnR5VmFsdWVTdGFydCk7CgogICAgICAgICAgICBpZiAocHJvcGVydHlOYW1lKSB7CiAgICAgICAgICAgICAgLy8gU2F2ZSBwYXJzZWQgcGFydC4KICAgICAgICAgICAgICBzdHlsZXNNYXAuc2V0KHByb3BlcnR5TmFtZS50cmltKCksIHByb3BlcnR5VmFsdWUudHJpbSgpKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcHJvcGVydHlOYW1lID0gbnVsbDsgLy8gU2F2ZSB0aGlzIHBvaW50IGFzIHByb3BlcnR5IG5hbWUgc3RhcnQuIFByb3BlcnR5IG5hbWUgc3RhcnRzIGltbWVkaWF0ZWx5IGFmdGVyIHByZXZpb3VzIHByb3BlcnR5IHZhbHVlIGVuZHMuCgogICAgICAgICAgICBwcm9wZXJ0eU5hbWVTdGFydCA9IGkgKyAxOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KICAgICAgfQogICAgfSBlbHNlIGlmIChjaGFyID09PSBxdW90ZVR5cGUpIHsKICAgICAgLy8gSWYgYSBxdW90ZSBjaGFyIGlzIGZvdW5kIGFuZCBpdCBpcyBhIGNsb3NpbmcgcXVvdGUsIG1hcmsgdGhpcyBmYWN0IGJ5IGBudWxsYC1pbmcgYHF1b3RlVHlwZWAuCiAgICAgIHF1b3RlVHlwZSA9IG51bGw7CiAgICB9CiAgfQp9IC8vIFBhcnNlcyBjbGFzcyBhdHRyaWJ1dGUgYW5kIHB1dHMgYWxsIGNsYXNzZXMgaW50byBjbGFzc2VzIHNldC4KLy8gQ2xhc3NlcyBzZXQgcyBjbGVhcmVkIGJlZm9yZSBpbnNlcnRpb24uCi8vCi8vIEBwYXJhbSB7U2V0LjxTdHJpbmc+fSBjbGFzc2VzU2V0IFNldCB0byBpbnNlcnQgcGFyc2VkIGNsYXNzZXMuCi8vIEBwYXJhbSB7U3RyaW5nfSBjbGFzc2VzU3RyaW5nIFN0cmluZyB3aXRoIGNsYXNzZXMgdG8gcGFyc2UuCgoKZnVuY3Rpb24gcGFyc2VDbGFzc2VzKGNsYXNzZXNTZXQsIGNsYXNzZXNTdHJpbmcpIHsKICBjb25zdCBjbGFzc0FycmF5ID0gY2xhc3Nlc1N0cmluZy5zcGxpdCgvXHMrLyk7CiAgY2xhc3Nlc1NldC5jbGVhcigpOwogIGNsYXNzQXJyYXkuZm9yRWFjaChuYW1lID0+IGNsYXNzZXNTZXQuYWRkKG5hbWUpKTsKfSAvLyBDb252ZXJ0cyBzdHJpbmdzIHRvIFRleHQgYW5kIG5vbi1pdGVyYWJsZXMgdG8gYXJyYXlzLgovLwovLyBAcGFyYW0ge1N0cmluZ3xtb2R1bGU6ZW5naW5lL3ZpZXcvaXRlbX5JdGVtfEl0ZXJhYmxlLjxTdHJpbmd8bW9kdWxlOmVuZ2luZS92aWV3L2l0ZW1+SXRlbT59Ci8vIEByZXR1cm5zIHtJdGVyYWJsZS48bW9kdWxlOmVuZ2luZS92aWV3L25vZGV+Tm9kZT59CgoKZnVuY3Rpb24gbm9ybWFsaXplKG5vZGVzKSB7CiAgLy8gU2VwYXJhdGUgY29uZGl0aW9uIGJlY2F1c2Ugc3RyaW5nIGlzIGl0ZXJhYmxlLgogIGlmICh0eXBlb2Ygbm9kZXMgPT0gJ3N0cmluZycpIHsKICAgIHJldHVybiBbbmV3IFRleHQobm9kZXMpXTsKICB9CgogIGlmICghaXNJdGVyYWJsZShub2RlcykpIHsKICAgIG5vZGVzID0gW25vZGVzXTsKICB9IC8vIEFycmF5LmZyb20gdG8gZW5hYmxlIC5tYXAoKSBvbiBub24tYXJyYXlzLgoKCiAgcmV0dXJuIEFycmF5LmZyb20obm9kZXMpLm1hcChub2RlID0+IHsKICAgIGlmICh0eXBlb2Ygbm9kZSA9PSAnc3RyaW5nJykgewogICAgICByZXR1cm4gbmV3IFRleHQobm9kZSk7CiAgICB9CgogICAgaWYgKG5vZGUgaW5zdGFuY2VvZiBUZXh0UHJveHkpIHsKICAgICAgcmV0dXJuIG5ldyBUZXh0KG5vZGUuZGF0YSk7CiAgICB9CgogICAgcmV0dXJuIG5vZGU7CiAgfSk7Cn0="},{"version":3,"sources":["/Users/antonyching/Desktop/project/new-builder-demo/node_modules/@ckeditor/ckeditor5-engine/src/view/element.js"],"names":["Node","Text","TextProxy","objectToMap","isIterable","Matcher","isPlainObject","Element","constructor","name","attrs","children","_attrs","parseAttributes","_children","_insertChild","_classes","Set","has","classString","get","parseClasses","delete","_styles","Map","parseInlineStyles","_customProperties","childCount","length","isEmpty","is","type","cutType","replace","getChild","index","getChildIndex","node","indexOf","getChildren","Symbol","iterator","getAttributeKeys","size","keys","getAttributes","entries","getAttribute","key","join","undefined","styleString","property","value","hasAttribute","isSimilar","otherElement","className","hasClass","getClassNames","getStyle","getStyleNames","hasStyle","findAncestor","patterns","matcher","parent","match","getCustomProperty","getCustomProperties","getIdentity","classes","Array","from","sort","styles","map","i","attributes","_clone","deep","childrenClone","child","push","cloned","getFillerOffset","_appendChild","items","_fireChange","count","nodes","normalize","_remove","splice","_removeChildren","howMany","_setAttribute","String","set","_removeAttribute","clear","_addClass","isArray","forEach","add","_removeClass","_setStyle","Object","_removeStyle","_setCustomProperty","_removeCustomProperty","stylesMap","stylesString","quoteType","propertyNameStart","propertyValueStart","propertyName","charAt","char","substr","propertyValue","trim","classesSet","classesString","classArray","split","data"],"mappings":"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","sourcesContent":["/**\n * @license Copyright (c) 2003-2019, CKSource - Frederico Knabben. All rights reserved.\n * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license\n */\n\n/**\n * @module engine/view/element\n */\n\nimport Node from './node';\nimport Text from './text';\nimport TextProxy from './textproxy';\nimport objectToMap from '@ckeditor/ckeditor5-utils/src/objecttomap';\nimport isIterable from '@ckeditor/ckeditor5-utils/src/isiterable';\nimport Matcher from './matcher';\nimport { isPlainObject } from 'lodash-es';\n\n// @if CK_DEBUG_ENGINE // const { convertMapToTags } = require( '../dev-utils/utils' );\n\n/**\n * View element.\n *\n * The editing engine does not define a fixed semantics of its elements (it is \"DTD-free\").\n * This is why the type of the {@link module:engine/view/element~Element} need to\n * be defined by the feature developer. When creating an element you should use one of the following methods:\n *\n * * {@link module:engine/view/downcastwriter~DowncastWriter#createContainerElement `downcastWriter#createContainerElement()`}\n * in order to create a {@link module:engine/view/containerelement~ContainerElement},\n * * {@link module:engine/view/downcastwriter~DowncastWriter#createAttributeElement `downcastWriter#createAttributeElement()`}\n * in order to create a {@link module:engine/view/attributeelement~AttributeElement},\n * * {@link module:engine/view/downcastwriter~DowncastWriter#createEmptyElement `downcastWriter#createEmptyElement()`}\n * in order to create a {@link module:engine/view/emptyelement~EmptyElement}.\n * * {@link module:engine/view/downcastwriter~DowncastWriter#createUIElement `downcastWriter#createUIElement()`}\n * in order to create a {@link module:engine/view/uielement~UIElement}.\n * * {@link module:engine/view/downcastwriter~DowncastWriter#createEditableElement `downcastWriter#createEditableElement()`}\n * in order to create a {@link module:engine/view/editableelement~EditableElement}.\n *\n * Note that for view elements which are not created from the model, like elements from mutations, paste or\n * {@link module:engine/controller/datacontroller~DataController#set data.set} it is not possible to define the type of the element.\n * In such cases the {@link module:engine/view/upcastwriter~UpcastWriter#createElement `UpcastWriter#createElement()`} method\n * should be used to create generic view elements.\n *\n * @extends module:engine/view/node~Node\n */\nexport default class Element extends Node {\n\t/**\n\t * Creates a view element.\n\t *\n\t * Attributes can be passed in various formats:\n\t *\n\t *\t\tnew Element( 'div', { class: 'editor', contentEditable: 'true' } ); // object\n\t *\t\tnew Element( 'div', [ [ 'class', 'editor' ], [ 'contentEditable', 'true' ] ] ); // map-like iterator\n\t *\t\tnew Element( 'div', mapOfAttributes ); // map\n\t *\n\t * @protected\n\t * @param {String} name Node name.\n\t * @param {Object|Iterable} [attrs] Collection of attributes.\n\t * @param {module:engine/view/node~Node|Iterable.<module:engine/view/node~Node>} [children]\n\t * A list of nodes to be inserted into created element.\n\t */\n\tconstructor( name, attrs, children ) {\n\t\tsuper();\n\n\t\t/**\n\t\t * Name of the element.\n\t\t *\n\t\t * @readonly\n\t\t * @member {String}\n\t\t */\n\t\tthis.name = name;\n\n\t\t/**\n\t\t * Map of attributes, where attributes names are keys and attributes values are values.\n\t\t *\n\t\t * @protected\n\t\t * @member {Map} #_attrs\n\t\t */\n\t\tthis._attrs = parseAttributes( attrs );\n\n\t\t/**\n\t\t * Array of child nodes.\n\t\t *\n\t\t * @protected\n\t\t * @member {Array.<module:engine/view/node~Node>}\n\t\t */\n\t\tthis._children = [];\n\n\t\tif ( children ) {\n\t\t\tthis._insertChild( 0, children );\n\t\t}\n\n\t\t/**\n\t\t * Set of classes associated with element instance.\n\t\t *\n\t\t * @protected\n\t\t * @member {Set}\n\t\t */\n\t\tthis._classes = new Set();\n\n\t\tif ( this._attrs.has( 'class' ) ) {\n\t\t\t// Remove class attribute and handle it by class set.\n\t\t\tconst classString = this._attrs.get( 'class' );\n\t\t\tparseClasses( this._classes, classString );\n\t\t\tthis._attrs.delete( 'class' );\n\t\t}\n\n\t\t/**\n\t\t * Map of styles.\n\t\t *\n\t\t * @protected\n\t\t * @member {Map} module:engine/view/element~Element#_styles\n\t\t */\n\t\tthis._styles = new Map();\n\n\t\tif ( this._attrs.has( 'style' ) ) {\n\t\t\t// Remove style attribute and handle it by styles map.\n\t\t\tparseInlineStyles( this._styles, this._attrs.get( 'style' ) );\n\t\t\tthis._attrs.delete( 'style' );\n\t\t}\n\n\t\t/**\n\t\t * Map of custom properties.\n\t\t * Custom properties can be added to element instance, will be cloned but not rendered into DOM.\n\t\t *\n\t\t * @protected\n\t\t * @member {Map}\n\t\t */\n\t\tthis._customProperties = new Map();\n\t}\n\n\t/**\n\t * Number of element's children.\n\t *\n\t * @readonly\n\t * @type {Number}\n\t */\n\tget childCount() {\n\t\treturn this._children.length;\n\t}\n\n\t/**\n\t * Is `true` if there are no nodes inside this element, `false` otherwise.\n\t *\n\t * @readonly\n\t * @type {Boolean}\n\t */\n\tget isEmpty() {\n\t\treturn this._children.length === 0;\n\t}\n\n\t/**\n\t * Checks whether this object is of the given.\n\t *\n\t *\t\telement.is( 'element' ); // -> true\n\t *\t\telement.is( 'node' ); // -> true\n\t *\t\telement.is( 'view:element' ); // -> true\n\t *\t\telement.is( 'view:node' ); // -> true\n\t *\n\t *\t\telement.is( 'model:element' ); // -> false\n\t *\t\telement.is( 'documentSelection' ); // -> false\n\t *\n\t * Assuming that the object being checked is an element, you can also check its\n\t * {@link module:engine/view/element~Element#name name}:\n\t *\n\t *\t\telement.is( 'img' ); // -> true if this is an <img> element\n\t *\t\telement.is( 'element', 'img' ); // -> same as above\n\t *\t\ttext.is( 'img' ); -> false\n\t *\n\t * {@link module:engine/view/node~Node#is Check the entire list of view objects} which implement the `is()` method.\n\t *\n\t * @param {String} type Type to check when `name` parameter is present.\n\t * Otherwise, it acts like the `name` parameter.\n\t * @param {String} [name] Element name.\n\t * @returns {Boolean}\n\t */\n\tis( type, name = null ) {\n\t\tconst cutType = type.replace( /^view:/, '' );\n\t\tif ( !name ) {\n\t\t\treturn cutType == 'element' || cutType == this.name || super.is( type );\n\t\t} else {\n\t\t\treturn cutType == 'element' && name == this.name;\n\t\t}\n\t}\n\n\t/**\n\t * Gets child at the given index.\n\t *\n\t * @param {Number} index Index of child.\n\t * @returns {module:engine/view/node~Node} Child node.\n\t */\n\tgetChild( index ) {\n\t\treturn this._children[ index ];\n\t}\n\n\t/**\n\t * Gets index of the given child node. Returns `-1` if child node is not found.\n\t *\n\t * @param {module:engine/view/node~Node} node Child node.\n\t * @returns {Number} Index of the child node.\n\t */\n\tgetChildIndex( node ) {\n\t\treturn this._children.indexOf( node );\n\t}\n\n\t/**\n\t * Gets child nodes iterator.\n\t *\n\t * @returns {Iterable.<module:engine/view/node~Node>} Child nodes iterator.\n\t */\n\tgetChildren() {\n\t\treturn this._children[ Symbol.iterator ]();\n\t}\n\n\t/**\n\t * Returns an iterator that contains the keys for attributes. Order of inserting attributes is not preserved.\n\t *\n\t * @returns {Iterable.<String>} Keys for attributes.\n\t */\n\t* getAttributeKeys() {\n\t\tif ( this._classes.size > 0 ) {\n\t\t\tyield 'class';\n\t\t}\n\n\t\tif ( this._styles.size > 0 ) {\n\t\t\tyield 'style';\n\t\t}\n\n\t\tyield* this._attrs.keys();\n\t}\n\n\t/**\n\t * Returns iterator that iterates over this element's attributes.\n\t *\n\t * Attributes are returned as arrays containing two items. First one is attribute key and second is attribute value.\n\t * This format is accepted by native `Map` object and also can be passed in `Node` constructor.\n\t *\n\t * @returns {Iterable.<*>}\n\t */\n\t* getAttributes() {\n\t\tyield* this._attrs.entries();\n\n\t\tif ( this._classes.size > 0 ) {\n\t\t\tyield [ 'class', this.getAttribute( 'class' ) ];\n\t\t}\n\n\t\tif ( this._styles.size > 0 ) {\n\t\t\tyield [ 'style', this.getAttribute( 'style' ) ];\n\t\t}\n\t}\n\n\t/**\n\t * Gets attribute by key. If attribute is not present - returns undefined.\n\t *\n\t * @param {String} key Attribute key.\n\t * @returns {String|undefined} Attribute value.\n\t */\n\tgetAttribute( key ) {\n\t\tif ( key == 'class' ) {\n\t\t\tif ( this._classes.size > 0 ) {\n\t\t\t\treturn [ ...this._classes ].join( ' ' );\n\t\t\t}\n\n\t\t\treturn undefined;\n\t\t}\n\n\t\tif ( key == 'style' ) {\n\t\t\tif ( this._styles.size > 0 ) {\n\t\t\t\tlet styleString = '';\n\n\t\t\t\tfor ( const [ property, value ] of this._styles ) {\n\t\t\t\t\tstyleString += `${ property }:${ value };`;\n\t\t\t\t}\n\n\t\t\t\treturn styleString;\n\t\t\t}\n\n\t\t\treturn undefined;\n\t\t}\n\n\t\treturn this._attrs.get( key );\n\t}\n\n\t/**\n\t * Returns a boolean indicating whether an attribute with the specified key exists in the element.\n\t *\n\t * @param {String} key Attribute key.\n\t * @returns {Boolean} `true` if attribute with the specified key exists in the element, false otherwise.\n\t */\n\thasAttribute( key ) {\n\t\tif ( key == 'class' ) {\n\t\t\treturn this._classes.size > 0;\n\t\t}\n\n\t\tif ( key == 'style' ) {\n\t\t\treturn this._styles.size > 0;\n\t\t}\n\n\t\treturn this._attrs.has( key );\n\t}\n\n\t/**\n\t * Checks if this element is similar to other element.\n\t * Both elements should have the same name and attributes to be considered as similar. Two similar elements\n\t * can contain different set of children nodes.\n\t *\n\t * @param {module:engine/view/element~Element} otherElement\n\t * @returns {Boolean}\n\t */\n\tisSimilar( otherElement ) {\n\t\tif ( !( otherElement instanceof Element ) ) {\n\t\t\treturn false;\n\t\t}\n\n\t\t// If exactly the same Element is provided - return true immediately.\n\t\tif ( this === otherElement ) {\n\t\t\treturn true;\n\t\t}\n\n\t\t// Check element name.\n\t\tif ( this.name != otherElement.name ) {\n\t\t\treturn false;\n\t\t}\n\n\t\t// Check number of attributes, classes and styles.\n\t\tif ( this._attrs.size !== otherElement._attrs.size || this._classes.size !== otherElement._classes.size ||\n\t\t\tthis._styles.size !== otherElement._styles.size ) {\n\t\t\treturn false;\n\t\t}\n\n\t\t// Check if attributes are the same.\n\t\tfor ( const [ key, value ] of this._attrs ) {\n\t\t\tif ( !otherElement._attrs.has( key ) || otherElement._attrs.get( key ) !== value ) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\n\t\t// Check if classes are the same.\n\t\tfor ( const className of this._classes ) {\n\t\t\tif ( !otherElement._classes.has( className ) ) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\n\t\t// Check if styles are the same.\n\t\tfor ( const [ property, value ] of this._styles ) {\n\t\t\tif ( !otherElement._styles.has( property ) || otherElement._styles.get( property ) !== value ) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\n\t\treturn true;\n\t}\n\n\t/**\n\t * Returns true if class is present.\n\t * If more then one class is provided - returns true only when all classes are present.\n\t *\n\t *\t\telement.hasClass( 'foo' ); // Returns true if 'foo' class is present.\n\t *\t\telement.hasClass( 'foo', 'bar' ); // Returns true if 'foo' and 'bar' classes are both present.\n\t *\n\t * @param {...String} className\n\t */\n\thasClass( ...className ) {\n\t\tfor ( const name of className ) {\n\t\t\tif ( !this._classes.has( name ) ) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\n\t\treturn true;\n\t}\n\n\t/**\n\t * Returns iterator that contains all class names.\n\t *\n\t * @returns {Iterable.<String>}\n\t */\n\tgetClassNames() {\n\t\treturn this._classes.keys();\n\t}\n\n\t/**\n\t * Returns style value for given property.\n\t * Undefined is returned if style does not exist.\n\t *\n\t * @param {String} property\n\t * @returns {String|undefined}\n\t */\n\tgetStyle( property ) {\n\t\treturn this._styles.get( property );\n\t}\n\n\t/**\n\t * Returns iterator that contains all style names.\n\t *\n\t * @returns {Iterable.<String>}\n\t */\n\tgetStyleNames() {\n\t\treturn this._styles.keys();\n\t}\n\n\t/**\n\t * Returns true if style keys are present.\n\t * If more then one style property is provided - returns true only when all properties are present.\n\t *\n\t *\t\telement.hasStyle( 'color' ); // Returns true if 'border-top' style is present.\n\t *\t\telement.hasStyle( 'color', 'border-top' ); // Returns true if 'color' and 'border-top' styles are both present.\n\t *\n\t * @param {...String} property\n\t */\n\thasStyle( ...property ) {\n\t\tfor ( const name of property ) {\n\t\t\tif ( !this._styles.has( name ) ) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\n\t\treturn true;\n\t}\n\n\t/**\n\t * Returns ancestor element that match specified pattern.\n\t * Provided patterns should be compatible with {@link module:engine/view/matcher~Matcher Matcher} as it is used internally.\n\t *\n\t * @see module:engine/view/matcher~Matcher\n\t * @param {Object|String|RegExp|Function} patterns Patterns used to match correct ancestor.\n\t * See {@link module:engine/view/matcher~Matcher}.\n\t * @returns {module:engine/view/element~Element|null} Found element or `null` if no matching ancestor was found.\n\t */\n\tfindAncestor( ...patterns ) {\n\t\tconst matcher = new Matcher( ...patterns );\n\t\tlet parent = this.parent;\n\n\t\twhile ( parent ) {\n\t\t\tif ( matcher.match( parent ) ) {\n\t\t\t\treturn parent;\n\t\t\t}\n\n\t\t\tparent = parent.parent;\n\t\t}\n\n\t\treturn null;\n\t}\n\n\t/**\n\t * Returns the custom property value for the given key.\n\t *\n\t * @param {String|Symbol} key\n\t * @returns {*}\n\t */\n\tgetCustomProperty( key ) {\n\t\treturn this._customProperties.get( key );\n\t}\n\n\t/**\n\t * Returns an iterator which iterates over this element's custom properties.\n\t * Iterator provides `[ key, value ]` pairs for each stored property.\n\t *\n\t * @returns {Iterable.<*>}\n\t */\n\t* getCustomProperties() {\n\t\tyield* this._customProperties.entries();\n\t}\n\n\t/**\n\t * Returns identity string based on element's name, styles, classes and other attributes.\n\t * Two elements that {@link #isSimilar are similar} will have same identity string.\n\t * It has the following format:\n\t *\n\t *\t\t'name class=\"class1,class2\" style=\"style1:value1;style2:value2\" attr1=\"val1\" attr2=\"val2\"'\n \t *\n\t * For example:\n\t *\n\t *\t\tconst element = writer.createContainerElement( 'foo', {\n\t *\t\t\tbanana: '10',\n\t *\t\t\tapple: '20',\n\t *\t\t\tstyle: 'color: red; border-color: white;',\n\t *\t\t\tclass: 'baz'\n\t *\t\t} );\n\t *\n\t *\t\t// returns 'foo class=\"baz\" style=\"border-color:white;color:red\" apple=\"20\" banana=\"10\"'\n\t *\t\telement.getIdentity();\n\t *\n\t * NOTE: Classes, styles and other attributes are sorted alphabetically.\n\t *\n\t * @returns {String}\n\t */\n\tgetIdentity() {\n\t\tconst classes = Array.from( this._classes ).sort().join( ',' );\n\t\tconst styles = Array.from( this._styles ).map( i => `${ i[ 0 ] }:${ i[ 1 ] }` ).sort().join( ';' );\n\t\tconst attributes = Array.from( this._attrs ).map( i => `${ i[ 0 ] }=\"${ i[ 1 ] }\"` ).sort().join( ' ' );\n\n\t\treturn this.name +\n\t\t\t( classes == '' ? '' : ` class=\"${ classes }\"` ) +\n\t\t\t( styles == '' ? '' : ` style=\"${ styles }\"` ) +\n\t\t\t( attributes == '' ? '' : ` ${ attributes }` );\n\t}\n\n\t/**\n\t * Clones provided element.\n\t *\n\t * @protected\n\t * @param {Boolean} [deep=false] If set to `true` clones element and all its children recursively. When set to `false`,\n\t * element will be cloned without any children.\n\t * @returns {module:engine/view/element~Element} Clone of this element.\n\t */\n\t_clone( deep = false ) {\n\t\tconst childrenClone = [];\n\n\t\tif ( deep ) {\n\t\t\tfor ( const child of this.getChildren() ) {\n\t\t\t\tchildrenClone.push( child._clone( deep ) );\n\t\t\t}\n\t\t}\n\n\t\t// ContainerElement and AttributeElement should be also cloned properly.\n\t\tconst cloned = new this.constructor( this.name, this._attrs, childrenClone );\n\n\t\t// Classes and styles are cloned separately - this solution is faster than adding them back to attributes and\n\t\t// parse once again in constructor.\n\t\tcloned._classes = new Set( this._classes );\n\t\tcloned._styles = new Map( this._styles );\n\n\t\t// Clone custom properties.\n\t\tcloned._customProperties = new Map( this._customProperties );\n\n\t\t// Clone filler offset method.\n\t\t// We can't define this method in a prototype because it's behavior which\n\t\t// is changed by e.g. toWidget() function from ckeditor5-widget. Perhaps this should be one of custom props.\n\t\tcloned.getFillerOffset = this.getFillerOffset;\n\n\t\treturn cloned;\n\t}\n\n\t/**\n\t * {@link module:engine/view/element~Element#_insertChild Insert} a child node or a list of child nodes at the end of this node\n\t * and sets the parent of these nodes to this element.\n\t *\n\t * @see module:engine/view/downcastwriter~DowncastWriter#insert\n\t * @protected\n\t * @param {module:engine/view/item~Item|Iterable.<module:engine/view/item~Item>} items Items to be inserted.\n\t * @fires module:engine/view/node~Node#change\n\t * @returns {Number} Number of appended nodes.\n\t */\n\t_appendChild( items ) {\n\t\treturn this._insertChild( this.childCount, items );\n\t}\n\n\t/**\n\t * Inserts a child node or a list of child nodes on the given index and sets the parent of these nodes to\n\t * this element.\n\t *\n\t * @see module:engine/view/downcastwriter~DowncastWriter#insert\n\t * @protected\n\t * @param {Number} index Position where nodes should be inserted.\n\t * @param {module:engine/view/item~Item|Iterable.<module:engine/view/item~Item>} items Items to be inserted.\n\t * @fires module:engine/view/node~Node#change\n\t * @returns {Number} Number of inserted nodes.\n\t */\n\t_insertChild( index, items ) {\n\t\tthis._fireChange( 'children', this );\n\t\tlet count = 0;\n\n\t\tconst nodes = normalize( items );\n\n\t\tfor ( const node of nodes ) {\n\t\t\t// If node that is being added to this element is already inside another element, first remove it from the old parent.\n\t\t\tif ( node.parent !== null ) {\n\t\t\t\tnode._remove();\n\t\t\t}\n\n\t\t\tnode.parent = this;\n\n\t\t\tthis._children.splice( index, 0, node );\n\t\t\tindex++;\n\t\t\tcount++;\n\t\t}\n\n\t\treturn count;\n\t}\n\n\t/**\n\t * Removes number of child nodes starting at the given index and set the parent of these nodes to `null`.\n\t *\n\t * @see module:engine/view/downcastwriter~DowncastWriter#remove\n\t * @protected\n\t * @param {Number} index Number of the first node to remove.\n\t * @param {Number} [howMany=1] Number of nodes to remove.\n\t * @fires module:engine/view/node~Node#change\n\t * @returns {Array.<module:engine/view/node~Node>} The array of removed nodes.\n\t */\n\t_removeChildren( index, howMany = 1 ) {\n\t\tthis._fireChange( 'children', this );\n\n\t\tfor ( let i = index; i < index + howMany; i++ ) {\n\t\t\tthis._children[ i ].parent = null;\n\t\t}\n\n\t\treturn this._children.splice( index, howMany );\n\t}\n\n\t/**\n\t * Adds or overwrite attribute with a specified key and value.\n\t *\n\t * @see module:engine/view/downcastwriter~DowncastWriter#setAttribute\n\t * @protected\n\t * @param {String} key Attribute key.\n\t * @param {String} value Attribute value.\n\t * @fires module:engine/view/node~Node#change\n\t */\n\t_setAttribute( key, value ) {\n\t\tvalue = String( value );\n\n\t\tthis._fireChange( 'attributes', this );\n\n\t\tif ( key == 'class' ) {\n\t\t\tparseClasses( this._classes, value );\n\t\t} else if ( key == 'style' ) {\n\t\t\tparseInlineStyles( this._styles, value );\n\t\t} else {\n\t\t\tthis._attrs.set( key, value );\n\t\t}\n\t}\n\n\t/**\n\t * Removes attribute from the element.\n\t *\n\t * @see module:engine/view/downcastwriter~DowncastWriter#removeAttribute\n\t * @protected\n\t * @param {String} key Attribute key.\n\t * @returns {Boolean} Returns true if an attribute existed and has been removed.\n\t * @fires module:engine/view/node~Node#change\n\t */\n\t_removeAttribute( key ) {\n\t\tthis._fireChange( 'attributes', this );\n\n\t\t// Remove class attribute.\n\t\tif ( key == 'class' ) {\n\t\t\tif ( this._classes.size > 0 ) {\n\t\t\t\tthis._classes.clear();\n\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\treturn false;\n\t\t}\n\n\t\t// Remove style attribute.\n\t\tif ( key == 'style' ) {\n\t\t\tif ( this._styles.size > 0 ) {\n\t\t\t\tthis._styles.clear();\n\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\treturn false;\n\t\t}\n\n\t\t// Remove other attributes.\n\t\treturn this._attrs.delete( key );\n\t}\n\n\t/**\n\t * Adds specified class.\n\t *\n\t *\t\telement._addClass( 'foo' ); // Adds 'foo' class.\n\t *\t\telement._addClass( [ 'foo', 'bar' ] ); // Adds 'foo' and 'bar' classes.\n\t *\n\t * @see module:engine/view/downcastwriter~DowncastWriter#addClass\n\t * @protected\n\t * @param {Array.<String>|String} className\n\t * @fires module:engine/view/node~Node#change\n\t */\n\t_addClass( className ) {\n\t\tthis._fireChange( 'attributes', this );\n\n\t\tclassName = Array.isArray( className ) ? className : [ className ];\n\t\tclassName.forEach( name => this._classes.add( name ) );\n\t}\n\n\t/**\n\t * Removes specified class.\n\t *\n\t *\t\telement._removeClass( 'foo' );  // Removes 'foo' class.\n\t *\t\telement._removeClass( [ 'foo', 'bar' ] ); // Removes both 'foo' and 'bar' classes.\n\t *\n\t * @see module:engine/view/downcastwriter~DowncastWriter#removeClass\n\t * @protected\n\t * @param {Array.<String>|String} className\n\t * @fires module:engine/view/node~Node#change\n\t */\n\t_removeClass( className ) {\n\t\tthis._fireChange( 'attributes', this );\n\n\t\tclassName = Array.isArray( className ) ? className : [ className ];\n\t\tclassName.forEach( name => this._classes.delete( name ) );\n\t}\n\n\t/**\n\t * Adds style to the element.\n\t *\n\t *\t\telement._setStyle( 'color', 'red' );\n\t *\t\telement._setStyle( {\n\t *\t\t\tcolor: 'red',\n\t *\t\t\tposition: 'fixed'\n\t *\t\t} );\n\t *\n\t * @see module:engine/view/downcastwriter~DowncastWriter#setStyle\n\t * @protected\n\t * @param {String|Object} property Property name or object with key - value pairs.\n\t * @param {String} [value] Value to set. This parameter is ignored if object is provided as the first parameter.\n\t * @fires module:engine/view/node~Node#change\n\t */\n\t_setStyle( property, value ) {\n\t\tthis._fireChange( 'attributes', this );\n\n\t\tif ( isPlainObject( property ) ) {\n\t\t\tconst keys = Object.keys( property );\n\n\t\t\tfor ( const key of keys ) {\n\t\t\t\tthis._styles.set( key, property[ key ] );\n\t\t\t}\n\t\t} else {\n\t\t\tthis._styles.set( property, value );\n\t\t}\n\t}\n\n\t/**\n\t * Removes specified style.\n\t *\n\t *\t\telement._removeStyle( 'color' );  // Removes 'color' style.\n\t *\t\telement._removeStyle( [ 'color', 'border-top' ] ); // Removes both 'color' and 'border-top' styles.\n\t *\n\t * @see module:engine/view/downcastwriter~DowncastWriter#removeStyle\n\t * @protected\n\t * @param {Array.<String>|String} property\n\t * @fires module:engine/view/node~Node#change\n\t */\n\t_removeStyle( property ) {\n\t\tthis._fireChange( 'attributes', this );\n\n\t\tproperty = Array.isArray( property ) ? property : [ property ];\n\t\tproperty.forEach( name => this._styles.delete( name ) );\n\t}\n\n\t/**\n\t * Sets a custom property. Unlike attributes, custom properties are not rendered to the DOM,\n\t * so they can be used to add special data to elements.\n\t *\n\t * @see module:engine/view/downcastwriter~DowncastWriter#setCustomProperty\n\t * @protected\n\t * @param {String|Symbol} key\n\t * @param {*} value\n\t */\n\t_setCustomProperty( key, value ) {\n\t\tthis._customProperties.set( key, value );\n\t}\n\n\t/**\n\t * Removes the custom property stored under the given key.\n\t *\n\t * @see module:engine/view/downcastwriter~DowncastWriter#removeCustomProperty\n\t * @protected\n\t * @param {String|Symbol} key\n\t * @returns {Boolean} Returns true if property was removed.\n\t */\n\t_removeCustomProperty( key ) {\n\t\treturn this._customProperties.delete( key );\n\t}\n\n\t/**\n\t * Returns block {@link module:engine/view/filler filler} offset or `null` if block filler is not needed.\n\t *\n\t * @abstract\n\t * @method module:engine/view/element~Element#getFillerOffset\n\t */\n\n\t// @if CK_DEBUG_ENGINE // printTree( level = 0) {\n\t// @if CK_DEBUG_ENGINE // \tlet string = '';\n\n\t// @if CK_DEBUG_ENGINE //\tstring += '\\t'.repeat( level ) + `<${ this.name }${ convertMapToTags( this.getAttributes() ) }>`;\n\n\t// @if CK_DEBUG_ENGINE //\tfor ( const child of this.getChildren() ) {\n\t// @if CK_DEBUG_ENGINE //\t\tif ( child.is( 'text' ) ) {\n\t// @if CK_DEBUG_ENGINE //\t\t\tstring += '\\n' + '\\t'.repeat( level + 1 ) + child.data;\n\t// @if CK_DEBUG_ENGINE //\t\t} else {\n\t// @if CK_DEBUG_ENGINE //\t\t\tstring += '\\n' + child.printTree( level + 1 );\n\t// @if CK_DEBUG_ENGINE //\t\t}\n\t// @if CK_DEBUG_ENGINE //\t}\n\n\t// @if CK_DEBUG_ENGINE //\tif ( this.childCount ) {\n\t// @if CK_DEBUG_ENGINE //\t\tstring += '\\n' + '\\t'.repeat( level );\n\t// @if CK_DEBUG_ENGINE //\t}\n\n\t// @if CK_DEBUG_ENGINE //\tstring += `</${ this.name }>`;\n\n\t// @if CK_DEBUG_ENGINE //\treturn string;\n\t// @if CK_DEBUG_ENGINE // }\n\n\t// @if CK_DEBUG_ENGINE // logTree() {\n\t// @if CK_DEBUG_ENGINE // \tconsole.log( this.printTree() );\n\t// @if CK_DEBUG_ENGINE // }\n}\n\n// Parses attributes provided to the element constructor before they are applied to an element. If attributes are passed\n// as an object (instead of `Map`), the object is transformed to the map. Attributes with `null` value are removed.\n// Attributes with non-`String` value are converted to `String`.\n//\n// @param {Object|Map} attrs Attributes to parse.\n// @returns {Map} Parsed attributes.\nfunction parseAttributes( attrs ) {\n\tif ( isPlainObject( attrs ) ) {\n\t\tattrs = objectToMap( attrs );\n\t} else {\n\t\tattrs = new Map( attrs );\n\t}\n\n\tfor ( const [ key, value ] of attrs ) {\n\t\tif ( value === null ) {\n\t\t\tattrs.delete( key );\n\t\t} else if ( typeof value != 'string' ) {\n\t\t\tattrs.set( key, String( value ) );\n\t\t}\n\t}\n\n\treturn attrs;\n}\n\n// Parses inline styles and puts property - value pairs into styles map.\n// Styles map is cleared before insertion.\n//\n// @param {Map.<String, String>} stylesMap Map to insert parsed properties and values.\n// @param {String} stylesString Styles to parse.\nfunction parseInlineStyles( stylesMap, stylesString ) {\n\t// `null` if no quote was found in input string or last found quote was a closing quote. See below.\n\tlet quoteType = null;\n\tlet propertyNameStart = 0;\n\tlet propertyValueStart = 0;\n\tlet propertyName = null;\n\n\tstylesMap.clear();\n\n\t// Do not set anything if input string is empty.\n\tif ( stylesString === '' ) {\n\t\treturn;\n\t}\n\n\t// Fix inline styles that do not end with `;` so they are compatible with algorithm below.\n\tif ( stylesString.charAt( stylesString.length - 1 ) != ';' ) {\n\t\tstylesString = stylesString + ';';\n\t}\n\n\t// Seek the whole string for \"special characters\".\n\tfor ( let i = 0; i < stylesString.length; i++ ) {\n\t\tconst char = stylesString.charAt( i );\n\n\t\tif ( quoteType === null ) {\n\t\t\t// No quote found yet or last found quote was a closing quote.\n\t\t\tswitch ( char ) {\n\t\t\t\tcase ':':\n\t\t\t\t\t// Most of time colon means that property name just ended.\n\t\t\t\t\t// Sometimes however `:` is found inside property value (for example in background image url).\n\t\t\t\t\tif ( !propertyName ) {\n\t\t\t\t\t\t// Treat this as end of property only if property name is not already saved.\n\t\t\t\t\t\t// Save property name.\n\t\t\t\t\t\tpropertyName = stylesString.substr( propertyNameStart, i - propertyNameStart );\n\t\t\t\t\t\t// Save this point as the start of property value.\n\t\t\t\t\t\tpropertyValueStart = i + 1;\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase '\"':\n\t\t\t\tcase '\\'':\n\t\t\t\t\t// Opening quote found (this is an opening quote, because `quoteType` is `null`).\n\t\t\t\t\tquoteType = char;\n\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase ';': {\n\t\t\t\t\t// Property value just ended.\n\t\t\t\t\t// Use previously stored property value start to obtain property value.\n\t\t\t\t\tconst propertyValue = stylesString.substr( propertyValueStart, i - propertyValueStart );\n\n\t\t\t\t\tif ( propertyName ) {\n\t\t\t\t\t\t// Save parsed part.\n\t\t\t\t\t\tstylesMap.set( propertyName.trim(), propertyValue.trim() );\n\t\t\t\t\t}\n\n\t\t\t\t\tpropertyName = null;\n\n\t\t\t\t\t// Save this point as property name start. Property name starts immediately after previous property value ends.\n\t\t\t\t\tpropertyNameStart = i + 1;\n\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t} else if ( char === quoteType ) {\n\t\t\t// If a quote char is found and it is a closing quote, mark this fact by `null`-ing `quoteType`.\n\t\t\tquoteType = null;\n\t\t}\n\t}\n}\n\n// Parses class attribute and puts all classes into classes set.\n// Classes set s cleared before insertion.\n//\n// @param {Set.<String>} classesSet Set to insert parsed classes.\n// @param {String} classesString String with classes to parse.\nfunction parseClasses( classesSet, classesString ) {\n\tconst classArray = classesString.split( /\\s+/ );\n\tclassesSet.clear();\n\tclassArray.forEach( name => classesSet.add( name ) );\n}\n\n// Converts strings to Text and non-iterables to arrays.\n//\n// @param {String|module:engine/view/item~Item|Iterable.<String|module:engine/view/item~Item>}\n// @returns {Iterable.<module:engine/view/node~Node>}\nfunction normalize( nodes ) {\n\t// Separate condition because string is iterable.\n\tif ( typeof nodes == 'string' ) {\n\t\treturn [ new Text( nodes ) ];\n\t}\n\n\tif ( !isIterable( nodes ) ) {\n\t\tnodes = [ nodes ];\n\t}\n\n\t// Array.from to enable .map() on non-arrays.\n\treturn Array.from( nodes )\n\t\t.map( node => {\n\t\t\tif ( typeof node == 'string' ) {\n\t\t\t\treturn new Text( node );\n\t\t\t}\n\n\t\t\tif ( node instanceof TextProxy ) {\n\t\t\t\treturn new Text( node.data );\n\t\t\t}\n\n\t\t\treturn node;\n\t\t} );\n}\n"]}]}
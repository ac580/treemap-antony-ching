{"remainingRequest":"/Users/antonyching/Desktop/project/new-builder-demo/node_modules/babel-loader/lib/index.js!/Users/antonyching/Desktop/project/new-builder-demo/node_modules/@ckeditor/ckeditor5-engine/src/conversion/viewconsumable.js","dependencies":[{"path":"/Users/antonyching/Desktop/project/new-builder-demo/node_modules/@ckeditor/ckeditor5-engine/src/conversion/viewconsumable.js","mtime":499162500000},{"path":"/Users/antonyching/Desktop/project/new-builder-demo/node_modules/@ckeditor/ckeditor5-dev-webpack-plugin/lib/translatesourceloader.js","mtime":499162500000},{"path":"/Users/antonyching/Desktop/project/new-builder-demo/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/antonyching/Desktop/project/new-builder-demo/node_modules/babel-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:LyoqCiAqIEBsaWNlbnNlIENvcHlyaWdodCAoYykgMjAwMy0yMDE5LCBDS1NvdXJjZSAtIEZyZWRlcmljbyBLbmFiYmVuLiBBbGwgcmlnaHRzIHJlc2VydmVkLgogKiBGb3IgbGljZW5zaW5nLCBzZWUgTElDRU5TRS5tZCBvciBodHRwczovL2NrZWRpdG9yLmNvbS9sZWdhbC9ja2VkaXRvci1vc3MtbGljZW5zZQogKi8KCi8qKgogKiBAbW9kdWxlIGVuZ2luZS9jb252ZXJzaW9uL3ZpZXdjb25zdW1hYmxlCiAqLwppbXBvcnQgeyBpc0FycmF5IH0gZnJvbSAnbG9kYXNoLWVzJzsKaW1wb3J0IENLRWRpdG9yRXJyb3IgZnJvbSAnQGNrZWRpdG9yL2NrZWRpdG9yNS11dGlscy9zcmMvY2tlZGl0b3JlcnJvcic7Ci8qKgogKiBDbGFzcyB1c2VkIGZvciBoYW5kbGluZyBjb25zdW1wdGlvbiBvZiB2aWV3IHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvZWxlbWVudH5FbGVtZW50IGVsZW1lbnRzfSwKICoge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy90ZXh0flRleHQgdGV4dCBub2Rlc30gYW5kIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvZG9jdW1lbnRmcmFnbWVudH5Eb2N1bWVudEZyYWdtZW50IGRvY3VtZW50IGZyYWdtZW50c30uCiAqIEVsZW1lbnQncyBuYW1lIGFuZCBpdHMgcGFydHMgKGF0dHJpYnV0ZXMsIGNsYXNzZXMgYW5kIHN0eWxlcykgY2FuIGJlIGNvbnN1bWVkIHNlcGFyYXRlbHkuIENvbnN1bWluZyBhbiBlbGVtZW50J3MgbmFtZQogKiBkb2VzIG5vdCBjb25zdW1lIGl0cyBhdHRyaWJ1dGVzLCBjbGFzc2VzIGFuZCBzdHlsZXMuCiAqIFRvIGFkZCBpdGVtcyBmb3IgY29uc3VtcHRpb24gdXNlIHtAbGluayBtb2R1bGU6ZW5naW5lL2NvbnZlcnNpb24vdmlld2NvbnN1bWFibGV+Vmlld0NvbnN1bWFibGUjYWRkIGFkZCBtZXRob2R9LgogKiBUbyB0ZXN0IGl0ZW1zIHVzZSB7QGxpbmsgbW9kdWxlOmVuZ2luZS9jb252ZXJzaW9uL3ZpZXdjb25zdW1hYmxlflZpZXdDb25zdW1hYmxlI3Rlc3QgdGVzdCBtZXRob2R9LgogKiBUbyBjb25zdW1lIGl0ZW1zIHVzZSB7QGxpbmsgbW9kdWxlOmVuZ2luZS9jb252ZXJzaW9uL3ZpZXdjb25zdW1hYmxlflZpZXdDb25zdW1hYmxlI2NvbnN1bWUgY29uc3VtZSBtZXRob2R9LgogKiBUbyByZXZlcnQgYWxyZWFkeSBjb25zdW1lZCBpdGVtcyB1c2Uge0BsaW5rIG1vZHVsZTplbmdpbmUvY29udmVyc2lvbi92aWV3Y29uc3VtYWJsZX5WaWV3Q29uc3VtYWJsZSNyZXZlcnQgcmV2ZXJ0IG1ldGhvZH0uCiAqCiAqCQl2aWV3Q29uc3VtYWJsZS5hZGQoIGVsZW1lbnQsIHsgbmFtZTogdHJ1ZSB9ICk7IC8vIEFkZHMgZWxlbWVudCdzIG5hbWUgYXMgcmVhZHkgdG8gYmUgY29uc3VtZWQuCiAqCQl2aWV3Q29uc3VtYWJsZS5hZGQoIHRleHROb2RlICk7IC8vIEFkZHMgdGV4dCBub2RlIGZvciBjb25zdW1wdGlvbi4KICoJCXZpZXdDb25zdW1hYmxlLmFkZCggZG9jRnJhZ21lbnQgKTsgLy8gQWRkcyBkb2N1bWVudCBmcmFnbWVudCBmb3IgY29uc3VtcHRpb24uCiAqCQl2aWV3Q29uc3VtYWJsZS50ZXN0KCBlbGVtZW50LCB7IG5hbWU6IHRydWUgfSAgKTsgLy8gVGVzdHMgaWYgZWxlbWVudCdzIG5hbWUgY2FuIGJlIGNvbnN1bWVkLgogKgkJdmlld0NvbnN1bWFibGUudGVzdCggdGV4dE5vZGUgKTsgLy8gVGVzdHMgaWYgdGV4dCBub2RlIGNhbiBiZSBjb25zdW1lZC4KICoJCXZpZXdDb25zdW1hYmxlLnRlc3QoIGRvY0ZyYWdtZW50ICk7IC8vIFRlc3RzIGlmIGRvY3VtZW50IGZyYWdtZW50IGNhbiBiZSBjb25zdW1lZC4KICoJCXZpZXdDb25zdW1hYmxlLmNvbnN1bWUoIGVsZW1lbnQsIHsgbmFtZTogdHJ1ZSB9ICApOyAvLyBDb25zdW1lIGVsZW1lbnQncyBuYW1lLgogKgkJdmlld0NvbnN1bWFibGUuY29uc3VtZSggdGV4dE5vZGUgKTsgLy8gQ29uc3VtZSB0ZXh0IG5vZGUuCiAqCQl2aWV3Q29uc3VtYWJsZS5jb25zdW1lKCBkb2NGcmFnbWVudCApOyAvLyBDb25zdW1lIGRvY3VtZW50IGZyYWdtZW50LgogKgkJdmlld0NvbnN1bWFibGUucmV2ZXJ0KCBlbGVtZW50LCB7IG5hbWU6IHRydWUgfSAgKTsgLy8gUmV2ZXJ0IGFscmVhZHkgY29uc3VtZWQgZWxlbWVudCdzIG5hbWUuCiAqCQl2aWV3Q29uc3VtYWJsZS5yZXZlcnQoIHRleHROb2RlICk7IC8vIFJldmVydCBhbHJlYWR5IGNvbnN1bWVkIHRleHQgbm9kZS4KICoJCXZpZXdDb25zdW1hYmxlLnJldmVydCggZG9jRnJhZ21lbnQgKTsgLy8gUmV2ZXJ0IGFscmVhZHkgY29uc3VtZWQgZG9jdW1lbnQgZnJhZ21lbnQuCiAqLwoKZXhwb3J0IGRlZmF1bHQgY2xhc3MgVmlld0NvbnN1bWFibGUgewogIC8qKgogICAqIENyZWF0ZXMgbmV3IFZpZXdDb25zdW1hYmxlLgogICAqLwogIGNvbnN0cnVjdG9yKCkgewogICAgLyoqCiAgICAgKiBNYXAgb2YgY29uc3VtYWJsZSBlbGVtZW50cy4gSWYge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9lbGVtZW50fkVsZW1lbnQgZWxlbWVudH0gaXMgdXNlZCBhcyBhIGtleSwKICAgICAqIHtAbGluayBtb2R1bGU6ZW5naW5lL2NvbnZlcnNpb24vdmlld2NvbnN1bWFibGV+Vmlld0VsZW1lbnRDb25zdW1hYmxlcyBWaWV3RWxlbWVudENvbnN1bWFibGVzfSBpbnN0YW5jZSBpcyBzdG9yZWQgYXMgdmFsdWUuCiAgICAgKiBGb3Ige0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy90ZXh0flRleHQgdGV4dCBub2Rlc30gYW5kCiAgICAgKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2RvY3VtZW50ZnJhZ21lbnR+RG9jdW1lbnRGcmFnbWVudCBkb2N1bWVudCBmcmFnbWVudHN9IGJvb2xlYW4gdmFsdWUgaXMgc3RvcmVkIGFzIHZhbHVlLgogICAgICoKICAgICAqIEBwcm90ZWN0ZWQKICAgICAqIEBtZW1iZXIge01hcC48bW9kdWxlOmVuZ2luZS9jb252ZXJzaW9uL3ZpZXdjb25zdW1hYmxlflZpZXdFbGVtZW50Q29uc3VtYWJsZXN8Qm9vbGVhbj59CiAgICAqLwogICAgdGhpcy5fY29uc3VtYWJsZXMgPSBuZXcgTWFwKCk7CiAgfQogIC8qKgogICAqIEFkZHMge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9lbGVtZW50fkVsZW1lbnQgdmlldyBlbGVtZW50fSwge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy90ZXh0flRleHQgdGV4dCBub2RlfSBvcgogICAqIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvZG9jdW1lbnRmcmFnbWVudH5Eb2N1bWVudEZyYWdtZW50IGRvY3VtZW50IGZyYWdtZW50fSBhcyByZWFkeSB0byBiZSBjb25zdW1lZC4KICAgKgogICAqCQl2aWV3Q29uc3VtYWJsZS5hZGQoIHAsIHsgbmFtZTogdHJ1ZSB9ICk7IC8vIEFkZHMgZWxlbWVudCdzIG5hbWUgdG8gY29uc3VtZS4KICAgKgkJdmlld0NvbnN1bWFibGUuYWRkKCBwLCB7IGF0dHJpYnV0ZXM6ICduYW1lJyB9ICk7IC8vIEFkZHMgZWxlbWVudCdzIGF0dHJpYnV0ZS4KICAgKgkJdmlld0NvbnN1bWFibGUuYWRkKCBwLCB7IGNsYXNzZXM6ICdmb29iYXInIH0gKTsgLy8gQWRkcyBlbGVtZW50J3MgY2xhc3MuCiAgICoJCXZpZXdDb25zdW1hYmxlLmFkZCggcCwgeyBzdHlsZXM6ICdjb2xvcicgfSApOyAvLyBBZGRzIGVsZW1lbnQncyBzdHlsZQogICAqCQl2aWV3Q29uc3VtYWJsZS5hZGQoIHAsIHsgYXR0cmlidXRlczogJ25hbWUnLCBzdHlsZXM6ICdjb2xvcicgfSApOyAvLyBBZGRzIGF0dHJpYnV0ZSBhbmQgc3R5bGUuCiAgICoJCXZpZXdDb25zdW1hYmxlLmFkZCggcCwgeyBjbGFzc2VzOiBbICdiYXonLCAnYmFyJyBdIH0gKTsgLy8gTXVsdGlwbGUgY29uc3VtYWJsZXMgY2FuIGJlIHByb3ZpZGVkLgogICAqCQl2aWV3Q29uc3VtYWJsZS5hZGQoIHRleHROb2RlICk7IC8vIEFkZHMgdGV4dCBub2RlIHRvIGNvbnN1bWUuCiAgICoJCXZpZXdDb25zdW1hYmxlLmFkZCggZG9jRnJhZ21lbnQgKTsgLy8gQWRkcyBkb2N1bWVudCBmcmFnbWVudCB0byBjb25zdW1lLgogICAqCiAgICogVGhyb3dzIHtAbGluayBtb2R1bGU6dXRpbHMvY2tlZGl0b3JlcnJvcn5DS0VkaXRvckVycm9yIENLRWRpdG9yRXJyb3J9IGB2aWV3Y29uc3VtYWJsZS1pbnZhbGlkLWF0dHJpYnV0ZWAgd2hlbiBgY2xhc3NgIG9yIGBzdHlsZWAKICAgKiBhdHRyaWJ1dGUgaXMgcHJvdmlkZWQgLSBpdCBzaG91bGQgYmUgaGFuZGxlZCBzZXBhcmF0ZWx5IGJ5IHByb3ZpZGluZyBhY3R1YWwgc3R5bGUvY2xhc3MuCiAgICoKICAgKgkJdmlld0NvbnN1bWFibGUuYWRkKCBwLCB7IGF0dHJpYnV0ZXM6ICdzdHlsZScgfSApOyAvLyBUaGlzIGNhbGwgd2lsbCB0aHJvdyBhbiBleGNlcHRpb24uCiAgICoJCXZpZXdDb25zdW1hYmxlLmFkZCggcCwgeyBzdHlsZXM6ICdjb2xvcicgfSApOyAvLyBUaGlzIGlzIHByb3Blcmx5IGhhbmRsZWQgc3R5bGUuCiAgICoKICAgKiBAcGFyYW0ge21vZHVsZTplbmdpbmUvdmlldy9lbGVtZW50fkVsZW1lbnR8bW9kdWxlOmVuZ2luZS92aWV3L3RleHR+VGV4dHxtb2R1bGU6ZW5naW5lL3ZpZXcvZG9jdW1lbnRmcmFnbWVudH5Eb2N1bWVudEZyYWdtZW50fSBlbGVtZW50CiAgICogQHBhcmFtIHtPYmplY3R9IFtjb25zdW1hYmxlc10gVXNlZCBvbmx5IGlmIGZpcnN0IHBhcmFtZXRlciBpcyB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2VsZW1lbnR+RWxlbWVudCB2aWV3IGVsZW1lbnR9IGluc3RhbmNlLgogICAqIEBwYXJhbSB7Qm9vbGVhbn0gY29uc3VtYWJsZXMubmFtZSBJZiBzZXQgdG8gdHJ1ZSBlbGVtZW50J3MgbmFtZSB3aWxsIGJlIGluY2x1ZGVkLgogICAqIEBwYXJhbSB7U3RyaW5nfEFycmF5LjxTdHJpbmc+fSBjb25zdW1hYmxlcy5hdHRyaWJ1dGVzIEF0dHJpYnV0ZSBuYW1lIG9yIGFycmF5IG9mIGF0dHJpYnV0ZSBuYW1lcy4KICAgKiBAcGFyYW0ge1N0cmluZ3xBcnJheS48U3RyaW5nPn0gY29uc3VtYWJsZXMuY2xhc3NlcyBDbGFzcyBuYW1lIG9yIGFycmF5IG9mIGNsYXNzIG5hbWVzLgogICAqIEBwYXJhbSB7U3RyaW5nfEFycmF5LjxTdHJpbmc+fSBjb25zdW1hYmxlcy5zdHlsZXMgU3R5bGUgbmFtZSBvciBhcnJheSBvZiBzdHlsZSBuYW1lcy4KICAgKi8KCgogIGFkZChlbGVtZW50LCBjb25zdW1hYmxlcykgewogICAgbGV0IGVsZW1lbnRDb25zdW1hYmxlczsgLy8gRm9yIHRleHQgbm9kZXMgYW5kIGRvY3VtZW50IGZyYWdtZW50cyBqdXN0IG1hcmsgdGhlbSBhcyBjb25zdW1hYmxlLgoKICAgIGlmIChlbGVtZW50LmlzKCd0ZXh0JykgfHwgZWxlbWVudC5pcygnZG9jdW1lbnRGcmFnbWVudCcpKSB7CiAgICAgIHRoaXMuX2NvbnN1bWFibGVzLnNldChlbGVtZW50LCB0cnVlKTsKCiAgICAgIHJldHVybjsKICAgIH0gLy8gRm9yIGVsZW1lbnRzIGNyZWF0ZSBuZXcgVmlld0VsZW1lbnRDb25zdW1hYmxlcyBvciB1cGRhdGUgYWxyZWFkeSBleGlzdGluZyBvbmUuCgoKICAgIGlmICghdGhpcy5fY29uc3VtYWJsZXMuaGFzKGVsZW1lbnQpKSB7CiAgICAgIGVsZW1lbnRDb25zdW1hYmxlcyA9IG5ldyBWaWV3RWxlbWVudENvbnN1bWFibGVzKCk7CgogICAgICB0aGlzLl9jb25zdW1hYmxlcy5zZXQoZWxlbWVudCwgZWxlbWVudENvbnN1bWFibGVzKTsKICAgIH0gZWxzZSB7CiAgICAgIGVsZW1lbnRDb25zdW1hYmxlcyA9IHRoaXMuX2NvbnN1bWFibGVzLmdldChlbGVtZW50KTsKICAgIH0KCiAgICBlbGVtZW50Q29uc3VtYWJsZXMuYWRkKGNvbnN1bWFibGVzKTsKICB9CiAgLyoqCiAgICogVGVzdHMgaWYge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9lbGVtZW50fkVsZW1lbnQgdmlldyBlbGVtZW50fSwge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy90ZXh0flRleHQgdGV4dCBub2RlfSBvcgogICAqIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvZG9jdW1lbnRmcmFnbWVudH5Eb2N1bWVudEZyYWdtZW50IGRvY3VtZW50IGZyYWdtZW50fSBjYW4gYmUgY29uc3VtZWQuCiAgICogSXQgcmV0dXJucyBgdHJ1ZWAgd2hlbiBhbGwgaXRlbXMgaW5jbHVkZWQgaW4gbWV0aG9kJ3MgY2FsbCBjYW4gYmUgY29uc3VtZWQuIFJldHVybnMgYGZhbHNlYCB3aGVuCiAgICogZmlyc3QgYWxyZWFkeSBjb25zdW1lZCBpdGVtIGlzIGZvdW5kIGFuZCBgbnVsbGAgd2hlbiBmaXJzdCBub24tY29uc3VtYWJsZSBpdGVtIGlzIGZvdW5kLgogICAqCiAgICoJCXZpZXdDb25zdW1hYmxlLnRlc3QoIHAsIHsgbmFtZTogdHJ1ZSB9ICk7IC8vIFRlc3RzIGVsZW1lbnQncyBuYW1lLgogICAqCQl2aWV3Q29uc3VtYWJsZS50ZXN0KCBwLCB7IGF0dHJpYnV0ZXM6ICduYW1lJyB9ICk7IC8vIFRlc3RzIGF0dHJpYnV0ZS4KICAgKgkJdmlld0NvbnN1bWFibGUudGVzdCggcCwgeyBjbGFzc2VzOiAnZm9vYmFyJyB9ICk7IC8vIFRlc3RzIGNsYXNzLgogICAqCQl2aWV3Q29uc3VtYWJsZS50ZXN0KCBwLCB7IHN0eWxlczogJ2NvbG9yJyB9ICk7IC8vIFRlc3RzIHN0eWxlLgogICAqCQl2aWV3Q29uc3VtYWJsZS50ZXN0KCBwLCB7IGF0dHJpYnV0ZXM6ICduYW1lJywgc3R5bGVzOiAnY29sb3InIH0gKTsgLy8gVGVzdHMgYXR0cmlidXRlIGFuZCBzdHlsZS4KICAgKgkJdmlld0NvbnN1bWFibGUudGVzdCggcCwgeyBjbGFzc2VzOiBbICdiYXonLCAnYmFyJyBdIH0gKTsgLy8gTXVsdGlwbGUgY29uc3VtYWJsZXMgY2FuIGJlIHRlc3RlZC4KICAgKgkJdmlld0NvbnN1bWFibGUudGVzdCggdGV4dE5vZGUgKTsgLy8gVGVzdHMgdGV4dCBub2RlLgogICAqCQl2aWV3Q29uc3VtYWJsZS50ZXN0KCBkb2NGcmFnbWVudCApOyAvLyBUZXN0cyBkb2N1bWVudCBmcmFnbWVudC4KICAgKgogICAqIFRlc3RpbmcgY2xhc3NlcyBhbmQgc3R5bGVzIGFzIGF0dHJpYnV0ZSB3aWxsIHRlc3QgaWYgYWxsIGFkZGVkIGNsYXNzZXMvc3R5bGVzIGNhbiBiZSBjb25zdW1lZC4KICAgKgogICAqCQl2aWV3Q29uc3VtYWJsZS50ZXN0KCBwLCB7IGF0dHJpYnV0ZXM6ICdjbGFzcycgfSApOyAvLyBUZXN0cyBpZiBhbGwgYWRkZWQgY2xhc3NlcyBjYW4gYmUgY29uc3VtZWQuCiAgICoJCXZpZXdDb25zdW1hYmxlLnRlc3QoIHAsIHsgYXR0cmlidXRlczogJ3N0eWxlJyB9ICk7IC8vIFRlc3RzIGlmIGFsbCBhZGRlZCBzdHlsZXMgY2FuIGJlIGNvbnN1bWVkLgogICAqCiAgICogQHBhcmFtIHttb2R1bGU6ZW5naW5lL3ZpZXcvZWxlbWVudH5FbGVtZW50fG1vZHVsZTplbmdpbmUvdmlldy90ZXh0flRleHR8bW9kdWxlOmVuZ2luZS92aWV3L2RvY3VtZW50ZnJhZ21lbnR+RG9jdW1lbnRGcmFnbWVudH0gZWxlbWVudAogICAqIEBwYXJhbSB7T2JqZWN0fSBbY29uc3VtYWJsZXNdIFVzZWQgb25seSBpZiBmaXJzdCBwYXJhbWV0ZXIgaXMge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9lbGVtZW50fkVsZW1lbnQgdmlldyBlbGVtZW50fSBpbnN0YW5jZS4KICAgKiBAcGFyYW0ge0Jvb2xlYW59IGNvbnN1bWFibGVzLm5hbWUgSWYgc2V0IHRvIHRydWUgZWxlbWVudCdzIG5hbWUgd2lsbCBiZSBpbmNsdWRlZC4KICAgKiBAcGFyYW0ge1N0cmluZ3xBcnJheS48U3RyaW5nPn0gY29uc3VtYWJsZXMuYXR0cmlidXRlcyBBdHRyaWJ1dGUgbmFtZSBvciBhcnJheSBvZiBhdHRyaWJ1dGUgbmFtZXMuCiAgICogQHBhcmFtIHtTdHJpbmd8QXJyYXkuPFN0cmluZz59IGNvbnN1bWFibGVzLmNsYXNzZXMgQ2xhc3MgbmFtZSBvciBhcnJheSBvZiBjbGFzcyBuYW1lcy4KICAgKiBAcGFyYW0ge1N0cmluZ3xBcnJheS48U3RyaW5nPn0gY29uc3VtYWJsZXMuc3R5bGVzIFN0eWxlIG5hbWUgb3IgYXJyYXkgb2Ygc3R5bGUgbmFtZXMuCiAgICogQHJldHVybnMge0Jvb2xlYW58bnVsbH0gUmV0dXJucyBgdHJ1ZWAgd2hlbiBhbGwgaXRlbXMgaW5jbHVkZWQgaW4gbWV0aG9kJ3MgY2FsbCBjYW4gYmUgY29uc3VtZWQuIFJldHVybnMgYGZhbHNlYAogICAqIHdoZW4gZmlyc3QgYWxyZWFkeSBjb25zdW1lZCBpdGVtIGlzIGZvdW5kIGFuZCBgbnVsbGAgd2hlbiBmaXJzdCBub24tY29uc3VtYWJsZSBpdGVtIGlzIGZvdW5kLgogICAqLwoKCiAgdGVzdChlbGVtZW50LCBjb25zdW1hYmxlcykgewogICAgY29uc3QgZWxlbWVudENvbnN1bWFibGVzID0gdGhpcy5fY29uc3VtYWJsZXMuZ2V0KGVsZW1lbnQpOwoKICAgIGlmIChlbGVtZW50Q29uc3VtYWJsZXMgPT09IHVuZGVmaW5lZCkgewogICAgICByZXR1cm4gbnVsbDsKICAgIH0gLy8gRm9yIHRleHQgbm9kZXMgYW5kIGRvY3VtZW50IGZyYWdtZW50cyByZXR1cm4gc3RvcmVkIGJvb2xlYW4gdmFsdWUuCgoKICAgIGlmIChlbGVtZW50LmlzKCd0ZXh0JykgfHwgZWxlbWVudC5pcygnZG9jdW1lbnRGcmFnbWVudCcpKSB7CiAgICAgIHJldHVybiBlbGVtZW50Q29uc3VtYWJsZXM7CiAgICB9IC8vIEZvciBlbGVtZW50cyB0ZXN0IGNvbnN1bWFibGVzIG9iamVjdC4KCgogICAgcmV0dXJuIGVsZW1lbnRDb25zdW1hYmxlcy50ZXN0KGNvbnN1bWFibGVzKTsKICB9CiAgLyoqCiAgICogQ29uc3VtZXMge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9lbGVtZW50fkVsZW1lbnQgdmlldyBlbGVtZW50fSwge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy90ZXh0flRleHQgdGV4dCBub2RlfSBvcgogICAqIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvZG9jdW1lbnRmcmFnbWVudH5Eb2N1bWVudEZyYWdtZW50IGRvY3VtZW50IGZyYWdtZW50fS4KICAgKiBJdCByZXR1cm5zIGB0cnVlYCB3aGVuIGFsbCBpdGVtcyBpbmNsdWRlZCBpbiBtZXRob2QncyBjYWxsIGNhbiBiZSBjb25zdW1lZCwgb3RoZXJ3aXNlIHJldHVybnMgYGZhbHNlYC4KICAgKgogICAqCQl2aWV3Q29uc3VtYWJsZS5jb25zdW1lKCBwLCB7IG5hbWU6IHRydWUgfSApOyAvLyBDb25zdW1lcyBlbGVtZW50J3MgbmFtZS4KICAgKgkJdmlld0NvbnN1bWFibGUuY29uc3VtZSggcCwgeyBhdHRyaWJ1dGVzOiAnbmFtZScgfSApOyAvLyBDb25zdW1lcyBlbGVtZW50J3MgYXR0cmlidXRlLgogICAqCQl2aWV3Q29uc3VtYWJsZS5jb25zdW1lKCBwLCB7IGNsYXNzZXM6ICdmb29iYXInIH0gKTsgLy8gQ29uc3VtZXMgZWxlbWVudCdzIGNsYXNzLgogICAqCQl2aWV3Q29uc3VtYWJsZS5jb25zdW1lKCBwLCB7IHN0eWxlczogJ2NvbG9yJyB9ICk7IC8vIENvbnN1bWVzIGVsZW1lbnQncyBzdHlsZS4KICAgKgkJdmlld0NvbnN1bWFibGUuY29uc3VtZSggcCwgeyBhdHRyaWJ1dGVzOiAnbmFtZScsIHN0eWxlczogJ2NvbG9yJyB9ICk7IC8vIENvbnN1bWVzIGF0dHJpYnV0ZSBhbmQgc3R5bGUuCiAgICoJCXZpZXdDb25zdW1hYmxlLmNvbnN1bWUoIHAsIHsgY2xhc3NlczogWyAnYmF6JywgJ2JhcicgXSB9ICk7IC8vIE11bHRpcGxlIGNvbnN1bWFibGVzIGNhbiBiZSBjb25zdW1lZC4KICAgKgkJdmlld0NvbnN1bWFibGUuY29uc3VtZSggdGV4dE5vZGUgKTsgLy8gQ29uc3VtZXMgdGV4dCBub2RlLgogICAqCQl2aWV3Q29uc3VtYWJsZS5jb25zdW1lKCBkb2NGcmFnbWVudCApOyAvLyBDb25zdW1lcyBkb2N1bWVudCBmcmFnbWVudC4KICAgKgogICAqIENvbnN1bWluZyBjbGFzc2VzIGFuZCBzdHlsZXMgYXMgYXR0cmlidXRlIHdpbGwgdGVzdCBpZiBhbGwgYWRkZWQgY2xhc3Nlcy9zdHlsZXMgY2FuIGJlIGNvbnN1bWVkLgogICAqCiAgICoJCXZpZXdDb25zdW1hYmxlLmNvbnN1bWUoIHAsIHsgYXR0cmlidXRlczogJ2NsYXNzJyB9ICk7IC8vIENvbnN1bWUgb25seSBpZiBhbGwgYWRkZWQgY2xhc3NlcyBjYW4gYmUgY29uc3VtZWQuCiAgICoJCXZpZXdDb25zdW1hYmxlLmNvbnN1bWUoIHAsIHsgYXR0cmlidXRlczogJ3N0eWxlJyB9ICk7IC8vIENvbnN1bWUgb25seSBpZiBhbGwgYWRkZWQgc3R5bGVzIGNhbiBiZSBjb25zdW1lZC4KICAgKgogICAqIEBwYXJhbSB7bW9kdWxlOmVuZ2luZS92aWV3L2VsZW1lbnR+RWxlbWVudHxtb2R1bGU6ZW5naW5lL3ZpZXcvdGV4dH5UZXh0fG1vZHVsZTplbmdpbmUvdmlldy9kb2N1bWVudGZyYWdtZW50fkRvY3VtZW50RnJhZ21lbnR9IGVsZW1lbnQKICAgKiBAcGFyYW0ge09iamVjdH0gW2NvbnN1bWFibGVzXSBVc2VkIG9ubHkgaWYgZmlyc3QgcGFyYW1ldGVyIGlzIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvZWxlbWVudH5FbGVtZW50IHZpZXcgZWxlbWVudH0gaW5zdGFuY2UuCiAgICogQHBhcmFtIHtCb29sZWFufSBjb25zdW1hYmxlcy5uYW1lIElmIHNldCB0byB0cnVlIGVsZW1lbnQncyBuYW1lIHdpbGwgYmUgaW5jbHVkZWQuCiAgICogQHBhcmFtIHtTdHJpbmd8QXJyYXkuPFN0cmluZz59IGNvbnN1bWFibGVzLmF0dHJpYnV0ZXMgQXR0cmlidXRlIG5hbWUgb3IgYXJyYXkgb2YgYXR0cmlidXRlIG5hbWVzLgogICAqIEBwYXJhbSB7U3RyaW5nfEFycmF5LjxTdHJpbmc+fSBjb25zdW1hYmxlcy5jbGFzc2VzIENsYXNzIG5hbWUgb3IgYXJyYXkgb2YgY2xhc3MgbmFtZXMuCiAgICogQHBhcmFtIHtTdHJpbmd8QXJyYXkuPFN0cmluZz59IGNvbnN1bWFibGVzLnN0eWxlcyBTdHlsZSBuYW1lIG9yIGFycmF5IG9mIHN0eWxlIG5hbWVzLgogICAqIEByZXR1cm5zIHtCb29sZWFufSBSZXR1cm5zIGB0cnVlYCB3aGVuIGFsbCBpdGVtcyBpbmNsdWRlZCBpbiBtZXRob2QncyBjYWxsIGNhbiBiZSBjb25zdW1lZCwKICAgKiBvdGhlcndpc2UgcmV0dXJucyBgZmFsc2VgLgogICAqLwoKCiAgY29uc3VtZShlbGVtZW50LCBjb25zdW1hYmxlcykgewogICAgaWYgKHRoaXMudGVzdChlbGVtZW50LCBjb25zdW1hYmxlcykpIHsKICAgICAgaWYgKGVsZW1lbnQuaXMoJ3RleHQnKSB8fCBlbGVtZW50LmlzKCdkb2N1bWVudEZyYWdtZW50JykpIHsKICAgICAgICAvLyBGb3IgdGV4dCBub2RlcyBhbmQgZG9jdW1lbnQgZnJhZ21lbnRzIHNldCB2YWx1ZSB0byBmYWxzZS4KICAgICAgICB0aGlzLl9jb25zdW1hYmxlcy5zZXQoZWxlbWVudCwgZmFsc2UpOwogICAgICB9IGVsc2UgewogICAgICAgIC8vIEZvciBlbGVtZW50cyAtIGNvbnN1bWUgY29uc3VtYWJsZXMgb2JqZWN0LgogICAgICAgIHRoaXMuX2NvbnN1bWFibGVzLmdldChlbGVtZW50KS5jb25zdW1lKGNvbnN1bWFibGVzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgcmV0dXJuIGZhbHNlOwogIH0KICAvKioKICAgKiBSZXZlcnRzIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvZWxlbWVudH5FbGVtZW50IHZpZXcgZWxlbWVudH0sIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvdGV4dH5UZXh0IHRleHQgbm9kZX0gb3IKICAgKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2RvY3VtZW50ZnJhZ21lbnR+RG9jdW1lbnRGcmFnbWVudCBkb2N1bWVudCBmcmFnbWVudH0gc28gdGhleSBjYW4gYmUgY29uc3VtZWQgb25jZSBhZ2Fpbi4KICAgKiBNZXRob2QgZG9lcyBub3QgcmV2ZXJ0IGl0ZW1zIHRoYXQgd2VyZSBuZXZlciBwcmV2aW91c2x5IGFkZGVkIGZvciBjb25zdW1wdGlvbiwgZXZlbiBpZiB0aGV5IGFyZSBpbmNsdWRlZCBpbgogICAqIG1ldGhvZCdzIGNhbGwuCiAgICoKICAgKgkJdmlld0NvbnN1bWFibGUucmV2ZXJ0KCBwLCB7IG5hbWU6IHRydWUgfSApOyAvLyBSZXZlcnRzIGVsZW1lbnQncyBuYW1lLgogICAqCQl2aWV3Q29uc3VtYWJsZS5yZXZlcnQoIHAsIHsgYXR0cmlidXRlczogJ25hbWUnIH0gKTsgLy8gUmV2ZXJ0cyBlbGVtZW50J3MgYXR0cmlidXRlLgogICAqCQl2aWV3Q29uc3VtYWJsZS5yZXZlcnQoIHAsIHsgY2xhc3NlczogJ2Zvb2JhcicgfSApOyAvLyBSZXZlcnRzIGVsZW1lbnQncyBjbGFzcy4KICAgKgkJdmlld0NvbnN1bWFibGUucmV2ZXJ0KCBwLCB7IHN0eWxlczogJ2NvbG9yJyB9ICk7IC8vIFJldmVydHMgZWxlbWVudCdzIHN0eWxlLgogICAqCQl2aWV3Q29uc3VtYWJsZS5yZXZlcnQoIHAsIHsgYXR0cmlidXRlczogJ25hbWUnLCBzdHlsZXM6ICdjb2xvcicgfSApOyAvLyBSZXZlcnRzIGF0dHJpYnV0ZSBhbmQgc3R5bGUuCiAgICoJCXZpZXdDb25zdW1hYmxlLnJldmVydCggcCwgeyBjbGFzc2VzOiBbICdiYXonLCAnYmFyJyBdIH0gKTsgLy8gTXVsdGlwbGUgbmFtZXMgY2FuIGJlIHJldmVydGVkLgogICAqCQl2aWV3Q29uc3VtYWJsZS5yZXZlcnQoIHRleHROb2RlICk7IC8vIFJldmVydHMgdGV4dCBub2RlLgogICAqCQl2aWV3Q29uc3VtYWJsZS5yZXZlcnQoIGRvY0ZyYWdtZW50ICk7IC8vIFJldmVydHMgZG9jdW1lbnQgZnJhZ21lbnQuCiAgICoKICAgKiBSZXZlcnRpbmcgY2xhc3NlcyBhbmQgc3R5bGVzIGFzIGF0dHJpYnV0ZSB3aWxsIHJldmVydCBhbGwgY2xhc3Nlcy9zdHlsZXMgdGhhdCB3ZXJlIHByZXZpb3VzbHkgYWRkZWQgZm9yCiAgICogY29uc3VtcHRpb24uCiAgICoKICAgKgkJdmlld0NvbnN1bWFibGUucmV2ZXJ0KCBwLCB7IGF0dHJpYnV0ZXM6ICdjbGFzcycgfSApOyAvLyBSZXZlcnRzIGFsbCBjbGFzc2VzIGFkZGVkIGZvciBjb25zdW1wdGlvbi4KICAgKgkJdmlld0NvbnN1bWFibGUucmV2ZXJ0KCBwLCB7IGF0dHJpYnV0ZXM6ICdzdHlsZScgfSApOyAvLyBSZXZlcnRzIGFsbCBzdHlsZXMgYWRkZWQgZm9yIGNvbnN1bXB0aW9uLgogICAqCiAgICogQHBhcmFtIHttb2R1bGU6ZW5naW5lL3ZpZXcvZWxlbWVudH5FbGVtZW50fG1vZHVsZTplbmdpbmUvdmlldy90ZXh0flRleHR8bW9kdWxlOmVuZ2luZS92aWV3L2RvY3VtZW50ZnJhZ21lbnR+RG9jdW1lbnRGcmFnbWVudH0gZWxlbWVudAogICAqIEBwYXJhbSB7T2JqZWN0fSBbY29uc3VtYWJsZXNdIFVzZWQgb25seSBpZiBmaXJzdCBwYXJhbWV0ZXIgaXMge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9lbGVtZW50fkVsZW1lbnQgdmlldyBlbGVtZW50fSBpbnN0YW5jZS4KICAgKiBAcGFyYW0ge0Jvb2xlYW59IGNvbnN1bWFibGVzLm5hbWUgSWYgc2V0IHRvIHRydWUgZWxlbWVudCdzIG5hbWUgd2lsbCBiZSBpbmNsdWRlZC4KICAgKiBAcGFyYW0ge1N0cmluZ3xBcnJheS48U3RyaW5nPn0gY29uc3VtYWJsZXMuYXR0cmlidXRlcyBBdHRyaWJ1dGUgbmFtZSBvciBhcnJheSBvZiBhdHRyaWJ1dGUgbmFtZXMuCiAgICogQHBhcmFtIHtTdHJpbmd8QXJyYXkuPFN0cmluZz59IGNvbnN1bWFibGVzLmNsYXNzZXMgQ2xhc3MgbmFtZSBvciBhcnJheSBvZiBjbGFzcyBuYW1lcy4KICAgKiBAcGFyYW0ge1N0cmluZ3xBcnJheS48U3RyaW5nPn0gY29uc3VtYWJsZXMuc3R5bGVzIFN0eWxlIG5hbWUgb3IgYXJyYXkgb2Ygc3R5bGUgbmFtZXMuCiAgICovCgoKICByZXZlcnQoZWxlbWVudCwgY29uc3VtYWJsZXMpIHsKICAgIGNvbnN0IGVsZW1lbnRDb25zdW1hYmxlcyA9IHRoaXMuX2NvbnN1bWFibGVzLmdldChlbGVtZW50KTsKCiAgICBpZiAoZWxlbWVudENvbnN1bWFibGVzICE9PSB1bmRlZmluZWQpIHsKICAgICAgaWYgKGVsZW1lbnQuaXMoJ3RleHQnKSB8fCBlbGVtZW50LmlzKCdkb2N1bWVudEZyYWdtZW50JykpIHsKICAgICAgICAvLyBGb3IgdGV4dCBub2RlcyBhbmQgZG9jdW1lbnQgZnJhZ21lbnRzIC0gc2V0IGNvbnN1bWFibGUgdG8gdHJ1ZS4KICAgICAgICB0aGlzLl9jb25zdW1hYmxlcy5zZXQoZWxlbWVudCwgdHJ1ZSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgLy8gRm9yIGVsZW1lbnRzIC0gcmV2ZXJ0IGl0ZW1zIGZyb20gY29uc3VtYWJsZXMgb2JqZWN0LgogICAgICAgIGVsZW1lbnRDb25zdW1hYmxlcy5yZXZlcnQoY29uc3VtYWJsZXMpOwogICAgICB9CiAgICB9CiAgfQogIC8qKgogICAqIENyZWF0ZXMgY29uc3VtYWJsZSBvYmplY3QgZnJvbSB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2VsZW1lbnR+RWxlbWVudCB2aWV3IGVsZW1lbnR9LiBDb25zdW1hYmxlIG9iamVjdCB3aWxsIGluY2x1ZGUKICAgKiBlbGVtZW50J3MgbmFtZSBhbmQgYWxsIGl0cyBhdHRyaWJ1dGVzLCBjbGFzc2VzIGFuZCBzdHlsZXMuCiAgICoKICAgKiBAc3RhdGljCiAgICogQHBhcmFtIHttb2R1bGU6ZW5naW5lL3ZpZXcvZWxlbWVudH5FbGVtZW50fSBlbGVtZW50CiAgICogQHJldHVybnMge09iamVjdH0gY29uc3VtYWJsZXMKICAgKi8KCgogIHN0YXRpYyBjb25zdW1hYmxlc0Zyb21FbGVtZW50KGVsZW1lbnQpIHsKICAgIGNvbnN0IGNvbnN1bWFibGVzID0gewogICAgICBuYW1lOiB0cnVlLAogICAgICBhdHRyaWJ1dGVzOiBbXSwKICAgICAgY2xhc3NlczogW10sCiAgICAgIHN0eWxlczogW10KICAgIH07CiAgICBjb25zdCBhdHRyaWJ1dGVzID0gZWxlbWVudC5nZXRBdHRyaWJ1dGVLZXlzKCk7CgogICAgZm9yIChjb25zdCBhdHRyaWJ1dGUgb2YgYXR0cmlidXRlcykgewogICAgICAvLyBTa2lwIGNsYXNzZXMgYW5kIHN0eWxlcyAtIHdpbGwgYmUgYWRkZWQgc2VwYXJhdGVseS4KICAgICAgaWYgKGF0dHJpYnV0ZSA9PSAnc3R5bGUnIHx8IGF0dHJpYnV0ZSA9PSAnY2xhc3MnKSB7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KCiAgICAgIGNvbnN1bWFibGVzLmF0dHJpYnV0ZXMucHVzaChhdHRyaWJ1dGUpOwogICAgfQoKICAgIGNvbnN0IGNsYXNzZXMgPSBlbGVtZW50LmdldENsYXNzTmFtZXMoKTsKCiAgICBmb3IgKGNvbnN0IGNsYXNzTmFtZSBvZiBjbGFzc2VzKSB7CiAgICAgIGNvbnN1bWFibGVzLmNsYXNzZXMucHVzaChjbGFzc05hbWUpOwogICAgfQoKICAgIGNvbnN0IHN0eWxlcyA9IGVsZW1lbnQuZ2V0U3R5bGVOYW1lcygpOwoKICAgIGZvciAoY29uc3Qgc3R5bGUgb2Ygc3R5bGVzKSB7CiAgICAgIGNvbnN1bWFibGVzLnN0eWxlcy5wdXNoKHN0eWxlKTsKICAgIH0KCiAgICByZXR1cm4gY29uc3VtYWJsZXM7CiAgfQogIC8qKgogICAqIENyZWF0ZXMge0BsaW5rIG1vZHVsZTplbmdpbmUvY29udmVyc2lvbi92aWV3Y29uc3VtYWJsZX5WaWV3Q29uc3VtYWJsZSBWaWV3Q29uc3VtYWJsZX0gaW5zdGFuY2UgZnJvbQogICAqIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvbm9kZX5Ob2RlIG5vZGV9IG9yIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvZG9jdW1lbnRmcmFnbWVudH5Eb2N1bWVudEZyYWdtZW50IGRvY3VtZW50IGZyYWdtZW50fS4KICAgKiBJbnN0YW5jZSB3aWxsIGNvbnRhaW4gYWxsIGVsZW1lbnRzLCBjaGlsZCBub2RlcywgYXR0cmlidXRlcywgc3R5bGVzIGFuZCBjbGFzc2VzIGFkZGVkIGZvciBjb25zdW1wdGlvbi4KICAgKgogICAqIEBzdGF0aWMKICAgKiBAcGFyYW0ge21vZHVsZTplbmdpbmUvdmlldy9ub2Rlfk5vZGV8bW9kdWxlOmVuZ2luZS92aWV3L2RvY3VtZW50ZnJhZ21lbnR+RG9jdW1lbnRGcmFnbWVudH0gZnJvbSBWaWV3IG5vZGUgb3IgZG9jdW1lbnQgZnJhZ21lbnQKICAgKiBmcm9tIHdoaWNoIGBWaWV3Q29uc3VtYWJsZWAgd2lsbCBiZSBjcmVhdGVkLgogICAqIEBwYXJhbSB7bW9kdWxlOmVuZ2luZS9jb252ZXJzaW9uL3ZpZXdjb25zdW1hYmxlflZpZXdDb25zdW1hYmxlfSBbaW5zdGFuY2VdIElmIHByb3ZpZGVkLCBnaXZlbiBgVmlld0NvbnN1bWFibGVgIGluc3RhbmNlIHdpbGwgYmUgdXNlZAogICAqIHRvIGFkZCBhbGwgY29uc3VtYWJsZXMuIEl0IHdpbGwgYmUgcmV0dXJuZWQgaW5zdGVhZCBvZiBhIG5ldyBpbnN0YW5jZS4KICAgKi8KCgogIHN0YXRpYyBjcmVhdGVGcm9tKGZyb20sIGluc3RhbmNlKSB7CiAgICBpZiAoIWluc3RhbmNlKSB7CiAgICAgIGluc3RhbmNlID0gbmV3IFZpZXdDb25zdW1hYmxlKCk7CiAgICB9CgogICAgaWYgKGZyb20uaXMoJ3RleHQnKSkgewogICAgICBpbnN0YW5jZS5hZGQoZnJvbSk7CiAgICAgIHJldHVybiBpbnN0YW5jZTsKICAgIH0gLy8gQWRkIGBmcm9tYCBpdHNlbGYsIGlmIGl0IGlzIGFuIGVsZW1lbnQuCgoKICAgIGlmIChmcm9tLmlzKCdlbGVtZW50JykpIHsKICAgICAgaW5zdGFuY2UuYWRkKGZyb20sIFZpZXdDb25zdW1hYmxlLmNvbnN1bWFibGVzRnJvbUVsZW1lbnQoZnJvbSkpOwogICAgfQoKICAgIGlmIChmcm9tLmlzKCdkb2N1bWVudEZyYWdtZW50JykpIHsKICAgICAgaW5zdGFuY2UuYWRkKGZyb20pOwogICAgfQoKICAgIGZvciAoY29uc3QgY2hpbGQgb2YgZnJvbS5nZXRDaGlsZHJlbigpKSB7CiAgICAgIGluc3RhbmNlID0gVmlld0NvbnN1bWFibGUuY3JlYXRlRnJvbShjaGlsZCwgaW5zdGFuY2UpOwogICAgfQoKICAgIHJldHVybiBpbnN0YW5jZTsKICB9Cgp9Ci8qKgogKiBUaGlzIGlzIGEgcHJpdmF0ZSBoZWxwZXItY2xhc3MgZm9yIHtAbGluayBtb2R1bGU6ZW5naW5lL2NvbnZlcnNpb24vdmlld2NvbnN1bWFibGV+Vmlld0NvbnN1bWFibGV9LgogKiBJdCByZXByZXNlbnRzIGFuZCBtYW5pcHVsYXRlcyBjb25zdW1hYmxlIHBhcnRzIG9mIGEgc2luZ2xlIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvZWxlbWVudH5FbGVtZW50fS4KICoKICogQHByaXZhdGUKICovCgpjbGFzcyBWaWV3RWxlbWVudENvbnN1bWFibGVzIHsKICAvKioKICAgKiBDcmVhdGVzIFZpZXdFbGVtZW50Q29uc3VtYWJsZXMgaW5zdGFuY2UuCiAgICovCiAgY29uc3RydWN0b3IoKSB7CiAgICAvKioKICAgICAqIEZsYWcgaW5kaWNhdGluZyBpZiBuYW1lIG9mIHRoZSBlbGVtZW50IGNhbiBiZSBjb25zdW1lZC4KICAgICAqCiAgICAgKiBAcHJpdmF0ZQogICAgICogQG1lbWJlciB7Qm9vbGVhbn0KICAgICAqLwogICAgdGhpcy5fY2FuQ29uc3VtZU5hbWUgPSBudWxsOwogICAgLyoqCiAgICAgKiBDb250YWlucyBtYXBzIG9mIGVsZW1lbnQncyBjb25zdW1hYmxlczogYXR0cmlidXRlcywgY2xhc3NlcyBhbmQgc3R5bGVzLgogICAgICoKICAgICAqIEBwcml2YXRlCiAgICAgKiBAbWVtYmVyIHtPYmplY3R9CiAgICAgKi8KCiAgICB0aGlzLl9jb25zdW1hYmxlcyA9IHsKICAgICAgYXR0cmlidXRlczogbmV3IE1hcCgpLAogICAgICBzdHlsZXM6IG5ldyBNYXAoKSwKICAgICAgY2xhc3NlczogbmV3IE1hcCgpCiAgICB9OwogIH0KICAvKioKICAgKiBBZGRzIGNvbnN1bWFibGUgcGFydHMgb2YgdGhlIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvZWxlbWVudH5FbGVtZW50IHZpZXcgZWxlbWVudH0uCiAgICogRWxlbWVudCdzIG5hbWUgaXRzZWxmIGNhbiBiZSBtYXJrZWQgdG8gYmUgY29uc3VtZWQgKHdoZW4gZWxlbWVudCdzIG5hbWUgaXMgY29uc3VtZWQgaXRzIGF0dHJpYnV0ZXMsIGNsYXNzZXMgYW5kCiAgICogc3R5bGVzIHN0aWxsIGNvdWxkIGJlIGNvbnN1bWVkKToKICAgKgogICAqCQljb25zdW1hYmxlcy5hZGQoIHsgbmFtZTogdHJ1ZSB9ICk7CiAgICoKICAgKiBBdHRyaWJ1dGVzIGNsYXNzZXMgYW5kIHN0eWxlczoKICAgKgogICAqCQljb25zdW1hYmxlcy5hZGQoIHsgYXR0cmlidXRlczogJ3RpdGxlJywgY2xhc3NlczogJ2ZvbycsIHN0eWxlczogJ2NvbG9yJyB9ICk7CiAgICoJCWNvbnN1bWFibGVzLmFkZCggeyBhdHRyaWJ1dGVzOiBbICd0aXRsZScsICduYW1lJyBdLCBjbGFzc2VzOiBbICdmb28nLCAnYmFyJyBdICk7CiAgICoKICAgKiBUaHJvd3Mge0BsaW5rIG1vZHVsZTp1dGlscy9ja2VkaXRvcmVycm9yfkNLRWRpdG9yRXJyb3IgQ0tFZGl0b3JFcnJvcn0gYHZpZXdjb25zdW1hYmxlLWludmFsaWQtYXR0cmlidXRlYCB3aGVuIGBjbGFzc2Agb3IgYHN0eWxlYAogICAqIGF0dHJpYnV0ZSBpcyBwcm92aWRlZCAtIGl0IHNob3VsZCBiZSBoYW5kbGVkIHNlcGFyYXRlbHkgYnkgcHJvdmlkaW5nIGBzdHlsZWAgYW5kIGBjbGFzc2AgaW4gY29uc3VtYWJsZXMgb2JqZWN0LgogICAqCiAgICogQHBhcmFtIHtPYmplY3R9IGNvbnN1bWFibGVzIE9iamVjdCBkZXNjcmliaW5nIHdoaWNoIHBhcnRzIG9mIHRoZSBlbGVtZW50IGNhbiBiZSBjb25zdW1lZC4KICAgKiBAcGFyYW0ge0Jvb2xlYW59IGNvbnN1bWFibGVzLm5hbWUgSWYgc2V0IHRvIGB0cnVlYCBlbGVtZW50J3MgbmFtZSB3aWxsIGJlIGFkZGVkIGFzIGNvbnN1bWFibGUuCiAgICogQHBhcmFtIHtTdHJpbmd8QXJyYXkuPFN0cmluZz59IGNvbnN1bWFibGVzLmF0dHJpYnV0ZXMgQXR0cmlidXRlIG5hbWUgb3IgYXJyYXkgb2YgYXR0cmlidXRlIG5hbWVzIHRvIGFkZCBhcyBjb25zdW1hYmxlLgogICAqIEBwYXJhbSB7U3RyaW5nfEFycmF5LjxTdHJpbmc+fSBjb25zdW1hYmxlcy5jbGFzc2VzIENsYXNzIG5hbWUgb3IgYXJyYXkgb2YgY2xhc3MgbmFtZXMgdG8gYWRkIGFzIGNvbnN1bWFibGUuCiAgICogQHBhcmFtIHtTdHJpbmd8QXJyYXkuPFN0cmluZz59IGNvbnN1bWFibGVzLnN0eWxlcyBTdHlsZSBuYW1lIG9yIGFycmF5IG9mIHN0eWxlIG5hbWVzIHRvIGFkZCBhcyBjb25zdW1hYmxlLgogICAqLwoKCiAgYWRkKGNvbnN1bWFibGVzKSB7CiAgICBpZiAoY29uc3VtYWJsZXMubmFtZSkgewogICAgICB0aGlzLl9jYW5Db25zdW1lTmFtZSA9IHRydWU7CiAgICB9CgogICAgZm9yIChjb25zdCB0eXBlIGluIHRoaXMuX2NvbnN1bWFibGVzKSB7CiAgICAgIGlmICh0eXBlIGluIGNvbnN1bWFibGVzKSB7CiAgICAgICAgdGhpcy5fYWRkKHR5cGUsIGNvbnN1bWFibGVzW3R5cGVdKTsKICAgICAgfQogICAgfQogIH0KICAvKioKICAgKiBUZXN0cyBpZiBwYXJ0cyBvZiB0aGUge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9ub2Rlfk5vZGUgdmlldyBub2RlfSBjYW4gYmUgY29uc3VtZWQuCiAgICoKICAgKiBFbGVtZW50J3MgbmFtZSBjYW4gYmUgdGVzdGVkOgogICAqCiAgICoJCWNvbnN1bWFibGVzLnRlc3QoIHsgbmFtZTogdHJ1ZSB9ICk7CiAgICoKICAgKiBBdHRyaWJ1dGVzIGNsYXNzZXMgYW5kIHN0eWxlczoKICAgKgogICAqCQljb25zdW1hYmxlcy50ZXN0KCB7IGF0dHJpYnV0ZXM6ICd0aXRsZScsIGNsYXNzZXM6ICdmb28nLCBzdHlsZXM6ICdjb2xvcicgfSApOwogICAqCQljb25zdW1hYmxlcy50ZXN0KCB7IGF0dHJpYnV0ZXM6IFsgJ3RpdGxlJywgJ25hbWUnIF0sIGNsYXNzZXM6IFsgJ2ZvbycsICdiYXInIF0gKTsKICAgKgogICAqIEBwYXJhbSB7T2JqZWN0fSBjb25zdW1hYmxlcyBPYmplY3QgZGVzY3JpYmluZyB3aGljaCBwYXJ0cyBvZiB0aGUgZWxlbWVudCBzaG91bGQgYmUgdGVzdGVkLgogICAqIEBwYXJhbSB7Qm9vbGVhbn0gY29uc3VtYWJsZXMubmFtZSBJZiBzZXQgdG8gYHRydWVgIGVsZW1lbnQncyBuYW1lIHdpbGwgYmUgdGVzdGVkLgogICAqIEBwYXJhbSB7U3RyaW5nfEFycmF5LjxTdHJpbmc+fSBjb25zdW1hYmxlcy5hdHRyaWJ1dGVzIEF0dHJpYnV0ZSBuYW1lIG9yIGFycmF5IG9mIGF0dHJpYnV0ZSBuYW1lcyB0byB0ZXN0LgogICAqIEBwYXJhbSB7U3RyaW5nfEFycmF5LjxTdHJpbmc+fSBjb25zdW1hYmxlcy5jbGFzc2VzIENsYXNzIG5hbWUgb3IgYXJyYXkgb2YgY2xhc3MgbmFtZXMgdG8gdGVzdC4KICAgKiBAcGFyYW0ge1N0cmluZ3xBcnJheS48U3RyaW5nPn0gY29uc3VtYWJsZXMuc3R5bGVzIFN0eWxlIG5hbWUgb3IgYXJyYXkgb2Ygc3R5bGUgbmFtZXMgdG8gdGVzdC4KICAgKiBAcmV0dXJucyB7Qm9vbGVhbnxudWxsfSBgdHJ1ZWAgd2hlbiBhbGwgdGVzdGVkIGl0ZW1zIGNhbiBiZSBjb25zdW1lZCwgYG51bGxgIHdoZW4gZXZlbiBvbmUgb2YgdGhlIGl0ZW1zCiAgICogd2FzIG5ldmVyIG1hcmtlZCBmb3IgY29uc3VtcHRpb24gYW5kIGBmYWxzZWAgd2hlbiBldmVuIG9uZSBvZiB0aGUgaXRlbXMgd2FzIGFscmVhZHkgY29uc3VtZWQuCiAgICovCgoKICB0ZXN0KGNvbnN1bWFibGVzKSB7CiAgICAvLyBDaGVjayBpZiBuYW1lIGNhbiBiZSBjb25zdW1lZC4KICAgIGlmIChjb25zdW1hYmxlcy5uYW1lICYmICF0aGlzLl9jYW5Db25zdW1lTmFtZSkgewogICAgICByZXR1cm4gdGhpcy5fY2FuQ29uc3VtZU5hbWU7CiAgICB9CgogICAgZm9yIChjb25zdCB0eXBlIGluIHRoaXMuX2NvbnN1bWFibGVzKSB7CiAgICAgIGlmICh0eXBlIGluIGNvbnN1bWFibGVzKSB7CiAgICAgICAgY29uc3QgdmFsdWUgPSB0aGlzLl90ZXN0KHR5cGUsIGNvbnN1bWFibGVzW3R5cGVdKTsKCiAgICAgICAgaWYgKHZhbHVlICE9PSB0cnVlKSB7CiAgICAgICAgICByZXR1cm4gdmFsdWU7CiAgICAgICAgfQogICAgICB9CiAgICB9IC8vIFJldHVybiB0cnVlIG9ubHkgaWYgYWxsIGNhbiBiZSBjb25zdW1lZC4KCgogICAgcmV0dXJuIHRydWU7CiAgfQogIC8qKgogICAqIENvbnN1bWVzIHBhcnRzIG9mIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvZWxlbWVudH5FbGVtZW50IHZpZXcgZWxlbWVudH0uIFRoaXMgZnVuY3Rpb24gZG9lcyBub3QgY2hlY2sgaWYgY29uc3VtYWJsZSBpdGVtCiAgICogaXMgYWxyZWFkeSBjb25zdW1lZCAtIGl0IGNvbnN1bWVzIGFsbCBjb25zdW1hYmxlIGl0ZW1zIHByb3ZpZGVkLgogICAqIEVsZW1lbnQncyBuYW1lIGNhbiBiZSBjb25zdW1lZDoKICAgKgogICAqCQljb25zdW1hYmxlcy5jb25zdW1lKCB7IG5hbWU6IHRydWUgfSApOwogICAqCiAgICogQXR0cmlidXRlcyBjbGFzc2VzIGFuZCBzdHlsZXM6CiAgICoKICAgKgkJY29uc3VtYWJsZXMuY29uc3VtZSggeyBhdHRyaWJ1dGVzOiAndGl0bGUnLCBjbGFzc2VzOiAnZm9vJywgc3R5bGVzOiAnY29sb3InIH0gKTsKICAgKgkJY29uc3VtYWJsZXMuY29uc3VtZSggeyBhdHRyaWJ1dGVzOiBbICd0aXRsZScsICduYW1lJyBdLCBjbGFzc2VzOiBbICdmb28nLCAnYmFyJyBdICk7CiAgICoKICAgKiBAcGFyYW0ge09iamVjdH0gY29uc3VtYWJsZXMgT2JqZWN0IGRlc2NyaWJpbmcgd2hpY2ggcGFydHMgb2YgdGhlIGVsZW1lbnQgc2hvdWxkIGJlIGNvbnN1bWVkLgogICAqIEBwYXJhbSB7Qm9vbGVhbn0gY29uc3VtYWJsZXMubmFtZSBJZiBzZXQgdG8gYHRydWVgIGVsZW1lbnQncyBuYW1lIHdpbGwgYmUgY29uc3VtZWQuCiAgICogQHBhcmFtIHtTdHJpbmd8QXJyYXkuPFN0cmluZz59IGNvbnN1bWFibGVzLmF0dHJpYnV0ZXMgQXR0cmlidXRlIG5hbWUgb3IgYXJyYXkgb2YgYXR0cmlidXRlIG5hbWVzIHRvIGNvbnN1bWUuCiAgICogQHBhcmFtIHtTdHJpbmd8QXJyYXkuPFN0cmluZz59IGNvbnN1bWFibGVzLmNsYXNzZXMgQ2xhc3MgbmFtZSBvciBhcnJheSBvZiBjbGFzcyBuYW1lcyB0byBjb25zdW1lLgogICAqIEBwYXJhbSB7U3RyaW5nfEFycmF5LjxTdHJpbmc+fSBjb25zdW1hYmxlcy5zdHlsZXMgU3R5bGUgbmFtZSBvciBhcnJheSBvZiBzdHlsZSBuYW1lcyB0byBjb25zdW1lLgogICAqLwoKCiAgY29uc3VtZShjb25zdW1hYmxlcykgewogICAgaWYgKGNvbnN1bWFibGVzLm5hbWUpIHsKICAgICAgdGhpcy5fY2FuQ29uc3VtZU5hbWUgPSBmYWxzZTsKICAgIH0KCiAgICBmb3IgKGNvbnN0IHR5cGUgaW4gdGhpcy5fY29uc3VtYWJsZXMpIHsKICAgICAgaWYgKHR5cGUgaW4gY29uc3VtYWJsZXMpIHsKICAgICAgICB0aGlzLl9jb25zdW1lKHR5cGUsIGNvbnN1bWFibGVzW3R5cGVdKTsKICAgICAgfQogICAgfQogIH0KICAvKioKICAgKiBSZXZlcnQgYWxyZWFkeSBjb25zdW1lZCBwYXJ0cyBvZiB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2VsZW1lbnR+RWxlbWVudCB2aWV3IEVsZW1lbnR9LCBzbyB0aGV5IGNhbiBiZSBjb25zdW1lZCBvbmNlIGFnYWluLgogICAqIEVsZW1lbnQncyBuYW1lIGNhbiBiZSByZXZlcnRlZDoKICAgKgogICAqCQljb25zdW1hYmxlcy5yZXZlcnQoIHsgbmFtZTogdHJ1ZSB9ICk7CiAgICoKICAgKiBBdHRyaWJ1dGVzIGNsYXNzZXMgYW5kIHN0eWxlczoKICAgKgogICAqCQljb25zdW1hYmxlcy5yZXZlcnQoIHsgYXR0cmlidXRlczogJ3RpdGxlJywgY2xhc3NlczogJ2ZvbycsIHN0eWxlczogJ2NvbG9yJyB9ICk7CiAgICoJCWNvbnN1bWFibGVzLnJldmVydCggeyBhdHRyaWJ1dGVzOiBbICd0aXRsZScsICduYW1lJyBdLCBjbGFzc2VzOiBbICdmb28nLCAnYmFyJyBdICk7CiAgICoKICAgKiBAcGFyYW0ge09iamVjdH0gY29uc3VtYWJsZXMgT2JqZWN0IGRlc2NyaWJpbmcgd2hpY2ggcGFydHMgb2YgdGhlIGVsZW1lbnQgc2hvdWxkIGJlIHJldmVydGVkLgogICAqIEBwYXJhbSB7Qm9vbGVhbn0gY29uc3VtYWJsZXMubmFtZSBJZiBzZXQgdG8gYHRydWVgIGVsZW1lbnQncyBuYW1lIHdpbGwgYmUgcmV2ZXJ0ZWQuCiAgICogQHBhcmFtIHtTdHJpbmd8QXJyYXkuPFN0cmluZz59IGNvbnN1bWFibGVzLmF0dHJpYnV0ZXMgQXR0cmlidXRlIG5hbWUgb3IgYXJyYXkgb2YgYXR0cmlidXRlIG5hbWVzIHRvIHJldmVydC4KICAgKiBAcGFyYW0ge1N0cmluZ3xBcnJheS48U3RyaW5nPn0gY29uc3VtYWJsZXMuY2xhc3NlcyBDbGFzcyBuYW1lIG9yIGFycmF5IG9mIGNsYXNzIG5hbWVzIHRvIHJldmVydC4KICAgKiBAcGFyYW0ge1N0cmluZ3xBcnJheS48U3RyaW5nPn0gY29uc3VtYWJsZXMuc3R5bGVzIFN0eWxlIG5hbWUgb3IgYXJyYXkgb2Ygc3R5bGUgbmFtZXMgdG8gcmV2ZXJ0LgogICAqLwoKCiAgcmV2ZXJ0KGNvbnN1bWFibGVzKSB7CiAgICBpZiAoY29uc3VtYWJsZXMubmFtZSkgewogICAgICB0aGlzLl9jYW5Db25zdW1lTmFtZSA9IHRydWU7CiAgICB9CgogICAgZm9yIChjb25zdCB0eXBlIGluIHRoaXMuX2NvbnN1bWFibGVzKSB7CiAgICAgIGlmICh0eXBlIGluIGNvbnN1bWFibGVzKSB7CiAgICAgICAgdGhpcy5fcmV2ZXJ0KHR5cGUsIGNvbnN1bWFibGVzW3R5cGVdKTsKICAgICAgfQogICAgfQogIH0KICAvKioKICAgKiBIZWxwZXIgbWV0aG9kIHRoYXQgYWRkcyBjb25zdW1hYmxlcyBvZiBhIGdpdmVuIHR5cGU6IGF0dHJpYnV0ZSwgY2xhc3Mgb3Igc3R5bGUuCiAgICoKICAgKiBUaHJvd3Mge0BsaW5rIG1vZHVsZTp1dGlscy9ja2VkaXRvcmVycm9yfkNLRWRpdG9yRXJyb3IgQ0tFZGl0b3JFcnJvcn0gYHZpZXdjb25zdW1hYmxlLWludmFsaWQtYXR0cmlidXRlYCB3aGVuIGBjbGFzc2Agb3IgYHN0eWxlYAogICAqIHR5cGUgaXMgcHJvdmlkZWQgLSBpdCBzaG91bGQgYmUgaGFuZGxlZCBzZXBhcmF0ZWx5IGJ5IHByb3ZpZGluZyBhY3R1YWwgc3R5bGUvY2xhc3MgdHlwZS4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHtTdHJpbmd9IHR5cGUgVHlwZSBvZiB0aGUgY29uc3VtYWJsZSBpdGVtOiBgYXR0cmlidXRlc2AsIGBjbGFzc2VzYCBvciBgc3R5bGVzYC4KICAgKiBAcGFyYW0ge1N0cmluZ3xBcnJheS48U3RyaW5nPn0gaXRlbSBDb25zdW1hYmxlIGl0ZW0gb3IgYXJyYXkgb2YgaXRlbXMuCiAgICovCgoKICBfYWRkKHR5cGUsIGl0ZW0pIHsKICAgIGNvbnN0IGl0ZW1zID0gaXNBcnJheShpdGVtKSA/IGl0ZW0gOiBbaXRlbV07CiAgICBjb25zdCBjb25zdW1hYmxlcyA9IHRoaXMuX2NvbnN1bWFibGVzW3R5cGVdOwoKICAgIGZvciAoY29uc3QgbmFtZSBvZiBpdGVtcykgewogICAgICBpZiAodHlwZSA9PT0gJ2F0dHJpYnV0ZXMnICYmIChuYW1lID09PSAnY2xhc3MnIHx8IG5hbWUgPT09ICdzdHlsZScpKSB7CiAgICAgICAgLyoqCiAgICAgICAgICogQ2xhc3MgYW5kIHN0eWxlIGF0dHJpYnV0ZXMgc2hvdWxkIGJlIGhhbmRsZWQgc2VwYXJhdGVseSBpbgogICAgICAgICAqIHtAbGluayBtb2R1bGU6ZW5naW5lL2NvbnZlcnNpb24vdmlld2NvbnN1bWFibGV+Vmlld0NvbnN1bWFibGUjYWRkIGBWaWV3Q29uc3VtYWJsZSNhZGQoKWB9LgogICAgICAgICAqCiAgICAgICAgICogV2hhdCB5b3UgaGF2ZSBkb25lIGlzIHRyeWluZyB0byB1c2U6CiAgICAgICAgICoKICAgICAgICAgKgkJY29uc3VtYWJsZXMuYWRkKCB7IGF0dHJpYnV0ZXM6IFsgJ2NsYXNzJywgJ3N0eWxlJyBdIH0gKTsKICAgICAgICAgKgogICAgICAgICAqIFdoaWxlIGVhY2ggY2xhc3MgYW5kIHN0eWxlIHNob3VsZCBiZSByZWdpc3RlcmVkIHNlcGFyYXRlbHk6CiAgICAgICAgICoKICAgICAgICAgKgkJY29uc3VtYWJsZXMuYWRkKCB7IGNsYXNzZXM6ICdzb21lLWNsYXNzJywgc3R5bGVzOiAnZm9udC13ZWlnaHQnIH0gKTsKICAgICAgICAgKgogICAgICAgICAqIEBlcnJvciB2aWV3Y29uc3VtYWJsZS1pbnZhbGlkLWF0dHJpYnV0ZQogICAgICAgICAqLwogICAgICAgIHRocm93IG5ldyBDS0VkaXRvckVycm9yKCd2aWV3Y29uc3VtYWJsZS1pbnZhbGlkLWF0dHJpYnV0ZTogQ2xhc3NlcyBhbmQgc3R5bGVzIHNob3VsZCBiZSBoYW5kbGVkIHNlcGFyYXRlbHkuJywgdGhpcyk7CiAgICAgIH0KCiAgICAgIGNvbnN1bWFibGVzLnNldChuYW1lLCB0cnVlKTsKICAgIH0KICB9CiAgLyoqCiAgICogSGVscGVyIG1ldGhvZCB0aGF0IHRlc3RzIGNvbnN1bWFibGVzIG9mIGEgZ2l2ZW4gdHlwZTogYXR0cmlidXRlLCBjbGFzcyBvciBzdHlsZS4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHtTdHJpbmd9IHR5cGUgVHlwZSBvZiB0aGUgY29uc3VtYWJsZSBpdGVtOiBgYXR0cmlidXRlc2AsIGBjbGFzc2VzYCBvciBgc3R5bGVzYC4KICAgKiBAcGFyYW0ge1N0cmluZ3xBcnJheS48U3RyaW5nPn0gaXRlbSBDb25zdW1hYmxlIGl0ZW0gb3IgYXJyYXkgb2YgaXRlbXMuCiAgICogQHJldHVybnMge0Jvb2xlYW58bnVsbH0gUmV0dXJucyBgdHJ1ZWAgaWYgYWxsIGl0ZW1zIGNhbiBiZSBjb25zdW1lZCwgYG51bGxgIHdoZW4gb25lIG9mIHRoZSBpdGVtcyBjYW5ub3QgYmUKICAgKiBjb25zdW1lZCBhbmQgYGZhbHNlYCB3aGVuIG9uZSBvZiB0aGUgaXRlbXMgaXMgYWxyZWFkeSBjb25zdW1lZC4KICAgKi8KCgogIF90ZXN0KHR5cGUsIGl0ZW0pIHsKICAgIGNvbnN0IGl0ZW1zID0gaXNBcnJheShpdGVtKSA/IGl0ZW0gOiBbaXRlbV07CiAgICBjb25zdCBjb25zdW1hYmxlcyA9IHRoaXMuX2NvbnN1bWFibGVzW3R5cGVdOwoKICAgIGZvciAoY29uc3QgbmFtZSBvZiBpdGVtcykgewogICAgICBpZiAodHlwZSA9PT0gJ2F0dHJpYnV0ZXMnICYmIChuYW1lID09PSAnY2xhc3MnIHx8IG5hbWUgPT09ICdzdHlsZScpKSB7CiAgICAgICAgY29uc3QgY29uc3VtYWJsZU5hbWUgPSBuYW1lID09ICdjbGFzcycgPyAnY2xhc3NlcycgOiAnc3R5bGVzJzsgLy8gQ2hlY2sgYWxsIGNsYXNzZXMvc3R5bGVzIGlmIGNsYXNzL3N0eWxlIGF0dHJpYnV0ZSBpcyB0ZXN0ZWQuCgogICAgICAgIGNvbnN0IHZhbHVlID0gdGhpcy5fdGVzdChjb25zdW1hYmxlTmFtZSwgWy4uLnRoaXMuX2NvbnN1bWFibGVzW2NvbnN1bWFibGVOYW1lXS5rZXlzKCldKTsKCiAgICAgICAgaWYgKHZhbHVlICE9PSB0cnVlKSB7CiAgICAgICAgICByZXR1cm4gdmFsdWU7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIGNvbnN0IHZhbHVlID0gY29uc3VtYWJsZXMuZ2V0KG5hbWUpOyAvLyBSZXR1cm4gbnVsbCBpZiBhdHRyaWJ1dGUgaXMgbm90IGZvdW5kLgoKICAgICAgICBpZiAodmFsdWUgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgfQoKICAgICAgICBpZiAoIXZhbHVlKSB7CiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgcmV0dXJuIHRydWU7CiAgfQogIC8qKgogICAqIEhlbHBlciBtZXRob2QgdGhhdCBjb25zdW1lcyBpdGVtcyBvZiBhIGdpdmVuIHR5cGU6IGF0dHJpYnV0ZSwgY2xhc3Mgb3Igc3R5bGUuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBwYXJhbSB7U3RyaW5nfSB0eXBlIFR5cGUgb2YgdGhlIGNvbnN1bWFibGUgaXRlbTogYGF0dHJpYnV0ZXNgLCBgY2xhc3Nlc2Agb3IgYHN0eWxlc2AuCiAgICogQHBhcmFtIHtTdHJpbmd8QXJyYXkuPFN0cmluZz59IGl0ZW0gQ29uc3VtYWJsZSBpdGVtIG9yIGFycmF5IG9mIGl0ZW1zLgogICAqLwoKCiAgX2NvbnN1bWUodHlwZSwgaXRlbSkgewogICAgY29uc3QgaXRlbXMgPSBpc0FycmF5KGl0ZW0pID8gaXRlbSA6IFtpdGVtXTsKICAgIGNvbnN0IGNvbnN1bWFibGVzID0gdGhpcy5fY29uc3VtYWJsZXNbdHlwZV07CgogICAgZm9yIChjb25zdCBuYW1lIG9mIGl0ZW1zKSB7CiAgICAgIGlmICh0eXBlID09PSAnYXR0cmlidXRlcycgJiYgKG5hbWUgPT09ICdjbGFzcycgfHwgbmFtZSA9PT0gJ3N0eWxlJykpIHsKICAgICAgICBjb25zdCBjb25zdW1hYmxlTmFtZSA9IG5hbWUgPT0gJ2NsYXNzJyA/ICdjbGFzc2VzJyA6ICdzdHlsZXMnOyAvLyBJZiBjbGFzcyBvciBzdHlsZSBpcyBwcm92aWRlZCBmb3IgY29uc3VtcHRpb24gLSBjb25zdW1lIHRoZW0gYWxsLgoKICAgICAgICB0aGlzLl9jb25zdW1lKGNvbnN1bWFibGVOYW1lLCBbLi4udGhpcy5fY29uc3VtYWJsZXNbY29uc3VtYWJsZU5hbWVdLmtleXMoKV0pOwogICAgICB9IGVsc2UgewogICAgICAgIGNvbnN1bWFibGVzLnNldChuYW1lLCBmYWxzZSk7CiAgICAgIH0KICAgIH0KICB9CiAgLyoqCiAgICogSGVscGVyIG1ldGhvZCB0aGF0IHJldmVydHMgaXRlbXMgb2YgYSBnaXZlbiB0eXBlOiBhdHRyaWJ1dGUsIGNsYXNzIG9yIHN0eWxlLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0ge1N0cmluZ30gdHlwZSBUeXBlIG9mIHRoZSBjb25zdW1hYmxlIGl0ZW06IGBhdHRyaWJ1dGVzYCwgYGNsYXNzZXNgIG9yICwgYHN0eWxlc2AuCiAgICogQHBhcmFtIHtTdHJpbmd8QXJyYXkuPFN0cmluZz59IGl0ZW0gQ29uc3VtYWJsZSBpdGVtIG9yIGFycmF5IG9mIGl0ZW1zLgogICAqLwoKCiAgX3JldmVydCh0eXBlLCBpdGVtKSB7CiAgICBjb25zdCBpdGVtcyA9IGlzQXJyYXkoaXRlbSkgPyBpdGVtIDogW2l0ZW1dOwogICAgY29uc3QgY29uc3VtYWJsZXMgPSB0aGlzLl9jb25zdW1hYmxlc1t0eXBlXTsKCiAgICBmb3IgKGNvbnN0IG5hbWUgb2YgaXRlbXMpIHsKICAgICAgaWYgKHR5cGUgPT09ICdhdHRyaWJ1dGVzJyAmJiAobmFtZSA9PT0gJ2NsYXNzJyB8fCBuYW1lID09PSAnc3R5bGUnKSkgewogICAgICAgIGNvbnN0IGNvbnN1bWFibGVOYW1lID0gbmFtZSA9PSAnY2xhc3MnID8gJ2NsYXNzZXMnIDogJ3N0eWxlcyc7IC8vIElmIGNsYXNzIG9yIHN0eWxlIGlzIHByb3ZpZGVkIGZvciByZXZlcnRpbmcgLSByZXZlcnQgdGhlbSBhbGwuCgogICAgICAgIHRoaXMuX3JldmVydChjb25zdW1hYmxlTmFtZSwgWy4uLnRoaXMuX2NvbnN1bWFibGVzW2NvbnN1bWFibGVOYW1lXS5rZXlzKCldKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBjb25zdCB2YWx1ZSA9IGNvbnN1bWFibGVzLmdldChuYW1lKTsKCiAgICAgICAgaWYgKHZhbHVlID09PSBmYWxzZSkgewogICAgICAgICAgY29uc3VtYWJsZXMuc2V0KG5hbWUsIHRydWUpOwogICAgICAgIH0KICAgICAgfQogICAgfQogIH0KCn0="},{"version":3,"sources":["/Users/antonyching/Desktop/project/new-builder-demo/node_modules/@ckeditor/ckeditor5-engine/src/conversion/viewconsumable.js"],"names":["isArray","CKEditorError","ViewConsumable","constructor","_consumables","Map","add","element","consumables","elementConsumables","is","set","has","ViewElementConsumables","get","test","undefined","consume","revert","consumablesFromElement","name","attributes","classes","styles","getAttributeKeys","attribute","push","getClassNames","className","getStyleNames","style","createFrom","from","instance","child","getChildren","_canConsumeName","type","_add","value","_test","_consume","_revert","item","items","consumableName","keys"],"mappings":"AAAA;;;;;AAKA;;;AAIA,SAASA,OAAT,QAAwB,WAAxB;AACA,OAAOC,aAAP,MAA0B,6CAA1B;AAEA;;;;;;;;;;;;;;;;;;;;;;;;AAuBA,eAAe,MAAMC,cAAN,CAAqB;AACnC;;;AAGAC,EAAAA,WAAW,GAAG;AACb;;;;;;;;;AASA,SAAKC,YAAL,GAAoB,IAAIC,GAAJ,EAApB;AACA;AAED;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA0BAC,EAAAA,GAAG,CAAEC,OAAF,EAAWC,WAAX,EAAyB;AAC3B,QAAIC,kBAAJ,CAD2B,CAG3B;;AACA,QAAKF,OAAO,CAACG,EAAR,CAAY,MAAZ,KAAwBH,OAAO,CAACG,EAAR,CAAY,kBAAZ,CAA7B,EAAgE;AAC/D,WAAKN,YAAL,CAAkBO,GAAlB,CAAuBJ,OAAvB,EAAgC,IAAhC;;AAEA;AACA,KAR0B,CAU3B;;;AACA,QAAK,CAAC,KAAKH,YAAL,CAAkBQ,GAAlB,CAAuBL,OAAvB,CAAN,EAAyC;AACxCE,MAAAA,kBAAkB,GAAG,IAAII,sBAAJ,EAArB;;AACA,WAAKT,YAAL,CAAkBO,GAAlB,CAAuBJ,OAAvB,EAAgCE,kBAAhC;AACA,KAHD,MAGO;AACNA,MAAAA,kBAAkB,GAAG,KAAKL,YAAL,CAAkBU,GAAlB,CAAuBP,OAAvB,CAArB;AACA;;AAEDE,IAAAA,kBAAkB,CAACH,GAAnB,CAAwBE,WAAxB;AACA;AAED;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA6BAO,EAAAA,IAAI,CAAER,OAAF,EAAWC,WAAX,EAAyB;AAC5B,UAAMC,kBAAkB,GAAG,KAAKL,YAAL,CAAkBU,GAAlB,CAAuBP,OAAvB,CAA3B;;AAEA,QAAKE,kBAAkB,KAAKO,SAA5B,EAAwC;AACvC,aAAO,IAAP;AACA,KAL2B,CAO5B;;;AACA,QAAKT,OAAO,CAACG,EAAR,CAAY,MAAZ,KAAwBH,OAAO,CAACG,EAAR,CAAY,kBAAZ,CAA7B,EAAgE;AAC/D,aAAOD,kBAAP;AACA,KAV2B,CAY5B;;;AACA,WAAOA,kBAAkB,CAACM,IAAnB,CAAyBP,WAAzB,CAAP;AACA;AAED;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA4BAS,EAAAA,OAAO,CAAEV,OAAF,EAAWC,WAAX,EAAyB;AAC/B,QAAK,KAAKO,IAAL,CAAWR,OAAX,EAAoBC,WAApB,CAAL,EAAyC;AACxC,UAAKD,OAAO,CAACG,EAAR,CAAY,MAAZ,KAAwBH,OAAO,CAACG,EAAR,CAAY,kBAAZ,CAA7B,EAAgE;AAC/D;AACA,aAAKN,YAAL,CAAkBO,GAAlB,CAAuBJ,OAAvB,EAAgC,KAAhC;AACA,OAHD,MAGO;AACN;AACA,aAAKH,YAAL,CAAkBU,GAAlB,CAAuBP,OAAvB,EAAiCU,OAAjC,CAA0CT,WAA1C;AACA;;AAED,aAAO,IAAP;AACA;;AAED,WAAO,KAAP;AACA;AAED;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA4BAU,EAAAA,MAAM,CAAEX,OAAF,EAAWC,WAAX,EAAyB;AAC9B,UAAMC,kBAAkB,GAAG,KAAKL,YAAL,CAAkBU,GAAlB,CAAuBP,OAAvB,CAA3B;;AAEA,QAAKE,kBAAkB,KAAKO,SAA5B,EAAwC;AACvC,UAAKT,OAAO,CAACG,EAAR,CAAY,MAAZ,KAAwBH,OAAO,CAACG,EAAR,CAAY,kBAAZ,CAA7B,EAAgE;AAC/D;AACA,aAAKN,YAAL,CAAkBO,GAAlB,CAAuBJ,OAAvB,EAAgC,IAAhC;AACA,OAHD,MAGO;AACN;AACAE,QAAAA,kBAAkB,CAACS,MAAnB,CAA2BV,WAA3B;AACA;AACD;AACD;AAED;;;;;;;;;;AAQA,SAAOW,sBAAP,CAA+BZ,OAA/B,EAAyC;AACxC,UAAMC,WAAW,GAAG;AACnBY,MAAAA,IAAI,EAAE,IADa;AAEnBC,MAAAA,UAAU,EAAE,EAFO;AAGnBC,MAAAA,OAAO,EAAE,EAHU;AAInBC,MAAAA,MAAM,EAAE;AAJW,KAApB;AAOA,UAAMF,UAAU,GAAGd,OAAO,CAACiB,gBAAR,EAAnB;;AAEA,SAAM,MAAMC,SAAZ,IAAyBJ,UAAzB,EAAsC;AACrC;AACA,UAAKI,SAAS,IAAI,OAAb,IAAwBA,SAAS,IAAI,OAA1C,EAAoD;AACnD;AACA;;AAEDjB,MAAAA,WAAW,CAACa,UAAZ,CAAuBK,IAAvB,CAA6BD,SAA7B;AACA;;AAED,UAAMH,OAAO,GAAGf,OAAO,CAACoB,aAAR,EAAhB;;AAEA,SAAM,MAAMC,SAAZ,IAAyBN,OAAzB,EAAmC;AAClCd,MAAAA,WAAW,CAACc,OAAZ,CAAoBI,IAApB,CAA0BE,SAA1B;AACA;;AAED,UAAML,MAAM,GAAGhB,OAAO,CAACsB,aAAR,EAAf;;AAEA,SAAM,MAAMC,KAAZ,IAAqBP,MAArB,EAA8B;AAC7Bf,MAAAA,WAAW,CAACe,MAAZ,CAAmBG,IAAnB,CAAyBI,KAAzB;AACA;;AAED,WAAOtB,WAAP;AACA;AAED;;;;;;;;;;;;;AAWA,SAAOuB,UAAP,CAAmBC,IAAnB,EAAyBC,QAAzB,EAAoC;AACnC,QAAK,CAACA,QAAN,EAAiB;AAChBA,MAAAA,QAAQ,GAAG,IAAI/B,cAAJ,EAAX;AACA;;AAED,QAAK8B,IAAI,CAACtB,EAAL,CAAS,MAAT,CAAL,EAAyB;AACxBuB,MAAAA,QAAQ,CAAC3B,GAAT,CAAc0B,IAAd;AAEA,aAAOC,QAAP;AACA,KATkC,CAWnC;;;AACA,QAAKD,IAAI,CAACtB,EAAL,CAAS,SAAT,CAAL,EAA4B;AAC3BuB,MAAAA,QAAQ,CAAC3B,GAAT,CAAc0B,IAAd,EAAoB9B,cAAc,CAACiB,sBAAf,CAAuCa,IAAvC,CAApB;AACA;;AAED,QAAKA,IAAI,CAACtB,EAAL,CAAS,kBAAT,CAAL,EAAqC;AACpCuB,MAAAA,QAAQ,CAAC3B,GAAT,CAAc0B,IAAd;AACA;;AAED,SAAM,MAAME,KAAZ,IAAqBF,IAAI,CAACG,WAAL,EAArB,EAA0C;AACzCF,MAAAA,QAAQ,GAAG/B,cAAc,CAAC6B,UAAf,CAA2BG,KAA3B,EAAkCD,QAAlC,CAAX;AACA;;AAED,WAAOA,QAAP;AACA;;AAjRkC;AAoRpC;;;;;;;AAMA,MAAMpB,sBAAN,CAA6B;AAC5B;;;AAGAV,EAAAA,WAAW,GAAG;AACb;;;;;;AAMA,SAAKiC,eAAL,GAAuB,IAAvB;AAEA;;;;;;;AAMA,SAAKhC,YAAL,GAAoB;AACnBiB,MAAAA,UAAU,EAAE,IAAIhB,GAAJ,EADO;AAEnBkB,MAAAA,MAAM,EAAE,IAAIlB,GAAJ,EAFW;AAGnBiB,MAAAA,OAAO,EAAE,IAAIjB,GAAJ;AAHU,KAApB;AAKA;AAED;;;;;;;;;;;;;;;;;;;;;;;AAqBAC,EAAAA,GAAG,CAAEE,WAAF,EAAgB;AAClB,QAAKA,WAAW,CAACY,IAAjB,EAAwB;AACvB,WAAKgB,eAAL,GAAuB,IAAvB;AACA;;AAED,SAAM,MAAMC,IAAZ,IAAoB,KAAKjC,YAAzB,EAAwC;AACvC,UAAKiC,IAAI,IAAI7B,WAAb,EAA2B;AAC1B,aAAK8B,IAAL,CAAWD,IAAX,EAAiB7B,WAAW,CAAE6B,IAAF,CAA5B;AACA;AACD;AACD;AAED;;;;;;;;;;;;;;;;;;;;;;AAoBAtB,EAAAA,IAAI,CAAEP,WAAF,EAAgB;AACnB;AACA,QAAKA,WAAW,CAACY,IAAZ,IAAoB,CAAC,KAAKgB,eAA/B,EAAiD;AAChD,aAAO,KAAKA,eAAZ;AACA;;AAED,SAAM,MAAMC,IAAZ,IAAoB,KAAKjC,YAAzB,EAAwC;AACvC,UAAKiC,IAAI,IAAI7B,WAAb,EAA2B;AAC1B,cAAM+B,KAAK,GAAG,KAAKC,KAAL,CAAYH,IAAZ,EAAkB7B,WAAW,CAAE6B,IAAF,CAA7B,CAAd;;AAEA,YAAKE,KAAK,KAAK,IAAf,EAAsB;AACrB,iBAAOA,KAAP;AACA;AACD;AACD,KAdkB,CAgBnB;;;AACA,WAAO,IAAP;AACA;AAED;;;;;;;;;;;;;;;;;;;;AAkBAtB,EAAAA,OAAO,CAAET,WAAF,EAAgB;AACtB,QAAKA,WAAW,CAACY,IAAjB,EAAwB;AACvB,WAAKgB,eAAL,GAAuB,KAAvB;AACA;;AAED,SAAM,MAAMC,IAAZ,IAAoB,KAAKjC,YAAzB,EAAwC;AACvC,UAAKiC,IAAI,IAAI7B,WAAb,EAA2B;AAC1B,aAAKiC,QAAL,CAAeJ,IAAf,EAAqB7B,WAAW,CAAE6B,IAAF,CAAhC;AACA;AACD;AACD;AAED;;;;;;;;;;;;;;;;;;;AAiBAnB,EAAAA,MAAM,CAAEV,WAAF,EAAgB;AACrB,QAAKA,WAAW,CAACY,IAAjB,EAAwB;AACvB,WAAKgB,eAAL,GAAuB,IAAvB;AACA;;AAED,SAAM,MAAMC,IAAZ,IAAoB,KAAKjC,YAAzB,EAAwC;AACvC,UAAKiC,IAAI,IAAI7B,WAAb,EAA2B;AAC1B,aAAKkC,OAAL,CAAcL,IAAd,EAAoB7B,WAAW,CAAE6B,IAAF,CAA/B;AACA;AACD;AACD;AAED;;;;;;;;;;;;AAUAC,EAAAA,IAAI,CAAED,IAAF,EAAQM,IAAR,EAAe;AAClB,UAAMC,KAAK,GAAG5C,OAAO,CAAE2C,IAAF,CAAP,GAAkBA,IAAlB,GAAyB,CAAEA,IAAF,CAAvC;AACA,UAAMnC,WAAW,GAAG,KAAKJ,YAAL,CAAmBiC,IAAnB,CAApB;;AAEA,SAAM,MAAMjB,IAAZ,IAAoBwB,KAApB,EAA4B;AAC3B,UAAKP,IAAI,KAAK,YAAT,KAA2BjB,IAAI,KAAK,OAAT,IAAoBA,IAAI,KAAK,OAAxD,CAAL,EAAyE;AACxE;;;;;;;;;;;;;;AAcA,cAAM,IAAInB,aAAJ,CAAmB,oFAAnB,EAAyG,IAAzG,CAAN;AACA;;AAEDO,MAAAA,WAAW,CAACG,GAAZ,CAAiBS,IAAjB,EAAuB,IAAvB;AACA;AACD;AAED;;;;;;;;;;;AASAoB,EAAAA,KAAK,CAAEH,IAAF,EAAQM,IAAR,EAAe;AACnB,UAAMC,KAAK,GAAG5C,OAAO,CAAE2C,IAAF,CAAP,GAAkBA,IAAlB,GAAyB,CAAEA,IAAF,CAAvC;AACA,UAAMnC,WAAW,GAAG,KAAKJ,YAAL,CAAmBiC,IAAnB,CAApB;;AAEA,SAAM,MAAMjB,IAAZ,IAAoBwB,KAApB,EAA4B;AAC3B,UAAKP,IAAI,KAAK,YAAT,KAA2BjB,IAAI,KAAK,OAAT,IAAoBA,IAAI,KAAK,OAAxD,CAAL,EAAyE;AACxE,cAAMyB,cAAc,GAAGzB,IAAI,IAAI,OAAR,GAAkB,SAAlB,GAA8B,QAArD,CADwE,CAGxE;;AACA,cAAMmB,KAAK,GAAG,KAAKC,KAAL,CAAYK,cAAZ,EAA4B,CAAE,GAAG,KAAKzC,YAAL,CAAmByC,cAAnB,EAAoCC,IAApC,EAAL,CAA5B,CAAd;;AAEA,YAAKP,KAAK,KAAK,IAAf,EAAsB;AACrB,iBAAOA,KAAP;AACA;AACD,OATD,MASO;AACN,cAAMA,KAAK,GAAG/B,WAAW,CAACM,GAAZ,CAAiBM,IAAjB,CAAd,CADM,CAEN;;AACA,YAAKmB,KAAK,KAAKvB,SAAf,EAA2B;AAC1B,iBAAO,IAAP;AACA;;AAED,YAAK,CAACuB,KAAN,EAAc;AACb,iBAAO,KAAP;AACA;AACD;AACD;;AAED,WAAO,IAAP;AACA;AAED;;;;;;;;;AAOAE,EAAAA,QAAQ,CAAEJ,IAAF,EAAQM,IAAR,EAAe;AACtB,UAAMC,KAAK,GAAG5C,OAAO,CAAE2C,IAAF,CAAP,GAAkBA,IAAlB,GAAyB,CAAEA,IAAF,CAAvC;AACA,UAAMnC,WAAW,GAAG,KAAKJ,YAAL,CAAmBiC,IAAnB,CAApB;;AAEA,SAAM,MAAMjB,IAAZ,IAAoBwB,KAApB,EAA4B;AAC3B,UAAKP,IAAI,KAAK,YAAT,KAA2BjB,IAAI,KAAK,OAAT,IAAoBA,IAAI,KAAK,OAAxD,CAAL,EAAyE;AACxE,cAAMyB,cAAc,GAAGzB,IAAI,IAAI,OAAR,GAAkB,SAAlB,GAA8B,QAArD,CADwE,CAGxE;;AACA,aAAKqB,QAAL,CAAeI,cAAf,EAA+B,CAAE,GAAG,KAAKzC,YAAL,CAAmByC,cAAnB,EAAoCC,IAApC,EAAL,CAA/B;AACA,OALD,MAKO;AACNtC,QAAAA,WAAW,CAACG,GAAZ,CAAiBS,IAAjB,EAAuB,KAAvB;AACA;AACD;AACD;AAED;;;;;;;;;AAOAsB,EAAAA,OAAO,CAAEL,IAAF,EAAQM,IAAR,EAAe;AACrB,UAAMC,KAAK,GAAG5C,OAAO,CAAE2C,IAAF,CAAP,GAAkBA,IAAlB,GAAyB,CAAEA,IAAF,CAAvC;AACA,UAAMnC,WAAW,GAAG,KAAKJ,YAAL,CAAmBiC,IAAnB,CAApB;;AAEA,SAAM,MAAMjB,IAAZ,IAAoBwB,KAApB,EAA4B;AAC3B,UAAKP,IAAI,KAAK,YAAT,KAA2BjB,IAAI,KAAK,OAAT,IAAoBA,IAAI,KAAK,OAAxD,CAAL,EAAyE;AACxE,cAAMyB,cAAc,GAAGzB,IAAI,IAAI,OAAR,GAAkB,SAAlB,GAA8B,QAArD,CADwE,CAGxE;;AACA,aAAKsB,OAAL,CAAcG,cAAd,EAA8B,CAAE,GAAG,KAAKzC,YAAL,CAAmByC,cAAnB,EAAoCC,IAApC,EAAL,CAA9B;AACA,OALD,MAKO;AACN,cAAMP,KAAK,GAAG/B,WAAW,CAACM,GAAZ,CAAiBM,IAAjB,CAAd;;AAEA,YAAKmB,KAAK,KAAK,KAAf,EAAuB;AACtB/B,UAAAA,WAAW,CAACG,GAAZ,CAAiBS,IAAjB,EAAuB,IAAvB;AACA;AACD;AACD;AACD;;AA1R2B","sourcesContent":["/**\n * @license Copyright (c) 2003-2019, CKSource - Frederico Knabben. All rights reserved.\n * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license\n */\n\n/**\n * @module engine/conversion/viewconsumable\n */\n\nimport { isArray } from 'lodash-es';\nimport CKEditorError from '@ckeditor/ckeditor5-utils/src/ckeditorerror';\n\n/**\n * Class used for handling consumption of view {@link module:engine/view/element~Element elements},\n * {@link module:engine/view/text~Text text nodes} and {@link module:engine/view/documentfragment~DocumentFragment document fragments}.\n * Element's name and its parts (attributes, classes and styles) can be consumed separately. Consuming an element's name\n * does not consume its attributes, classes and styles.\n * To add items for consumption use {@link module:engine/conversion/viewconsumable~ViewConsumable#add add method}.\n * To test items use {@link module:engine/conversion/viewconsumable~ViewConsumable#test test method}.\n * To consume items use {@link module:engine/conversion/viewconsumable~ViewConsumable#consume consume method}.\n * To revert already consumed items use {@link module:engine/conversion/viewconsumable~ViewConsumable#revert revert method}.\n *\n *\t\tviewConsumable.add( element, { name: true } ); // Adds element's name as ready to be consumed.\n *\t\tviewConsumable.add( textNode ); // Adds text node for consumption.\n *\t\tviewConsumable.add( docFragment ); // Adds document fragment for consumption.\n *\t\tviewConsumable.test( element, { name: true }  ); // Tests if element's name can be consumed.\n *\t\tviewConsumable.test( textNode ); // Tests if text node can be consumed.\n *\t\tviewConsumable.test( docFragment ); // Tests if document fragment can be consumed.\n *\t\tviewConsumable.consume( element, { name: true }  ); // Consume element's name.\n *\t\tviewConsumable.consume( textNode ); // Consume text node.\n *\t\tviewConsumable.consume( docFragment ); // Consume document fragment.\n *\t\tviewConsumable.revert( element, { name: true }  ); // Revert already consumed element's name.\n *\t\tviewConsumable.revert( textNode ); // Revert already consumed text node.\n *\t\tviewConsumable.revert( docFragment ); // Revert already consumed document fragment.\n */\nexport default class ViewConsumable {\n\t/**\n\t * Creates new ViewConsumable.\n\t */\n\tconstructor() {\n\t\t/**\n\t\t * Map of consumable elements. If {@link module:engine/view/element~Element element} is used as a key,\n\t\t * {@link module:engine/conversion/viewconsumable~ViewElementConsumables ViewElementConsumables} instance is stored as value.\n\t\t * For {@link module:engine/view/text~Text text nodes} and\n\t\t * {@link module:engine/view/documentfragment~DocumentFragment document fragments} boolean value is stored as value.\n\t\t *\n\t\t * @protected\n\t\t * @member {Map.<module:engine/conversion/viewconsumable~ViewElementConsumables|Boolean>}\n\t\t*/\n\t\tthis._consumables = new Map();\n\t}\n\n\t/**\n\t * Adds {@link module:engine/view/element~Element view element}, {@link module:engine/view/text~Text text node} or\n\t * {@link module:engine/view/documentfragment~DocumentFragment document fragment} as ready to be consumed.\n\t *\n\t *\t\tviewConsumable.add( p, { name: true } ); // Adds element's name to consume.\n\t *\t\tviewConsumable.add( p, { attributes: 'name' } ); // Adds element's attribute.\n\t *\t\tviewConsumable.add( p, { classes: 'foobar' } ); // Adds element's class.\n\t *\t\tviewConsumable.add( p, { styles: 'color' } ); // Adds element's style\n\t *\t\tviewConsumable.add( p, { attributes: 'name', styles: 'color' } ); // Adds attribute and style.\n\t *\t\tviewConsumable.add( p, { classes: [ 'baz', 'bar' ] } ); // Multiple consumables can be provided.\n\t *\t\tviewConsumable.add( textNode ); // Adds text node to consume.\n\t *\t\tviewConsumable.add( docFragment ); // Adds document fragment to consume.\n\t *\n\t * Throws {@link module:utils/ckeditorerror~CKEditorError CKEditorError} `viewconsumable-invalid-attribute` when `class` or `style`\n\t * attribute is provided - it should be handled separately by providing actual style/class.\n\t *\n\t *\t\tviewConsumable.add( p, { attributes: 'style' } ); // This call will throw an exception.\n\t *\t\tviewConsumable.add( p, { styles: 'color' } ); // This is properly handled style.\n\t *\n\t * @param {module:engine/view/element~Element|module:engine/view/text~Text|module:engine/view/documentfragment~DocumentFragment} element\n\t * @param {Object} [consumables] Used only if first parameter is {@link module:engine/view/element~Element view element} instance.\n\t * @param {Boolean} consumables.name If set to true element's name will be included.\n\t * @param {String|Array.<String>} consumables.attributes Attribute name or array of attribute names.\n\t * @param {String|Array.<String>} consumables.classes Class name or array of class names.\n\t * @param {String|Array.<String>} consumables.styles Style name or array of style names.\n\t */\n\tadd( element, consumables ) {\n\t\tlet elementConsumables;\n\n\t\t// For text nodes and document fragments just mark them as consumable.\n\t\tif ( element.is( 'text' ) || element.is( 'documentFragment' ) ) {\n\t\t\tthis._consumables.set( element, true );\n\n\t\t\treturn;\n\t\t}\n\n\t\t// For elements create new ViewElementConsumables or update already existing one.\n\t\tif ( !this._consumables.has( element ) ) {\n\t\t\telementConsumables = new ViewElementConsumables();\n\t\t\tthis._consumables.set( element, elementConsumables );\n\t\t} else {\n\t\t\telementConsumables = this._consumables.get( element );\n\t\t}\n\n\t\telementConsumables.add( consumables );\n\t}\n\n\t/**\n\t * Tests if {@link module:engine/view/element~Element view element}, {@link module:engine/view/text~Text text node} or\n\t * {@link module:engine/view/documentfragment~DocumentFragment document fragment} can be consumed.\n\t * It returns `true` when all items included in method's call can be consumed. Returns `false` when\n\t * first already consumed item is found and `null` when first non-consumable item is found.\n\t *\n\t *\t\tviewConsumable.test( p, { name: true } ); // Tests element's name.\n\t *\t\tviewConsumable.test( p, { attributes: 'name' } ); // Tests attribute.\n\t *\t\tviewConsumable.test( p, { classes: 'foobar' } ); // Tests class.\n\t *\t\tviewConsumable.test( p, { styles: 'color' } ); // Tests style.\n\t *\t\tviewConsumable.test( p, { attributes: 'name', styles: 'color' } ); // Tests attribute and style.\n\t *\t\tviewConsumable.test( p, { classes: [ 'baz', 'bar' ] } ); // Multiple consumables can be tested.\n\t *\t\tviewConsumable.test( textNode ); // Tests text node.\n\t *\t\tviewConsumable.test( docFragment ); // Tests document fragment.\n\t *\n\t * Testing classes and styles as attribute will test if all added classes/styles can be consumed.\n\t *\n\t *\t\tviewConsumable.test( p, { attributes: 'class' } ); // Tests if all added classes can be consumed.\n\t *\t\tviewConsumable.test( p, { attributes: 'style' } ); // Tests if all added styles can be consumed.\n\t *\n\t * @param {module:engine/view/element~Element|module:engine/view/text~Text|module:engine/view/documentfragment~DocumentFragment} element\n\t * @param {Object} [consumables] Used only if first parameter is {@link module:engine/view/element~Element view element} instance.\n\t * @param {Boolean} consumables.name If set to true element's name will be included.\n\t * @param {String|Array.<String>} consumables.attributes Attribute name or array of attribute names.\n\t * @param {String|Array.<String>} consumables.classes Class name or array of class names.\n\t * @param {String|Array.<String>} consumables.styles Style name or array of style names.\n\t * @returns {Boolean|null} Returns `true` when all items included in method's call can be consumed. Returns `false`\n\t * when first already consumed item is found and `null` when first non-consumable item is found.\n\t */\n\ttest( element, consumables ) {\n\t\tconst elementConsumables = this._consumables.get( element );\n\n\t\tif ( elementConsumables === undefined ) {\n\t\t\treturn null;\n\t\t}\n\n\t\t// For text nodes and document fragments return stored boolean value.\n\t\tif ( element.is( 'text' ) || element.is( 'documentFragment' ) ) {\n\t\t\treturn elementConsumables;\n\t\t}\n\n\t\t// For elements test consumables object.\n\t\treturn elementConsumables.test( consumables );\n\t}\n\n\t/**\n\t * Consumes {@link module:engine/view/element~Element view element}, {@link module:engine/view/text~Text text node} or\n\t * {@link module:engine/view/documentfragment~DocumentFragment document fragment}.\n\t * It returns `true` when all items included in method's call can be consumed, otherwise returns `false`.\n\t *\n\t *\t\tviewConsumable.consume( p, { name: true } ); // Consumes element's name.\n\t *\t\tviewConsumable.consume( p, { attributes: 'name' } ); // Consumes element's attribute.\n\t *\t\tviewConsumable.consume( p, { classes: 'foobar' } ); // Consumes element's class.\n\t *\t\tviewConsumable.consume( p, { styles: 'color' } ); // Consumes element's style.\n\t *\t\tviewConsumable.consume( p, { attributes: 'name', styles: 'color' } ); // Consumes attribute and style.\n\t *\t\tviewConsumable.consume( p, { classes: [ 'baz', 'bar' ] } ); // Multiple consumables can be consumed.\n\t *\t\tviewConsumable.consume( textNode ); // Consumes text node.\n\t *\t\tviewConsumable.consume( docFragment ); // Consumes document fragment.\n\t *\n\t * Consuming classes and styles as attribute will test if all added classes/styles can be consumed.\n\t *\n\t *\t\tviewConsumable.consume( p, { attributes: 'class' } ); // Consume only if all added classes can be consumed.\n\t *\t\tviewConsumable.consume( p, { attributes: 'style' } ); // Consume only if all added styles can be consumed.\n\t *\n\t * @param {module:engine/view/element~Element|module:engine/view/text~Text|module:engine/view/documentfragment~DocumentFragment} element\n\t * @param {Object} [consumables] Used only if first parameter is {@link module:engine/view/element~Element view element} instance.\n\t * @param {Boolean} consumables.name If set to true element's name will be included.\n\t * @param {String|Array.<String>} consumables.attributes Attribute name or array of attribute names.\n\t * @param {String|Array.<String>} consumables.classes Class name or array of class names.\n\t * @param {String|Array.<String>} consumables.styles Style name or array of style names.\n\t * @returns {Boolean} Returns `true` when all items included in method's call can be consumed,\n\t * otherwise returns `false`.\n\t */\n\tconsume( element, consumables ) {\n\t\tif ( this.test( element, consumables ) ) {\n\t\t\tif ( element.is( 'text' ) || element.is( 'documentFragment' ) ) {\n\t\t\t\t// For text nodes and document fragments set value to false.\n\t\t\t\tthis._consumables.set( element, false );\n\t\t\t} else {\n\t\t\t\t// For elements - consume consumables object.\n\t\t\t\tthis._consumables.get( element ).consume( consumables );\n\t\t\t}\n\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t}\n\n\t/**\n\t * Reverts {@link module:engine/view/element~Element view element}, {@link module:engine/view/text~Text text node} or\n\t * {@link module:engine/view/documentfragment~DocumentFragment document fragment} so they can be consumed once again.\n\t * Method does not revert items that were never previously added for consumption, even if they are included in\n\t * method's call.\n\t *\n\t *\t\tviewConsumable.revert( p, { name: true } ); // Reverts element's name.\n\t *\t\tviewConsumable.revert( p, { attributes: 'name' } ); // Reverts element's attribute.\n\t *\t\tviewConsumable.revert( p, { classes: 'foobar' } ); // Reverts element's class.\n\t *\t\tviewConsumable.revert( p, { styles: 'color' } ); // Reverts element's style.\n\t *\t\tviewConsumable.revert( p, { attributes: 'name', styles: 'color' } ); // Reverts attribute and style.\n\t *\t\tviewConsumable.revert( p, { classes: [ 'baz', 'bar' ] } ); // Multiple names can be reverted.\n\t *\t\tviewConsumable.revert( textNode ); // Reverts text node.\n\t *\t\tviewConsumable.revert( docFragment ); // Reverts document fragment.\n\t *\n\t * Reverting classes and styles as attribute will revert all classes/styles that were previously added for\n\t * consumption.\n\t *\n\t *\t\tviewConsumable.revert( p, { attributes: 'class' } ); // Reverts all classes added for consumption.\n\t *\t\tviewConsumable.revert( p, { attributes: 'style' } ); // Reverts all styles added for consumption.\n\t *\n\t * @param {module:engine/view/element~Element|module:engine/view/text~Text|module:engine/view/documentfragment~DocumentFragment} element\n\t * @param {Object} [consumables] Used only if first parameter is {@link module:engine/view/element~Element view element} instance.\n\t * @param {Boolean} consumables.name If set to true element's name will be included.\n\t * @param {String|Array.<String>} consumables.attributes Attribute name or array of attribute names.\n\t * @param {String|Array.<String>} consumables.classes Class name or array of class names.\n\t * @param {String|Array.<String>} consumables.styles Style name or array of style names.\n\t */\n\trevert( element, consumables ) {\n\t\tconst elementConsumables = this._consumables.get( element );\n\n\t\tif ( elementConsumables !== undefined ) {\n\t\t\tif ( element.is( 'text' ) || element.is( 'documentFragment' ) ) {\n\t\t\t\t// For text nodes and document fragments - set consumable to true.\n\t\t\t\tthis._consumables.set( element, true );\n\t\t\t} else {\n\t\t\t\t// For elements - revert items from consumables object.\n\t\t\t\telementConsumables.revert( consumables );\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Creates consumable object from {@link module:engine/view/element~Element view element}. Consumable object will include\n\t * element's name and all its attributes, classes and styles.\n\t *\n\t * @static\n\t * @param {module:engine/view/element~Element} element\n\t * @returns {Object} consumables\n\t */\n\tstatic consumablesFromElement( element ) {\n\t\tconst consumables = {\n\t\t\tname: true,\n\t\t\tattributes: [],\n\t\t\tclasses: [],\n\t\t\tstyles: []\n\t\t};\n\n\t\tconst attributes = element.getAttributeKeys();\n\n\t\tfor ( const attribute of attributes ) {\n\t\t\t// Skip classes and styles - will be added separately.\n\t\t\tif ( attribute == 'style' || attribute == 'class' ) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tconsumables.attributes.push( attribute );\n\t\t}\n\n\t\tconst classes = element.getClassNames();\n\n\t\tfor ( const className of classes ) {\n\t\t\tconsumables.classes.push( className );\n\t\t}\n\n\t\tconst styles = element.getStyleNames();\n\n\t\tfor ( const style of styles ) {\n\t\t\tconsumables.styles.push( style );\n\t\t}\n\n\t\treturn consumables;\n\t}\n\n\t/**\n\t * Creates {@link module:engine/conversion/viewconsumable~ViewConsumable ViewConsumable} instance from\n\t * {@link module:engine/view/node~Node node} or {@link module:engine/view/documentfragment~DocumentFragment document fragment}.\n\t * Instance will contain all elements, child nodes, attributes, styles and classes added for consumption.\n\t *\n\t * @static\n\t * @param {module:engine/view/node~Node|module:engine/view/documentfragment~DocumentFragment} from View node or document fragment\n\t * from which `ViewConsumable` will be created.\n\t * @param {module:engine/conversion/viewconsumable~ViewConsumable} [instance] If provided, given `ViewConsumable` instance will be used\n\t * to add all consumables. It will be returned instead of a new instance.\n\t */\n\tstatic createFrom( from, instance ) {\n\t\tif ( !instance ) {\n\t\t\tinstance = new ViewConsumable();\n\t\t}\n\n\t\tif ( from.is( 'text' ) ) {\n\t\t\tinstance.add( from );\n\n\t\t\treturn instance;\n\t\t}\n\n\t\t// Add `from` itself, if it is an element.\n\t\tif ( from.is( 'element' ) ) {\n\t\t\tinstance.add( from, ViewConsumable.consumablesFromElement( from ) );\n\t\t}\n\n\t\tif ( from.is( 'documentFragment' ) ) {\n\t\t\tinstance.add( from );\n\t\t}\n\n\t\tfor ( const child of from.getChildren() ) {\n\t\t\tinstance = ViewConsumable.createFrom( child, instance );\n\t\t}\n\n\t\treturn instance;\n\t}\n}\n\n/**\n * This is a private helper-class for {@link module:engine/conversion/viewconsumable~ViewConsumable}.\n * It represents and manipulates consumable parts of a single {@link module:engine/view/element~Element}.\n *\n * @private\n */\nclass ViewElementConsumables {\n\t/**\n\t * Creates ViewElementConsumables instance.\n\t */\n\tconstructor() {\n\t\t/**\n\t\t * Flag indicating if name of the element can be consumed.\n\t\t *\n\t\t * @private\n\t\t * @member {Boolean}\n\t\t */\n\t\tthis._canConsumeName = null;\n\n\t\t/**\n\t\t * Contains maps of element's consumables: attributes, classes and styles.\n\t\t *\n\t\t * @private\n\t\t * @member {Object}\n\t\t */\n\t\tthis._consumables = {\n\t\t\tattributes: new Map(),\n\t\t\tstyles: new Map(),\n\t\t\tclasses: new Map()\n\t\t};\n\t}\n\n\t/**\n\t * Adds consumable parts of the {@link module:engine/view/element~Element view element}.\n\t * Element's name itself can be marked to be consumed (when element's name is consumed its attributes, classes and\n\t * styles still could be consumed):\n\t *\n\t *\t\tconsumables.add( { name: true } );\n\t *\n\t * Attributes classes and styles:\n\t *\n\t *\t\tconsumables.add( { attributes: 'title', classes: 'foo', styles: 'color' } );\n\t *\t\tconsumables.add( { attributes: [ 'title', 'name' ], classes: [ 'foo', 'bar' ] );\n\t *\n\t * Throws {@link module:utils/ckeditorerror~CKEditorError CKEditorError} `viewconsumable-invalid-attribute` when `class` or `style`\n\t * attribute is provided - it should be handled separately by providing `style` and `class` in consumables object.\n\t *\n\t * @param {Object} consumables Object describing which parts of the element can be consumed.\n\t * @param {Boolean} consumables.name If set to `true` element's name will be added as consumable.\n\t * @param {String|Array.<String>} consumables.attributes Attribute name or array of attribute names to add as consumable.\n\t * @param {String|Array.<String>} consumables.classes Class name or array of class names to add as consumable.\n\t * @param {String|Array.<String>} consumables.styles Style name or array of style names to add as consumable.\n\t */\n\tadd( consumables ) {\n\t\tif ( consumables.name ) {\n\t\t\tthis._canConsumeName = true;\n\t\t}\n\n\t\tfor ( const type in this._consumables ) {\n\t\t\tif ( type in consumables ) {\n\t\t\t\tthis._add( type, consumables[ type ] );\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Tests if parts of the {@link module:engine/view/node~Node view node} can be consumed.\n\t *\n\t * Element's name can be tested:\n\t *\n\t *\t\tconsumables.test( { name: true } );\n\t *\n\t * Attributes classes and styles:\n\t *\n\t *\t\tconsumables.test( { attributes: 'title', classes: 'foo', styles: 'color' } );\n\t *\t\tconsumables.test( { attributes: [ 'title', 'name' ], classes: [ 'foo', 'bar' ] );\n\t *\n\t * @param {Object} consumables Object describing which parts of the element should be tested.\n\t * @param {Boolean} consumables.name If set to `true` element's name will be tested.\n\t * @param {String|Array.<String>} consumables.attributes Attribute name or array of attribute names to test.\n\t * @param {String|Array.<String>} consumables.classes Class name or array of class names to test.\n\t * @param {String|Array.<String>} consumables.styles Style name or array of style names to test.\n\t * @returns {Boolean|null} `true` when all tested items can be consumed, `null` when even one of the items\n\t * was never marked for consumption and `false` when even one of the items was already consumed.\n\t */\n\ttest( consumables ) {\n\t\t// Check if name can be consumed.\n\t\tif ( consumables.name && !this._canConsumeName ) {\n\t\t\treturn this._canConsumeName;\n\t\t}\n\n\t\tfor ( const type in this._consumables ) {\n\t\t\tif ( type in consumables ) {\n\t\t\t\tconst value = this._test( type, consumables[ type ] );\n\n\t\t\t\tif ( value !== true ) {\n\t\t\t\t\treturn value;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// Return true only if all can be consumed.\n\t\treturn true;\n\t}\n\n\t/**\n\t * Consumes parts of {@link module:engine/view/element~Element view element}. This function does not check if consumable item\n\t * is already consumed - it consumes all consumable items provided.\n\t * Element's name can be consumed:\n\t *\n\t *\t\tconsumables.consume( { name: true } );\n\t *\n\t * Attributes classes and styles:\n\t *\n\t *\t\tconsumables.consume( { attributes: 'title', classes: 'foo', styles: 'color' } );\n\t *\t\tconsumables.consume( { attributes: [ 'title', 'name' ], classes: [ 'foo', 'bar' ] );\n\t *\n\t * @param {Object} consumables Object describing which parts of the element should be consumed.\n\t * @param {Boolean} consumables.name If set to `true` element's name will be consumed.\n\t * @param {String|Array.<String>} consumables.attributes Attribute name or array of attribute names to consume.\n\t * @param {String|Array.<String>} consumables.classes Class name or array of class names to consume.\n\t * @param {String|Array.<String>} consumables.styles Style name or array of style names to consume.\n\t */\n\tconsume( consumables ) {\n\t\tif ( consumables.name ) {\n\t\t\tthis._canConsumeName = false;\n\t\t}\n\n\t\tfor ( const type in this._consumables ) {\n\t\t\tif ( type in consumables ) {\n\t\t\t\tthis._consume( type, consumables[ type ] );\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Revert already consumed parts of {@link module:engine/view/element~Element view Element}, so they can be consumed once again.\n\t * Element's name can be reverted:\n\t *\n\t *\t\tconsumables.revert( { name: true } );\n\t *\n\t * Attributes classes and styles:\n\t *\n\t *\t\tconsumables.revert( { attributes: 'title', classes: 'foo', styles: 'color' } );\n\t *\t\tconsumables.revert( { attributes: [ 'title', 'name' ], classes: [ 'foo', 'bar' ] );\n\t *\n\t * @param {Object} consumables Object describing which parts of the element should be reverted.\n\t * @param {Boolean} consumables.name If set to `true` element's name will be reverted.\n\t * @param {String|Array.<String>} consumables.attributes Attribute name or array of attribute names to revert.\n\t * @param {String|Array.<String>} consumables.classes Class name or array of class names to revert.\n\t * @param {String|Array.<String>} consumables.styles Style name or array of style names to revert.\n\t */\n\trevert( consumables ) {\n\t\tif ( consumables.name ) {\n\t\t\tthis._canConsumeName = true;\n\t\t}\n\n\t\tfor ( const type in this._consumables ) {\n\t\t\tif ( type in consumables ) {\n\t\t\t\tthis._revert( type, consumables[ type ] );\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Helper method that adds consumables of a given type: attribute, class or style.\n\t *\n\t * Throws {@link module:utils/ckeditorerror~CKEditorError CKEditorError} `viewconsumable-invalid-attribute` when `class` or `style`\n\t * type is provided - it should be handled separately by providing actual style/class type.\n\t *\n\t * @private\n\t * @param {String} type Type of the consumable item: `attributes`, `classes` or `styles`.\n\t * @param {String|Array.<String>} item Consumable item or array of items.\n\t */\n\t_add( type, item ) {\n\t\tconst items = isArray( item ) ? item : [ item ];\n\t\tconst consumables = this._consumables[ type ];\n\n\t\tfor ( const name of items ) {\n\t\t\tif ( type === 'attributes' && ( name === 'class' || name === 'style' ) ) {\n\t\t\t\t/**\n\t\t\t\t * Class and style attributes should be handled separately in\n\t\t\t\t * {@link module:engine/conversion/viewconsumable~ViewConsumable#add `ViewConsumable#add()`}.\n\t\t\t\t *\n\t\t\t\t * What you have done is trying to use:\n\t\t\t\t *\n\t\t\t\t *\t\tconsumables.add( { attributes: [ 'class', 'style' ] } );\n\t\t\t\t *\n\t\t\t\t * While each class and style should be registered separately:\n\t\t\t\t *\n\t\t\t\t *\t\tconsumables.add( { classes: 'some-class', styles: 'font-weight' } );\n\t\t\t\t *\n\t\t\t\t * @error viewconsumable-invalid-attribute\n\t\t\t\t */\n\t\t\t\tthrow new CKEditorError( 'viewconsumable-invalid-attribute: Classes and styles should be handled separately.', this );\n\t\t\t}\n\n\t\t\tconsumables.set( name, true );\n\t\t}\n\t}\n\n\t/**\n\t * Helper method that tests consumables of a given type: attribute, class or style.\n\t *\n\t * @private\n\t * @param {String} type Type of the consumable item: `attributes`, `classes` or `styles`.\n\t * @param {String|Array.<String>} item Consumable item or array of items.\n\t * @returns {Boolean|null} Returns `true` if all items can be consumed, `null` when one of the items cannot be\n\t * consumed and `false` when one of the items is already consumed.\n\t */\n\t_test( type, item ) {\n\t\tconst items = isArray( item ) ? item : [ item ];\n\t\tconst consumables = this._consumables[ type ];\n\n\t\tfor ( const name of items ) {\n\t\t\tif ( type === 'attributes' && ( name === 'class' || name === 'style' ) ) {\n\t\t\t\tconst consumableName = name == 'class' ? 'classes' : 'styles';\n\n\t\t\t\t// Check all classes/styles if class/style attribute is tested.\n\t\t\t\tconst value = this._test( consumableName, [ ...this._consumables[ consumableName ].keys() ] );\n\n\t\t\t\tif ( value !== true ) {\n\t\t\t\t\treturn value;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tconst value = consumables.get( name );\n\t\t\t\t// Return null if attribute is not found.\n\t\t\t\tif ( value === undefined ) {\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\n\t\t\t\tif ( !value ) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn true;\n\t}\n\n\t/**\n\t * Helper method that consumes items of a given type: attribute, class or style.\n\t *\n\t * @private\n\t * @param {String} type Type of the consumable item: `attributes`, `classes` or `styles`.\n\t * @param {String|Array.<String>} item Consumable item or array of items.\n\t */\n\t_consume( type, item ) {\n\t\tconst items = isArray( item ) ? item : [ item ];\n\t\tconst consumables = this._consumables[ type ];\n\n\t\tfor ( const name of items ) {\n\t\t\tif ( type === 'attributes' && ( name === 'class' || name === 'style' ) ) {\n\t\t\t\tconst consumableName = name == 'class' ? 'classes' : 'styles';\n\n\t\t\t\t// If class or style is provided for consumption - consume them all.\n\t\t\t\tthis._consume( consumableName, [ ...this._consumables[ consumableName ].keys() ] );\n\t\t\t} else {\n\t\t\t\tconsumables.set( name, false );\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Helper method that reverts items of a given type: attribute, class or style.\n\t *\n\t * @private\n\t * @param {String} type Type of the consumable item: `attributes`, `classes` or , `styles`.\n\t * @param {String|Array.<String>} item Consumable item or array of items.\n\t */\n\t_revert( type, item ) {\n\t\tconst items = isArray( item ) ? item : [ item ];\n\t\tconst consumables = this._consumables[ type ];\n\n\t\tfor ( const name of items ) {\n\t\t\tif ( type === 'attributes' && ( name === 'class' || name === 'style' ) ) {\n\t\t\t\tconst consumableName = name == 'class' ? 'classes' : 'styles';\n\n\t\t\t\t// If class or style is provided for reverting - revert them all.\n\t\t\t\tthis._revert( consumableName, [ ...this._consumables[ consumableName ].keys() ] );\n\t\t\t} else {\n\t\t\t\tconst value = consumables.get( name );\n\n\t\t\t\tif ( value === false ) {\n\t\t\t\t\tconsumables.set( name, true );\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\n"]}]}
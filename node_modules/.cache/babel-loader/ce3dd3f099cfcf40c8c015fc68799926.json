{"remainingRequest":"/Users/antonyching/Desktop/project/new-builder-demo/node_modules/babel-loader/lib/index.js!/Users/antonyching/Desktop/project/new-builder-demo/node_modules/@ckeditor/ckeditor5-link/src/linkui.js","dependencies":[{"path":"/Users/antonyching/Desktop/project/new-builder-demo/node_modules/@ckeditor/ckeditor5-link/src/linkui.js","mtime":499162500000},{"path":"/Users/antonyching/Desktop/project/new-builder-demo/node_modules/@ckeditor/ckeditor5-dev-webpack-plugin/lib/translatesourceloader.js","mtime":499162500000},{"path":"/Users/antonyching/Desktop/project/new-builder-demo/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/antonyching/Desktop/project/new-builder-demo/node_modules/babel-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:LyoqCiAqIEBsaWNlbnNlIENvcHlyaWdodCAoYykgMjAwMy0yMDE5LCBDS1NvdXJjZSAtIEZyZWRlcmljbyBLbmFiYmVuLiBBbGwgcmlnaHRzIHJlc2VydmVkLgogKiBGb3IgbGljZW5zaW5nLCBzZWUgTElDRU5TRS5tZCBvciBodHRwczovL2NrZWRpdG9yLmNvbS9sZWdhbC9ja2VkaXRvci1vc3MtbGljZW5zZQogKi8KCi8qKgogKiBAbW9kdWxlIGxpbmsvbGlua3VpCiAqLwppbXBvcnQgUGx1Z2luIGZyb20gJ0Bja2VkaXRvci9ja2VkaXRvcjUtY29yZS9zcmMvcGx1Z2luJzsKaW1wb3J0IENsaWNrT2JzZXJ2ZXIgZnJvbSAnQGNrZWRpdG9yL2NrZWRpdG9yNS1lbmdpbmUvc3JjL3ZpZXcvb2JzZXJ2ZXIvY2xpY2tvYnNlcnZlcic7CmltcG9ydCB7IGlzTGlua0VsZW1lbnQgfSBmcm9tICcuL3V0aWxzJzsKaW1wb3J0IENvbnRleHR1YWxCYWxsb29uIGZyb20gJ0Bja2VkaXRvci9ja2VkaXRvcjUtdWkvc3JjL3BhbmVsL2JhbGxvb24vY29udGV4dHVhbGJhbGxvb24nOwppbXBvcnQgY2xpY2tPdXRzaWRlSGFuZGxlciBmcm9tICdAY2tlZGl0b3IvY2tlZGl0b3I1LXVpL3NyYy9iaW5kaW5ncy9jbGlja291dHNpZGVoYW5kbGVyJzsKaW1wb3J0IEJ1dHRvblZpZXcgZnJvbSAnQGNrZWRpdG9yL2NrZWRpdG9yNS11aS9zcmMvYnV0dG9uL2J1dHRvbnZpZXcnOwppbXBvcnQgTGlua0Zvcm1WaWV3IGZyb20gJy4vdWkvbGlua2Zvcm12aWV3JzsKaW1wb3J0IExpbmtBY3Rpb25zVmlldyBmcm9tICcuL3VpL2xpbmthY3Rpb25zdmlldyc7CmltcG9ydCBsaW5rSWNvbiBmcm9tICcuLi90aGVtZS9pY29ucy9saW5rLnN2Zyc7CmNvbnN0IGxpbmtLZXlzdHJva2UgPSAnQ3RybCtLJzsKLyoqCiAqIFRoZSBsaW5rIFVJIHBsdWdpbi4gSXQgaW50cm9kdWNlcyB0aGUgYCdsaW5rJ2AgYW5kIGAndW5saW5rJ2AgYnV0dG9ucyBhbmQgc3VwcG9ydCBmb3IgdGhlIDxrYmQ+Q3RybCtLPC9rYmQ+IGtleXN0cm9rZS4KICoKICogSXQgdXNlcyB0aGUKICoge0BsaW5rIG1vZHVsZTp1aS9wYW5lbC9iYWxsb29uL2NvbnRleHR1YWxiYWxsb29ufkNvbnRleHR1YWxCYWxsb29uIGNvbnRleHR1YWwgYmFsbG9vbiBwbHVnaW59LgogKgogKiBAZXh0ZW5kcyBtb2R1bGU6Y29yZS9wbHVnaW5+UGx1Z2luCiAqLwoKZXhwb3J0IGRlZmF1bHQgY2xhc3MgTGlua1VJIGV4dGVuZHMgUGx1Z2luIHsKICAvKioKICAgKiBAaW5oZXJpdERvYwogICAqLwogIHN0YXRpYyBnZXQgcmVxdWlyZXMoKSB7CiAgICByZXR1cm4gW0NvbnRleHR1YWxCYWxsb29uXTsKICB9CiAgLyoqCiAgICogQGluaGVyaXREb2MKICAgKi8KCgogIHN0YXRpYyBnZXQgcGx1Z2luTmFtZSgpIHsKICAgIHJldHVybiAnTGlua1VJJzsKICB9CiAgLyoqCiAgICogQGluaGVyaXREb2MKICAgKi8KCgogIGluaXQoKSB7CiAgICBjb25zdCBlZGl0b3IgPSB0aGlzLmVkaXRvcjsKICAgIGVkaXRvci5lZGl0aW5nLnZpZXcuYWRkT2JzZXJ2ZXIoQ2xpY2tPYnNlcnZlcik7CiAgICAvKioKICAgICAqIFRoZSBhY3Rpb25zIHZpZXcgZGlzcGxheWVkIGluc2lkZSBvZiB0aGUgYmFsbG9vbi4KICAgICAqCiAgICAgKiBAbWVtYmVyIHttb2R1bGU6bGluay91aS9saW5rYWN0aW9uc3ZpZXd+TGlua0FjdGlvbnNWaWV3fQogICAgICovCgogICAgdGhpcy5hY3Rpb25zVmlldyA9IHRoaXMuX2NyZWF0ZUFjdGlvbnNWaWV3KCk7CiAgICAvKioKICAgICAqIFRoZSBmb3JtIHZpZXcgZGlzcGxheWVkIGluc2lkZSB0aGUgYmFsbG9vbi4KICAgICAqCiAgICAgKiBAbWVtYmVyIHttb2R1bGU6bGluay91aS9saW5rZm9ybXZpZXd+TGlua0Zvcm1WaWV3fQogICAgICovCgogICAgdGhpcy5mb3JtVmlldyA9IHRoaXMuX2NyZWF0ZUZvcm1WaWV3KCk7CiAgICAvKioKICAgICAqIFRoZSBjb250ZXh0dWFsIGJhbGxvb24gcGx1Z2luIGluc3RhbmNlLgogICAgICoKICAgICAqIEBwcml2YXRlCiAgICAgKiBAbWVtYmVyIHttb2R1bGU6dWkvcGFuZWwvYmFsbG9vbi9jb250ZXh0dWFsYmFsbG9vbn5Db250ZXh0dWFsQmFsbG9vbn0KICAgICAqLwoKICAgIHRoaXMuX2JhbGxvb24gPSBlZGl0b3IucGx1Z2lucy5nZXQoQ29udGV4dHVhbEJhbGxvb24pOyAvLyBDcmVhdGUgdG9vbGJhciBidXR0b25zLgoKICAgIHRoaXMuX2NyZWF0ZVRvb2xiYXJMaW5rQnV0dG9uKCk7IC8vIEF0dGFjaCBsaWZlY3ljbGUgYWN0aW9ucyB0byB0aGUgdGhlIGJhbGxvb24uCgoKICAgIHRoaXMuX2VuYWJsZVVzZXJCYWxsb29uSW50ZXJhY3Rpb25zKCk7CiAgfQogIC8qKgogICAqIEBpbmhlcml0RG9jCiAgICovCgoKICBkZXN0cm95KCkgewogICAgc3VwZXIuZGVzdHJveSgpOyAvLyBEZXN0cm95IGNyZWF0ZWQgVUkgY29tcG9uZW50cyBhcyB0aGV5IGFyZSBub3QgYXV0b21hdGljYWxseSBkZXN0cm95ZWQgKHNlZSBja2VkaXRvcjUjMTM0MSkuCgogICAgdGhpcy5mb3JtVmlldy5kZXN0cm95KCk7CiAgfQogIC8qKgogICAqIENyZWF0ZXMgdGhlIHtAbGluayBtb2R1bGU6bGluay91aS9saW5rYWN0aW9uc3ZpZXd+TGlua0FjdGlvbnNWaWV3fSBpbnN0YW5jZS4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHJldHVybnMge21vZHVsZTpsaW5rL3VpL2xpbmthY3Rpb25zdmlld35MaW5rQWN0aW9uc1ZpZXd9IFRoZSBsaW5rIGFjdGlvbnMgdmlldyBpbnN0YW5jZS4KICAgKi8KCgogIF9jcmVhdGVBY3Rpb25zVmlldygpIHsKICAgIGNvbnN0IGVkaXRvciA9IHRoaXMuZWRpdG9yOwogICAgY29uc3QgYWN0aW9uc1ZpZXcgPSBuZXcgTGlua0FjdGlvbnNWaWV3KGVkaXRvci5sb2NhbGUpOwogICAgY29uc3QgbGlua0NvbW1hbmQgPSBlZGl0b3IuY29tbWFuZHMuZ2V0KCdsaW5rJyk7CiAgICBjb25zdCB1bmxpbmtDb21tYW5kID0gZWRpdG9yLmNvbW1hbmRzLmdldCgndW5saW5rJyk7CiAgICBhY3Rpb25zVmlldy5iaW5kKCdocmVmJykudG8obGlua0NvbW1hbmQsICd2YWx1ZScpOwogICAgYWN0aW9uc1ZpZXcuZWRpdEJ1dHRvblZpZXcuYmluZCgnaXNFbmFibGVkJykudG8obGlua0NvbW1hbmQpOwogICAgYWN0aW9uc1ZpZXcudW5saW5rQnV0dG9uVmlldy5iaW5kKCdpc0VuYWJsZWQnKS50byh1bmxpbmtDb21tYW5kKTsgLy8gRXhlY3V0ZSB1bmxpbmsgY29tbWFuZCBhZnRlciBjbGlja2luZyBvbiB0aGUgIkVkaXQiIGJ1dHRvbi4KCiAgICB0aGlzLmxpc3RlblRvKGFjdGlvbnNWaWV3LCAnZWRpdCcsICgpID0+IHsKICAgICAgdGhpcy5fYWRkRm9ybVZpZXcoKTsKICAgIH0pOyAvLyBFeGVjdXRlIHVubGluayBjb21tYW5kIGFmdGVyIGNsaWNraW5nIG9uIHRoZSAiVW5saW5rIiBidXR0b24uCgogICAgdGhpcy5saXN0ZW5UbyhhY3Rpb25zVmlldywgJ3VubGluaycsICgpID0+IHsKICAgICAgZWRpdG9yLmV4ZWN1dGUoJ3VubGluaycpOwoKICAgICAgdGhpcy5faGlkZVVJKCk7CiAgICB9KTsgLy8gQ2xvc2UgdGhlIHBhbmVsIG9uIGVzYyBrZXkgcHJlc3Mgd2hlbiB0aGUgKiphY3Rpb25zIGhhdmUgZm9jdXMqKi4KCiAgICBhY3Rpb25zVmlldy5rZXlzdHJva2VzLnNldCgnRXNjJywgKGRhdGEsIGNhbmNlbCkgPT4gewogICAgICB0aGlzLl9oaWRlVUkoKTsKCiAgICAgIGNhbmNlbCgpOwogICAgfSk7IC8vIE9wZW4gdGhlIGZvcm0gdmlldyBvbiBDdHJsK0sgd2hlbiB0aGUgKiphY3Rpb25zIGhhdmUgZm9jdXMqKi4uCgogICAgYWN0aW9uc1ZpZXcua2V5c3Ryb2tlcy5zZXQobGlua0tleXN0cm9rZSwgKGRhdGEsIGNhbmNlbCkgPT4gewogICAgICB0aGlzLl9hZGRGb3JtVmlldygpOwoKICAgICAgY2FuY2VsKCk7CiAgICB9KTsKICAgIHJldHVybiBhY3Rpb25zVmlldzsKICB9CiAgLyoqCiAgICogQ3JlYXRlcyB0aGUge0BsaW5rIG1vZHVsZTpsaW5rL3VpL2xpbmtmb3Jtdmlld35MaW5rRm9ybVZpZXd9IGluc3RhbmNlLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcmV0dXJucyB7bW9kdWxlOmxpbmsvdWkvbGlua2Zvcm12aWV3fkxpbmtGb3JtVmlld30gVGhlIGxpbmsgZm9ybSB2aWV3IGluc3RhbmNlLgogICAqLwoKCiAgX2NyZWF0ZUZvcm1WaWV3KCkgewogICAgY29uc3QgZWRpdG9yID0gdGhpcy5lZGl0b3I7CiAgICBjb25zdCBsaW5rQ29tbWFuZCA9IGVkaXRvci5jb21tYW5kcy5nZXQoJ2xpbmsnKTsKICAgIGNvbnN0IGZvcm1WaWV3ID0gbmV3IExpbmtGb3JtVmlldyhlZGl0b3IubG9jYWxlLCBsaW5rQ29tbWFuZC5tYW51YWxEZWNvcmF0b3JzKTsKICAgIGZvcm1WaWV3LnVybElucHV0Vmlldy5iaW5kKCd2YWx1ZScpLnRvKGxpbmtDb21tYW5kLCAndmFsdWUnKTsgLy8gRm9ybSBlbGVtZW50cyBzaG91bGQgYmUgcmVhZC1vbmx5IHdoZW4gY29ycmVzcG9uZGluZyBjb21tYW5kcyBhcmUgZGlzYWJsZWQuCgogICAgZm9ybVZpZXcudXJsSW5wdXRWaWV3LmJpbmQoJ2lzUmVhZE9ubHknKS50byhsaW5rQ29tbWFuZCwgJ2lzRW5hYmxlZCcsIHZhbHVlID0+ICF2YWx1ZSk7CiAgICBmb3JtVmlldy5zYXZlQnV0dG9uVmlldy5iaW5kKCdpc0VuYWJsZWQnKS50byhsaW5rQ29tbWFuZCk7IC8vIEV4ZWN1dGUgbGluayBjb21tYW5kIGFmdGVyIGNsaWNraW5nIHRoZSAiU2F2ZSIgYnV0dG9uLgoKICAgIHRoaXMubGlzdGVuVG8oZm9ybVZpZXcsICdzdWJtaXQnLCAoKSA9PiB7CiAgICAgIGVkaXRvci5leGVjdXRlKCdsaW5rJywgZm9ybVZpZXcudXJsSW5wdXRWaWV3LmlucHV0Vmlldy5lbGVtZW50LnZhbHVlLCBmb3JtVmlldy5nZXREZWNvcmF0b3JTd2l0Y2hlc1N0YXRlKCkpOwoKICAgICAgdGhpcy5fY2xvc2VGb3JtVmlldygpOwogICAgfSk7IC8vIEhpZGUgdGhlIHBhbmVsIGFmdGVyIGNsaWNraW5nIHRoZSAiQ2FuY2VsIiBidXR0b24uCgogICAgdGhpcy5saXN0ZW5Ubyhmb3JtVmlldywgJ2NhbmNlbCcsICgpID0+IHsKICAgICAgdGhpcy5fY2xvc2VGb3JtVmlldygpOwogICAgfSk7IC8vIENsb3NlIHRoZSBwYW5lbCBvbiBlc2Mga2V5IHByZXNzIHdoZW4gdGhlICoqZm9ybSBoYXMgZm9jdXMqKi4KCiAgICBmb3JtVmlldy5rZXlzdHJva2VzLnNldCgnRXNjJywgKGRhdGEsIGNhbmNlbCkgPT4gewogICAgICB0aGlzLl9jbG9zZUZvcm1WaWV3KCk7CgogICAgICBjYW5jZWwoKTsKICAgIH0pOwogICAgcmV0dXJuIGZvcm1WaWV3OwogIH0KICAvKioKICAgKiBDcmVhdGVzIGEgdG9vbGJhciBMaW5rIGJ1dHRvbi4gQ2xpY2tpbmcgdGhpcyBidXR0b24gd2lsbCBzaG93CiAgICogYSB7QGxpbmsgI19iYWxsb29ufSBhdHRhY2hlZCB0byB0aGUgc2VsZWN0aW9uLgogICAqCiAgICogQHByaXZhdGUKICAgKi8KCgogIF9jcmVhdGVUb29sYmFyTGlua0J1dHRvbigpIHsKICAgIGNvbnN0IGVkaXRvciA9IHRoaXMuZWRpdG9yOwogICAgY29uc3QgbGlua0NvbW1hbmQgPSBlZGl0b3IuY29tbWFuZHMuZ2V0KCdsaW5rJyk7CiAgICBjb25zdCB0ID0gZWRpdG9yLnQ7IC8vIEhhbmRsZSB0aGUgYEN0cmwrS2Aga2V5c3Ryb2tlIGFuZCBzaG93IHRoZSBwYW5lbC4KCiAgICBlZGl0b3Iua2V5c3Ryb2tlcy5zZXQobGlua0tleXN0cm9rZSwgKGtleUV2dERhdGEsIGNhbmNlbCkgPT4gewogICAgICAvLyBQcmV2ZW50IGZvY3VzaW5nIHRoZSBzZWFyY2ggYmFyIGluIEZGIGFuZCBvcGVuaW5nIG5ldyB0YWIgaW4gRWRnZS4gIzE1MywgIzE1NC4KICAgICAgY2FuY2VsKCk7CgogICAgICBpZiAobGlua0NvbW1hbmQuaXNFbmFibGVkKSB7CiAgICAgICAgdGhpcy5fc2hvd1VJKHRydWUpOwogICAgICB9CiAgICB9KTsKICAgIGVkaXRvci51aS5jb21wb25lbnRGYWN0b3J5LmFkZCgnbGluaycsIGxvY2FsZSA9PiB7CiAgICAgIGNvbnN0IGJ1dHRvbiA9IG5ldyBCdXR0b25WaWV3KGxvY2FsZSk7CiAgICAgIGJ1dHRvbi5pc0VuYWJsZWQgPSB0cnVlOwogICAgICBidXR0b24ubGFiZWwgPSB0KCdMaW5rJyk7CiAgICAgIGJ1dHRvbi5pY29uID0gbGlua0ljb247CiAgICAgIGJ1dHRvbi5rZXlzdHJva2UgPSBsaW5rS2V5c3Ryb2tlOwogICAgICBidXR0b24udG9vbHRpcCA9IHRydWU7CiAgICAgIGJ1dHRvbi5pc1RvZ2dsZWFibGUgPSB0cnVlOyAvLyBCaW5kIGJ1dHRvbiB0byB0aGUgY29tbWFuZC4KCiAgICAgIGJ1dHRvbi5iaW5kKCdpc0VuYWJsZWQnKS50byhsaW5rQ29tbWFuZCwgJ2lzRW5hYmxlZCcpOwogICAgICBidXR0b24uYmluZCgnaXNPbicpLnRvKGxpbmtDb21tYW5kLCAndmFsdWUnLCB2YWx1ZSA9PiAhIXZhbHVlKTsgLy8gU2hvdyB0aGUgcGFuZWwgb24gYnV0dG9uIGNsaWNrLgoKICAgICAgdGhpcy5saXN0ZW5UbyhidXR0b24sICdleGVjdXRlJywgKCkgPT4gdGhpcy5fc2hvd1VJKHRydWUpKTsKICAgICAgcmV0dXJuIGJ1dHRvbjsKICAgIH0pOwogIH0KICAvKioKICAgKiBBdHRhY2hlcyBhY3Rpb25zIHRoYXQgY29udHJvbCB3aGV0aGVyIHRoZSBiYWxsb29uIHBhbmVsIGNvbnRhaW5pbmcgdGhlCiAgICoge0BsaW5rICNmb3JtVmlld30gaXMgdmlzaWJsZSBvciBub3QuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqLwoKCiAgX2VuYWJsZVVzZXJCYWxsb29uSW50ZXJhY3Rpb25zKCkgewogICAgY29uc3Qgdmlld0RvY3VtZW50ID0gdGhpcy5lZGl0b3IuZWRpdGluZy52aWV3LmRvY3VtZW50OyAvLyBIYW5kbGUgY2xpY2sgb24gdmlldyBkb2N1bWVudCBhbmQgc2hvdyBwYW5lbCB3aGVuIHNlbGVjdGlvbiBpcyBwbGFjZWQgaW5zaWRlIHRoZSBsaW5rIGVsZW1lbnQuCiAgICAvLyBLZWVwIHBhbmVsIG9wZW4gdW50aWwgc2VsZWN0aW9uIHdpbGwgYmUgaW5zaWRlIHRoZSBzYW1lIGxpbmsgZWxlbWVudC4KCiAgICB0aGlzLmxpc3RlblRvKHZpZXdEb2N1bWVudCwgJ2NsaWNrJywgKCkgPT4gewogICAgICBjb25zdCBwYXJlbnRMaW5rID0gdGhpcy5fZ2V0U2VsZWN0ZWRMaW5rRWxlbWVudCgpOwoKICAgICAgaWYgKHBhcmVudExpbmspIHsKICAgICAgICAvLyBUaGVuIHNob3cgcGFuZWwgYnV0IGtlZXAgZm9jdXMgaW5zaWRlIGVkaXRvciBlZGl0YWJsZS4KICAgICAgICB0aGlzLl9zaG93VUkoKTsKICAgICAgfQogICAgfSk7IC8vIEZvY3VzIHRoZSBmb3JtIGlmIHRoZSBiYWxsb29uIGlzIHZpc2libGUgYW5kIHRoZSBUYWIga2V5IGhhcyBiZWVuIHByZXNzZWQuCgogICAgdGhpcy5lZGl0b3Iua2V5c3Ryb2tlcy5zZXQoJ1RhYicsIChkYXRhLCBjYW5jZWwpID0+IHsKICAgICAgaWYgKHRoaXMuX2FyZUFjdGlvbnNWaXNpYmxlICYmICF0aGlzLmFjdGlvbnNWaWV3LmZvY3VzVHJhY2tlci5pc0ZvY3VzZWQpIHsKICAgICAgICB0aGlzLmFjdGlvbnNWaWV3LmZvY3VzKCk7CiAgICAgICAgY2FuY2VsKCk7CiAgICAgIH0KICAgIH0sIHsKICAgICAgLy8gVXNlIHRoZSBoaWdoIHByaW9yaXR5IGJlY2F1c2UgdGhlIGxpbmsgVUkgbmF2aWdhdGlvbiBpcyBtb3JlIGltcG9ydGFudAogICAgICAvLyB0aGFuIG90aGVyIGZlYXR1cmUncyBhY3Rpb25zLCBlLmcuIGxpc3QgaW5kZW50YXRpb24uCiAgICAgIC8vIGh0dHBzOi8vZ2l0aHViLmNvbS9ja2VkaXRvci9ja2VkaXRvcjUtbGluay9pc3N1ZXMvMTQ2CiAgICAgIHByaW9yaXR5OiAnaGlnaCcKICAgIH0pOyAvLyBDbG9zZSB0aGUgcGFuZWwgb24gdGhlIEVzYyBrZXkgcHJlc3Mgd2hlbiB0aGUgZWRpdGFibGUgaGFzIGZvY3VzIGFuZCB0aGUgYmFsbG9vbiBpcyB2aXNpYmxlLgoKICAgIHRoaXMuZWRpdG9yLmtleXN0cm9rZXMuc2V0KCdFc2MnLCAoZGF0YSwgY2FuY2VsKSA9PiB7CiAgICAgIGlmICh0aGlzLl9pc1VJVmlzaWJsZSkgewogICAgICAgIHRoaXMuX2hpZGVVSSgpOwoKICAgICAgICBjYW5jZWwoKTsKICAgICAgfQogICAgfSk7IC8vIENsb3NlIG9uIGNsaWNrIG91dHNpZGUgb2YgYmFsbG9vbiBwYW5lbCBlbGVtZW50LgoKICAgIGNsaWNrT3V0c2lkZUhhbmRsZXIoewogICAgICBlbWl0dGVyOiB0aGlzLmZvcm1WaWV3LAogICAgICBhY3RpdmF0b3I6ICgpID0+IHRoaXMuX2lzVUlJblBhbmVsLAogICAgICBjb250ZXh0RWxlbWVudHM6IFt0aGlzLl9iYWxsb29uLnZpZXcuZWxlbWVudF0sCiAgICAgIGNhbGxiYWNrOiAoKSA9PiB0aGlzLl9oaWRlVUkoKQogICAgfSk7CiAgfQogIC8qKgogICAqIEFkZHMgdGhlIHtAbGluayAjYWN0aW9uc1ZpZXd9IHRvIHRoZSB7QGxpbmsgI19iYWxsb29ufS4KICAgKgogICAqIEBwcm90ZWN0ZWQKICAgKi8KCgogIF9hZGRBY3Rpb25zVmlldygpIHsKICAgIGlmICh0aGlzLl9hcmVBY3Rpb25zSW5QYW5lbCkgewogICAgICByZXR1cm47CiAgICB9CgogICAgdGhpcy5fYmFsbG9vbi5hZGQoewogICAgICB2aWV3OiB0aGlzLmFjdGlvbnNWaWV3LAogICAgICBwb3NpdGlvbjogdGhpcy5fZ2V0QmFsbG9vblBvc2l0aW9uRGF0YSgpCiAgICB9KTsKICB9CiAgLyoqCiAgICogQWRkcyB0aGUge0BsaW5rICNmb3JtVmlld30gdG8gdGhlIHtAbGluayAjX2JhbGxvb259LgogICAqCiAgICogQHByb3RlY3RlZAogICAqLwoKCiAgX2FkZEZvcm1WaWV3KCkgewogICAgaWYgKHRoaXMuX2lzRm9ybUluUGFuZWwpIHsKICAgICAgcmV0dXJuOwogICAgfQoKICAgIGNvbnN0IGVkaXRvciA9IHRoaXMuZWRpdG9yOwogICAgY29uc3QgbGlua0NvbW1hbmQgPSBlZGl0b3IuY29tbWFuZHMuZ2V0KCdsaW5rJyk7CgogICAgdGhpcy5fYmFsbG9vbi5hZGQoewogICAgICB2aWV3OiB0aGlzLmZvcm1WaWV3LAogICAgICBwb3NpdGlvbjogdGhpcy5fZ2V0QmFsbG9vblBvc2l0aW9uRGF0YSgpCiAgICB9KTsgLy8gU2VsZWN0IGlucHV0IHdoZW4gZm9ybSB2aWV3IGlzIGN1cnJlbnRseSB2aXNpYmxlLgoKCiAgICBpZiAodGhpcy5fYmFsbG9vbi52aXNpYmxlVmlldyA9PT0gdGhpcy5mb3JtVmlldykgewogICAgICB0aGlzLmZvcm1WaWV3LnVybElucHV0Vmlldy5zZWxlY3QoKTsKICAgIH0gLy8gTWFrZSBzdXJlIHRoYXQgZWFjaCB0aW1lIHRoZSBwYW5lbCBzaG93cyB1cCwgdGhlIFVSTCBmaWVsZCByZW1haW5zIGluIHN5bmMgd2l0aCB0aGUgdmFsdWUgb2YKICAgIC8vIHRoZSBjb21tYW5kLiBJZiB0aGUgdXNlciB0eXBlZCBpbiB0aGUgaW5wdXQsIHRoZW4gY2FuY2VsZWQgdGhlIGJhbGxvb24gKGB1cmxJbnB1dFZpZXcjdmFsdWVgIHN0YXlzCiAgICAvLyB1bmFsdGVyZWQpIGFuZCByZS1vcGVuZWQgaXQgd2l0aG91dCBjaGFuZ2luZyB0aGUgdmFsdWUgb2YgdGhlIGxpbmsgY29tbWFuZCAoZS5nLiBiZWNhdXNlIHRoZXkKICAgIC8vIGNsaWNrZWQgdGhlIHNhbWUgbGluayksIHRoZXkgd291bGQgc2VlIHRoZSBvbGQgdmFsdWUgaW5zdGVhZCBvZiB0aGUgYWN0dWFsIHZhbHVlIG9mIHRoZSBjb21tYW5kLgogICAgLy8gaHR0cHM6Ly9naXRodWIuY29tL2NrZWRpdG9yL2NrZWRpdG9yNS1saW5rL2lzc3Vlcy83OAogICAgLy8gaHR0cHM6Ly9naXRodWIuY29tL2NrZWRpdG9yL2NrZWRpdG9yNS1saW5rL2lzc3Vlcy8xMjMKCgogICAgdGhpcy5mb3JtVmlldy51cmxJbnB1dFZpZXcuaW5wdXRWaWV3LmVsZW1lbnQudmFsdWUgPSBsaW5rQ29tbWFuZC52YWx1ZSB8fCAnJzsKICB9CiAgLyoqCiAgICogQ2xvc2VzIHRoZSBmb3JtIHZpZXcuIERlY2lkZXMgd2hldGhlciB0aGUgYmFsbG9vbiBzaG91bGQgYmUgaGlkZGVuIGNvbXBsZXRlbHkgb3IgaWYgdGhlIGFjdGlvbiB2aWV3IHNob3VsZCBiZSBzaG93bi4gVGhpcyBpcwogICAqIGRlY2lkZWQgdXBvbiB0aGUgbGluayBjb21tYW5kIHZhbHVlICh3aGljaCBoYXMgYSB2YWx1ZSBpZiB0aGUgZG9jdW1lbnQgc2VsZWN0aW9uIGlzIGluIHRoZSBsaW5rKS4KICAgKgogICAqIEFkZGl0aW9uYWxseSwgaWYgYW55IHtAbGluayBtb2R1bGU6bGluay9saW5rfkxpbmtDb25maWcjZGVjb3JhdG9yc30gYXJlIGRlZmluZWQgaW4gdGhlIGVkaXRvciBjb25maWd1cmF0aW9uLCB0aGUgc3RhdGUgb2YKICAgKiBzd2l0Y2ggYnV0dG9ucyByZXNwb25zaWJsZSBmb3IgbWFudWFsIGRlY29yYXRvciBoYW5kbGluZyBpcyByZXN0b3JlZC4KICAgKgogICAqIEBwcml2YXRlCiAgICovCgoKICBfY2xvc2VGb3JtVmlldygpIHsKICAgIGNvbnN0IGxpbmtDb21tYW5kID0gdGhpcy5lZGl0b3IuY29tbWFuZHMuZ2V0KCdsaW5rJyk7IC8vIFJlc3RvcmUgbWFudWFsIGRlY29yYXRvciBzdGF0ZXMgdG8gcmVwcmVzZW50IHRoZSBjdXJyZW50IG1vZGVsIHN0YXRlLiBUaGlzIGNhc2UgaXMgaW1wb3J0YW50IHRvIHJlc2V0IHRoZSBzd2l0Y2ggYnV0dG9ucwogICAgLy8gd2hlbiB0aGUgdXNlciBjYW5jZWxzIHRoZSBlZGl0aW5nIGZvcm0uCgogICAgbGlua0NvbW1hbmQucmVzdG9yZU1hbnVhbERlY29yYXRvclN0YXRlcygpOwoKICAgIGlmIChsaW5rQ29tbWFuZC52YWx1ZSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgIHRoaXMuX3JlbW92ZUZvcm1WaWV3KCk7CiAgICB9IGVsc2UgewogICAgICB0aGlzLl9oaWRlVUkoKTsKICAgIH0KICB9CiAgLyoqCiAgICogUmVtb3ZlcyB0aGUge0BsaW5rICNmb3JtVmlld30gZnJvbSB0aGUge0BsaW5rICNfYmFsbG9vbn0uCiAgICoKICAgKiBAcHJvdGVjdGVkCiAgICovCgoKICBfcmVtb3ZlRm9ybVZpZXcoKSB7CiAgICBpZiAodGhpcy5faXNGb3JtSW5QYW5lbCkgewogICAgICAvLyBCbHVyIHRoZSBpbnB1dCBlbGVtZW50IGJlZm9yZSByZW1vdmluZyBpdCBmcm9tIERPTSB0byBwcmV2ZW50IGlzc3VlcyBpbiBzb21lIGJyb3dzZXJzLgogICAgICAvLyBTZWUgaHR0cHM6Ly9naXRodWIuY29tL2NrZWRpdG9yL2NrZWRpdG9yNS9pc3N1ZXMvMTUwMS4KICAgICAgdGhpcy5mb3JtVmlldy5zYXZlQnV0dG9uVmlldy5mb2N1cygpOwoKICAgICAgdGhpcy5fYmFsbG9vbi5yZW1vdmUodGhpcy5mb3JtVmlldyk7IC8vIEJlY2F1c2UgdGhlIGZvcm0gaGFzIGFuIGlucHV0IHdoaWNoIGhhcyBmb2N1cywgdGhlIGZvY3VzIG11c3QgYmUgYnJvdWdodCBiYWNrCiAgICAgIC8vIHRvIHRoZSBlZGl0b3IuIE90aGVyd2lzZSwgaXQgd291bGQgYmUgbG9zdC4KCgogICAgICB0aGlzLmVkaXRvci5lZGl0aW5nLnZpZXcuZm9jdXMoKTsKICAgIH0KICB9CiAgLyoqCiAgICogU2hvd3MgdGhlIGNvcnJlY3QgVUkgdHlwZSBmb3IgdGhlIGN1cnJlbnQgc3RhdGUgb2YgdGhlIGNvbW1hbmQuIEl0IGlzIGVpdGhlcgogICAqIHtAbGluayAjZm9ybVZpZXd9IG9yIHtAbGluayAjYWN0aW9uc1ZpZXd9LgogICAqCiAgICogQHBhcmFtIHtCb29sZWFufSBmb3JjZVZpc2libGUKICAgKiBAcHJpdmF0ZQogICAqLwoKCiAgX3Nob3dVSShmb3JjZVZpc2libGUgPSBmYWxzZSkgewogICAgY29uc3QgZWRpdG9yID0gdGhpcy5lZGl0b3I7CiAgICBjb25zdCBsaW5rQ29tbWFuZCA9IGVkaXRvci5jb21tYW5kcy5nZXQoJ2xpbmsnKTsKCiAgICBpZiAoIWxpbmtDb21tYW5kLmlzRW5hYmxlZCkgewogICAgICByZXR1cm47CiAgICB9IC8vIFdoZW4gdGhlcmUncyBubyBsaW5rIHVuZGVyIHRoZSBzZWxlY3Rpb24sIGdvIHN0cmFpZ2h0IHRvIHRoZSBlZGl0aW5nIFVJLgoKCiAgICBpZiAoIXRoaXMuX2dldFNlbGVjdGVkTGlua0VsZW1lbnQoKSkgewogICAgICB0aGlzLl9hZGRBY3Rpb25zVmlldygpOyAvLyBCZSBzdXJlIHBhbmVsIHdpdGggbGluayBpcyB2aXNpYmxlLgoKCiAgICAgIGlmIChmb3JjZVZpc2libGUpIHsKICAgICAgICB0aGlzLl9iYWxsb29uLnNob3dTdGFjaygnbWFpbicpOwogICAgICB9CgogICAgICB0aGlzLl9hZGRGb3JtVmlldygpOwogICAgfSAvLyBJZiB0aGVyZSdzIGEgbGluayB1bmRlciB0aGUgc2VsZWN0aW9uLi4uCiAgICBlbHNlIHsKICAgICAgICAvLyBHbyB0byB0aGUgZWRpdGluZyBVSSBpZiBhY3Rpb25zIGFyZSBhbHJlYWR5IHZpc2libGUuCiAgICAgICAgaWYgKHRoaXMuX2FyZUFjdGlvbnNWaXNpYmxlKSB7CiAgICAgICAgICB0aGlzLl9hZGRGb3JtVmlldygpOwogICAgICAgIH0gLy8gT3RoZXJ3aXNlIGRpc3BsYXkganVzdCB0aGUgYWN0aW9ucyBVSS4KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgdGhpcy5fYWRkQWN0aW9uc1ZpZXcoKTsKICAgICAgICAgIH0gLy8gQmUgc3VyZSBwYW5lbCB3aXRoIGxpbmsgaXMgdmlzaWJsZS4KCgogICAgICAgIGlmIChmb3JjZVZpc2libGUpIHsKICAgICAgICAgIHRoaXMuX2JhbGxvb24uc2hvd1N0YWNrKCdtYWluJyk7CiAgICAgICAgfQogICAgICB9IC8vIEJlZ2luIHJlc3BvbmRpbmcgdG8gdWkjdXBkYXRlIG9uY2UgdGhlIFVJIGlzIGFkZGVkLgoKCiAgICB0aGlzLl9zdGFydFVwZGF0aW5nVUkoKTsKICB9CiAgLyoqCiAgICogUmVtb3ZlcyB0aGUge0BsaW5rICNmb3JtVmlld30gZnJvbSB0aGUge0BsaW5rICNfYmFsbG9vbn0uCiAgICoKICAgKiBTZWUge0BsaW5rICNfYWRkRm9ybVZpZXd9LCB7QGxpbmsgI19hZGRBY3Rpb25zVmlld30uCiAgICoKICAgKiBAcHJvdGVjdGVkCiAgICovCgoKICBfaGlkZVVJKCkgewogICAgaWYgKCF0aGlzLl9pc1VJSW5QYW5lbCkgewogICAgICByZXR1cm47CiAgICB9CgogICAgY29uc3QgZWRpdG9yID0gdGhpcy5lZGl0b3I7CiAgICB0aGlzLnN0b3BMaXN0ZW5pbmcoZWRpdG9yLnVpLCAndXBkYXRlJyk7CiAgICB0aGlzLnN0b3BMaXN0ZW5pbmcodGhpcy5fYmFsbG9vbiwgJ2NoYW5nZTp2aXNpYmxlVmlldycpOyAvLyBNYWtlIHN1cmUgdGhlIGZvY3VzIGFsd2F5cyBnZXRzIGJhY2sgdG8gdGhlIGVkaXRhYmxlIF9iZWZvcmVfIHJlbW92aW5nIHRoZSBmb2N1c2VkIGZvcm0gdmlldy4KICAgIC8vIERvaW5nIG90aGVyd2lzZSBjYXVzZXMgaXNzdWVzIGluIHNvbWUgYnJvd3NlcnMuIFNlZSBodHRwczovL2dpdGh1Yi5jb20vY2tlZGl0b3IvY2tlZGl0b3I1LWxpbmsvaXNzdWVzLzE5My4KCiAgICBlZGl0b3IuZWRpdGluZy52aWV3LmZvY3VzKCk7IC8vIFJlbW92ZSBmb3JtIGZpcnN0IGJlY2F1c2UgaXQncyBvbiB0b3Agb2YgdGhlIHN0YWNrLgoKICAgIHRoaXMuX3JlbW92ZUZvcm1WaWV3KCk7IC8vIFRoZW4gcmVtb3ZlIHRoZSBhY3Rpb25zIHZpZXcgYmVjYXVzZSBpdCdzIGJlbmVhdGggdGhlIGZvcm0uCgoKICAgIHRoaXMuX2JhbGxvb24ucmVtb3ZlKHRoaXMuYWN0aW9uc1ZpZXcpOwogIH0KICAvKioKICAgKiBNYWtlcyB0aGUgVUkgcmVhY3QgdG8gdGhlIHtAbGluayBtb2R1bGU6Y29yZS9lZGl0b3IvZWRpdG9ydWl+RWRpdG9yVUkjZXZlbnQ6dXBkYXRlfSBldmVudCB0bwogICAqIHJlcG9zaXRpb24gaXRzZWxmIHdoZW4gdGhlIGVkaXRvciBVSSBzaG91bGQgYmUgcmVmcmVzaGVkLgogICAqCiAgICogU2VlOiB7QGxpbmsgI19oaWRlVUl9IHRvIGxlYXJuIHdoZW4gdGhlIFVJIHN0b3BzIHJlYWN0aW5nIHRvIHRoZSBgdXBkYXRlYCBldmVudC4KICAgKgogICAqIEBwcm90ZWN0ZWQKICAgKi8KCgogIF9zdGFydFVwZGF0aW5nVUkoKSB7CiAgICBjb25zdCBlZGl0b3IgPSB0aGlzLmVkaXRvcjsKICAgIGNvbnN0IHZpZXdEb2N1bWVudCA9IGVkaXRvci5lZGl0aW5nLnZpZXcuZG9jdW1lbnQ7CgogICAgbGV0IHByZXZTZWxlY3RlZExpbmsgPSB0aGlzLl9nZXRTZWxlY3RlZExpbmtFbGVtZW50KCk7CgogICAgbGV0IHByZXZTZWxlY3Rpb25QYXJlbnQgPSBnZXRTZWxlY3Rpb25QYXJlbnQoKTsKCiAgICBjb25zdCB1cGRhdGUgPSAoKSA9PiB7CiAgICAgIGNvbnN0IHNlbGVjdGVkTGluayA9IHRoaXMuX2dldFNlbGVjdGVkTGlua0VsZW1lbnQoKTsKCiAgICAgIGNvbnN0IHNlbGVjdGlvblBhcmVudCA9IGdldFNlbGVjdGlvblBhcmVudCgpOyAvLyBIaWRlIHRoZSBwYW5lbCBpZjoKICAgICAgLy8KICAgICAgLy8gKiB0aGUgc2VsZWN0aW9uIHdlbnQgb3V0IG9mIHRoZSBFWElTVElORyBsaW5rIGVsZW1lbnQuIEUuZy4gdXNlciBtb3ZlZCB0aGUgY2FyZXQgb3V0CiAgICAgIC8vICAgb2YgdGhlIGxpbmssCiAgICAgIC8vICogdGhlIHNlbGVjdGlvbiB3ZW50IHRvIGEgZGlmZmVyZW50IHBhcmVudCB3aGVuIGNyZWF0aW5nIGEgTkVXIGxpbmsuIEUuZy4gc29tZW9uZQogICAgICAvLyAgIGVsc2UgbW9kaWZpZWQgdGhlIGRvY3VtZW50LgogICAgICAvLyAqIHRoZSBzZWxlY3Rpb24gaGFzIGV4cGFuZGVkIChlLmcuIGRpc3BsYXlpbmcgbGluayBhY3Rpb25zIHRoZW4gcHJlc3NpbmcgU0hJRlQrUmlnaHQgYXJyb3cpLgogICAgICAvLwogICAgICAvLyBOb3RlOiAjX2dldFNlbGVjdGVkTGlua0VsZW1lbnQgd2lsbCByZXR1cm4gYSBsaW5rIGZvciBhIG5vbi1jb2xsYXBzZWQgc2VsZWN0aW9uIG9ubHkKICAgICAgLy8gd2hlbiBmdWxseSBzZWxlY3RlZC4KCiAgICAgIGlmIChwcmV2U2VsZWN0ZWRMaW5rICYmICFzZWxlY3RlZExpbmsgfHwgIXByZXZTZWxlY3RlZExpbmsgJiYgc2VsZWN0aW9uUGFyZW50ICE9PSBwcmV2U2VsZWN0aW9uUGFyZW50KSB7CiAgICAgICAgdGhpcy5faGlkZVVJKCk7CiAgICAgIH0gLy8gVXBkYXRlIHRoZSBwb3NpdGlvbiBvZiB0aGUgcGFuZWwgd2hlbjoKICAgICAgLy8gICogbGluayBwYW5lbCBpcyBpbiB0aGUgdmlzaWJsZSBzdGFjawogICAgICAvLyAgKiB0aGUgc2VsZWN0aW9uIHJlbWFpbnMgaW4gdGhlIG9yaWdpbmFsIGxpbmsgZWxlbWVudCwKICAgICAgLy8gICogdGhlcmUgd2FzIG5vIGxpbmsgZWxlbWVudCBpbiB0aGUgZmlyc3QgcGxhY2UsIGkuZS4gY3JlYXRpbmcgYSBuZXcgbGluawogICAgICBlbHNlIGlmICh0aGlzLl9pc1VJVmlzaWJsZSkgewogICAgICAgICAgLy8gSWYgc3RpbGwgaW4gYSBsaW5rIGVsZW1lbnQsIHNpbXBseSB1cGRhdGUgdGhlIHBvc2l0aW9uIG9mIHRoZSBiYWxsb29uLgogICAgICAgICAgLy8gSWYgdGhlcmUgd2FzIG5vIGxpbmsgKGUuZy4gaW5zZXJ0aW5nIG9uZSksIHRoZSBiYWxsb29uIG11c3QgYmUgbW92ZWQKICAgICAgICAgIC8vIHRvIHRoZSBuZXcgcG9zaXRpb24gaW4gdGhlIGVkaXRpbmcgdmlldyAoYSBuZXcgbmF0aXZlIERPTSByYW5nZSkuCiAgICAgICAgICB0aGlzLl9iYWxsb29uLnVwZGF0ZVBvc2l0aW9uKHRoaXMuX2dldEJhbGxvb25Qb3NpdGlvbkRhdGEoKSk7CiAgICAgICAgfQoKICAgICAgcHJldlNlbGVjdGVkTGluayA9IHNlbGVjdGVkTGluazsKICAgICAgcHJldlNlbGVjdGlvblBhcmVudCA9IHNlbGVjdGlvblBhcmVudDsKICAgIH07CgogICAgZnVuY3Rpb24gZ2V0U2VsZWN0aW9uUGFyZW50KCkgewogICAgICByZXR1cm4gdmlld0RvY3VtZW50LnNlbGVjdGlvbi5mb2N1cy5nZXRBbmNlc3RvcnMoKS5yZXZlcnNlKCkuZmluZChub2RlID0+IG5vZGUuaXMoJ2VsZW1lbnQnKSk7CiAgICB9CgogICAgdGhpcy5saXN0ZW5UbyhlZGl0b3IudWksICd1cGRhdGUnLCB1cGRhdGUpOwogICAgdGhpcy5saXN0ZW5Ubyh0aGlzLl9iYWxsb29uLCAnY2hhbmdlOnZpc2libGVWaWV3JywgdXBkYXRlKTsKICB9CiAgLyoqCiAgICogUmV0dXJucyBgdHJ1ZWAgd2hlbiB7QGxpbmsgI2Zvcm1WaWV3fSBpcyBpbiB0aGUge0BsaW5rICNfYmFsbG9vbn0uCiAgICoKICAgKiBAcmVhZG9ubHkKICAgKiBAcHJvdGVjdGVkCiAgICogQHR5cGUge0Jvb2xlYW59CiAgICovCgoKICBnZXQgX2lzRm9ybUluUGFuZWwoKSB7CiAgICByZXR1cm4gdGhpcy5fYmFsbG9vbi5oYXNWaWV3KHRoaXMuZm9ybVZpZXcpOwogIH0KICAvKioKICAgKiBSZXR1cm5zIGB0cnVlYCB3aGVuIHtAbGluayAjYWN0aW9uc1ZpZXd9IGlzIGluIHRoZSB7QGxpbmsgI19iYWxsb29ufS4KICAgKgogICAqIEByZWFkb25seQogICAqIEBwcm90ZWN0ZWQKICAgKiBAdHlwZSB7Qm9vbGVhbn0KICAgKi8KCgogIGdldCBfYXJlQWN0aW9uc0luUGFuZWwoKSB7CiAgICByZXR1cm4gdGhpcy5fYmFsbG9vbi5oYXNWaWV3KHRoaXMuYWN0aW9uc1ZpZXcpOwogIH0KICAvKioKICAgKiBSZXR1cm5zIGB0cnVlYCB3aGVuIHtAbGluayAjYWN0aW9uc1ZpZXd9IGlzIGluIHRoZSB7QGxpbmsgI19iYWxsb29ufSBhbmQgaXQgaXMKICAgKiBjdXJyZW50bHkgdmlzaWJsZS4KICAgKgogICAqIEByZWFkb25seQogICAqIEBwcm90ZWN0ZWQKICAgKiBAdHlwZSB7Qm9vbGVhbn0KICAgKi8KCgogIGdldCBfYXJlQWN0aW9uc1Zpc2libGUoKSB7CiAgICByZXR1cm4gdGhpcy5fYmFsbG9vbi52aXNpYmxlVmlldyA9PT0gdGhpcy5hY3Rpb25zVmlldzsKICB9CiAgLyoqCiAgICogUmV0dXJucyBgdHJ1ZWAgd2hlbiB7QGxpbmsgI2FjdGlvbnNWaWV3fSBvciB7QGxpbmsgI2Zvcm1WaWV3fSBpcyBpbiB0aGUge0BsaW5rICNfYmFsbG9vbn0uCiAgICoKICAgKiBAcmVhZG9ubHkKICAgKiBAcHJvdGVjdGVkCiAgICogQHR5cGUge0Jvb2xlYW59CiAgICovCgoKICBnZXQgX2lzVUlJblBhbmVsKCkgewogICAgcmV0dXJuIHRoaXMuX2lzRm9ybUluUGFuZWwgfHwgdGhpcy5fYXJlQWN0aW9uc0luUGFuZWw7CiAgfQogIC8qKgogICAqIFJldHVybnMgYHRydWVgIHdoZW4ge0BsaW5rICNhY3Rpb25zVmlld30gb3Ige0BsaW5rICNmb3JtVmlld30gaXMgaW4gdGhlIHtAbGluayAjX2JhbGxvb259IGFuZCBpdCBpcwogICAqIGN1cnJlbnRseSB2aXNpYmxlLgogICAqCiAgICogQHJlYWRvbmx5CiAgICogQHByb3RlY3RlZAogICAqIEB0eXBlIHtCb29sZWFufQogICAqLwoKCiAgZ2V0IF9pc1VJVmlzaWJsZSgpIHsKICAgIGNvbnN0IHZpc2libGVWaWV3ID0gdGhpcy5fYmFsbG9vbi52aXNpYmxlVmlldzsKICAgIHJldHVybiB2aXNpYmxlVmlldyA9PSB0aGlzLmZvcm1WaWV3IHx8IHRoaXMuX2FyZUFjdGlvbnNWaXNpYmxlOwogIH0KICAvKioKICAgKiBSZXR1cm5zIHBvc2l0aW9uaW5nIG9wdGlvbnMgZm9yIHRoZSB7QGxpbmsgI19iYWxsb29ufS4gVGhleSBjb250cm9sIHRoZSB3YXkgdGhlIGJhbGxvb24gaXMgYXR0YWNoZWQKICAgKiB0byB0aGUgdGFyZ2V0IGVsZW1lbnQgb3Igc2VsZWN0aW9uLgogICAqCiAgICogSWYgdGhlIHNlbGVjdGlvbiBpcyBjb2xsYXBzZWQgYW5kIGluc2lkZSBhIGxpbmsgZWxlbWVudCwgdGhlIHBhbmVsIHdpbGwgYmUgYXR0YWNoZWQgdG8gdGhlCiAgICogZW50aXJlIGxpbmsgZWxlbWVudC4gT3RoZXJ3aXNlLCBpdCB3aWxsIGJlIGF0dGFjaGVkIHRvIHRoZSBzZWxlY3Rpb24uCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEByZXR1cm5zIHttb2R1bGU6dXRpbHMvZG9tL3Bvc2l0aW9ufk9wdGlvbnN9CiAgICovCgoKICBfZ2V0QmFsbG9vblBvc2l0aW9uRGF0YSgpIHsKICAgIGNvbnN0IHZpZXcgPSB0aGlzLmVkaXRvci5lZGl0aW5nLnZpZXc7CiAgICBjb25zdCB2aWV3RG9jdW1lbnQgPSB2aWV3LmRvY3VtZW50OwoKICAgIGNvbnN0IHRhcmdldExpbmsgPSB0aGlzLl9nZXRTZWxlY3RlZExpbmtFbGVtZW50KCk7CgogICAgY29uc3QgdGFyZ2V0ID0gdGFyZ2V0TGluayA/IC8vIFdoZW4gc2VsZWN0aW9uIGlzIGluc2lkZSBsaW5rIGVsZW1lbnQsIHRoZW4gYXR0YWNoIHBhbmVsIHRvIHRoaXMgZWxlbWVudC4KICAgIHZpZXcuZG9tQ29udmVydGVyLm1hcFZpZXdUb0RvbSh0YXJnZXRMaW5rKSA6IC8vIE90aGVyd2lzZSBhdHRhY2ggcGFuZWwgdG8gdGhlIHNlbGVjdGlvbi4KICAgIHZpZXcuZG9tQ29udmVydGVyLnZpZXdSYW5nZVRvRG9tKHZpZXdEb2N1bWVudC5zZWxlY3Rpb24uZ2V0Rmlyc3RSYW5nZSgpKTsKICAgIHJldHVybiB7CiAgICAgIHRhcmdldAogICAgfTsKICB9CiAgLyoqCiAgICogUmV0dXJucyB0aGUgbGluayB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2F0dHJpYnV0ZWVsZW1lbnR+QXR0cmlidXRlRWxlbWVudH0gdW5kZXIKICAgKiB0aGUge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9kb2N1bWVudH5Eb2N1bWVudCBlZGl0aW5nIHZpZXcnc30gc2VsZWN0aW9uIG9yIGBudWxsYAogICAqIGlmIHRoZXJlIGlzIG5vbmUuCiAgICoKICAgKiAqKk5vdGUqKjogRm9yIGEgbm9u4oCTY29sbGFwc2VkIHNlbGVjdGlvbiwgdGhlIGxpbmsgZWxlbWVudCBpcyBvbmx5IHJldHVybmVkIHdoZW4gKipmdWxseSoqCiAgICogc2VsZWN0ZWQgYW5kIHRoZSAqKm9ubHkqKiBlbGVtZW50IHdpdGhpbiB0aGUgc2VsZWN0aW9uIGJvdW5kYXJpZXMuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEByZXR1cm5zIHttb2R1bGU6ZW5naW5lL3ZpZXcvYXR0cmlidXRlZWxlbWVudH5BdHRyaWJ1dGVFbGVtZW50fG51bGx9CiAgICovCgoKICBfZ2V0U2VsZWN0ZWRMaW5rRWxlbWVudCgpIHsKICAgIGNvbnN0IHZpZXcgPSB0aGlzLmVkaXRvci5lZGl0aW5nLnZpZXc7CiAgICBjb25zdCBzZWxlY3Rpb24gPSB2aWV3LmRvY3VtZW50LnNlbGVjdGlvbjsKCiAgICBpZiAoc2VsZWN0aW9uLmlzQ29sbGFwc2VkKSB7CiAgICAgIHJldHVybiBmaW5kTGlua0VsZW1lbnRBbmNlc3RvcihzZWxlY3Rpb24uZ2V0Rmlyc3RQb3NpdGlvbigpKTsKICAgIH0gZWxzZSB7CiAgICAgIC8vIFRoZSByYW5nZSBmb3IgZnVsbHkgc2VsZWN0ZWQgbGluayBpcyB1c3VhbGx5IGFuY2hvcmVkIGluIGFkamFjZW50IHRleHQgbm9kZXMuCiAgICAgIC8vIFRyaW0gaXQgdG8gZ2V0IGNsb3NlciB0byB0aGUgYWN0dWFsIGxpbmsgZWxlbWVudC4KICAgICAgY29uc3QgcmFuZ2UgPSBzZWxlY3Rpb24uZ2V0Rmlyc3RSYW5nZSgpLmdldFRyaW1tZWQoKTsKICAgICAgY29uc3Qgc3RhcnRMaW5rID0gZmluZExpbmtFbGVtZW50QW5jZXN0b3IocmFuZ2Uuc3RhcnQpOwogICAgICBjb25zdCBlbmRMaW5rID0gZmluZExpbmtFbGVtZW50QW5jZXN0b3IocmFuZ2UuZW5kKTsKCiAgICAgIGlmICghc3RhcnRMaW5rIHx8IHN0YXJ0TGluayAhPSBlbmRMaW5rKSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0gLy8gQ2hlY2sgaWYgdGhlIGxpbmsgZWxlbWVudCBpcyBmdWxseSBzZWxlY3RlZC4KCgogICAgICBpZiAodmlldy5jcmVhdGVSYW5nZUluKHN0YXJ0TGluaykuZ2V0VHJpbW1lZCgpLmlzRXF1YWwocmFuZ2UpKSB7CiAgICAgICAgcmV0dXJuIHN0YXJ0TGluazsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQogICAgfQogIH0KCn0gLy8gUmV0dXJucyBhIGxpbmsgZWxlbWVudCBpZiB0aGVyZSdzIG9uZSBhbW9uZyB0aGUgYW5jZXN0b3JzIG9mIHRoZSBwcm92aWRlZCBgUG9zaXRpb25gLgovLwovLyBAcHJpdmF0ZQovLyBAcGFyYW0ge21vZHVsZTplbmdpbmUvdmlldy9wb3NpdGlvbn5Qb3NpdGlvbn0gVmlldyBwb3NpdGlvbiB0byBhbmFseXplLgovLyBAcmV0dXJucyB7bW9kdWxlOmVuZ2luZS92aWV3L2F0dHJpYnV0ZWVsZW1lbnR+QXR0cmlidXRlRWxlbWVudHxudWxsfSBMaW5rIGVsZW1lbnQgYXQgdGhlIHBvc2l0aW9uIG9yIG51bGwuCgpmdW5jdGlvbiBmaW5kTGlua0VsZW1lbnRBbmNlc3Rvcihwb3NpdGlvbikgewogIHJldHVybiBwb3NpdGlvbi5nZXRBbmNlc3RvcnMoKS5maW5kKGFuY2VzdG9yID0+IGlzTGlua0VsZW1lbnQoYW5jZXN0b3IpKTsKfQ=="},{"version":3,"sources":["/Users/antonyching/Desktop/project/new-builder-demo/node_modules/@ckeditor/ckeditor5-link/src/linkui.js"],"names":["Plugin","ClickObserver","isLinkElement","ContextualBalloon","clickOutsideHandler","ButtonView","LinkFormView","LinkActionsView","linkIcon","linkKeystroke","LinkUI","requires","pluginName","init","editor","editing","view","addObserver","actionsView","_createActionsView","formView","_createFormView","_balloon","plugins","get","_createToolbarLinkButton","_enableUserBalloonInteractions","destroy","locale","linkCommand","commands","unlinkCommand","bind","to","editButtonView","unlinkButtonView","listenTo","_addFormView","execute","_hideUI","keystrokes","set","data","cancel","manualDecorators","urlInputView","value","saveButtonView","inputView","element","getDecoratorSwitchesState","_closeFormView","t","keyEvtData","isEnabled","_showUI","ui","componentFactory","add","button","label","icon","keystroke","tooltip","isToggleable","viewDocument","document","parentLink","_getSelectedLinkElement","_areActionsVisible","focusTracker","isFocused","focus","priority","_isUIVisible","emitter","activator","_isUIInPanel","contextElements","callback","_addActionsView","_areActionsInPanel","position","_getBalloonPositionData","_isFormInPanel","visibleView","select","restoreManualDecoratorStates","undefined","_removeFormView","remove","forceVisible","showStack","_startUpdatingUI","stopListening","prevSelectedLink","prevSelectionParent","getSelectionParent","update","selectedLink","selectionParent","updatePosition","selection","getAncestors","reverse","find","node","is","hasView","targetLink","target","domConverter","mapViewToDom","viewRangeToDom","getFirstRange","isCollapsed","findLinkElementAncestor","getFirstPosition","range","getTrimmed","startLink","start","endLink","end","createRangeIn","isEqual","ancestor"],"mappings":"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","sourcesContent":["/**\n * @license Copyright (c) 2003-2019, CKSource - Frederico Knabben. All rights reserved.\n * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license\n */\n\n/**\n * @module link/linkui\n */\n\nimport Plugin from '@ckeditor/ckeditor5-core/src/plugin';\nimport ClickObserver from '@ckeditor/ckeditor5-engine/src/view/observer/clickobserver';\nimport { isLinkElement } from './utils';\nimport ContextualBalloon from '@ckeditor/ckeditor5-ui/src/panel/balloon/contextualballoon';\n\nimport clickOutsideHandler from '@ckeditor/ckeditor5-ui/src/bindings/clickoutsidehandler';\n\nimport ButtonView from '@ckeditor/ckeditor5-ui/src/button/buttonview';\nimport LinkFormView from './ui/linkformview';\nimport LinkActionsView from './ui/linkactionsview';\n\nimport linkIcon from '../theme/icons/link.svg';\n\nconst linkKeystroke = 'Ctrl+K';\n\n/**\n * The link UI plugin. It introduces the `'link'` and `'unlink'` buttons and support for the <kbd>Ctrl+K</kbd> keystroke.\n *\n * It uses the\n * {@link module:ui/panel/balloon/contextualballoon~ContextualBalloon contextual balloon plugin}.\n *\n * @extends module:core/plugin~Plugin\n */\nexport default class LinkUI extends Plugin {\n\t/**\n\t * @inheritDoc\n\t */\n\tstatic get requires() {\n\t\treturn [ ContextualBalloon ];\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tstatic get pluginName() {\n\t\treturn 'LinkUI';\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tinit() {\n\t\tconst editor = this.editor;\n\n\t\teditor.editing.view.addObserver( ClickObserver );\n\n\t\t/**\n\t\t * The actions view displayed inside of the balloon.\n\t\t *\n\t\t * @member {module:link/ui/linkactionsview~LinkActionsView}\n\t\t */\n\t\tthis.actionsView = this._createActionsView();\n\n\t\t/**\n\t\t * The form view displayed inside the balloon.\n\t\t *\n\t\t * @member {module:link/ui/linkformview~LinkFormView}\n\t\t */\n\t\tthis.formView = this._createFormView();\n\n\t\t/**\n\t\t * The contextual balloon plugin instance.\n\t\t *\n\t\t * @private\n\t\t * @member {module:ui/panel/balloon/contextualballoon~ContextualBalloon}\n\t\t */\n\t\tthis._balloon = editor.plugins.get( ContextualBalloon );\n\n\t\t// Create toolbar buttons.\n\t\tthis._createToolbarLinkButton();\n\n\t\t// Attach lifecycle actions to the the balloon.\n\t\tthis._enableUserBalloonInteractions();\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tdestroy() {\n\t\tsuper.destroy();\n\n\t\t// Destroy created UI components as they are not automatically destroyed (see ckeditor5#1341).\n\t\tthis.formView.destroy();\n\t}\n\n\t/**\n\t * Creates the {@link module:link/ui/linkactionsview~LinkActionsView} instance.\n\t *\n\t * @private\n\t * @returns {module:link/ui/linkactionsview~LinkActionsView} The link actions view instance.\n\t */\n\t_createActionsView() {\n\t\tconst editor = this.editor;\n\t\tconst actionsView = new LinkActionsView( editor.locale );\n\t\tconst linkCommand = editor.commands.get( 'link' );\n\t\tconst unlinkCommand = editor.commands.get( 'unlink' );\n\n\t\tactionsView.bind( 'href' ).to( linkCommand, 'value' );\n\t\tactionsView.editButtonView.bind( 'isEnabled' ).to( linkCommand );\n\t\tactionsView.unlinkButtonView.bind( 'isEnabled' ).to( unlinkCommand );\n\n\t\t// Execute unlink command after clicking on the \"Edit\" button.\n\t\tthis.listenTo( actionsView, 'edit', () => {\n\t\t\tthis._addFormView();\n\t\t} );\n\n\t\t// Execute unlink command after clicking on the \"Unlink\" button.\n\t\tthis.listenTo( actionsView, 'unlink', () => {\n\t\t\teditor.execute( 'unlink' );\n\t\t\tthis._hideUI();\n\t\t} );\n\n\t\t// Close the panel on esc key press when the **actions have focus**.\n\t\tactionsView.keystrokes.set( 'Esc', ( data, cancel ) => {\n\t\t\tthis._hideUI();\n\t\t\tcancel();\n\t\t} );\n\n\t\t// Open the form view on Ctrl+K when the **actions have focus**..\n\t\tactionsView.keystrokes.set( linkKeystroke, ( data, cancel ) => {\n\t\t\tthis._addFormView();\n\t\t\tcancel();\n\t\t} );\n\n\t\treturn actionsView;\n\t}\n\n\t/**\n\t * Creates the {@link module:link/ui/linkformview~LinkFormView} instance.\n\t *\n\t * @private\n\t * @returns {module:link/ui/linkformview~LinkFormView} The link form view instance.\n\t */\n\t_createFormView() {\n\t\tconst editor = this.editor;\n\t\tconst linkCommand = editor.commands.get( 'link' );\n\n\t\tconst formView = new LinkFormView( editor.locale, linkCommand.manualDecorators );\n\n\t\tformView.urlInputView.bind( 'value' ).to( linkCommand, 'value' );\n\n\t\t// Form elements should be read-only when corresponding commands are disabled.\n\t\tformView.urlInputView.bind( 'isReadOnly' ).to( linkCommand, 'isEnabled', value => !value );\n\t\tformView.saveButtonView.bind( 'isEnabled' ).to( linkCommand );\n\n\t\t// Execute link command after clicking the \"Save\" button.\n\t\tthis.listenTo( formView, 'submit', () => {\n\t\t\teditor.execute( 'link', formView.urlInputView.inputView.element.value, formView.getDecoratorSwitchesState() );\n\t\t\tthis._closeFormView();\n\t\t} );\n\n\t\t// Hide the panel after clicking the \"Cancel\" button.\n\t\tthis.listenTo( formView, 'cancel', () => {\n\t\t\tthis._closeFormView();\n\t\t} );\n\n\t\t// Close the panel on esc key press when the **form has focus**.\n\t\tformView.keystrokes.set( 'Esc', ( data, cancel ) => {\n\t\t\tthis._closeFormView();\n\t\t\tcancel();\n\t\t} );\n\n\t\treturn formView;\n\t}\n\n\t/**\n\t * Creates a toolbar Link button. Clicking this button will show\n\t * a {@link #_balloon} attached to the selection.\n\t *\n\t * @private\n\t */\n\t_createToolbarLinkButton() {\n\t\tconst editor = this.editor;\n\t\tconst linkCommand = editor.commands.get( 'link' );\n\t\tconst t = editor.t;\n\n\t\t// Handle the `Ctrl+K` keystroke and show the panel.\n\t\teditor.keystrokes.set( linkKeystroke, ( keyEvtData, cancel ) => {\n\t\t\t// Prevent focusing the search bar in FF and opening new tab in Edge. #153, #154.\n\t\t\tcancel();\n\n\t\t\tif ( linkCommand.isEnabled ) {\n\t\t\t\tthis._showUI( true );\n\t\t\t}\n\t\t} );\n\n\t\teditor.ui.componentFactory.add( 'link', locale => {\n\t\t\tconst button = new ButtonView( locale );\n\n\t\t\tbutton.isEnabled = true;\n\t\t\tbutton.label = t( 'Link' );\n\t\t\tbutton.icon = linkIcon;\n\t\t\tbutton.keystroke = linkKeystroke;\n\t\t\tbutton.tooltip = true;\n\t\t\tbutton.isToggleable = true;\n\n\t\t\t// Bind button to the command.\n\t\t\tbutton.bind( 'isEnabled' ).to( linkCommand, 'isEnabled' );\n\t\t\tbutton.bind( 'isOn' ).to( linkCommand, 'value', value => !!value );\n\n\t\t\t// Show the panel on button click.\n\t\t\tthis.listenTo( button, 'execute', () => this._showUI( true ) );\n\n\t\t\treturn button;\n\t\t} );\n\t}\n\n\t/**\n\t * Attaches actions that control whether the balloon panel containing the\n\t * {@link #formView} is visible or not.\n\t *\n\t * @private\n\t */\n\t_enableUserBalloonInteractions() {\n\t\tconst viewDocument = this.editor.editing.view.document;\n\n\t\t// Handle click on view document and show panel when selection is placed inside the link element.\n\t\t// Keep panel open until selection will be inside the same link element.\n\t\tthis.listenTo( viewDocument, 'click', () => {\n\t\t\tconst parentLink = this._getSelectedLinkElement();\n\n\t\t\tif ( parentLink ) {\n\t\t\t\t// Then show panel but keep focus inside editor editable.\n\t\t\t\tthis._showUI();\n\t\t\t}\n\t\t} );\n\n\t\t// Focus the form if the balloon is visible and the Tab key has been pressed.\n\t\tthis.editor.keystrokes.set( 'Tab', ( data, cancel ) => {\n\t\t\tif ( this._areActionsVisible && !this.actionsView.focusTracker.isFocused ) {\n\t\t\t\tthis.actionsView.focus();\n\t\t\t\tcancel();\n\t\t\t}\n\t\t}, {\n\t\t\t// Use the high priority because the link UI navigation is more important\n\t\t\t// than other feature's actions, e.g. list indentation.\n\t\t\t// https://github.com/ckeditor/ckeditor5-link/issues/146\n\t\t\tpriority: 'high'\n\t\t} );\n\n\t\t// Close the panel on the Esc key press when the editable has focus and the balloon is visible.\n\t\tthis.editor.keystrokes.set( 'Esc', ( data, cancel ) => {\n\t\t\tif ( this._isUIVisible ) {\n\t\t\t\tthis._hideUI();\n\t\t\t\tcancel();\n\t\t\t}\n\t\t} );\n\n\t\t// Close on click outside of balloon panel element.\n\t\tclickOutsideHandler( {\n\t\t\temitter: this.formView,\n\t\t\tactivator: () => this._isUIInPanel,\n\t\t\tcontextElements: [ this._balloon.view.element ],\n\t\t\tcallback: () => this._hideUI()\n\t\t} );\n\t}\n\n\t/**\n\t * Adds the {@link #actionsView} to the {@link #_balloon}.\n\t *\n\t * @protected\n\t */\n\t_addActionsView() {\n\t\tif ( this._areActionsInPanel ) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._balloon.add( {\n\t\t\tview: this.actionsView,\n\t\t\tposition: this._getBalloonPositionData()\n\t\t} );\n\t}\n\n\t/**\n\t * Adds the {@link #formView} to the {@link #_balloon}.\n\t *\n\t * @protected\n\t */\n\t_addFormView() {\n\t\tif ( this._isFormInPanel ) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst editor = this.editor;\n\t\tconst linkCommand = editor.commands.get( 'link' );\n\n\t\tthis._balloon.add( {\n\t\t\tview: this.formView,\n\t\t\tposition: this._getBalloonPositionData()\n\t\t} );\n\n\t\t// Select input when form view is currently visible.\n\t\tif ( this._balloon.visibleView === this.formView ) {\n\t\t\tthis.formView.urlInputView.select();\n\t\t}\n\n\t\t// Make sure that each time the panel shows up, the URL field remains in sync with the value of\n\t\t// the command. If the user typed in the input, then canceled the balloon (`urlInputView#value` stays\n\t\t// unaltered) and re-opened it without changing the value of the link command (e.g. because they\n\t\t// clicked the same link), they would see the old value instead of the actual value of the command.\n\t\t// https://github.com/ckeditor/ckeditor5-link/issues/78\n\t\t// https://github.com/ckeditor/ckeditor5-link/issues/123\n\t\tthis.formView.urlInputView.inputView.element.value = linkCommand.value || '';\n\t}\n\n\t/**\n\t * Closes the form view. Decides whether the balloon should be hidden completely or if the action view should be shown. This is\n\t * decided upon the link command value (which has a value if the document selection is in the link).\n\t *\n\t * Additionally, if any {@link module:link/link~LinkConfig#decorators} are defined in the editor configuration, the state of\n\t * switch buttons responsible for manual decorator handling is restored.\n\t *\n\t * @private\n\t */\n\t_closeFormView() {\n\t\tconst linkCommand = this.editor.commands.get( 'link' );\n\n\t\t// Restore manual decorator states to represent the current model state. This case is important to reset the switch buttons\n\t\t// when the user cancels the editing form.\n\t\tlinkCommand.restoreManualDecoratorStates();\n\n\t\tif ( linkCommand.value !== undefined ) {\n\t\t\tthis._removeFormView();\n\t\t} else {\n\t\t\tthis._hideUI();\n\t\t}\n\t}\n\n\t/**\n\t * Removes the {@link #formView} from the {@link #_balloon}.\n\t *\n\t * @protected\n\t */\n\t_removeFormView() {\n\t\tif ( this._isFormInPanel ) {\n\t\t\t// Blur the input element before removing it from DOM to prevent issues in some browsers.\n\t\t\t// See https://github.com/ckeditor/ckeditor5/issues/1501.\n\t\t\tthis.formView.saveButtonView.focus();\n\n\t\t\tthis._balloon.remove( this.formView );\n\n\t\t\t// Because the form has an input which has focus, the focus must be brought back\n\t\t\t// to the editor. Otherwise, it would be lost.\n\t\t\tthis.editor.editing.view.focus();\n\t\t}\n\t}\n\n\t/**\n\t * Shows the correct UI type for the current state of the command. It is either\n\t * {@link #formView} or {@link #actionsView}.\n\t *\n\t * @param {Boolean} forceVisible\n\t * @private\n\t */\n\t_showUI( forceVisible = false ) {\n\t\tconst editor = this.editor;\n\t\tconst linkCommand = editor.commands.get( 'link' );\n\n\t\tif ( !linkCommand.isEnabled ) {\n\t\t\treturn;\n\t\t}\n\n\t\t// When there's no link under the selection, go straight to the editing UI.\n\t\tif ( !this._getSelectedLinkElement() ) {\n\t\t\tthis._addActionsView();\n\n\t\t\t// Be sure panel with link is visible.\n\t\t\tif ( forceVisible ) {\n\t\t\t\tthis._balloon.showStack( 'main' );\n\t\t\t}\n\n\t\t\tthis._addFormView();\n\t\t}\n\t\t// If there's a link under the selection...\n\t\telse {\n\t\t\t// Go to the editing UI if actions are already visible.\n\t\t\tif ( this._areActionsVisible ) {\n\t\t\t\tthis._addFormView();\n\t\t\t}\n\t\t\t// Otherwise display just the actions UI.\n\t\t\telse {\n\t\t\t\tthis._addActionsView();\n\t\t\t}\n\n\t\t\t// Be sure panel with link is visible.\n\t\t\tif ( forceVisible ) {\n\t\t\t\tthis._balloon.showStack( 'main' );\n\t\t\t}\n\t\t}\n\n\t\t// Begin responding to ui#update once the UI is added.\n\t\tthis._startUpdatingUI();\n\t}\n\n\t/**\n\t * Removes the {@link #formView} from the {@link #_balloon}.\n\t *\n\t * See {@link #_addFormView}, {@link #_addActionsView}.\n\t *\n\t * @protected\n\t */\n\t_hideUI() {\n\t\tif ( !this._isUIInPanel ) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst editor = this.editor;\n\n\t\tthis.stopListening( editor.ui, 'update' );\n\t\tthis.stopListening( this._balloon, 'change:visibleView' );\n\n\t\t// Make sure the focus always gets back to the editable _before_ removing the focused form view.\n\t\t// Doing otherwise causes issues in some browsers. See https://github.com/ckeditor/ckeditor5-link/issues/193.\n\t\teditor.editing.view.focus();\n\n\t\t// Remove form first because it's on top of the stack.\n\t\tthis._removeFormView();\n\n\t\t// Then remove the actions view because it's beneath the form.\n\t\tthis._balloon.remove( this.actionsView );\n\t}\n\n\t/**\n\t * Makes the UI react to the {@link module:core/editor/editorui~EditorUI#event:update} event to\n\t * reposition itself when the editor UI should be refreshed.\n\t *\n\t * See: {@link #_hideUI} to learn when the UI stops reacting to the `update` event.\n\t *\n\t * @protected\n\t */\n\t_startUpdatingUI() {\n\t\tconst editor = this.editor;\n\t\tconst viewDocument = editor.editing.view.document;\n\n\t\tlet prevSelectedLink = this._getSelectedLinkElement();\n\t\tlet prevSelectionParent = getSelectionParent();\n\n\t\tconst update = () => {\n\t\t\tconst selectedLink = this._getSelectedLinkElement();\n\t\t\tconst selectionParent = getSelectionParent();\n\n\t\t\t// Hide the panel if:\n\t\t\t//\n\t\t\t// * the selection went out of the EXISTING link element. E.g. user moved the caret out\n\t\t\t//   of the link,\n\t\t\t// * the selection went to a different parent when creating a NEW link. E.g. someone\n\t\t\t//   else modified the document.\n\t\t\t// * the selection has expanded (e.g. displaying link actions then pressing SHIFT+Right arrow).\n\t\t\t//\n\t\t\t// Note: #_getSelectedLinkElement will return a link for a non-collapsed selection only\n\t\t\t// when fully selected.\n\t\t\tif ( ( prevSelectedLink && !selectedLink ) ||\n\t\t\t\t( !prevSelectedLink && selectionParent !== prevSelectionParent ) ) {\n\t\t\t\tthis._hideUI();\n\t\t\t}\n\t\t\t// Update the position of the panel when:\n\t\t\t//  * link panel is in the visible stack\n\t\t\t//  * the selection remains in the original link element,\n\t\t\t//  * there was no link element in the first place, i.e. creating a new link\n\t\t\telse if ( this._isUIVisible ) {\n\t\t\t\t// If still in a link element, simply update the position of the balloon.\n\t\t\t\t// If there was no link (e.g. inserting one), the balloon must be moved\n\t\t\t\t// to the new position in the editing view (a new native DOM range).\n\t\t\t\tthis._balloon.updatePosition( this._getBalloonPositionData() );\n\t\t\t}\n\n\t\t\tprevSelectedLink = selectedLink;\n\t\t\tprevSelectionParent = selectionParent;\n\t\t};\n\n\t\tfunction getSelectionParent() {\n\t\t\treturn viewDocument.selection.focus.getAncestors()\n\t\t\t\t.reverse()\n\t\t\t\t.find( node => node.is( 'element' ) );\n\t\t}\n\n\t\tthis.listenTo( editor.ui, 'update', update );\n\t\tthis.listenTo( this._balloon, 'change:visibleView', update );\n\t}\n\n\t/**\n\t * Returns `true` when {@link #formView} is in the {@link #_balloon}.\n\t *\n\t * @readonly\n\t * @protected\n\t * @type {Boolean}\n\t */\n\tget _isFormInPanel() {\n\t\treturn this._balloon.hasView( this.formView );\n\t}\n\n\t/**\n\t * Returns `true` when {@link #actionsView} is in the {@link #_balloon}.\n\t *\n\t * @readonly\n\t * @protected\n\t * @type {Boolean}\n\t */\n\tget _areActionsInPanel() {\n\t\treturn this._balloon.hasView( this.actionsView );\n\t}\n\n\t/**\n\t * Returns `true` when {@link #actionsView} is in the {@link #_balloon} and it is\n\t * currently visible.\n\t *\n\t * @readonly\n\t * @protected\n\t * @type {Boolean}\n\t */\n\tget _areActionsVisible() {\n\t\treturn this._balloon.visibleView === this.actionsView;\n\t}\n\n\t/**\n\t * Returns `true` when {@link #actionsView} or {@link #formView} is in the {@link #_balloon}.\n\t *\n\t * @readonly\n\t * @protected\n\t * @type {Boolean}\n\t */\n\tget _isUIInPanel() {\n\t\treturn this._isFormInPanel || this._areActionsInPanel;\n\t}\n\n\t/**\n\t * Returns `true` when {@link #actionsView} or {@link #formView} is in the {@link #_balloon} and it is\n\t * currently visible.\n\t *\n\t * @readonly\n\t * @protected\n\t * @type {Boolean}\n\t */\n\tget _isUIVisible() {\n\t\tconst visibleView = this._balloon.visibleView;\n\n\t\treturn visibleView == this.formView || this._areActionsVisible;\n\t}\n\n\t/**\n\t * Returns positioning options for the {@link #_balloon}. They control the way the balloon is attached\n\t * to the target element or selection.\n\t *\n\t * If the selection is collapsed and inside a link element, the panel will be attached to the\n\t * entire link element. Otherwise, it will be attached to the selection.\n\t *\n\t * @private\n\t * @returns {module:utils/dom/position~Options}\n\t */\n\t_getBalloonPositionData() {\n\t\tconst view = this.editor.editing.view;\n\t\tconst viewDocument = view.document;\n\t\tconst targetLink = this._getSelectedLinkElement();\n\n\t\tconst target = targetLink ?\n\t\t\t// When selection is inside link element, then attach panel to this element.\n\t\t\tview.domConverter.mapViewToDom( targetLink ) :\n\t\t\t// Otherwise attach panel to the selection.\n\t\t\tview.domConverter.viewRangeToDom( viewDocument.selection.getFirstRange() );\n\n\t\treturn { target };\n\t}\n\n\t/**\n\t * Returns the link {@link module:engine/view/attributeelement~AttributeElement} under\n\t * the {@link module:engine/view/document~Document editing view's} selection or `null`\n\t * if there is none.\n\t *\n\t * **Note**: For a non–collapsed selection, the link element is only returned when **fully**\n\t * selected and the **only** element within the selection boundaries.\n\t *\n\t * @private\n\t * @returns {module:engine/view/attributeelement~AttributeElement|null}\n\t */\n\t_getSelectedLinkElement() {\n\t\tconst view = this.editor.editing.view;\n\t\tconst selection = view.document.selection;\n\n\t\tif ( selection.isCollapsed ) {\n\t\t\treturn findLinkElementAncestor( selection.getFirstPosition() );\n\t\t} else {\n\t\t\t// The range for fully selected link is usually anchored in adjacent text nodes.\n\t\t\t// Trim it to get closer to the actual link element.\n\t\t\tconst range = selection.getFirstRange().getTrimmed();\n\t\t\tconst startLink = findLinkElementAncestor( range.start );\n\t\t\tconst endLink = findLinkElementAncestor( range.end );\n\n\t\t\tif ( !startLink || startLink != endLink ) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\t// Check if the link element is fully selected.\n\t\t\tif ( view.createRangeIn( startLink ).getTrimmed().isEqual( range ) ) {\n\t\t\t\treturn startLink;\n\t\t\t} else {\n\t\t\t\treturn null;\n\t\t\t}\n\t\t}\n\t}\n}\n\n// Returns a link element if there's one among the ancestors of the provided `Position`.\n//\n// @private\n// @param {module:engine/view/position~Position} View position to analyze.\n// @returns {module:engine/view/attributeelement~AttributeElement|null} Link element at the position or null.\nfunction findLinkElementAncestor( position ) {\n\treturn position.getAncestors().find( ancestor => isLinkElement( ancestor ) );\n}\n"]}]}
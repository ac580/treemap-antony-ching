{"remainingRequest":"/Users/antonyching/Desktop/project/new-builder-demo/node_modules/babel-loader/lib/index.js!/Users/antonyching/Desktop/project/new-builder-demo/node_modules/@ckeditor/ckeditor5-image/src/imagecaption/imagecaptionediting.js","dependencies":[{"path":"/Users/antonyching/Desktop/project/new-builder-demo/node_modules/@ckeditor/ckeditor5-image/src/imagecaption/imagecaptionediting.js","mtime":499162500000},{"path":"/Users/antonyching/Desktop/project/new-builder-demo/node_modules/@ckeditor/ckeditor5-dev-webpack-plugin/lib/translatesourceloader.js","mtime":499162500000},{"path":"/Users/antonyching/Desktop/project/new-builder-demo/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/antonyching/Desktop/project/new-builder-demo/node_modules/babel-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:LyoqCiAqIEBsaWNlbnNlIENvcHlyaWdodCAoYykgMjAwMy0yMDE5LCBDS1NvdXJjZSAtIEZyZWRlcmljbyBLbmFiYmVuLiBBbGwgcmlnaHRzIHJlc2VydmVkLgogKiBGb3IgbGljZW5zaW5nLCBzZWUgTElDRU5TRS5tZCBvciBodHRwczovL2NrZWRpdG9yLmNvbS9sZWdhbC9ja2VkaXRvci1vc3MtbGljZW5zZQogKi8KCi8qKgogKiBAbW9kdWxlIGltYWdlL2ltYWdlY2FwdGlvbi9pbWFnZWNhcHRpb25lZGl0aW5nCiAqLwppbXBvcnQgUGx1Z2luIGZyb20gJ0Bja2VkaXRvci9ja2VkaXRvcjUtY29yZS9zcmMvcGx1Z2luJzsKaW1wb3J0IHsgaXNJbWFnZSB9IGZyb20gJy4uL2ltYWdlL3V0aWxzJzsKaW1wb3J0IHsgY2FwdGlvbkVsZW1lbnRDcmVhdG9yLCBnZXRDYXB0aW9uRnJvbUltYWdlLCBtYXRjaEltYWdlQ2FwdGlvbiB9IGZyb20gJy4vdXRpbHMnOwovKioKICogVGhlIGltYWdlIGNhcHRpb24gZW5naW5lIHBsdWdpbi4KICoKICogSXQgcmVnaXN0ZXJzIHByb3BlciBjb252ZXJ0ZXJzLiBJdCB0YWtlcyBjYXJlIG9mIGFkZGluZyBhIGNhcHRpb24gZWxlbWVudCBpZiB0aGUgaW1hZ2Ugd2l0aG91dCBpdCBpcyBpbnNlcnRlZAogKiB0byB0aGUgbW9kZWwgZG9jdW1lbnQuCiAqCiAqIEBleHRlbmRzIG1vZHVsZTpjb3JlL3BsdWdpbn5QbHVnaW4KICovCgpleHBvcnQgZGVmYXVsdCBjbGFzcyBJbWFnZUNhcHRpb25FZGl0aW5nIGV4dGVuZHMgUGx1Z2luIHsKICAvKioKICAgKiBAaW5oZXJpdERvYwogICAqLwogIHN0YXRpYyBnZXQgcGx1Z2luTmFtZSgpIHsKICAgIHJldHVybiAnSW1hZ2VDYXB0aW9uRWRpdGluZyc7CiAgfQogIC8qKgogICAqIEBpbmhlcml0RG9jCiAgICovCgoKICBpbml0KCkgewogICAgY29uc3QgZWRpdG9yID0gdGhpcy5lZGl0b3I7CiAgICBjb25zdCB2aWV3ID0gZWRpdG9yLmVkaXRpbmcudmlldzsKICAgIGNvbnN0IHNjaGVtYSA9IGVkaXRvci5tb2RlbC5zY2hlbWE7CiAgICBjb25zdCBkYXRhID0gZWRpdG9yLmRhdGE7CiAgICBjb25zdCBlZGl0aW5nID0gZWRpdG9yLmVkaXRpbmc7CiAgICBjb25zdCB0ID0gZWRpdG9yLnQ7CiAgICAvKioKICAgICAqIFRoZSBsYXN0IHNlbGVjdGVkIGNhcHRpb24gZWRpdGFibGUuCiAgICAgKiBJdCBpcyB1c2VkIGZvciBoaWRpbmcgdGhlIGVkaXRhYmxlIHdoZW4gaXQgaXMgZW1wdHkgYW5kIHRoZSBpbWFnZSB3aWRnZXQgaXMgbm8gbG9uZ2VyIHNlbGVjdGVkLgogICAgICoKICAgICAqIEBwcml2YXRlCiAgICAgKiBAbWVtYmVyIHttb2R1bGU6ZW5naW5lL3ZpZXcvZWRpdGFibGVlbGVtZW50fkVkaXRhYmxlRWxlbWVudH0gI19sYXN0U2VsZWN0ZWRDYXB0aW9uCiAgICAgKi8KICAgIC8vIFNjaGVtYSBjb25maWd1cmF0aW9uLgoKICAgIHNjaGVtYS5yZWdpc3RlcignY2FwdGlvbicsIHsKICAgICAgYWxsb3dJbjogJ2ltYWdlJywKICAgICAgYWxsb3dDb250ZW50T2Y6ICckYmxvY2snLAogICAgICBpc0xpbWl0OiB0cnVlCiAgICB9KTsgLy8gQWRkIGNhcHRpb24gZWxlbWVudCB0byBlYWNoIGltYWdlIGluc2VydGVkIHdpdGhvdXQgaXQuCgogICAgZWRpdG9yLm1vZGVsLmRvY3VtZW50LnJlZ2lzdGVyUG9zdEZpeGVyKHdyaXRlciA9PiB0aGlzLl9pbnNlcnRNaXNzaW5nTW9kZWxDYXB0aW9uRWxlbWVudCh3cml0ZXIpKTsgLy8gVmlldyB0byBtb2RlbCBjb252ZXJ0ZXIgZm9yIHRoZSBkYXRhIHBpcGVsaW5lLgoKICAgIGVkaXRvci5jb252ZXJzaW9uLmZvcigndXBjYXN0JykuZWxlbWVudFRvRWxlbWVudCh7CiAgICAgIHZpZXc6IG1hdGNoSW1hZ2VDYXB0aW9uLAogICAgICBtb2RlbDogJ2NhcHRpb24nCiAgICB9KTsgLy8gTW9kZWwgdG8gdmlldyBjb252ZXJ0ZXIgZm9yIHRoZSBkYXRhIHBpcGVsaW5lLgoKICAgIGNvbnN0IGNyZWF0ZUNhcHRpb25Gb3JEYXRhID0gd3JpdGVyID0+IHdyaXRlci5jcmVhdGVDb250YWluZXJFbGVtZW50KCdmaWdjYXB0aW9uJyk7CgogICAgZGF0YS5kb3duY2FzdERpc3BhdGNoZXIub24oJ2luc2VydDpjYXB0aW9uJywgY2FwdGlvbk1vZGVsVG9WaWV3KGNyZWF0ZUNhcHRpb25Gb3JEYXRhLCBmYWxzZSkpOyAvLyBNb2RlbCB0byB2aWV3IGNvbnZlcnRlciBmb3IgdGhlIGVkaXRpbmcgcGlwZWxpbmUuCgogICAgY29uc3QgY3JlYXRlQ2FwdGlvbkZvckVkaXRpbmcgPSBjYXB0aW9uRWxlbWVudENyZWF0b3IodmlldywgdCgnRW50ZXIgaW1hZ2UgY2FwdGlvbicpKTsKICAgIGVkaXRpbmcuZG93bmNhc3REaXNwYXRjaGVyLm9uKCdpbnNlcnQ6Y2FwdGlvbicsIGNhcHRpb25Nb2RlbFRvVmlldyhjcmVhdGVDYXB0aW9uRm9yRWRpdGluZykpOyAvLyBBbHdheXMgc2hvdyBjYXB0aW9uIGluIHZpZXcgd2hlbiBzb21ldGhpbmcgaXMgaW5zZXJ0ZWQgaW4gbW9kZWwuCgogICAgZWRpdGluZy5kb3duY2FzdERpc3BhdGNoZXIub24oJ2luc2VydCcsIHRoaXMuX2ZpeENhcHRpb25WaXNpYmlsaXR5KGRhdGEgPT4gZGF0YS5pdGVtKSwgewogICAgICBwcmlvcml0eTogJ2hpZ2gnCiAgICB9KTsgLy8gSGlkZSBjYXB0aW9uIHdoZW4gZXZlcnl0aGluZyBpcyByZW1vdmVkIGZyb20gaXQuCgogICAgZWRpdGluZy5kb3duY2FzdERpc3BhdGNoZXIub24oJ3JlbW92ZScsIHRoaXMuX2ZpeENhcHRpb25WaXNpYmlsaXR5KGRhdGEgPT4gZGF0YS5wb3NpdGlvbi5wYXJlbnQpLCB7CiAgICAgIHByaW9yaXR5OiAnaGlnaCcKICAgIH0pOyAvLyBVcGRhdGUgY2FwdGlvbiB2aXNpYmlsaXR5IG9uIHZpZXcgaW4gcG9zdCBmaXhlci4KCiAgICB2aWV3LmRvY3VtZW50LnJlZ2lzdGVyUG9zdEZpeGVyKHdyaXRlciA9PiB0aGlzLl91cGRhdGVDYXB0aW9uVmlzaWJpbGl0eSh3cml0ZXIpKTsKICB9CiAgLyoqCiAgICogVXBkYXRlcyB0aGUgdmlldyBiZWZvcmUgZWFjaCByZW5kZXJpbmcsIG1ha2luZyBzdXJlIHRoYXQgZW1wdHkgY2FwdGlvbnMgKHNvIHVubmVjZXNzYXJ5IG9uZXMpIGFyZSBoaWRkZW4KICAgKiBhbmQgdGhlbiB2aXNpYmxlIHdoZW4gdGhlIGltYWdlIGlzIHNlbGVjdGVkLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0ge21vZHVsZTplbmdpbmUvdmlldy9kb3duY2FzdHdyaXRlcn5Eb3duY2FzdFdyaXRlcn0gdmlld1dyaXRlcgogICAqIEByZXR1cm5zIHtCb29sZWFufSBSZXR1cm5zIGB0cnVlYCB3aGVuIHRoZSB2aWV3IGlzIHVwZGF0ZWQuCiAgICovCgoKICBfdXBkYXRlQ2FwdGlvblZpc2liaWxpdHkodmlld1dyaXRlcikgewogICAgY29uc3QgbWFwcGVyID0gdGhpcy5lZGl0b3IuZWRpdGluZy5tYXBwZXI7CiAgICBjb25zdCBsYXN0Q2FwdGlvbiA9IHRoaXMuX2xhc3RTZWxlY3RlZENhcHRpb247CiAgICBsZXQgdmlld0NhcHRpb247IC8vIElmIHdob2xlIGltYWdlIGlzIHNlbGVjdGVkLgoKICAgIGNvbnN0IG1vZGVsU2VsZWN0aW9uID0gdGhpcy5lZGl0b3IubW9kZWwuZG9jdW1lbnQuc2VsZWN0aW9uOwogICAgY29uc3Qgc2VsZWN0ZWRFbGVtZW50ID0gbW9kZWxTZWxlY3Rpb24uZ2V0U2VsZWN0ZWRFbGVtZW50KCk7CgogICAgaWYgKHNlbGVjdGVkRWxlbWVudCAmJiBzZWxlY3RlZEVsZW1lbnQuaXMoJ2ltYWdlJykpIHsKICAgICAgY29uc3QgbW9kZWxDYXB0aW9uID0gZ2V0Q2FwdGlvbkZyb21JbWFnZShzZWxlY3RlZEVsZW1lbnQpOwogICAgICB2aWV3Q2FwdGlvbiA9IG1hcHBlci50b1ZpZXdFbGVtZW50KG1vZGVsQ2FwdGlvbik7CiAgICB9IC8vIElmIHNlbGVjdGlvbiBpcyBwbGFjZWQgaW5zaWRlIGNhcHRpb24uCgoKICAgIGNvbnN0IHBvc2l0aW9uID0gbW9kZWxTZWxlY3Rpb24uZ2V0Rmlyc3RQb3NpdGlvbigpOwogICAgY29uc3QgbW9kZWxDYXB0aW9uID0gZ2V0UGFyZW50Q2FwdGlvbihwb3NpdGlvbi5wYXJlbnQpOwoKICAgIGlmIChtb2RlbENhcHRpb24pIHsKICAgICAgdmlld0NhcHRpb24gPSBtYXBwZXIudG9WaWV3RWxlbWVudChtb2RlbENhcHRpb24pOwogICAgfSAvLyBJcyBjdXJyZW50bHkgYW55IGNhcHRpb24gc2VsZWN0ZWQ/CgoKICAgIGlmICh2aWV3Q2FwdGlvbikgewogICAgICAvLyBXYXMgYW55IGNhcHRpb24gc2VsZWN0ZWQgYmVmb3JlPwogICAgICBpZiAobGFzdENhcHRpb24pIHsKICAgICAgICAvLyBTYW1lIGNhcHRpb24gYXMgYmVmb3JlPwogICAgICAgIGlmIChsYXN0Q2FwdGlvbiA9PT0gdmlld0NhcHRpb24pIHsKICAgICAgICAgIHJldHVybiBzaG93Q2FwdGlvbih2aWV3Q2FwdGlvbiwgdmlld1dyaXRlcik7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGhpZGVDYXB0aW9uSWZFbXB0eShsYXN0Q2FwdGlvbiwgdmlld1dyaXRlcik7CiAgICAgICAgICB0aGlzLl9sYXN0U2VsZWN0ZWRDYXB0aW9uID0gdmlld0NhcHRpb247CiAgICAgICAgICByZXR1cm4gc2hvd0NhcHRpb24odmlld0NhcHRpb24sIHZpZXdXcml0ZXIpOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLl9sYXN0U2VsZWN0ZWRDYXB0aW9uID0gdmlld0NhcHRpb247CiAgICAgICAgcmV0dXJuIHNob3dDYXB0aW9uKHZpZXdDYXB0aW9uLCB2aWV3V3JpdGVyKTsKICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgLy8gV2FzIGFueSBjYXB0aW9uIHNlbGVjdGVkIGJlZm9yZT8KICAgICAgaWYgKGxhc3RDYXB0aW9uKSB7CiAgICAgICAgY29uc3Qgdmlld01vZGlmaWVkID0gaGlkZUNhcHRpb25JZkVtcHR5KGxhc3RDYXB0aW9uLCB2aWV3V3JpdGVyKTsKICAgICAgICB0aGlzLl9sYXN0U2VsZWN0ZWRDYXB0aW9uID0gbnVsbDsKICAgICAgICByZXR1cm4gdmlld01vZGlmaWVkOwogICAgICB9IGVsc2UgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgfQogIH0KICAvKioKICAgKiBSZXR1cm5zIGEgY29udmVydGVyIHRoYXQgZml4ZXMgY2FwdGlvbiB2aXNpYmlsaXR5IGR1cmluZyB0aGUgbW9kZWwtdG8tdmlldyBjb252ZXJzaW9uLgogICAqIENoZWNrcyBpZiB0aGUgY2hhbmdlZCBub2RlIGlzIHBsYWNlZCBpbnNpZGUgdGhlIGNhcHRpb24gZWxlbWVudCBhbmQgZml4ZXMgaXRzIHZpc2liaWxpdHkgaW4gdGhlIHZpZXcuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBwYXJhbSB7RnVuY3Rpb259IG5vZGVGaW5kZXIKICAgKiBAcmV0dXJucyB7RnVuY3Rpb259CiAgICovCgoKICBfZml4Q2FwdGlvblZpc2liaWxpdHkobm9kZUZpbmRlcikgewogICAgcmV0dXJuIChldnQsIGRhdGEsIGNvbnZlcnNpb25BcGkpID0+IHsKICAgICAgY29uc3Qgbm9kZSA9IG5vZGVGaW5kZXIoZGF0YSk7CiAgICAgIGNvbnN0IG1vZGVsQ2FwdGlvbiA9IGdldFBhcmVudENhcHRpb24obm9kZSk7CiAgICAgIGNvbnN0IG1hcHBlciA9IHRoaXMuZWRpdG9yLmVkaXRpbmcubWFwcGVyOwogICAgICBjb25zdCB2aWV3V3JpdGVyID0gY29udmVyc2lvbkFwaS53cml0ZXI7CgogICAgICBpZiAobW9kZWxDYXB0aW9uKSB7CiAgICAgICAgY29uc3Qgdmlld0NhcHRpb24gPSBtYXBwZXIudG9WaWV3RWxlbWVudChtb2RlbENhcHRpb24pOwoKICAgICAgICBpZiAodmlld0NhcHRpb24pIHsKICAgICAgICAgIGlmIChtb2RlbENhcHRpb24uY2hpbGRDb3VudCkgewogICAgICAgICAgICB2aWV3V3JpdGVyLnJlbW92ZUNsYXNzKCdjay1oaWRkZW4nLCB2aWV3Q2FwdGlvbik7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB2aWV3V3JpdGVyLmFkZENsYXNzKCdjay1oaWRkZW4nLCB2aWV3Q2FwdGlvbik7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9OwogIH0KICAvKioKICAgKiBDaGVja3Mgd2hldGhlciB0aGUgZGF0YSBpbnNlcnRlZCB0byB0aGUgbW9kZWwgZG9jdW1lbnQgaGF2ZSBhbiBpbWFnZSBlbGVtZW50IHRoYXQgaGFzIG5vIGNhcHRpb24gZWxlbWVudCBpbnNpZGUgaXQuCiAgICogSWYgdGhlcmUgaXMgbm9uZSwgaXQgYWRkcyBpdCB0byB0aGUgaW1hZ2UgZWxlbWVudC4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHttb2R1bGU6ZW5naW5lL21vZGVsL3dyaXRlcn5Xcml0ZXJ9IHdyaXRlciBUaGUgd3JpdGVyIHRvIG1ha2UgY2hhbmdlcyB3aXRoLgogICAqIEByZXR1cm5zIHtCb29sZWFufSBgdHJ1ZWAgaWYgYW55IGNoYW5nZSB3YXMgYXBwbGllZCwgYGZhbHNlYCBvdGhlcndpc2UuCiAgICovCgoKICBfaW5zZXJ0TWlzc2luZ01vZGVsQ2FwdGlvbkVsZW1lbnQod3JpdGVyKSB7CiAgICBjb25zdCBtb2RlbCA9IHRoaXMuZWRpdG9yLm1vZGVsOwogICAgY29uc3QgY2hhbmdlcyA9IG1vZGVsLmRvY3VtZW50LmRpZmZlci5nZXRDaGFuZ2VzKCk7CiAgICBjb25zdCBpbWFnZXNXaXRob3V0Q2FwdGlvbiA9IFtdOwoKICAgIGZvciAoY29uc3QgZW50cnkgb2YgY2hhbmdlcykgewogICAgICBpZiAoZW50cnkudHlwZSA9PSAnaW5zZXJ0JyAmJiBlbnRyeS5uYW1lICE9ICckdGV4dCcpIHsKICAgICAgICBjb25zdCBpdGVtID0gZW50cnkucG9zaXRpb24ubm9kZUFmdGVyOwoKICAgICAgICBpZiAoaXRlbS5pcygnaW1hZ2UnKSAmJiAhZ2V0Q2FwdGlvbkZyb21JbWFnZShpdGVtKSkgewogICAgICAgICAgaW1hZ2VzV2l0aG91dENhcHRpb24ucHVzaChpdGVtKTsKICAgICAgICB9IC8vIENoZWNrIGVsZW1lbnRzIHdpdGggY2hpbGRyZW4gZm9yIG5lc3RlZCBpbWFnZXMuCgoKICAgICAgICBpZiAoIWl0ZW0uaXMoJ2ltYWdlJykgJiYgaXRlbS5jaGlsZENvdW50KSB7CiAgICAgICAgICBmb3IgKGNvbnN0IG5lc3RlZEl0ZW0gb2YgbW9kZWwuY3JlYXRlUmFuZ2VJbihpdGVtKS5nZXRJdGVtcygpKSB7CiAgICAgICAgICAgIGlmIChuZXN0ZWRJdGVtLmlzKCdpbWFnZScpICYmICFnZXRDYXB0aW9uRnJvbUltYWdlKG5lc3RlZEl0ZW0pKSB7CiAgICAgICAgICAgICAgaW1hZ2VzV2l0aG91dENhcHRpb24ucHVzaChuZXN0ZWRJdGVtKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfQoKICAgIGZvciAoY29uc3QgaW1hZ2Ugb2YgaW1hZ2VzV2l0aG91dENhcHRpb24pIHsKICAgICAgd3JpdGVyLmFwcGVuZEVsZW1lbnQoJ2NhcHRpb24nLCBpbWFnZSk7CiAgICB9CgogICAgcmV0dXJuICEhaW1hZ2VzV2l0aG91dENhcHRpb24ubGVuZ3RoOwogIH0KCn0gLy8gQ3JlYXRlcyBhIGNvbnZlcnRlciB0aGF0IGNvbnZlcnRzIGltYWdlIGNhcHRpb24gbW9kZWwgZWxlbWVudCB0byB2aWV3IGVsZW1lbnQuCi8vCi8vIEBwcml2YXRlCi8vIEBwYXJhbSB7RnVuY3Rpb259IGVsZW1lbnRDcmVhdG9yCi8vIEBwYXJhbSB7Qm9vbGVhbn0gW2hpZGU9dHJ1ZV0gV2hlbiBzZXQgdG8gYGZhbHNlYCB2aWV3IGVsZW1lbnQgd2lsbCBub3QgYmUgaW5zZXJ0ZWQgd2hlbiBpdCdzIGVtcHR5LgovLyBAcmV0dXJucyB7RnVuY3Rpb259CgpmdW5jdGlvbiBjYXB0aW9uTW9kZWxUb1ZpZXcoZWxlbWVudENyZWF0b3IsIGhpZGUgPSB0cnVlKSB7CiAgcmV0dXJuIChldnQsIGRhdGEsIGNvbnZlcnNpb25BcGkpID0+IHsKICAgIGNvbnN0IGNhcHRpb25FbGVtZW50ID0gZGF0YS5pdGVtOyAvLyBSZXR1cm4gaWYgZWxlbWVudCBzaG91bGRuJ3QgYmUgcHJlc2VudCB3aGVuIGVtcHR5LgoKICAgIGlmICghY2FwdGlvbkVsZW1lbnQuY2hpbGRDb3VudCAmJiAhaGlkZSkgewogICAgICByZXR1cm47CiAgICB9CgogICAgaWYgKGlzSW1hZ2UoY2FwdGlvbkVsZW1lbnQucGFyZW50KSkgewogICAgICBpZiAoIWNvbnZlcnNpb25BcGkuY29uc3VtYWJsZS5jb25zdW1lKGRhdGEuaXRlbSwgJ2luc2VydCcpKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBjb25zdCB2aWV3SW1hZ2UgPSBjb252ZXJzaW9uQXBpLm1hcHBlci50b1ZpZXdFbGVtZW50KGRhdGEucmFuZ2Uuc3RhcnQucGFyZW50KTsKICAgICAgY29uc3Qgdmlld0NhcHRpb24gPSBlbGVtZW50Q3JlYXRvcihjb252ZXJzaW9uQXBpLndyaXRlcik7CiAgICAgIGNvbnN0IHZpZXdXcml0ZXIgPSBjb252ZXJzaW9uQXBpLndyaXRlcjsgLy8gSGlkZSBpZiBlbXB0eS4KCiAgICAgIGlmICghY2FwdGlvbkVsZW1lbnQuY2hpbGRDb3VudCkgewogICAgICAgIHZpZXdXcml0ZXIuYWRkQ2xhc3MoJ2NrLWhpZGRlbicsIHZpZXdDYXB0aW9uKTsKICAgICAgfQoKICAgICAgaW5zZXJ0Vmlld0NhcHRpb25BbmRCaW5kKHZpZXdDYXB0aW9uLCBkYXRhLml0ZW0sIHZpZXdJbWFnZSwgY29udmVyc2lvbkFwaSk7CiAgICB9CiAgfTsKfSAvLyBJbnNlcnRzIGB2aWV3Q2FwdGlvbmAgYXQgdGhlIGVuZCBvZiBgdmlld0ltYWdlYCBhbmQgYmluZHMgaXQgdG8gYG1vZGVsQ2FwdGlvbmAuCi8vCi8vIEBwcml2YXRlCi8vIEBwYXJhbSB7bW9kdWxlOmVuZ2luZS92aWV3L2NvbnRhaW5lcmVsZW1lbnR+Q29udGFpbmVyRWxlbWVudH0gdmlld0NhcHRpb24KLy8gQHBhcmFtIHttb2R1bGU6ZW5naW5lL21vZGVsL2VsZW1lbnR+RWxlbWVudH0gbW9kZWxDYXB0aW9uCi8vIEBwYXJhbSB7bW9kdWxlOmVuZ2luZS92aWV3L2NvbnRhaW5lcmVsZW1lbnR+Q29udGFpbmVyRWxlbWVudH0gdmlld0ltYWdlCi8vIEBwYXJhbSB7bW9kdWxlOmVuZ2luZS9jb252ZXJzaW9uL2Rvd25jYXN0ZGlzcGF0Y2hlcn5Eb3duY2FzdENvbnZlcnNpb25BcGl9IGNvbnZlcnNpb25BcGkKCgpmdW5jdGlvbiBpbnNlcnRWaWV3Q2FwdGlvbkFuZEJpbmQodmlld0NhcHRpb24sIG1vZGVsQ2FwdGlvbiwgdmlld0ltYWdlLCBjb252ZXJzaW9uQXBpKSB7CiAgY29uc3Qgdmlld1Bvc2l0aW9uID0gY29udmVyc2lvbkFwaS53cml0ZXIuY3JlYXRlUG9zaXRpb25BdCh2aWV3SW1hZ2UsICdlbmQnKTsKICBjb252ZXJzaW9uQXBpLndyaXRlci5pbnNlcnQodmlld1Bvc2l0aW9uLCB2aWV3Q2FwdGlvbik7CiAgY29udmVyc2lvbkFwaS5tYXBwZXIuYmluZEVsZW1lbnRzKG1vZGVsQ2FwdGlvbiwgdmlld0NhcHRpb24pOwp9IC8vIENoZWNrcyBpZiB0aGUgcHJvdmlkZWQgbm9kZSBvciBvbmUgb2YgaXRzIGFuY2VzdG9ycyBpcyBhIGNhcHRpb24gZWxlbWVudCwgYW5kIHJldHVybnMgaXQuCi8vCi8vIEBwcml2YXRlCi8vIEBwYXJhbSB7bW9kdWxlOmVuZ2luZS9tb2RlbC9ub2Rlfk5vZGV9IG5vZGUKLy8gQHJldHVybnMge21vZHVsZTplbmdpbmUvbW9kZWwvZWxlbWVudH5FbGVtZW50fG51bGx9CgoKZnVuY3Rpb24gZ2V0UGFyZW50Q2FwdGlvbihub2RlKSB7CiAgY29uc3QgYW5jZXN0b3JzID0gbm9kZS5nZXRBbmNlc3RvcnMoewogICAgaW5jbHVkZVNlbGY6IHRydWUKICB9KTsKICBjb25zdCBjYXB0aW9uID0gYW5jZXN0b3JzLmZpbmQoYW5jZXN0b3IgPT4gYW5jZXN0b3IubmFtZSA9PSAnY2FwdGlvbicpOwoKICBpZiAoY2FwdGlvbiAmJiBjYXB0aW9uLnBhcmVudCAmJiBjYXB0aW9uLnBhcmVudC5uYW1lID09ICdpbWFnZScpIHsKICAgIHJldHVybiBjYXB0aW9uOwogIH0KCiAgcmV0dXJuIG51bGw7Cn0gLy8gSGlkZXMgYSBnaXZlbiBjYXB0aW9uIGluIHRoZSB2aWV3IGlmIGl0IGlzIGVtcHR5LgovLwovLyBAcHJpdmF0ZQovLyBAcGFyYW0ge21vZHVsZTplbmdpbmUvdmlldy9jb250YWluZXJlbGVtZW50fkNvbnRhaW5lckVsZW1lbnR9IGNhcHRpb24KLy8gQHBhcmFtIHttb2R1bGU6ZW5naW5lL3ZpZXcvZG93bmNhc3R3cml0ZXJ+RG93bmNhc3RXcml0ZXJ9IHZpZXdXcml0ZXIKLy8gQHJldHVybnMge0Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIHRoZSB2aWV3IHdhcyBtb2RpZmllZC4KCgpmdW5jdGlvbiBoaWRlQ2FwdGlvbklmRW1wdHkoY2FwdGlvbiwgdmlld1dyaXRlcikgewogIGlmICghY2FwdGlvbi5jaGlsZENvdW50ICYmICFjYXB0aW9uLmhhc0NsYXNzKCdjay1oaWRkZW4nKSkgewogICAgdmlld1dyaXRlci5hZGRDbGFzcygnY2staGlkZGVuJywgY2FwdGlvbik7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIHJldHVybiBmYWxzZTsKfSAvLyBTaG93cyB0aGUgY2FwdGlvbi4KLy8KLy8gQHByaXZhdGUKLy8gQHBhcmFtIHttb2R1bGU6ZW5naW5lL3ZpZXcvY29udGFpbmVyZWxlbWVudH5Db250YWluZXJFbGVtZW50fSBjYXB0aW9uCi8vIEBwYXJhbSB7bW9kdWxlOmVuZ2luZS92aWV3L2Rvd25jYXN0d3JpdGVyfkRvd25jYXN0V3JpdGVyfSB2aWV3V3JpdGVyCi8vIEByZXR1cm5zIHtCb29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiB0aGUgdmlldyB3YXMgbW9kaWZpZWQuCgoKZnVuY3Rpb24gc2hvd0NhcHRpb24oY2FwdGlvbiwgdmlld1dyaXRlcikgewogIGlmIChjYXB0aW9uLmhhc0NsYXNzKCdjay1oaWRkZW4nKSkgewogICAgdmlld1dyaXRlci5yZW1vdmVDbGFzcygnY2staGlkZGVuJywgY2FwdGlvbik7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIHJldHVybiBmYWxzZTsKfQ=="},{"version":3,"sources":["/Users/antonyching/Desktop/project/new-builder-demo/node_modules/@ckeditor/ckeditor5-image/src/imagecaption/imagecaptionediting.js"],"names":["Plugin","isImage","captionElementCreator","getCaptionFromImage","matchImageCaption","ImageCaptionEditing","pluginName","init","editor","view","editing","schema","model","data","t","register","allowIn","allowContentOf","isLimit","document","registerPostFixer","writer","_insertMissingModelCaptionElement","conversion","for","elementToElement","createCaptionForData","createContainerElement","downcastDispatcher","on","captionModelToView","createCaptionForEditing","_fixCaptionVisibility","item","priority","position","parent","_updateCaptionVisibility","viewWriter","mapper","lastCaption","_lastSelectedCaption","viewCaption","modelSelection","selection","selectedElement","getSelectedElement","is","modelCaption","toViewElement","getFirstPosition","getParentCaption","showCaption","hideCaptionIfEmpty","viewModified","nodeFinder","evt","conversionApi","node","childCount","removeClass","addClass","changes","differ","getChanges","imagesWithoutCaption","entry","type","name","nodeAfter","push","nestedItem","createRangeIn","getItems","image","appendElement","length","elementCreator","hide","captionElement","consumable","consume","viewImage","range","start","insertViewCaptionAndBind","viewPosition","createPositionAt","insert","bindElements","ancestors","getAncestors","includeSelf","caption","find","ancestor","hasClass"],"mappings":"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","sourcesContent":["/**\n * @license Copyright (c) 2003-2019, CKSource - Frederico Knabben. All rights reserved.\n * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license\n */\n\n/**\n * @module image/imagecaption/imagecaptionediting\n */\n\nimport Plugin from '@ckeditor/ckeditor5-core/src/plugin';\nimport { isImage } from '../image/utils';\nimport { captionElementCreator, getCaptionFromImage, matchImageCaption } from './utils';\n\n/**\n * The image caption engine plugin.\n *\n * It registers proper converters. It takes care of adding a caption element if the image without it is inserted\n * to the model document.\n *\n * @extends module:core/plugin~Plugin\n */\nexport default class ImageCaptionEditing extends Plugin {\n\t/**\n\t * @inheritDoc\n\t */\n\tstatic get pluginName() {\n\t\treturn 'ImageCaptionEditing';\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tinit() {\n\t\tconst editor = this.editor;\n\t\tconst view = editor.editing.view;\n\t\tconst schema = editor.model.schema;\n\t\tconst data = editor.data;\n\t\tconst editing = editor.editing;\n\t\tconst t = editor.t;\n\n\t\t/**\n\t\t * The last selected caption editable.\n\t\t * It is used for hiding the editable when it is empty and the image widget is no longer selected.\n\t\t *\n\t\t * @private\n\t\t * @member {module:engine/view/editableelement~EditableElement} #_lastSelectedCaption\n\t\t */\n\n\t\t// Schema configuration.\n\t\tschema.register( 'caption', {\n\t\t\tallowIn: 'image',\n\t\t\tallowContentOf: '$block',\n\t\t\tisLimit: true\n\t\t} );\n\n\t\t// Add caption element to each image inserted without it.\n\t\teditor.model.document.registerPostFixer( writer => this._insertMissingModelCaptionElement( writer ) );\n\n\t\t// View to model converter for the data pipeline.\n\t\teditor.conversion.for( 'upcast' ).elementToElement( {\n\t\t\tview: matchImageCaption,\n\t\t\tmodel: 'caption'\n\t\t} );\n\n\t\t// Model to view converter for the data pipeline.\n\t\tconst createCaptionForData = writer => writer.createContainerElement( 'figcaption' );\n\t\tdata.downcastDispatcher.on( 'insert:caption', captionModelToView( createCaptionForData, false ) );\n\n\t\t// Model to view converter for the editing pipeline.\n\t\tconst createCaptionForEditing = captionElementCreator( view, t( 'Enter image caption' ) );\n\t\tediting.downcastDispatcher.on( 'insert:caption', captionModelToView( createCaptionForEditing ) );\n\n\t\t// Always show caption in view when something is inserted in model.\n\t\tediting.downcastDispatcher.on(\n\t\t\t'insert',\n\t\t\tthis._fixCaptionVisibility( data => data.item ),\n\t\t\t{ priority: 'high' }\n\t\t);\n\n\t\t// Hide caption when everything is removed from it.\n\t\tediting.downcastDispatcher.on( 'remove', this._fixCaptionVisibility( data => data.position.parent ), { priority: 'high' } );\n\n\t\t// Update caption visibility on view in post fixer.\n\t\tview.document.registerPostFixer( writer => this._updateCaptionVisibility( writer ) );\n\t}\n\n\t/**\n\t * Updates the view before each rendering, making sure that empty captions (so unnecessary ones) are hidden\n\t * and then visible when the image is selected.\n\t *\n\t * @private\n\t * @param {module:engine/view/downcastwriter~DowncastWriter} viewWriter\n\t * @returns {Boolean} Returns `true` when the view is updated.\n\t */\n\t_updateCaptionVisibility( viewWriter ) {\n\t\tconst mapper = this.editor.editing.mapper;\n\t\tconst lastCaption = this._lastSelectedCaption;\n\t\tlet viewCaption;\n\n\t\t// If whole image is selected.\n\t\tconst modelSelection = this.editor.model.document.selection;\n\t\tconst selectedElement = modelSelection.getSelectedElement();\n\n\t\tif ( selectedElement && selectedElement.is( 'image' ) ) {\n\t\t\tconst modelCaption = getCaptionFromImage( selectedElement );\n\t\t\tviewCaption = mapper.toViewElement( modelCaption );\n\t\t}\n\n\t\t// If selection is placed inside caption.\n\t\tconst position = modelSelection.getFirstPosition();\n\t\tconst modelCaption = getParentCaption( position.parent );\n\n\t\tif ( modelCaption ) {\n\t\t\tviewCaption = mapper.toViewElement( modelCaption );\n\t\t}\n\n\t\t// Is currently any caption selected?\n\t\tif ( viewCaption ) {\n\t\t\t// Was any caption selected before?\n\t\t\tif ( lastCaption ) {\n\t\t\t\t// Same caption as before?\n\t\t\t\tif ( lastCaption === viewCaption ) {\n\t\t\t\t\treturn showCaption( viewCaption, viewWriter );\n\t\t\t\t} else {\n\t\t\t\t\thideCaptionIfEmpty( lastCaption, viewWriter );\n\t\t\t\t\tthis._lastSelectedCaption = viewCaption;\n\n\t\t\t\t\treturn showCaption( viewCaption, viewWriter );\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthis._lastSelectedCaption = viewCaption;\n\t\t\t\treturn showCaption( viewCaption, viewWriter );\n\t\t\t}\n\t\t} else {\n\t\t\t// Was any caption selected before?\n\t\t\tif ( lastCaption ) {\n\t\t\t\tconst viewModified = hideCaptionIfEmpty( lastCaption, viewWriter );\n\t\t\t\tthis._lastSelectedCaption = null;\n\n\t\t\t\treturn viewModified;\n\t\t\t} else {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Returns a converter that fixes caption visibility during the model-to-view conversion.\n\t * Checks if the changed node is placed inside the caption element and fixes its visibility in the view.\n\t *\n\t * @private\n\t * @param {Function} nodeFinder\n\t * @returns {Function}\n\t */\n\t_fixCaptionVisibility( nodeFinder ) {\n\t\treturn ( evt, data, conversionApi ) => {\n\t\t\tconst node = nodeFinder( data );\n\t\t\tconst modelCaption = getParentCaption( node );\n\t\t\tconst mapper = this.editor.editing.mapper;\n\t\t\tconst viewWriter = conversionApi.writer;\n\n\t\t\tif ( modelCaption ) {\n\t\t\t\tconst viewCaption = mapper.toViewElement( modelCaption );\n\n\t\t\t\tif ( viewCaption ) {\n\t\t\t\t\tif ( modelCaption.childCount ) {\n\t\t\t\t\t\tviewWriter.removeClass( 'ck-hidden', viewCaption );\n\t\t\t\t\t} else {\n\t\t\t\t\t\tviewWriter.addClass( 'ck-hidden', viewCaption );\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t}\n\n\t/**\n\t * Checks whether the data inserted to the model document have an image element that has no caption element inside it.\n\t * If there is none, it adds it to the image element.\n\t *\n\t * @private\n\t * @param {module:engine/model/writer~Writer} writer The writer to make changes with.\n\t * @returns {Boolean} `true` if any change was applied, `false` otherwise.\n\t */\n\t_insertMissingModelCaptionElement( writer ) {\n\t\tconst model = this.editor.model;\n\t\tconst changes = model.document.differ.getChanges();\n\n\t\tconst imagesWithoutCaption = [];\n\n\t\tfor ( const entry of changes ) {\n\t\t\tif ( entry.type == 'insert' && entry.name != '$text' ) {\n\t\t\t\tconst item = entry.position.nodeAfter;\n\n\t\t\t\tif ( item.is( 'image' ) && !getCaptionFromImage( item ) ) {\n\t\t\t\t\timagesWithoutCaption.push( item );\n\t\t\t\t}\n\n\t\t\t\t// Check elements with children for nested images.\n\t\t\t\tif ( !item.is( 'image' ) && item.childCount ) {\n\t\t\t\t\tfor ( const nestedItem of model.createRangeIn( item ).getItems() ) {\n\t\t\t\t\t\tif ( nestedItem.is( 'image' ) && !getCaptionFromImage( nestedItem ) ) {\n\t\t\t\t\t\t\timagesWithoutCaption.push( nestedItem );\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tfor ( const image of imagesWithoutCaption ) {\n\t\t\twriter.appendElement( 'caption', image );\n\t\t}\n\n\t\treturn !!imagesWithoutCaption.length;\n\t}\n}\n\n// Creates a converter that converts image caption model element to view element.\n//\n// @private\n// @param {Function} elementCreator\n// @param {Boolean} [hide=true] When set to `false` view element will not be inserted when it's empty.\n// @returns {Function}\nfunction captionModelToView( elementCreator, hide = true ) {\n\treturn ( evt, data, conversionApi ) => {\n\t\tconst captionElement = data.item;\n\n\t\t// Return if element shouldn't be present when empty.\n\t\tif ( !captionElement.childCount && !hide ) {\n\t\t\treturn;\n\t\t}\n\n\t\tif ( isImage( captionElement.parent ) ) {\n\t\t\tif ( !conversionApi.consumable.consume( data.item, 'insert' ) ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst viewImage = conversionApi.mapper.toViewElement( data.range.start.parent );\n\t\t\tconst viewCaption = elementCreator( conversionApi.writer );\n\t\t\tconst viewWriter = conversionApi.writer;\n\n\t\t\t// Hide if empty.\n\t\t\tif ( !captionElement.childCount ) {\n\t\t\t\tviewWriter.addClass( 'ck-hidden', viewCaption );\n\t\t\t}\n\n\t\t\tinsertViewCaptionAndBind( viewCaption, data.item, viewImage, conversionApi );\n\t\t}\n\t};\n}\n\n// Inserts `viewCaption` at the end of `viewImage` and binds it to `modelCaption`.\n//\n// @private\n// @param {module:engine/view/containerelement~ContainerElement} viewCaption\n// @param {module:engine/model/element~Element} modelCaption\n// @param {module:engine/view/containerelement~ContainerElement} viewImage\n// @param {module:engine/conversion/downcastdispatcher~DowncastConversionApi} conversionApi\nfunction insertViewCaptionAndBind( viewCaption, modelCaption, viewImage, conversionApi ) {\n\tconst viewPosition = conversionApi.writer.createPositionAt( viewImage, 'end' );\n\n\tconversionApi.writer.insert( viewPosition, viewCaption );\n\tconversionApi.mapper.bindElements( modelCaption, viewCaption );\n}\n\n// Checks if the provided node or one of its ancestors is a caption element, and returns it.\n//\n// @private\n// @param {module:engine/model/node~Node} node\n// @returns {module:engine/model/element~Element|null}\nfunction getParentCaption( node ) {\n\tconst ancestors = node.getAncestors( { includeSelf: true } );\n\tconst caption = ancestors.find( ancestor => ancestor.name == 'caption' );\n\n\tif ( caption && caption.parent && caption.parent.name == 'image' ) {\n\t\treturn caption;\n\t}\n\n\treturn null;\n}\n\n// Hides a given caption in the view if it is empty.\n//\n// @private\n// @param {module:engine/view/containerelement~ContainerElement} caption\n// @param {module:engine/view/downcastwriter~DowncastWriter} viewWriter\n// @returns {Boolean} Returns `true` if the view was modified.\nfunction hideCaptionIfEmpty( caption, viewWriter ) {\n\tif ( !caption.childCount && !caption.hasClass( 'ck-hidden' ) ) {\n\t\tviewWriter.addClass( 'ck-hidden', caption );\n\t\treturn true;\n\t}\n\n\treturn false;\n}\n\n// Shows the caption.\n//\n// @private\n// @param {module:engine/view/containerelement~ContainerElement} caption\n// @param {module:engine/view/downcastwriter~DowncastWriter} viewWriter\n// @returns {Boolean} Returns `true` if the view was modified.\nfunction showCaption( caption, viewWriter ) {\n\tif ( caption.hasClass( 'ck-hidden' ) ) {\n\t\tviewWriter.removeClass( 'ck-hidden', caption );\n\t\treturn true;\n\t}\n\n\treturn false;\n}\n"]}]}
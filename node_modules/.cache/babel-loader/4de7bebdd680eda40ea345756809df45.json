{"remainingRequest":"/Users/antonyching/Desktop/project/new-builder-demo/node_modules/babel-loader/lib/index.js!/Users/antonyching/Desktop/project/new-builder-demo/node_modules/@ckeditor/ckeditor5-widget/src/widgettoolbarrepository.js","dependencies":[{"path":"/Users/antonyching/Desktop/project/new-builder-demo/node_modules/@ckeditor/ckeditor5-widget/src/widgettoolbarrepository.js","mtime":499162500000},{"path":"/Users/antonyching/Desktop/project/new-builder-demo/node_modules/@ckeditor/ckeditor5-dev-webpack-plugin/lib/translatesourceloader.js","mtime":499162500000},{"path":"/Users/antonyching/Desktop/project/new-builder-demo/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/antonyching/Desktop/project/new-builder-demo/node_modules/babel-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:LyoqCiAqIEBsaWNlbnNlIENvcHlyaWdodCAoYykgMjAwMy0yMDE5LCBDS1NvdXJjZSAtIEZyZWRlcmljbyBLbmFiYmVuLiBBbGwgcmlnaHRzIHJlc2VydmVkLgogKiBGb3IgbGljZW5zaW5nLCBzZWUgTElDRU5TRS5tZCBvciBodHRwczovL2NrZWRpdG9yLmNvbS9sZWdhbC9ja2VkaXRvci1vc3MtbGljZW5zZQogKi8KCi8qKgogKiBAbW9kdWxlIHdpZGdldC93aWRnZXR0b29sYmFycmVwb3NpdG9yeQogKi8KaW1wb3J0IFBsdWdpbiBmcm9tICdAY2tlZGl0b3IvY2tlZGl0b3I1LWNvcmUvc3JjL3BsdWdpbic7CmltcG9ydCBDb250ZXh0dWFsQmFsbG9vbiBmcm9tICdAY2tlZGl0b3IvY2tlZGl0b3I1LXVpL3NyYy9wYW5lbC9iYWxsb29uL2NvbnRleHR1YWxiYWxsb29uJzsKaW1wb3J0IFRvb2xiYXJWaWV3IGZyb20gJ0Bja2VkaXRvci9ja2VkaXRvcjUtdWkvc3JjL3Rvb2xiYXIvdG9vbGJhcnZpZXcnOwppbXBvcnQgQmFsbG9vblBhbmVsVmlldyBmcm9tICdAY2tlZGl0b3IvY2tlZGl0b3I1LXVpL3NyYy9wYW5lbC9iYWxsb29uL2JhbGxvb25wYW5lbHZpZXcnOwppbXBvcnQgeyBpc1dpZGdldCB9IGZyb20gJy4vdXRpbHMnOwppbXBvcnQgQ0tFZGl0b3JFcnJvciBmcm9tICdAY2tlZGl0b3IvY2tlZGl0b3I1LXV0aWxzL3NyYy9ja2VkaXRvcmVycm9yJzsKLyoqCiAqIFdpZGdldCB0b29sYmFyIHJlcG9zaXRvcnkgcGx1Z2luLiBBIGNlbnRyYWwgcG9pbnQgZm9yIHJlZ2lzdGVyaW5nIHdpZGdldCB0b29sYmFycy4gVGhpcyBwbHVnaW4gaGFuZGxlcyB0aGUgd2hvbGUKICogdG9vbGJhciByZW5kZXJpbmcgcHJvY2VzcyBhbmQgZXhwb3NlcyBhIGNvbmNpc2UgQVBJLgogKgogKiBUbyBhZGQgYSB0b29sYmFyIGZvciB5b3VyIHdpZGdldCB1c2UgdGhlIHtAbGluayB+V2lkZ2V0VG9vbGJhclJlcG9zaXRvcnkjcmVnaXN0ZXIgYFdpZGdldFRvb2xiYXJSZXBvc2l0b3J5I3JlZ2lzdGVyKClgfSBtZXRob2QuCiAqCiAqIFRoZSBmb2xsb3dpbmcgZXhhbXBsZSBjb21lcyBmcm9tIHRoZSB7QGxpbmsgbW9kdWxlOmltYWdlL2ltYWdldG9vbGJhcn5JbWFnZVRvb2xiYXJ9IHBsdWdpbjoKICoKICogCQljbGFzcyBJbWFnZVRvb2xiYXIgZXh0ZW5kcyBQbHVnaW4gewogKgkJCXN0YXRpYyBnZXQgcmVxdWlyZXMoKSB7CiAqCQkJCXJldHVybiBbIFdpZGdldFRvb2xiYXJSZXBvc2l0b3J5IF07CiAqCQkJfQogKgogKgkJCWFmdGVySW5pdCgpIHsKICoJCQkJY29uc3QgZWRpdG9yID0gdGhpcy5lZGl0b3I7CiAqCQkJCWNvbnN0IHdpZGdldFRvb2xiYXJSZXBvc2l0b3J5ID0gZWRpdG9yLnBsdWdpbnMuZ2V0KCBXaWRnZXRUb29sYmFyUmVwb3NpdG9yeSApOwogKgogKgkJCQl3aWRnZXRUb29sYmFyUmVwb3NpdG9yeS5yZWdpc3RlciggJ2ltYWdlJywgewogKgkJCQkJaXRlbXM6IGVkaXRvci5jb25maWcuZ2V0KCAnaW1hZ2UudG9vbGJhcicgKSwKICoJCQkJCWdldFJlbGF0ZWRFbGVtZW50OiBnZXRTZWxlY3RlZEltYWdlV2lkZ2V0CiAqCQkJCX0gKTsKICoJCQl9CiAqCQl9CiAqLwoKZXhwb3J0IGRlZmF1bHQgY2xhc3MgV2lkZ2V0VG9vbGJhclJlcG9zaXRvcnkgZXh0ZW5kcyBQbHVnaW4gewogIC8qKgogICAqIEBpbmhlcml0RG9jCiAgICovCiAgc3RhdGljIGdldCByZXF1aXJlcygpIHsKICAgIHJldHVybiBbQ29udGV4dHVhbEJhbGxvb25dOwogIH0KICAvKioKICAgKiBAaW5oZXJpdERvYwogICAqLwoKCiAgc3RhdGljIGdldCBwbHVnaW5OYW1lKCkgewogICAgcmV0dXJuICdXaWRnZXRUb29sYmFyUmVwb3NpdG9yeSc7CiAgfQogIC8qKgogICAqIEBpbmhlcml0RG9jCiAgICovCgoKICBpbml0KCkgewogICAgY29uc3QgZWRpdG9yID0gdGhpcy5lZGl0b3I7IC8vIERpc2FibGVzIHRoZSBkZWZhdWx0IGJhbGxvb24gdG9vbGJhciBmb3IgYWxsIHdpZGdldHMuCgogICAgaWYgKGVkaXRvci5wbHVnaW5zLmhhcygnQmFsbG9vblRvb2xiYXInKSkgewogICAgICBjb25zdCBiYWxsb29uVG9vbGJhciA9IGVkaXRvci5wbHVnaW5zLmdldCgnQmFsbG9vblRvb2xiYXInKTsKICAgICAgdGhpcy5saXN0ZW5UbyhiYWxsb29uVG9vbGJhciwgJ3Nob3cnLCBldnQgPT4gewogICAgICAgIGlmIChpc1dpZGdldFNlbGVjdGVkKGVkaXRvci5lZGl0aW5nLnZpZXcuZG9jdW1lbnQuc2VsZWN0aW9uKSkgewogICAgICAgICAgZXZ0LnN0b3AoKTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBwcmlvcml0eTogJ2hpZ2gnCiAgICAgIH0pOwogICAgfQogICAgLyoqCiAgICAgKiBBIG1hcCBvZiB0b29sYmFyIGRlZmluaXRpb25zLgogICAgICoKICAgICAqIEBwcm90ZWN0ZWQKICAgICAqIEBtZW1iZXIge01hcC48U3RyaW5nLG1vZHVsZTp3aWRnZXQvd2lkZ2V0dG9vbGJhcnJlcG9zaXRvcnl+V2lkZ2V0UmVwb3NpdG9yeVRvb2xiYXJEZWZpbml0aW9uPn0gI190b29sYmFyRGVmaW5pdGlvbnMKICAgICAqLwoKCiAgICB0aGlzLl90b29sYmFyRGVmaW5pdGlvbnMgPSBuZXcgTWFwKCk7CiAgICAvKioKICAgICAqIEBwcml2YXRlCiAgICAgKi8KCiAgICB0aGlzLl9iYWxsb29uID0gdGhpcy5lZGl0b3IucGx1Z2lucy5nZXQoJ0NvbnRleHR1YWxCYWxsb29uJyk7CiAgICB0aGlzLmxpc3RlblRvKGVkaXRvci51aSwgJ3VwZGF0ZScsICgpID0+IHsKICAgICAgdGhpcy5fdXBkYXRlVG9vbGJhcnNWaXNpYmlsaXR5KCk7CiAgICB9KTsgLy8gVUkjdXBkYXRlIGlzIG5vdCBmaXJlZCBhZnRlciBmb2N1cyBpcyBiYWNrIGluIGVkaXRvciwgd2UgbmVlZCB0byBjaGVjayBpZiBiYWxsb29uIHBhbmVsIHNob3VsZCBiZSB2aXNpYmxlLgoKICAgIHRoaXMubGlzdGVuVG8oZWRpdG9yLnVpLmZvY3VzVHJhY2tlciwgJ2NoYW5nZTppc0ZvY3VzZWQnLCAoKSA9PiB7CiAgICAgIHRoaXMuX3VwZGF0ZVRvb2xiYXJzVmlzaWJpbGl0eSgpOwogICAgfSwgewogICAgICBwcmlvcml0eTogJ2xvdycKICAgIH0pOwogIH0KCiAgZGVzdHJveSgpIHsKICAgIHN1cGVyLmRlc3Ryb3koKTsKCiAgICBmb3IgKGNvbnN0IHRvb2xiYXJDb25maWcgb2YgdGhpcy5fdG9vbGJhckRlZmluaXRpb25zLnZhbHVlcygpKSB7CiAgICAgIHRvb2xiYXJDb25maWcudmlldy5kZXN0cm95KCk7CiAgICB9CiAgfQogIC8qKgogICAqIFJlZ2lzdGVycyB0b29sYmFyIGluIHRoZSBXaWRnZXRUb29sYmFyUmVwb3NpdG9yeS4gSXQgcmVuZGVycyBpdCBpbiB0aGUgYENvbnRleHR1YWxCYWxsb29uYCBiYXNlZCBvbiB0aGUgdmFsdWUgb2YgdGhlIGludm9rZWQKICAgKiBgZ2V0UmVsYXRlZEVsZW1lbnRgIGZ1bmN0aW9uLiBUb29sYmFyIGl0ZW1zIGFyZSBnYXRoZXJlZCBmcm9tIGBpdGVtc2AgYXJyYXkuCiAgICogVGhlIGJhbGxvb24ncyBDU1MgY2xhc3MgaXMgYnkgZGVmYXVsdCBgY2stdG9vbGJhci1jb250YWluZXJgIGFuZCBtYXkgYmUgb3ZlcnJpZGUgd2l0aCB0aGUgYGJhbGxvb25DbGFzc05hbWVgIG9wdGlvbi4KICAgKgogICAqIE5vdGU6IFRoaXMgbWV0aG9kIHNob3VsZCBiZSBjYWxsZWQgaW4gdGhlIHtAbGluayBtb2R1bGU6Y29yZS9wbHVnaW5+UGx1Z2luSW50ZXJmYWNlI2FmdGVySW5pdCBgUGx1Z2luI2FmdGVySW5pdCgpYH0KICAgKiBjYWxsYmFjayAob3IgbGF0ZXIpIHRvIG1ha2Ugc3VyZSB0aGF0IHRoZSBnaXZlbiB0b29sYmFyIGl0ZW1zIHdlcmUgYWxyZWFkeSByZWdpc3RlcmVkIGJ5IG90aGVyIHBsdWdpbnMuCiAgICoKICAgKiBAcGFyYW0ge1N0cmluZ30gdG9vbGJhcklkIEFuIGlkIGZvciB0aGUgdG9vbGJhci4gVXNlZCB0bwogICAqIEBwYXJhbSB7T2JqZWN0fSBvcHRpb25zCiAgICogQHBhcmFtIHtTdHJpbmd9IFtvcHRpb25zLmFyaWFMYWJlbF0gTGFiZWwgdXNlZCBieSBhc3Npc3RpdmUgdGVjaG5vbG9naWVzIHRvIGRlc2NyaWJlIHRoaXMgdG9vbGJhciBlbGVtZW50LgogICAqIEBwYXJhbSB7QXJyYXkuPFN0cmluZz59IG9wdGlvbnMuaXRlbXMgQXJyYXkgb2YgdG9vbGJhciBpdGVtcy4KICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBvcHRpb25zLmdldFJlbGF0ZWRFbGVtZW50IENhbGxiYWNrIHdoaWNoIHJldHVybnMgYW4gZWxlbWVudCB0aGUgdG9vbGJhciBzaG91bGQgYmUgYXR0YWNoZWQgdG8uCiAgICogQHBhcmFtIHtTdHJpbmd9IFtvcHRpb25zLmJhbGxvb25DbGFzc05hbWU9J2NrLXRvb2xiYXItY29udGFpbmVyJ10gQ1NTIGNsYXNzIGZvciB0aGUgd2lkZ2V0IGJhbGxvb24uCiAgICovCgoKICByZWdpc3Rlcih0b29sYmFySWQsIHsKICAgIGFyaWFMYWJlbCwKICAgIGl0ZW1zLAogICAgZ2V0UmVsYXRlZEVsZW1lbnQsCiAgICBiYWxsb29uQ2xhc3NOYW1lID0gJ2NrLXRvb2xiYXItY29udGFpbmVyJwogIH0pIHsKICAgIGNvbnN0IGVkaXRvciA9IHRoaXMuZWRpdG9yOwogICAgY29uc3QgdCA9IGVkaXRvci50OwogICAgY29uc3QgdG9vbGJhclZpZXcgPSBuZXcgVG9vbGJhclZpZXcoZWRpdG9yLmxvY2FsZSk7CiAgICB0b29sYmFyVmlldy5hcmlhTGFiZWwgPSBhcmlhTGFiZWwgfHwgdCgnV2lkZ2V0IHRvb2xiYXInKTsKCiAgICBpZiAodGhpcy5fdG9vbGJhckRlZmluaXRpb25zLmhhcyh0b29sYmFySWQpKSB7CiAgICAgIC8qKgogICAgICAgKiBUb29sYmFyIHdpdGggdGhlIGdpdmVuIGlkIHdhcyBhbHJlYWR5IGFkZGVkLgogICAgICAgKgogICAgICAgKiBAZXJyb3Igd2lkZ2V0LXRvb2xiYXItZHVwbGljYXRlZAogICAgICAgKiBAcGFyYW0gdG9vbGJhcklkIFRvb2xiYXIgaWQuCiAgICAgICAqLwogICAgICB0aHJvdyBuZXcgQ0tFZGl0b3JFcnJvcignd2lkZ2V0LXRvb2xiYXItZHVwbGljYXRlZDogVG9vbGJhciB3aXRoIHRoZSBnaXZlbiBpZCB3YXMgYWxyZWFkeSBhZGRlZC4nLCB0aGlzLCB7CiAgICAgICAgdG9vbGJhcklkCiAgICAgIH0pOwogICAgfQoKICAgIHRvb2xiYXJWaWV3LmZpbGxGcm9tQ29uZmlnKGl0ZW1zLCBlZGl0b3IudWkuY29tcG9uZW50RmFjdG9yeSk7CgogICAgdGhpcy5fdG9vbGJhckRlZmluaXRpb25zLnNldCh0b29sYmFySWQsIHsKICAgICAgdmlldzogdG9vbGJhclZpZXcsCiAgICAgIGdldFJlbGF0ZWRFbGVtZW50LAogICAgICBiYWxsb29uQ2xhc3NOYW1lCiAgICB9KTsKICB9CiAgLyoqCiAgICogSXRlcmF0ZXMgb3ZlciBzdG9yZWQgdG9vbGJhcnMgYW5kIG1ha2VzIHRoZW0gdmlzaWJsZSBvciBoaWRkZW4uCiAgICoKICAgKiBAcHJpdmF0ZQogICAqLwoKCiAgX3VwZGF0ZVRvb2xiYXJzVmlzaWJpbGl0eSgpIHsKICAgIGxldCBtYXhSZWxhdGVkRWxlbWVudERlcHRoID0gMDsKICAgIGxldCBkZWVwZXN0UmVsYXRlZEVsZW1lbnQgPSBudWxsOwogICAgbGV0IGRlZXBlc3RUb29sYmFyRGVmaW5pdGlvbiA9IG51bGw7CgogICAgZm9yIChjb25zdCBkZWZpbml0aW9uIG9mIHRoaXMuX3Rvb2xiYXJEZWZpbml0aW9ucy52YWx1ZXMoKSkgewogICAgICBjb25zdCByZWxhdGVkRWxlbWVudCA9IGRlZmluaXRpb24uZ2V0UmVsYXRlZEVsZW1lbnQodGhpcy5lZGl0b3IuZWRpdGluZy52aWV3LmRvY3VtZW50LnNlbGVjdGlvbik7CgogICAgICBpZiAoIXRoaXMuZWRpdG9yLnVpLmZvY3VzVHJhY2tlci5pc0ZvY3VzZWQpIHsKICAgICAgICBpZiAodGhpcy5faXNUb29sYmFyVmlzaWJsZShkZWZpbml0aW9uKSkgewogICAgICAgICAgdGhpcy5faGlkZVRvb2xiYXIoZGVmaW5pdGlvbik7CiAgICAgICAgfQogICAgICB9IGVsc2UgaWYgKCFyZWxhdGVkRWxlbWVudCkgewogICAgICAgIGlmICh0aGlzLl9pc1Rvb2xiYXJJbkJhbGxvb24oZGVmaW5pdGlvbikpIHsKICAgICAgICAgIHRoaXMuX2hpZGVUb29sYmFyKGRlZmluaXRpb24pOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICBjb25zdCByZWxhdGVkRWxlbWVudERlcHRoID0gcmVsYXRlZEVsZW1lbnQuZ2V0QW5jZXN0b3JzKCkubGVuZ3RoOyAvLyBNYW55IHRvb2xiYXJzIGNhbiBleHByZXNzIHdpbGxpbmduZXNzIHRvIGJlIGRpc3BsYXllZCBidXQgdGhleSBkbyBub3Qga25vdyBhYm91dAogICAgICAgIC8vIGVhY2ggb3RoZXIuIEZpZ3VyZSBvdXQgd2hpY2ggdG9vbGJhciBpcyBkZWVwZXN0IGluIHRoZSB2aWV3IHRyZWUgdG8gZGVjaWRlIHdoaWNoCiAgICAgICAgLy8gc2hvdWxkIGJlIGRpc3BsYXllZC4gRm9yIGluc3RhbmNlLCBpZiBhIHNlbGVjdGVkIGltYWdlIGlzIGluc2lkZSBhIHRhYmxlIGNlbGwsIGRpc3BsYXkKICAgICAgICAvLyB0aGUgSW1hZ2VUb29sYmFyIHJhdGhlciB0aGFuIHRoZSBUYWJsZVRvb2xiYXIgKCM2MCkuCgogICAgICAgIGlmIChyZWxhdGVkRWxlbWVudERlcHRoID4gbWF4UmVsYXRlZEVsZW1lbnREZXB0aCkgewogICAgICAgICAgbWF4UmVsYXRlZEVsZW1lbnREZXB0aCA9IHJlbGF0ZWRFbGVtZW50RGVwdGg7CiAgICAgICAgICBkZWVwZXN0UmVsYXRlZEVsZW1lbnQgPSByZWxhdGVkRWxlbWVudDsKICAgICAgICAgIGRlZXBlc3RUb29sYmFyRGVmaW5pdGlvbiA9IGRlZmluaXRpb247CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgaWYgKGRlZXBlc3RUb29sYmFyRGVmaW5pdGlvbikgewogICAgICB0aGlzLl9zaG93VG9vbGJhcihkZWVwZXN0VG9vbGJhckRlZmluaXRpb24sIGRlZXBlc3RSZWxhdGVkRWxlbWVudCk7CiAgICB9CiAgfQogIC8qKgogICAqIEhpZGVzIHRoZSBnaXZlbiB0b29sYmFyLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0ge21vZHVsZTp3aWRnZXQvd2lkZ2V0dG9vbGJhcnJlcG9zaXRvcnl+V2lkZ2V0UmVwb3NpdG9yeVRvb2xiYXJEZWZpbml0aW9ufSB0b29sYmFyRGVmaW5pdGlvbgogICAqLwoKCiAgX2hpZGVUb29sYmFyKHRvb2xiYXJEZWZpbml0aW9uKSB7CiAgICB0aGlzLl9iYWxsb29uLnJlbW92ZSh0b29sYmFyRGVmaW5pdGlvbi52aWV3KTsKCiAgICB0aGlzLnN0b3BMaXN0ZW5pbmcodGhpcy5fYmFsbG9vbiwgJ2NoYW5nZTp2aXNpYmxlVmlldycpOwogIH0KICAvKioKICAgKiBTaG93cyB1cCB0aGUgdG9vbGJhciBpZiB0aGUgdG9vbGJhciBpcyBub3QgdmlzaWJsZS4KICAgKiBPdGhlcndpc2UsIHJlcG9zaXRpb25zIHRoZSB0b29sYmFyJ3MgYmFsbG9vbiB3aGVuIHRvb2xiYXIncyB2aWV3IGlzIHRoZSBtb3N0IHRvcCB2aWV3IGluIGJhbGxvb24gc3RhY2suCiAgICoKICAgKiBJdCBtaWdodCBoYXBwZW4gaGVyZSB0aGF0IHRoZSB0b29sYmFyJ3MgdmlldyBpcyB1bmRlciBhbm90aGVyIHZpZXcuIFRoZW4gZG8gbm90aGluZyBhcyB0aGUgb3RoZXIgdG9vbGJhciB2aWV3CiAgICogc2hvdWxkIGJlIHN0aWxsIHZpc2libGUgYWZ0ZXIgdGhlIHtAbGluayBtb2R1bGU6Y29yZS9lZGl0b3IvZWRpdG9ydWl+RWRpdG9yVUkjZXZlbnQ6dXBkYXRlfS4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHttb2R1bGU6d2lkZ2V0L3dpZGdldHRvb2xiYXJyZXBvc2l0b3J5fldpZGdldFJlcG9zaXRvcnlUb29sYmFyRGVmaW5pdGlvbn0gdG9vbGJhckRlZmluaXRpb24KICAgKiBAcGFyYW0ge21vZHVsZTplbmdpbmUvdmlldy9lbGVtZW50fkVsZW1lbnR9IHJlbGF0ZWRFbGVtZW50CiAgICovCgoKICBfc2hvd1Rvb2xiYXIodG9vbGJhckRlZmluaXRpb24sIHJlbGF0ZWRFbGVtZW50KSB7CiAgICBpZiAodGhpcy5faXNUb29sYmFyVmlzaWJsZSh0b29sYmFyRGVmaW5pdGlvbikpIHsKICAgICAgcmVwb3NpdGlvbkNvbnRleHR1YWxCYWxsb29uKHRoaXMuZWRpdG9yLCByZWxhdGVkRWxlbWVudCk7CiAgICB9IGVsc2UgaWYgKCF0aGlzLl9pc1Rvb2xiYXJJbkJhbGxvb24odG9vbGJhckRlZmluaXRpb24pKSB7CiAgICAgIHRoaXMuX2JhbGxvb24uYWRkKHsKICAgICAgICB2aWV3OiB0b29sYmFyRGVmaW5pdGlvbi52aWV3LAogICAgICAgIHBvc2l0aW9uOiBnZXRCYWxsb29uUG9zaXRpb25EYXRhKHRoaXMuZWRpdG9yLCByZWxhdGVkRWxlbWVudCksCiAgICAgICAgYmFsbG9vbkNsYXNzTmFtZTogdG9vbGJhckRlZmluaXRpb24uYmFsbG9vbkNsYXNzTmFtZQogICAgICB9KTsgLy8gVXBkYXRlIHRvb2xiYXIgcG9zaXRpb24gZWFjaCB0aW1lIHN0YWNrIHdpdGggdG9vbGJhciB2aWV3IGlzIHN3aXRjaGVkIHRvIHZpc2libGUuCiAgICAgIC8vIFRoaXMgaXMgaW4gYSBjYXNlIHRhcmdldCBlbGVtZW50IGhhcyBjaGFuZ2VkIHdoZW4gdG9vbGJhciB3YXMgaW4gaW52aXNpYmxlIHN0YWNrCiAgICAgIC8vIGUuZy4gdGFyZ2V0IGltYWdlIHdhcyB3cmFwcGVkIGJ5IGEgYmxvY2sgcXVvdGUuCiAgICAgIC8vIFNlZSBodHRwczovL2dpdGh1Yi5jb20vY2tlZGl0b3IvY2tlZGl0b3I1LXdpZGdldC9pc3N1ZXMvOTIuCgoKICAgICAgdGhpcy5saXN0ZW5Ubyh0aGlzLl9iYWxsb29uLCAnY2hhbmdlOnZpc2libGVWaWV3JywgKCkgPT4gewogICAgICAgIGZvciAoY29uc3QgZGVmaW5pdGlvbiBvZiB0aGlzLl90b29sYmFyRGVmaW5pdGlvbnMudmFsdWVzKCkpIHsKICAgICAgICAgIGlmICh0aGlzLl9pc1Rvb2xiYXJWaXNpYmxlKGRlZmluaXRpb24pKSB7CiAgICAgICAgICAgIGNvbnN0IHJlbGF0ZWRFbGVtZW50ID0gZGVmaW5pdGlvbi5nZXRSZWxhdGVkRWxlbWVudCh0aGlzLmVkaXRvci5lZGl0aW5nLnZpZXcuZG9jdW1lbnQuc2VsZWN0aW9uKTsKICAgICAgICAgICAgcmVwb3NpdGlvbkNvbnRleHR1YWxCYWxsb29uKHRoaXMuZWRpdG9yLCByZWxhdGVkRWxlbWVudCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9KTsKICAgIH0KICB9CiAgLyoqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0ge09iamVjdH0gdG9vbGJhcgogICAqIEByZXR1cm5zIHtCb29sZWFufQogICAqLwoKCiAgX2lzVG9vbGJhclZpc2libGUodG9vbGJhcikgewogICAgcmV0dXJuIHRoaXMuX2JhbGxvb24udmlzaWJsZVZpZXcgPT09IHRvb2xiYXIudmlldzsKICB9CiAgLyoqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0ge09iamVjdH0gdG9vbGJhcgogICAqIEByZXR1cm5zIHtCb29sZWFufQogICAqLwoKCiAgX2lzVG9vbGJhckluQmFsbG9vbih0b29sYmFyKSB7CiAgICByZXR1cm4gdGhpcy5fYmFsbG9vbi5oYXNWaWV3KHRvb2xiYXIudmlldyk7CiAgfQoKfQoKZnVuY3Rpb24gcmVwb3NpdGlvbkNvbnRleHR1YWxCYWxsb29uKGVkaXRvciwgcmVsYXRlZEVsZW1lbnQpIHsKICBjb25zdCBiYWxsb29uID0gZWRpdG9yLnBsdWdpbnMuZ2V0KCdDb250ZXh0dWFsQmFsbG9vbicpOwogIGNvbnN0IHBvc2l0aW9uID0gZ2V0QmFsbG9vblBvc2l0aW9uRGF0YShlZGl0b3IsIHJlbGF0ZWRFbGVtZW50KTsKICBiYWxsb29uLnVwZGF0ZVBvc2l0aW9uKHBvc2l0aW9uKTsKfQoKZnVuY3Rpb24gZ2V0QmFsbG9vblBvc2l0aW9uRGF0YShlZGl0b3IsIHJlbGF0ZWRFbGVtZW50KSB7CiAgY29uc3QgZWRpdGluZ1ZpZXcgPSBlZGl0b3IuZWRpdGluZy52aWV3OwogIGNvbnN0IGRlZmF1bHRQb3NpdGlvbnMgPSBCYWxsb29uUGFuZWxWaWV3LmRlZmF1bHRQb3NpdGlvbnM7CiAgcmV0dXJuIHsKICAgIHRhcmdldDogZWRpdGluZ1ZpZXcuZG9tQ29udmVydGVyLm1hcFZpZXdUb0RvbShyZWxhdGVkRWxlbWVudCksCiAgICBwb3NpdGlvbnM6IFtkZWZhdWx0UG9zaXRpb25zLm5vcnRoQXJyb3dTb3V0aCwgZGVmYXVsdFBvc2l0aW9ucy5ub3J0aEFycm93U291dGhXZXN0LCBkZWZhdWx0UG9zaXRpb25zLm5vcnRoQXJyb3dTb3V0aEVhc3QsIGRlZmF1bHRQb3NpdGlvbnMuc291dGhBcnJvd05vcnRoLCBkZWZhdWx0UG9zaXRpb25zLnNvdXRoQXJyb3dOb3J0aFdlc3QsIGRlZmF1bHRQb3NpdGlvbnMuc291dGhBcnJvd05vcnRoRWFzdF0KICB9Owp9CgpmdW5jdGlvbiBpc1dpZGdldFNlbGVjdGVkKHNlbGVjdGlvbikgewogIGNvbnN0IHZpZXdFbGVtZW50ID0gc2VsZWN0aW9uLmdldFNlbGVjdGVkRWxlbWVudCgpOwogIHJldHVybiAhISh2aWV3RWxlbWVudCAmJiBpc1dpZGdldCh2aWV3RWxlbWVudCkpOwp9Ci8qKgogKiBUaGUgdG9vbGJhciBkZWZpbml0aW9uIG9iamVjdCB1c2VkIGJ5IHRoZSB0b29sYmFyIHJlcG9zaXRvcnkgdG8gbWFuYWdlIHRvb2xiYXJzLgogKiBJdCBjb250YWlucyBpbmZvcm1hdGlvbiBuZWNlc3NhcnkgdG8gZGlzcGxheSB0aGUgdG9vbGJhciBpbiB0aGUKICoge0BsaW5rIG1vZHVsZTp1aS9wYW5lbC9iYWxsb29uL2NvbnRleHR1YWxiYWxsb29ufkNvbnRleHR1YWxCYWxsb29uIGNvbnRleHR1YWwgYmFsbG9vbn0gYW5kCiAqIHVwZGF0ZSBpdCBkdXJpbmcgaXRzIGxpZmUgKGRpc3BsYXkpIGN5Y2xlLgogKgogKiBAdHlwZWRlZiB7T2JqZWN0fSBtb2R1bGU6d2lkZ2V0L3dpZGdldHRvb2xiYXJyZXBvc2l0b3J5fldpZGdldFJlcG9zaXRvcnlUb29sYmFyRGVmaW5pdGlvbgogKgogKiBAcHJvcGVydHkge21vZHVsZTp1aS92aWV3flZpZXd9IHZpZXcgVGhlIFVJIHZpZXcgb2YgdGhlIHRvb2xiYXIuCiAqIEBwcm9wZXJ0eSB7RnVuY3Rpb259IGdldFJlbGF0ZWRFbGVtZW50IEEgZnVuY3Rpb24gdGhhdCByZXR1cm5zIGFuIGVuZ2luZSB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L3ZpZXd+Vmlld30KICogZWxlbWVudCB0aGUgdG9vbGJhciBpcyB0byBiZSBhdHRhY2hlZCB0by4gRm9yIGluc3RhbmNlLCBhbiBpbWFnZSB3aWRnZXQgb3IgYSB0YWJsZSB3aWRnZXQgKG9yIGBudWxsYCB3aGVuCiAqIHRoZXJlIGlzIG5vIHN1Y2ggZWxlbWVudCkuIFRoZSBmdW5jdGlvbiBhY2NlcHRzIGFuIGluc3RhbmNlIG9mIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvc2VsZWN0aW9uflNlbGVjdGlvbn0uCiAqIEBwcm9wZXJ0eSB7U3RyaW5nfSBiYWxsb29uQ2xhc3NOYW1lIENTUyBjbGFzcyBmb3IgdGhlIHdpZGdldCBiYWxsb29uIHdoZW4gYSB0b29sYmFyIGlzIGRpc3BsYXllZC4KICov"},{"version":3,"sources":["/Users/antonyching/Desktop/project/new-builder-demo/node_modules/@ckeditor/ckeditor5-widget/src/widgettoolbarrepository.js"],"names":["Plugin","ContextualBalloon","ToolbarView","BalloonPanelView","isWidget","CKEditorError","WidgetToolbarRepository","requires","pluginName","init","editor","plugins","has","balloonToolbar","get","listenTo","evt","isWidgetSelected","editing","view","document","selection","stop","priority","_toolbarDefinitions","Map","_balloon","ui","_updateToolbarsVisibility","focusTracker","destroy","toolbarConfig","values","register","toolbarId","ariaLabel","items","getRelatedElement","balloonClassName","t","toolbarView","locale","fillFromConfig","componentFactory","set","maxRelatedElementDepth","deepestRelatedElement","deepestToolbarDefinition","definition","relatedElement","isFocused","_isToolbarVisible","_hideToolbar","_isToolbarInBalloon","relatedElementDepth","getAncestors","length","_showToolbar","toolbarDefinition","remove","stopListening","repositionContextualBalloon","add","position","getBalloonPositionData","toolbar","visibleView","hasView","balloon","updatePosition","editingView","defaultPositions","target","domConverter","mapViewToDom","positions","northArrowSouth","northArrowSouthWest","northArrowSouthEast","southArrowNorth","southArrowNorthWest","southArrowNorthEast","viewElement","getSelectedElement"],"mappings":"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","sourcesContent":["/**\n * @license Copyright (c) 2003-2019, CKSource - Frederico Knabben. All rights reserved.\n * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license\n */\n\n/**\n * @module widget/widgettoolbarrepository\n */\n\nimport Plugin from '@ckeditor/ckeditor5-core/src/plugin';\nimport ContextualBalloon from '@ckeditor/ckeditor5-ui/src/panel/balloon/contextualballoon';\nimport ToolbarView from '@ckeditor/ckeditor5-ui/src/toolbar/toolbarview';\nimport BalloonPanelView from '@ckeditor/ckeditor5-ui/src/panel/balloon/balloonpanelview';\nimport { isWidget } from './utils';\nimport CKEditorError from '@ckeditor/ckeditor5-utils/src/ckeditorerror';\n\n/**\n * Widget toolbar repository plugin. A central point for registering widget toolbars. This plugin handles the whole\n * toolbar rendering process and exposes a concise API.\n *\n * To add a toolbar for your widget use the {@link ~WidgetToolbarRepository#register `WidgetToolbarRepository#register()`} method.\n *\n * The following example comes from the {@link module:image/imagetoolbar~ImageToolbar} plugin:\n *\n * \t\tclass ImageToolbar extends Plugin {\n *\t\t\tstatic get requires() {\n *\t\t\t\treturn [ WidgetToolbarRepository ];\n *\t\t\t}\n *\n *\t\t\tafterInit() {\n *\t\t\t\tconst editor = this.editor;\n *\t\t\t\tconst widgetToolbarRepository = editor.plugins.get( WidgetToolbarRepository );\n *\n *\t\t\t\twidgetToolbarRepository.register( 'image', {\n *\t\t\t\t\titems: editor.config.get( 'image.toolbar' ),\n *\t\t\t\t\tgetRelatedElement: getSelectedImageWidget\n *\t\t\t\t} );\n *\t\t\t}\n *\t\t}\n */\nexport default class WidgetToolbarRepository extends Plugin {\n\t/**\n\t * @inheritDoc\n\t */\n\tstatic get requires() {\n\t\treturn [ ContextualBalloon ];\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tstatic get pluginName() {\n\t\treturn 'WidgetToolbarRepository';\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tinit() {\n\t\tconst editor = this.editor;\n\n\t\t// Disables the default balloon toolbar for all widgets.\n\t\tif ( editor.plugins.has( 'BalloonToolbar' ) ) {\n\t\t\tconst balloonToolbar = editor.plugins.get( 'BalloonToolbar' );\n\n\t\t\tthis.listenTo( balloonToolbar, 'show', evt => {\n\t\t\t\tif ( isWidgetSelected( editor.editing.view.document.selection ) ) {\n\t\t\t\t\tevt.stop();\n\t\t\t\t}\n\t\t\t}, { priority: 'high' } );\n\t\t}\n\n\t\t/**\n\t\t * A map of toolbar definitions.\n\t\t *\n\t\t * @protected\n\t\t * @member {Map.<String,module:widget/widgettoolbarrepository~WidgetRepositoryToolbarDefinition>} #_toolbarDefinitions\n\t\t */\n\t\tthis._toolbarDefinitions = new Map();\n\n\t\t/**\n\t\t * @private\n\t\t */\n\t\tthis._balloon = this.editor.plugins.get( 'ContextualBalloon' );\n\n\t\tthis.listenTo( editor.ui, 'update', () => {\n\t\t\tthis._updateToolbarsVisibility();\n\t\t} );\n\n\t\t// UI#update is not fired after focus is back in editor, we need to check if balloon panel should be visible.\n\t\tthis.listenTo( editor.ui.focusTracker, 'change:isFocused', () => {\n\t\t\tthis._updateToolbarsVisibility();\n\t\t}, { priority: 'low' } );\n\t}\n\n\tdestroy() {\n\t\tsuper.destroy();\n\n\t\tfor ( const toolbarConfig of this._toolbarDefinitions.values() ) {\n\t\t\ttoolbarConfig.view.destroy();\n\t\t}\n\t}\n\n\t/**\n\t * Registers toolbar in the WidgetToolbarRepository. It renders it in the `ContextualBalloon` based on the value of the invoked\n\t * `getRelatedElement` function. Toolbar items are gathered from `items` array.\n\t * The balloon's CSS class is by default `ck-toolbar-container` and may be override with the `balloonClassName` option.\n\t *\n\t * Note: This method should be called in the {@link module:core/plugin~PluginInterface#afterInit `Plugin#afterInit()`}\n\t * callback (or later) to make sure that the given toolbar items were already registered by other plugins.\n\t *\n\t * @param {String} toolbarId An id for the toolbar. Used to\n\t * @param {Object} options\n\t * @param {String} [options.ariaLabel] Label used by assistive technologies to describe this toolbar element.\n\t * @param {Array.<String>} options.items Array of toolbar items.\n\t * @param {Function} options.getRelatedElement Callback which returns an element the toolbar should be attached to.\n\t * @param {String} [options.balloonClassName='ck-toolbar-container'] CSS class for the widget balloon.\n\t */\n\tregister( toolbarId, { ariaLabel, items, getRelatedElement, balloonClassName = 'ck-toolbar-container' } ) {\n\t\tconst editor = this.editor;\n\t\tconst t = editor.t;\n\t\tconst toolbarView = new ToolbarView( editor.locale );\n\n\t\ttoolbarView.ariaLabel = ariaLabel || t( 'Widget toolbar' );\n\n\t\tif ( this._toolbarDefinitions.has( toolbarId ) ) {\n\t\t\t/**\n\t\t\t * Toolbar with the given id was already added.\n\t\t\t *\n\t\t\t * @error widget-toolbar-duplicated\n\t\t\t * @param toolbarId Toolbar id.\n\t\t\t */\n\t\t\tthrow new CKEditorError( 'widget-toolbar-duplicated: Toolbar with the given id was already added.', this, { toolbarId } );\n\t\t}\n\n\t\ttoolbarView.fillFromConfig( items, editor.ui.componentFactory );\n\n\t\tthis._toolbarDefinitions.set( toolbarId, {\n\t\t\tview: toolbarView,\n\t\t\tgetRelatedElement,\n\t\t\tballoonClassName,\n\t\t} );\n\t}\n\n\t/**\n\t * Iterates over stored toolbars and makes them visible or hidden.\n\t *\n\t * @private\n\t */\n\t_updateToolbarsVisibility() {\n\t\tlet maxRelatedElementDepth = 0;\n\t\tlet deepestRelatedElement = null;\n\t\tlet deepestToolbarDefinition = null;\n\n\t\tfor ( const definition of this._toolbarDefinitions.values() ) {\n\t\t\tconst relatedElement = definition.getRelatedElement( this.editor.editing.view.document.selection );\n\n\t\t\tif ( !this.editor.ui.focusTracker.isFocused ) {\n\t\t\t\tif ( this._isToolbarVisible( definition ) ) {\n\t\t\t\t\tthis._hideToolbar( definition );\n\t\t\t\t}\n\t\t\t} else if ( !relatedElement ) {\n\t\t\t\tif ( this._isToolbarInBalloon( definition ) ) {\n\t\t\t\t\tthis._hideToolbar( definition );\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tconst relatedElementDepth = relatedElement.getAncestors().length;\n\n\t\t\t\t// Many toolbars can express willingness to be displayed but they do not know about\n\t\t\t\t// each other. Figure out which toolbar is deepest in the view tree to decide which\n\t\t\t\t// should be displayed. For instance, if a selected image is inside a table cell, display\n\t\t\t\t// the ImageToolbar rather than the TableToolbar (#60).\n\t\t\t\tif ( relatedElementDepth > maxRelatedElementDepth ) {\n\t\t\t\t\tmaxRelatedElementDepth = relatedElementDepth;\n\t\t\t\t\tdeepestRelatedElement = relatedElement;\n\t\t\t\t\tdeepestToolbarDefinition = definition;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif ( deepestToolbarDefinition ) {\n\t\t\tthis._showToolbar( deepestToolbarDefinition, deepestRelatedElement );\n\t\t}\n\t}\n\n\t/**\n\t * Hides the given toolbar.\n\t *\n\t * @private\n\t * @param {module:widget/widgettoolbarrepository~WidgetRepositoryToolbarDefinition} toolbarDefinition\n\t */\n\t_hideToolbar( toolbarDefinition ) {\n\t\tthis._balloon.remove( toolbarDefinition.view );\n\t\tthis.stopListening( this._balloon, 'change:visibleView' );\n\t}\n\n\t/**\n\t * Shows up the toolbar if the toolbar is not visible.\n\t * Otherwise, repositions the toolbar's balloon when toolbar's view is the most top view in balloon stack.\n\t *\n\t * It might happen here that the toolbar's view is under another view. Then do nothing as the other toolbar view\n\t * should be still visible after the {@link module:core/editor/editorui~EditorUI#event:update}.\n\t *\n\t * @private\n\t * @param {module:widget/widgettoolbarrepository~WidgetRepositoryToolbarDefinition} toolbarDefinition\n\t * @param {module:engine/view/element~Element} relatedElement\n\t */\n\t_showToolbar( toolbarDefinition, relatedElement ) {\n\t\tif ( this._isToolbarVisible( toolbarDefinition ) ) {\n\t\t\trepositionContextualBalloon( this.editor, relatedElement );\n\t\t} else if ( !this._isToolbarInBalloon( toolbarDefinition ) ) {\n\t\t\tthis._balloon.add( {\n\t\t\t\tview: toolbarDefinition.view,\n\t\t\t\tposition: getBalloonPositionData( this.editor, relatedElement ),\n\t\t\t\tballoonClassName: toolbarDefinition.balloonClassName,\n\t\t\t} );\n\n\t\t\t// Update toolbar position each time stack with toolbar view is switched to visible.\n\t\t\t// This is in a case target element has changed when toolbar was in invisible stack\n\t\t\t// e.g. target image was wrapped by a block quote.\n\t\t\t// See https://github.com/ckeditor/ckeditor5-widget/issues/92.\n\t\t\tthis.listenTo( this._balloon, 'change:visibleView', () => {\n\t\t\t\tfor ( const definition of this._toolbarDefinitions.values() ) {\n\t\t\t\t\tif ( this._isToolbarVisible( definition ) ) {\n\t\t\t\t\t\tconst relatedElement = definition.getRelatedElement( this.editor.editing.view.document.selection );\n\t\t\t\t\t\trepositionContextualBalloon( this.editor, relatedElement );\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} );\n\t\t}\n\t}\n\n\t/**\n\t * @private\n\t * @param {Object} toolbar\n\t * @returns {Boolean}\n\t */\n\t_isToolbarVisible( toolbar ) {\n\t\treturn this._balloon.visibleView === toolbar.view;\n\t}\n\n\t/**\n\t * @private\n\t * @param {Object} toolbar\n\t * @returns {Boolean}\n\t */\n\t_isToolbarInBalloon( toolbar ) {\n\t\treturn this._balloon.hasView( toolbar.view );\n\t}\n}\n\nfunction repositionContextualBalloon( editor, relatedElement ) {\n\tconst balloon = editor.plugins.get( 'ContextualBalloon' );\n\tconst position = getBalloonPositionData( editor, relatedElement );\n\n\tballoon.updatePosition( position );\n}\n\nfunction getBalloonPositionData( editor, relatedElement ) {\n\tconst editingView = editor.editing.view;\n\tconst defaultPositions = BalloonPanelView.defaultPositions;\n\n\treturn {\n\t\ttarget: editingView.domConverter.mapViewToDom( relatedElement ),\n\t\tpositions: [\n\t\t\tdefaultPositions.northArrowSouth,\n\t\t\tdefaultPositions.northArrowSouthWest,\n\t\t\tdefaultPositions.northArrowSouthEast,\n\t\t\tdefaultPositions.southArrowNorth,\n\t\t\tdefaultPositions.southArrowNorthWest,\n\t\t\tdefaultPositions.southArrowNorthEast\n\t\t]\n\t};\n}\n\nfunction isWidgetSelected( selection ) {\n\tconst viewElement = selection.getSelectedElement();\n\n\treturn !!( viewElement && isWidget( viewElement ) );\n}\n\n/**\n * The toolbar definition object used by the toolbar repository to manage toolbars.\n * It contains information necessary to display the toolbar in the\n * {@link module:ui/panel/balloon/contextualballoon~ContextualBalloon contextual balloon} and\n * update it during its life (display) cycle.\n *\n * @typedef {Object} module:widget/widgettoolbarrepository~WidgetRepositoryToolbarDefinition\n *\n * @property {module:ui/view~View} view The UI view of the toolbar.\n * @property {Function} getRelatedElement A function that returns an engine {@link module:engine/view/view~View}\n * element the toolbar is to be attached to. For instance, an image widget or a table widget (or `null` when\n * there is no such element). The function accepts an instance of {@link module:engine/view/selection~Selection}.\n * @property {String} balloonClassName CSS class for the widget balloon when a toolbar is displayed.\n */\n"]}]}
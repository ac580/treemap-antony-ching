{"remainingRequest":"/Users/antonyching/Desktop/project/new-builder-demo/node_modules/babel-loader/lib/index.js!/Users/antonyching/Desktop/project/new-builder-demo/node_modules/@ckeditor/ckeditor5-engine/src/model/utils/selection-post-fixer.js","dependencies":[{"path":"/Users/antonyching/Desktop/project/new-builder-demo/node_modules/@ckeditor/ckeditor5-engine/src/model/utils/selection-post-fixer.js","mtime":499162500000},{"path":"/Users/antonyching/Desktop/project/new-builder-demo/node_modules/@ckeditor/ckeditor5-dev-webpack-plugin/lib/translatesourceloader.js","mtime":499162500000},{"path":"/Users/antonyching/Desktop/project/new-builder-demo/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/antonyching/Desktop/project/new-builder-demo/node_modules/babel-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:LyoqCiAqIEBsaWNlbnNlIENvcHlyaWdodCAoYykgMjAwMy0yMDE5LCBDS1NvdXJjZSAtIEZyZWRlcmljbyBLbmFiYmVuLiBBbGwgcmlnaHRzIHJlc2VydmVkLgogKiBGb3IgbGljZW5zaW5nLCBzZWUgTElDRU5TRS5tZCBvciBodHRwczovL2NrZWRpdG9yLmNvbS9sZWdhbC9ja2VkaXRvci1vc3MtbGljZW5zZQogKi8KCi8qKgogKiBAbW9kdWxlIGVuZ2luZS9tb2RlbC91dGlscy9zZWxlY3Rpb24tcG9zdC1maXhlcgogKi8KaW1wb3J0IFJhbmdlIGZyb20gJy4uL3JhbmdlJzsKaW1wb3J0IFBvc2l0aW9uIGZyb20gJy4uL3Bvc2l0aW9uJzsKLyoqCiAqIEluamVjdHMgc2VsZWN0aW9uIHBvc3QtZml4ZXIgdG8gdGhlIG1vZGVsLgogKgogKiBUaGUgcm9sZSBvZiB0aGUgc2VsZWN0aW9uIHBvc3QtZml4ZXIgaXMgdG8gZW5zdXJlIHRoYXQgdGhlIHNlbGVjdGlvbiBpcyBpbiBhIGNvcnJlY3QgcGxhY2UKICogYWZ0ZXIgYSB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9tb2RlbH5Nb2RlbCNjaGFuZ2UgYGNoYW5nZSgpYH0gYmxvY2sgd2FzIGV4ZWN1dGVkLgogKgogKiBUaGUgY29ycmVjdCBwb3NpdGlvbiBtZWFucyB0aGF0OgogKgogKiAqIEFsbCBjb2xsYXBzZWQgc2VsZWN0aW9uIHJhbmdlcyBhcmUgaW4gYSBwbGFjZSB3aGVyZSB0aGUge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvc2NoZW1hflNjaGVtYX0KICogYWxsb3dzIGEgYCR0ZXh0YC4KICogKiBOb25lIG9mIHRoZSBzZWxlY3Rpb24ncyBub24tY29sbGFwc2VkIHJhbmdlcyBjcm9zc2VzIGEge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvc2NoZW1hflNjaGVtYSNpc0xpbWl0IGxpbWl0IGVsZW1lbnR9CiAqIGJvdW5kYXJ5IChhIHJhbmdlIG11c3QgYmUgcm9vdGVkIHdpdGhpbiBvbmUgbGltaXQgZWxlbWVudCkuCiAqICogT25seSB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9zY2hlbWF+U2NoZW1hI2lzT2JqZWN0IG9iamVjdCBlbGVtZW50c30gY2FuIGJlIHNlbGVjdGVkIGZyb20gdGhlIG91dHNpZGUKICogKGUuZy4gYFs8cGFyYWdyYXBoPmZvbzwvcGFyYWdyYXBoPl1gIGlzIGludmFsaWQpLiBUaGlzIHJ1bGUgYXBwbGllcyBpbmRlcGVuZGVudGx5IHRvIGJvdGggc2VsZWN0aW9uIGVuZHMsIHNvIHRoaXMKICogc2VsZWN0aW9uIGlzIGNvcnJlY3Q6IGA8cGFyYWdyYXBoPmZbb288L3BhcmFncmFwaD48aW1hZ2U+PC9pbWFnZT5dYC4KICoKICogSWYgdGhlIHBvc2l0aW9uIGlzIG5vdCBjb3JyZWN0LCB0aGUgcG9zdC1maXhlciB3aWxsIGF1dG9tYXRpY2FsbHkgY29ycmVjdCBpdC4KICoKICogIyMgRml4aW5nIGEgbm9uLWNvbGxhcHNlZCBzZWxlY3Rpb24KICoKICogU2VlIGFzIGFuIGV4YW1wbGUgYSBzZWxlY3Rpb24gdGhhdCBzdGFydHMgaW4gYSBQMSBlbGVtZW50IGFuZCBlbmRzIGluc2lkZSB0aGUgdGV4dCBvZiBhIFREIGVsZW1lbnQKICogKGBbYCBhbmQgYF1gIGFyZSByYW5nZSBib3VuZGFyaWVzIGFuZCBgKGwpYCBkZW5vdGVzIGFuIGVsZW1lbnQgZGVmaW5lZCBhcyBgaXNMaW1pdD10cnVlYCk6CiAqCiAqCQlyb290CiAqCQkgfC0gZWxlbWVudCBQMQogKgkJIHwgICB8LSAiZm9vIiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcm9vdAogKgkJIHwtIGVsZW1lbnQgVEFCTEUgKGwpICAgICAgICAgICAgICAgICAgIFAxICAgICAgICAgVEFCTEUgICAgICAgICAgICAgUDIKICoJCSB8ICAgfC0gZWxlbWVudCBUUiAobCkgICAgICAgICAgICAgICAgIGYgb1tvICAgICBUUiAgICAgIFRSICAgICAgICAgYiBhIHIKICoJCSB8ICAgfCAgIHwtIGVsZW1lbnQgVEQgKGwpICAgICAgICAgICAgICAgICAgICAgICBURCAgICAgIFRECiAqCQkgfCAgIHwgICAgICAgfC0gImFhYSIgICAgICAgICAgICAgICAgICAgICAgICAgIGFdYSBhICAgIGIgYiBiCiAqCQkgfCAgIHwtIGVsZW1lbnQgVFIgKGwpCiAqCQkgfCAgIHwgICB8LSBlbGVtZW50IFREIChsKSAgICAgICAgICAgICAgICAgICAgICAgICAgIHx8CiAqCQkgfCAgIHwgICAgICAgfC0gImJiYiIgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHx8CiAqCQkgfC0gZWxlbWVudCBQMiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFZWCiAqCQkgfCAgIHwtICJiYXIiCiAqCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByb290CiAqCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUDEgICAgICAgICBUQUJMRV0gICAgICAgICAgICBQMgogKgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZiBvW28gICAgIFRSICAgICAgVFIgICAgICAgICBiIGEgcgogKgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFREICAgICAgVEQKICoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYSBhIGEgICAgYiBiIGIKICoKICogSW4gdGhlIGV4YW1wbGUgYWJvdmUsIHRoZSBUQUJMRSwgVFIgYW5kIFREIGFyZSBkZWZpbmVkIGFzIGBpc0xpbWl0PXRydWVgIGluIHRoZSBzY2hlbWEuIFRoZSByYW5nZSB3aGljaCBpcyBub3QgY29udGFpbmVkIHdpdGhpbgogKiBhIHNpbmdsZSBsaW1pdCBlbGVtZW50IG11c3QgYmUgZXhwYW5kZWQgdG8gc2VsZWN0IHRoZSBvdXRlcm1vc3QgbGltaXQgZWxlbWVudC4gVGhlIHJhbmdlIGVuZCBpcyBpbnNpZGUgdGhlIHRleHQgbm9kZSBvZiB0aGUgVEQgZWxlbWVudC4KICogQXMgdGhlIFREIGVsZW1lbnQgaXMgYSBjaGlsZCBvZiB0aGUgVFIgYW5kIFRBQkxFIGVsZW1lbnRzLCB3aGVyZSBib3RoIGFyZSBkZWZpbmVkIGFzIGBpc0xpbWl0PXRydWVgIGluIHRoZSBzY2hlbWEsIHRoZSByYW5nZSBtdXN0IGJlCiAqIGV4cGFuZGVkIHRvIHNlbGVjdCB0aGUgd2hvbGUgVEFCTEUgZWxlbWVudC4KICoKICogKipOb3RlKiogSWYgdGhlIHNlbGVjdGlvbiBjb250YWlucyBtdWx0aXBsZSByYW5nZXMsIHRoZSBtZXRob2QgcmV0dXJucyBhIG1pbmltYWwgc2V0IG9mIHJhbmdlcyB0aGF0IGFyZSBub3QgaW50ZXJzZWN0aW5nIGFmdGVyIGV4cGFuZGluZwogKiB0aGVtIHRvIHNlbGVjdCBgaXNMaW1pdD10cnVlYCBlbGVtZW50cy4KICoKICogQHBhcmFtIHttb2R1bGU6ZW5naW5lL21vZGVsL21vZGVsfk1vZGVsfSBtb2RlbAogKi8KCmV4cG9ydCBmdW5jdGlvbiBpbmplY3RTZWxlY3Rpb25Qb3N0Rml4ZXIobW9kZWwpIHsKICBtb2RlbC5kb2N1bWVudC5yZWdpc3RlclBvc3RGaXhlcih3cml0ZXIgPT4gc2VsZWN0aW9uUG9zdEZpeGVyKHdyaXRlciwgbW9kZWwpKTsKfSAvLyBUaGUgc2VsZWN0aW9uIHBvc3QtZml4ZXIuCi8vCi8vIEBwYXJhbSB7bW9kdWxlOmVuZ2luZS9tb2RlbC93cml0ZXJ+V3JpdGVyfSB3cml0ZXIKLy8gQHBhcmFtIHttb2R1bGU6ZW5naW5lL21vZGVsL21vZGVsfk1vZGVsfSBtb2RlbAoKZnVuY3Rpb24gc2VsZWN0aW9uUG9zdEZpeGVyKHdyaXRlciwgbW9kZWwpIHsKICBjb25zdCBzZWxlY3Rpb24gPSBtb2RlbC5kb2N1bWVudC5zZWxlY3Rpb247CiAgY29uc3Qgc2NoZW1hID0gbW9kZWwuc2NoZW1hOwogIGNvbnN0IHJhbmdlcyA9IFtdOwogIGxldCB3YXNGaXhlZCA9IGZhbHNlOwoKICBmb3IgKGNvbnN0IG1vZGVsUmFuZ2Ugb2Ygc2VsZWN0aW9uLmdldFJhbmdlcygpKSB7CiAgICAvLyBHbyB0aHJvdWdoIGFsbCByYW5nZXMgaW4gc2VsZWN0aW9uIGFuZCB0cnkgZml4aW5nIGVhY2ggb2YgdGhlbS4KICAgIC8vIFRob3NlIHJhbmdlcyBtaWdodCBvdmVybGFwIGJ1dCB3aWxsIGJlIGNvcnJlY3RlZCBsYXRlci4KICAgIGNvbnN0IGNvcnJlY3RlZFJhbmdlID0gdHJ5Rml4aW5nUmFuZ2UobW9kZWxSYW5nZSwgc2NoZW1hKTsKCiAgICBpZiAoY29ycmVjdGVkUmFuZ2UpIHsKICAgICAgcmFuZ2VzLnB1c2goY29ycmVjdGVkUmFuZ2UpOwogICAgICB3YXNGaXhlZCA9IHRydWU7CiAgICB9IGVsc2UgewogICAgICByYW5nZXMucHVzaChtb2RlbFJhbmdlKTsKICAgIH0KICB9IC8vIElmIGFueSBvZiByYW5nZXMgd2VyZSBjb3JyZWN0ZWQgdXBkYXRlIHRoZSBzZWxlY3Rpb24uCgoKICBpZiAod2FzRml4ZWQpIHsKICAgIC8vIFRoZSBhYm92ZSBhbGdvcml0aG0gbWlnaHQgY3JlYXRlIHJhbmdlcyB0aGF0IGludGVyc2VjdHMgZWFjaCBvdGhlciB3aGVuIHNlbGVjdGlvbiBjb250YWlucyBtb3JlIHRoZW4gb25lIHJhbmdlLgogICAgLy8gVGhpcyBpcyBjYXNlIGhhcHBlbnMgbW9zdGx5IG9uIEZpcmVmb3ggd2hpY2ggY3JlYXRlcyBtdWx0aXBsZSByYW5nZXMgZm9yIHNlbGVjdGVkIHRhYmxlLgogICAgbGV0IGZpeGVkUmFuZ2VzID0gcmFuZ2VzOyAvLyBGaXhpbmcgc2VsZWN0aW9uIHdpdGggbWFueSByYW5nZXMgdXN1YWxseSBicmVha3MgdGhlIHNlbGVjdGlvbiBpbiBGaXJlZm94LiBBcyBvbmx5IEZpcmVmb3ggc3VwcG9ydHMgbXVsdGlwbGUgc2VsZWN0aW9uIHJhbmdlcwogICAgLy8gd2Ugc2ltcGx5IGNyZWF0ZSBvbmUgY29udGludW91cyByYW5nZSBmcm9tIGZpeGVkIHNlbGVjdGlvbiByYW5nZXMgKGV2ZW4gaWYgdGhleSBhcmUgbm90IGFkamFjZW50KS4KCiAgICBpZiAocmFuZ2VzLmxlbmd0aCA+IDEpIHsKICAgICAgY29uc3Qgc2VsZWN0aW9uU3RhcnQgPSByYW5nZXNbMF0uc3RhcnQ7CiAgICAgIGNvbnN0IHNlbGVjdGlvbkVuZCA9IHJhbmdlc1tyYW5nZXMubGVuZ3RoIC0gMV0uZW5kOwogICAgICBmaXhlZFJhbmdlcyA9IFtuZXcgUmFuZ2Uoc2VsZWN0aW9uU3RhcnQsIHNlbGVjdGlvbkVuZCldOwogICAgfQoKICAgIHdyaXRlci5zZXRTZWxlY3Rpb24oZml4ZWRSYW5nZXMsIHsKICAgICAgYmFja3dhcmQ6IHNlbGVjdGlvbi5pc0JhY2t3YXJkCiAgICB9KTsKICB9Cn0gLy8gVHJpZXMgZml4aW5nIGEgcmFuZ2UgaWYgaXQncyBpbmNvcnJlY3QuCi8vCi8vIEBwYXJhbSB7bW9kdWxlOmVuZ2luZS9tb2RlbC9yYW5nZX5SYW5nZX0gcmFuZ2UKLy8gQHBhcmFtIHttb2R1bGU6ZW5naW5lL21vZGVsL3NjaGVtYX5TY2hlbWF9IHNjaGVtYQovLyBAcmV0dXJucyB7bW9kdWxlOmVuZ2luZS9tb2RlbC9yYW5nZX5SYW5nZXxudWxsfSBSZXR1cm5zIGZpeGVkIHJhbmdlIG9yIG51bGwgaWYgcmFuZ2UgaXMgdmFsaWQuCgoKZnVuY3Rpb24gdHJ5Rml4aW5nUmFuZ2UocmFuZ2UsIHNjaGVtYSkgewogIGlmIChyYW5nZS5pc0NvbGxhcHNlZCkgewogICAgcmV0dXJuIHRyeUZpeGluZ0NvbGxhcHNlZFJhbmdlKHJhbmdlLCBzY2hlbWEpOwogIH0KCiAgcmV0dXJuIHRyeUZpeGluZ05vbkNvbGxhcHNlZFJhZ2UocmFuZ2UsIHNjaGVtYSk7Cn0gLy8gVHJpZXMgdG8gZml4IGNvbGxhcHNlZCByYW5nZXMuCi8vCi8vICogRml4ZXMgc2l0dWF0aW9uIHdoZW4gYSByYW5nZSBpcyBpbiBhIHBsYWNlIHdoZXJlICR0ZXh0IGlzIG5vdCBhbGxvd2VkCi8vCi8vIEBwYXJhbSB7bW9kdWxlOmVuZ2luZS9tb2RlbC9yYW5nZX5SYW5nZX0gcmFuZ2UgQ29sbGFwc2VkIHJhbmdlIHRvIGZpeC4KLy8gQHBhcmFtIHttb2R1bGU6ZW5naW5lL21vZGVsL3NjaGVtYX5TY2hlbWF9IHNjaGVtYQovLyBAcmV0dXJucyB7bW9kdWxlOmVuZ2luZS9tb2RlbC9yYW5nZX5SYW5nZXxudWxsfSBSZXR1cm5zIGZpeGVkIHJhbmdlIG9yIG51bGwgaWYgcmFuZ2UgaXMgdmFsaWQuCgoKZnVuY3Rpb24gdHJ5Rml4aW5nQ29sbGFwc2VkUmFuZ2UocmFuZ2UsIHNjaGVtYSkgewogIGNvbnN0IG9yaWdpbmFsUG9zaXRpb24gPSByYW5nZS5zdGFydDsKICBjb25zdCBuZWFyZXN0U2VsZWN0aW9uUmFuZ2UgPSBzY2hlbWEuZ2V0TmVhcmVzdFNlbGVjdGlvblJhbmdlKG9yaWdpbmFsUG9zaXRpb24pOyAvLyBUaGlzIG1pZ2h0IGJlIG51bGwgaWUgd2hlbiBlZGl0b3IgZGF0YSBpcyBlbXB0eS4KICAvLyBJbiBzdWNoIGNhc2VzIHRoZXJlIGlzIG5vIG5lZWQgdG8gZml4IHRoZSBzZWxlY3Rpb24gcmFuZ2UuCgogIGlmICghbmVhcmVzdFNlbGVjdGlvblJhbmdlKSB7CiAgICByZXR1cm4gbnVsbDsKICB9CgogIGNvbnN0IGZpeGVkUG9zaXRpb24gPSBuZWFyZXN0U2VsZWN0aW9uUmFuZ2Uuc3RhcnQ7IC8vIEZpeGVkIHBvc2l0aW9uIGlzIHRoZSBzYW1lIGFzIG9yaWdpbmFsIC0gbm8gbmVlZCB0byByZXR1cm4gY29ycmVjdGVkIHJhbmdlLgoKICBpZiAob3JpZ2luYWxQb3NpdGlvbi5pc0VxdWFsKGZpeGVkUG9zaXRpb24pKSB7CiAgICByZXR1cm4gbnVsbDsKICB9IC8vIENoZWNrIHNpbmdsZSBub2RlIHNlbGVjdGlvbiAoaGFwcGVucyBpbiB0YWJsZXMpLgoKCiAgaWYgKGZpeGVkUG9zaXRpb24ubm9kZUFmdGVyICYmIHNjaGVtYS5pc0xpbWl0KGZpeGVkUG9zaXRpb24ubm9kZUFmdGVyKSkgewogICAgcmV0dXJuIG5ldyBSYW5nZShmaXhlZFBvc2l0aW9uLCBQb3NpdGlvbi5fY3JlYXRlQWZ0ZXIoZml4ZWRQb3NpdGlvbi5ub2RlQWZ0ZXIpKTsKICB9CgogIHJldHVybiBuZXcgUmFuZ2UoZml4ZWRQb3NpdGlvbik7Cn0gLy8gVHJpZXMgdG8gZml4IGFuIGV4cGFuZGVkIHJhbmdlLgovLwovLyBAcGFyYW0ge21vZHVsZTplbmdpbmUvbW9kZWwvcmFuZ2V+UmFuZ2V9IHJhbmdlIEV4cGFuZGVkIHJhbmdlIHRvIGZpeC4KLy8gQHBhcmFtIHttb2R1bGU6ZW5naW5lL21vZGVsL3NjaGVtYX5TY2hlbWF9IHNjaGVtYQovLyBAcmV0dXJucyB7bW9kdWxlOmVuZ2luZS9tb2RlbC9yYW5nZX5SYW5nZXxudWxsfSBSZXR1cm5zIGZpeGVkIHJhbmdlIG9yIG51bGwgaWYgcmFuZ2UgaXMgdmFsaWQuCgoKZnVuY3Rpb24gdHJ5Rml4aW5nTm9uQ29sbGFwc2VkUmFnZShyYW5nZSwgc2NoZW1hKSB7CiAgY29uc3Qgc3RhcnQgPSByYW5nZS5zdGFydDsKICBjb25zdCBlbmQgPSByYW5nZS5lbmQ7CiAgY29uc3QgaXNUZXh0QWxsb3dlZE9uU3RhcnQgPSBzY2hlbWEuY2hlY2tDaGlsZChzdGFydCwgJyR0ZXh0Jyk7CiAgY29uc3QgaXNUZXh0QWxsb3dlZE9uRW5kID0gc2NoZW1hLmNoZWNrQ2hpbGQoZW5kLCAnJHRleHQnKTsKICBjb25zdCBzdGFydExpbWl0RWxlbWVudCA9IHNjaGVtYS5nZXRMaW1pdEVsZW1lbnQoc3RhcnQpOwogIGNvbnN0IGVuZExpbWl0RWxlbWVudCA9IHNjaGVtYS5nZXRMaW1pdEVsZW1lbnQoZW5kKTsgLy8gUmFuZ2VzIHdoaWNoIGJvdGggZW5kIGFyZSBpbnNpZGUgdGhlIHNhbWUgbGltaXQgZWxlbWVudCAob3Igcm9vdCkgbWlnaHQgbmVlZHMgb25seSBtaW5vciBmaXguCgogIGlmIChzdGFydExpbWl0RWxlbWVudCA9PT0gZW5kTGltaXRFbGVtZW50KSB7CiAgICAvLyBSYW5nZSBpcyB2YWxpZCB3aGVuIGJvdGggcG9zaXRpb24gYWxsb3dzIHRvIHBsYWNlIGEgdGV4dDoKICAgIC8vIC0gPGJsb2NrPmZbb29iYXJiYV16PC9ibG9jaz4KICAgIC8vIFRoaXMgd291bGQgYmUgImZpeGVkIiBieSBhIG5leHQgY2hlY2sgYnV0IGFzIGl0IHdpbGwgYmUgdGhlIHNhbWUgaXQncyBiZXR0ZXIgdG8gcmV0dXJuIG51bGwgc28gdGhlIHNlbGVjdGlvbiBzdGF5cyB0aGUgc2FtZS4KICAgIGlmIChpc1RleHRBbGxvd2VkT25TdGFydCAmJiBpc1RleHRBbGxvd2VkT25FbmQpIHsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9IC8vIFJhbmdlIHRoYXQgaXMgb24gbm9uLWxpbWl0IGVsZW1lbnQgKG9yIGlzIHBhcnRpYWxseSkgbXVzdCBiZSBmaXhlZCBzbyBpdCBpcyBwbGFjZWQgaW5zaWRlIHRoZSBibG9jayBhcm91bmQgJHRleHQ6CiAgICAvLyAtIFs8YmxvY2s+Zm9vPC9ibG9jaz5dICAgIC0+ICAgIDxibG9jaz5bZm9vXTwvYmxvY2s+CiAgICAvLyAtIFs8YmxvY2s+Zm9vXTwvYmxvY2s+ICAgIC0+ICAgIDxibG9jaz5bZm9vXTwvYmxvY2s+CiAgICAvLyAtIDxibG9jaz5mW29vPC9ibG9jaz5dICAgIC0+ICAgIDxibG9jaz5mW29vXTwvYmxvY2s+CiAgICAvLyAtIFs8YmxvY2s+Zm9vPC9ibG9jaz48b2JqZWN0Pjwvb2JqZWN0Pl0gICAgLT4gICAgPGJsb2NrPltmb288L2Jsb2NrPjxvYmplY3Q+PC9vYmplY3Q+XQoKCiAgICBpZiAoY2hlY2tTZWxlY3Rpb25Pbk5vbkxpbWl0RWxlbWVudHMoc3RhcnQsIGVuZCwgc2NoZW1hKSkgewogICAgICBjb25zdCBpc1N0YXJ0T2JqZWN0ID0gc3RhcnQubm9kZUFmdGVyICYmIHNjaGVtYS5pc09iamVjdChzdGFydC5ub2RlQWZ0ZXIpOwogICAgICBjb25zdCBmaXhlZFN0YXJ0ID0gaXNTdGFydE9iamVjdCA/IG51bGwgOiBzY2hlbWEuZ2V0TmVhcmVzdFNlbGVjdGlvblJhbmdlKHN0YXJ0LCAnZm9yd2FyZCcpOwogICAgICBjb25zdCBpc0VuZE9iamVjdCA9IGVuZC5ub2RlQmVmb3JlICYmIHNjaGVtYS5pc09iamVjdChlbmQubm9kZUJlZm9yZSk7CiAgICAgIGNvbnN0IGZpeGVkRW5kID0gaXNFbmRPYmplY3QgPyBudWxsIDogc2NoZW1hLmdldE5lYXJlc3RTZWxlY3Rpb25SYW5nZShlbmQsICdiYWNrd2FyZCcpOyAvLyBUaGUgc2NoZW1hLmdldE5lYXJlc3RTZWxlY3Rpb25SYW5nZSBtaWdodCByZXR1cm4gbnVsbCAtIGlmIHRoYXQgaGFwcGVucyB1c2Ugb3JpZ2luYWwgcG9zaXRpb24uCgogICAgICBjb25zdCByYW5nZVN0YXJ0ID0gZml4ZWRTdGFydCA/IGZpeGVkU3RhcnQuc3RhcnQgOiBzdGFydDsKICAgICAgY29uc3QgcmFuZ2VFbmQgPSBmaXhlZEVuZCA/IGZpeGVkRW5kLnN0YXJ0IDogZW5kOwogICAgICByZXR1cm4gbmV3IFJhbmdlKHJhbmdlU3RhcnQsIHJhbmdlRW5kKTsKICAgIH0KICB9CgogIGNvbnN0IGlzU3RhcnRJbkxpbWl0ID0gc3RhcnRMaW1pdEVsZW1lbnQgJiYgIXN0YXJ0TGltaXRFbGVtZW50LmlzKCdyb290RWxlbWVudCcpOwogIGNvbnN0IGlzRW5kSW5MaW1pdCA9IGVuZExpbWl0RWxlbWVudCAmJiAhZW5kTGltaXRFbGVtZW50LmlzKCdyb290RWxlbWVudCcpOyAvLyBBdCB0aGlzIHBvaW50IHdlIGVsaW1pbmF0ZWQgdmFsaWQgcG9zaXRpb25zIG9uIHRleHQgbm9kZXMgc28gaWYgb25lIG9mIHJhbmdlIHBvc2l0aW9ucyBpcyBwbGFjZWQgaW5zaWRlIGEgbGltaXQgZWxlbWVudAogIC8vIHRoZW4gdGhlIHJhbmdlIGNyb3NzZWQgbGltaXQgZWxlbWVudCBib3VuZGFyaWVzIGFuZCBuZWVkcyB0byBiZSBmaXhlZC4KCiAgaWYgKGlzU3RhcnRJbkxpbWl0IHx8IGlzRW5kSW5MaW1pdCkgewogICAgY29uc3QgYm90aEluU2FtZVBhcmVudCA9IHN0YXJ0Lm5vZGVBZnRlciAmJiBlbmQubm9kZUJlZm9yZSAmJiBzdGFydC5ub2RlQWZ0ZXIucGFyZW50ID09PSBlbmQubm9kZUJlZm9yZS5wYXJlbnQ7CiAgICBjb25zdCBleHBhbmRTdGFydCA9IGlzU3RhcnRJbkxpbWl0ICYmICghYm90aEluU2FtZVBhcmVudCB8fCAhaXNJbk9iamVjdChzdGFydC5ub2RlQWZ0ZXIsIHNjaGVtYSkpOwogICAgY29uc3QgZXhwYW5kRW5kID0gaXNFbmRJbkxpbWl0ICYmICghYm90aEluU2FtZVBhcmVudCB8fCAhaXNJbk9iamVjdChlbmQubm9kZUJlZm9yZSwgc2NoZW1hKSk7IC8vIEFsdGhvdWdoIHdlJ3ZlIGFscmVhZHkgZm91bmQgbGltaXQgZWxlbWVudCBvbiBzdGFydC9lbmQgcG9zaXRpb25zIHdlIG11c3QgZmluZCB0aGUgb3V0ZXItbW9zdCBsaW1pdCBlbGVtZW50LgogICAgLy8gYXMgbGltaXQgZWxlbWVudHMgbWlnaHQgYmUgbmVzdGVkIGRpcmVjdGx5IGluc2lkZSAoaWUgdGFibGUgPiB0YWJsZVJvdyA+IHRhYmxlQ2VsbCkuCgogICAgbGV0IGZpeGVkU3RhcnQgPSBzdGFydDsKICAgIGxldCBmaXhlZEVuZCA9IGVuZDsKCiAgICBpZiAoZXhwYW5kU3RhcnQpIHsKICAgICAgZml4ZWRTdGFydCA9IFBvc2l0aW9uLl9jcmVhdGVCZWZvcmUoZmluZE91dGVybW9zdExpbWl0QW5jZXN0b3Ioc3RhcnRMaW1pdEVsZW1lbnQsIHNjaGVtYSkpOwogICAgfQoKICAgIGlmIChleHBhbmRFbmQpIHsKICAgICAgZml4ZWRFbmQgPSBQb3NpdGlvbi5fY3JlYXRlQWZ0ZXIoZmluZE91dGVybW9zdExpbWl0QW5jZXN0b3IoZW5kTGltaXRFbGVtZW50LCBzY2hlbWEpKTsKICAgIH0KCiAgICByZXR1cm4gbmV3IFJhbmdlKGZpeGVkU3RhcnQsIGZpeGVkRW5kKTsKICB9IC8vIFJhbmdlIHdhcyBub3QgZml4ZWQgYXQgdGhpcyBwb2ludCBzbyBpdCBpcyB2YWxpZCAtIGllIGl0IHdhcyBwbGFjZWQgYXJvdW5kIGxpbWl0IGVsZW1lbnQgYWxyZWFkeS4KCgogIHJldHVybiBudWxsOwp9IC8vIEZpbmRzIHRoZSBvdXRlci1tb3N0IGFuY2VzdG9yLgovLwovLyBAcGFyYW0ge21vZHVsZTplbmdpbmUvbW9kZWwvbm9kZX5Ob2RlfSBzdGFydGluZ05vZGUKLy8gQHBhcmFtIHttb2R1bGU6ZW5naW5lL21vZGVsL3NjaGVtYX5TY2hlbWF9IHNjaGVtYQovLyBAcGFyYW0ge1N0cmluZ30gZXhwYW5kVG9EaXJlY3Rpb24gRGlyZWN0aW9uIG9mIGV4cGFuc2lvbiAtIGVpdGhlciAnc3RhcnQnIG9yICdlbmQnIG9mIHRoZSByYW5nZS4KLy8gQHJldHVybnMge21vZHVsZTplbmdpbmUvbW9kZWwvbm9kZX5Ob2RlfQoKCmZ1bmN0aW9uIGZpbmRPdXRlcm1vc3RMaW1pdEFuY2VzdG9yKHN0YXJ0aW5nTm9kZSwgc2NoZW1hKSB7CiAgbGV0IGlzTGltaXROb2RlID0gc3RhcnRpbmdOb2RlOwogIGxldCBwYXJlbnQgPSBpc0xpbWl0Tm9kZTsgLy8gRmluZCBvdXRlciBtb3N0IGlzTGltaXQgYmxvY2sgYXMgc3VjaCBibG9ja3MgbWlnaHQgYmUgbmVzdGVkIChpZS4gaW4gdGFibGVzKS4KCiAgd2hpbGUgKHNjaGVtYS5pc0xpbWl0KHBhcmVudCkgJiYgcGFyZW50LnBhcmVudCkgewogICAgaXNMaW1pdE5vZGUgPSBwYXJlbnQ7CiAgICBwYXJlbnQgPSBwYXJlbnQucGFyZW50OwogIH0KCiAgcmV0dXJuIGlzTGltaXROb2RlOwp9IC8vIENoZWNrcyB3aGV0aGVyIGFueSBvZiByYW5nZSBib3VuZGFyaWVzIGlzIHBsYWNlZCBhcm91bmQgbm9uLWxpbWl0IGVsZW1lbnRzLgovLwovLyBAcGFyYW0ge21vZHVsZTplbmdpbmUvbW9kZWwvcG9zaXRpb25+UG9zaXRpb259IHN0YXJ0Ci8vIEBwYXJhbSB7bW9kdWxlOmVuZ2luZS9tb2RlbC9wb3NpdGlvbn5Qb3NpdGlvbn0gZW5kCi8vIEBwYXJhbSB7bW9kdWxlOmVuZ2luZS9tb2RlbC9zY2hlbWF+U2NoZW1hfSBzY2hlbWEKLy8gQHJldHVybnMge0Jvb2xlYW59CgoKZnVuY3Rpb24gY2hlY2tTZWxlY3Rpb25Pbk5vbkxpbWl0RWxlbWVudHMoc3RhcnQsIGVuZCwgc2NoZW1hKSB7CiAgY29uc3Qgc3RhcnRJc09uQmxvY2sgPSBzdGFydC5ub2RlQWZ0ZXIgJiYgIXNjaGVtYS5pc0xpbWl0KHN0YXJ0Lm5vZGVBZnRlcikgfHwgc2NoZW1hLmNoZWNrQ2hpbGQoc3RhcnQsICckdGV4dCcpOwogIGNvbnN0IGVuZElzT25CbG9jayA9IGVuZC5ub2RlQmVmb3JlICYmICFzY2hlbWEuaXNMaW1pdChlbmQubm9kZUJlZm9yZSkgfHwgc2NoZW1hLmNoZWNrQ2hpbGQoZW5kLCAnJHRleHQnKTsgLy8gV2Ugc2hvdWxkIGZpeCBzdWNoIHNlbGVjdGlvbiB3aGVuIG9uZSBvZiB0aG9zZSBub2RlcyBuZWVkcyBmaXhpbmcuCgogIHJldHVybiBzdGFydElzT25CbG9jayB8fCBlbmRJc09uQmxvY2s7Cn0gLy8gQ2hlY2tzIGlmIG5vZGUgZXhpc3RzIGFuZCBpZiBpdCdzIGFuIG9iamVjdC4KLy8KLy8gQHBhcmFtIHttb2R1bGU6ZW5naW5lL21vZGVsL25vZGV+Tm9kZX0gbm9kZQovLyBAcGFyYW0ge21vZHVsZTplbmdpbmUvbW9kZWwvc2NoZW1hflNjaGVtYX0gc2NoZW1hCi8vIEByZXR1cm5zIHtCb29sZWFufQoKCmZ1bmN0aW9uIGlzSW5PYmplY3Qobm9kZSwgc2NoZW1hKSB7CiAgcmV0dXJuIG5vZGUgJiYgc2NoZW1hLmlzT2JqZWN0KG5vZGUpOwp9"},{"version":3,"sources":["/Users/antonyching/Desktop/project/new-builder-demo/node_modules/@ckeditor/ckeditor5-engine/src/model/utils/selection-post-fixer.js"],"names":["Range","Position","injectSelectionPostFixer","model","document","registerPostFixer","writer","selectionPostFixer","selection","schema","ranges","wasFixed","modelRange","getRanges","correctedRange","tryFixingRange","push","fixedRanges","length","selectionStart","start","selectionEnd","end","setSelection","backward","isBackward","range","isCollapsed","tryFixingCollapsedRange","tryFixingNonCollapsedRage","originalPosition","nearestSelectionRange","getNearestSelectionRange","fixedPosition","isEqual","nodeAfter","isLimit","_createAfter","isTextAllowedOnStart","checkChild","isTextAllowedOnEnd","startLimitElement","getLimitElement","endLimitElement","checkSelectionOnNonLimitElements","isStartObject","isObject","fixedStart","isEndObject","nodeBefore","fixedEnd","rangeStart","rangeEnd","isStartInLimit","is","isEndInLimit","bothInSameParent","parent","expandStart","isInObject","expandEnd","_createBefore","findOutermostLimitAncestor","startingNode","isLimitNode","startIsOnBlock","endIsOnBlock","node"],"mappings":"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","sourcesContent":["/**\n * @license Copyright (c) 2003-2019, CKSource - Frederico Knabben. All rights reserved.\n * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license\n */\n\n/**\n * @module engine/model/utils/selection-post-fixer\n */\n\nimport Range from '../range';\nimport Position from '../position';\n\n/**\n * Injects selection post-fixer to the model.\n *\n * The role of the selection post-fixer is to ensure that the selection is in a correct place\n * after a {@link module:engine/model/model~Model#change `change()`} block was executed.\n *\n * The correct position means that:\n *\n * * All collapsed selection ranges are in a place where the {@link module:engine/model/schema~Schema}\n * allows a `$text`.\n * * None of the selection's non-collapsed ranges crosses a {@link module:engine/model/schema~Schema#isLimit limit element}\n * boundary (a range must be rooted within one limit element).\n * * Only {@link module:engine/model/schema~Schema#isObject object elements} can be selected from the outside\n * (e.g. `[<paragraph>foo</paragraph>]` is invalid). This rule applies independently to both selection ends, so this\n * selection is correct: `<paragraph>f[oo</paragraph><image></image>]`.\n *\n * If the position is not correct, the post-fixer will automatically correct it.\n *\n * ## Fixing a non-collapsed selection\n *\n * See as an example a selection that starts in a P1 element and ends inside the text of a TD element\n * (`[` and `]` are range boundaries and `(l)` denotes an element defined as `isLimit=true`):\n *\n *\t\troot\n *\t\t |- element P1\n *\t\t |   |- \"foo\"                                      root\n *\t\t |- element TABLE (l)                   P1         TABLE             P2\n *\t\t |   |- element TR (l)                 f o[o     TR      TR         b a r\n *\t\t |   |   |- element TD (l)                       TD      TD\n *\t\t |   |       |- \"aaa\"                          a]a a    b b b\n *\t\t |   |- element TR (l)\n *\t\t |   |   |- element TD (l)                           ||\n *\t\t |   |       |- \"bbb\"                                ||\n *\t\t |- element P2                                       VV\n *\t\t |   |- \"bar\"\n *\t\t                                                   root\n *\t\t                                        P1         TABLE]            P2\n *\t\t                                       f o[o     TR      TR         b a r\n *\t\t                                                 TD      TD\n *\t\t                                               a a a    b b b\n *\n * In the example above, the TABLE, TR and TD are defined as `isLimit=true` in the schema. The range which is not contained within\n * a single limit element must be expanded to select the outermost limit element. The range end is inside the text node of the TD element.\n * As the TD element is a child of the TR and TABLE elements, where both are defined as `isLimit=true` in the schema, the range must be\n * expanded to select the whole TABLE element.\n *\n * **Note** If the selection contains multiple ranges, the method returns a minimal set of ranges that are not intersecting after expanding\n * them to select `isLimit=true` elements.\n *\n * @param {module:engine/model/model~Model} model\n */\nexport function injectSelectionPostFixer( model ) {\n\tmodel.document.registerPostFixer( writer => selectionPostFixer( writer, model ) );\n}\n\n// The selection post-fixer.\n//\n// @param {module:engine/model/writer~Writer} writer\n// @param {module:engine/model/model~Model} model\nfunction selectionPostFixer( writer, model ) {\n\tconst selection = model.document.selection;\n\tconst schema = model.schema;\n\n\tconst ranges = [];\n\n\tlet wasFixed = false;\n\n\tfor ( const modelRange of selection.getRanges() ) {\n\t\t// Go through all ranges in selection and try fixing each of them.\n\t\t// Those ranges might overlap but will be corrected later.\n\t\tconst correctedRange = tryFixingRange( modelRange, schema );\n\n\t\tif ( correctedRange ) {\n\t\t\tranges.push( correctedRange );\n\t\t\twasFixed = true;\n\t\t} else {\n\t\t\tranges.push( modelRange );\n\t\t}\n\t}\n\n\t// If any of ranges were corrected update the selection.\n\tif ( wasFixed ) {\n\t\t// The above algorithm might create ranges that intersects each other when selection contains more then one range.\n\t\t// This is case happens mostly on Firefox which creates multiple ranges for selected table.\n\t\tlet fixedRanges = ranges;\n\n\t\t// Fixing selection with many ranges usually breaks the selection in Firefox. As only Firefox supports multiple selection ranges\n\t\t// we simply create one continuous range from fixed selection ranges (even if they are not adjacent).\n\t\tif ( ranges.length > 1 ) {\n\t\t\tconst selectionStart = ranges[ 0 ].start;\n\t\t\tconst selectionEnd = ranges[ ranges.length - 1 ].end;\n\n\t\t\tfixedRanges = [ new Range( selectionStart, selectionEnd ) ];\n\t\t}\n\n\t\twriter.setSelection( fixedRanges, { backward: selection.isBackward } );\n\t}\n}\n\n// Tries fixing a range if it's incorrect.\n//\n// @param {module:engine/model/range~Range} range\n// @param {module:engine/model/schema~Schema} schema\n// @returns {module:engine/model/range~Range|null} Returns fixed range or null if range is valid.\nfunction tryFixingRange( range, schema ) {\n\tif ( range.isCollapsed ) {\n\t\treturn tryFixingCollapsedRange( range, schema );\n\t}\n\n\treturn tryFixingNonCollapsedRage( range, schema );\n}\n\n// Tries to fix collapsed ranges.\n//\n// * Fixes situation when a range is in a place where $text is not allowed\n//\n// @param {module:engine/model/range~Range} range Collapsed range to fix.\n// @param {module:engine/model/schema~Schema} schema\n// @returns {module:engine/model/range~Range|null} Returns fixed range or null if range is valid.\nfunction tryFixingCollapsedRange( range, schema ) {\n\tconst originalPosition = range.start;\n\n\tconst nearestSelectionRange = schema.getNearestSelectionRange( originalPosition );\n\n\t// This might be null ie when editor data is empty.\n\t// In such cases there is no need to fix the selection range.\n\tif ( !nearestSelectionRange ) {\n\t\treturn null;\n\t}\n\n\tconst fixedPosition = nearestSelectionRange.start;\n\n\t// Fixed position is the same as original - no need to return corrected range.\n\tif ( originalPosition.isEqual( fixedPosition ) ) {\n\t\treturn null;\n\t}\n\n\t// Check single node selection (happens in tables).\n\tif ( fixedPosition.nodeAfter && schema.isLimit( fixedPosition.nodeAfter ) ) {\n\t\treturn new Range( fixedPosition, Position._createAfter( fixedPosition.nodeAfter ) );\n\t}\n\n\treturn new Range( fixedPosition );\n}\n\n// Tries to fix an expanded range.\n//\n// @param {module:engine/model/range~Range} range Expanded range to fix.\n// @param {module:engine/model/schema~Schema} schema\n// @returns {module:engine/model/range~Range|null} Returns fixed range or null if range is valid.\nfunction tryFixingNonCollapsedRage( range, schema ) {\n\tconst start = range.start;\n\tconst end = range.end;\n\n\tconst isTextAllowedOnStart = schema.checkChild( start, '$text' );\n\tconst isTextAllowedOnEnd = schema.checkChild( end, '$text' );\n\n\tconst startLimitElement = schema.getLimitElement( start );\n\tconst endLimitElement = schema.getLimitElement( end );\n\n\t// Ranges which both end are inside the same limit element (or root) might needs only minor fix.\n\tif ( startLimitElement === endLimitElement ) {\n\t\t// Range is valid when both position allows to place a text:\n\t\t// - <block>f[oobarba]z</block>\n\t\t// This would be \"fixed\" by a next check but as it will be the same it's better to return null so the selection stays the same.\n\t\tif ( isTextAllowedOnStart && isTextAllowedOnEnd ) {\n\t\t\treturn null;\n\t\t}\n\n\t\t// Range that is on non-limit element (or is partially) must be fixed so it is placed inside the block around $text:\n\t\t// - [<block>foo</block>]    ->    <block>[foo]</block>\n\t\t// - [<block>foo]</block>    ->    <block>[foo]</block>\n\t\t// - <block>f[oo</block>]    ->    <block>f[oo]</block>\n\t\t// - [<block>foo</block><object></object>]    ->    <block>[foo</block><object></object>]\n\t\tif ( checkSelectionOnNonLimitElements( start, end, schema ) ) {\n\t\t\tconst isStartObject = start.nodeAfter && schema.isObject( start.nodeAfter );\n\t\t\tconst fixedStart = isStartObject ? null : schema.getNearestSelectionRange( start, 'forward' );\n\n\t\t\tconst isEndObject = end.nodeBefore && schema.isObject( end.nodeBefore );\n\t\t\tconst fixedEnd = isEndObject ? null : schema.getNearestSelectionRange( end, 'backward' );\n\n\t\t\t// The schema.getNearestSelectionRange might return null - if that happens use original position.\n\t\t\tconst rangeStart = fixedStart ? fixedStart.start : start;\n\t\t\tconst rangeEnd = fixedEnd ? fixedEnd.start : end;\n\n\t\t\treturn new Range( rangeStart, rangeEnd );\n\t\t}\n\t}\n\n\tconst isStartInLimit = startLimitElement && !startLimitElement.is( 'rootElement' );\n\tconst isEndInLimit = endLimitElement && !endLimitElement.is( 'rootElement' );\n\n\t// At this point we eliminated valid positions on text nodes so if one of range positions is placed inside a limit element\n\t// then the range crossed limit element boundaries and needs to be fixed.\n\tif ( isStartInLimit || isEndInLimit ) {\n\t\tconst bothInSameParent = ( start.nodeAfter && end.nodeBefore ) && start.nodeAfter.parent === end.nodeBefore.parent;\n\n\t\tconst expandStart = isStartInLimit && ( !bothInSameParent || !isInObject( start.nodeAfter, schema ) );\n\t\tconst expandEnd = isEndInLimit && ( !bothInSameParent || !isInObject( end.nodeBefore, schema ) );\n\n\t\t// Although we've already found limit element on start/end positions we must find the outer-most limit element.\n\t\t// as limit elements might be nested directly inside (ie table > tableRow > tableCell).\n\t\tlet fixedStart = start;\n\t\tlet fixedEnd = end;\n\n\t\tif ( expandStart ) {\n\t\t\tfixedStart = Position._createBefore( findOutermostLimitAncestor( startLimitElement, schema ) );\n\t\t}\n\n\t\tif ( expandEnd ) {\n\t\t\tfixedEnd = Position._createAfter( findOutermostLimitAncestor( endLimitElement, schema ) );\n\t\t}\n\n\t\treturn new Range( fixedStart, fixedEnd );\n\t}\n\n\t// Range was not fixed at this point so it is valid - ie it was placed around limit element already.\n\treturn null;\n}\n\n// Finds the outer-most ancestor.\n//\n// @param {module:engine/model/node~Node} startingNode\n// @param {module:engine/model/schema~Schema} schema\n// @param {String} expandToDirection Direction of expansion - either 'start' or 'end' of the range.\n// @returns {module:engine/model/node~Node}\nfunction findOutermostLimitAncestor( startingNode, schema ) {\n\tlet isLimitNode = startingNode;\n\tlet parent = isLimitNode;\n\n\t// Find outer most isLimit block as such blocks might be nested (ie. in tables).\n\twhile ( schema.isLimit( parent ) && parent.parent ) {\n\t\tisLimitNode = parent;\n\t\tparent = parent.parent;\n\t}\n\n\treturn isLimitNode;\n}\n\n// Checks whether any of range boundaries is placed around non-limit elements.\n//\n// @param {module:engine/model/position~Position} start\n// @param {module:engine/model/position~Position} end\n// @param {module:engine/model/schema~Schema} schema\n// @returns {Boolean}\nfunction checkSelectionOnNonLimitElements( start, end, schema ) {\n\tconst startIsOnBlock = ( start.nodeAfter && !schema.isLimit( start.nodeAfter ) ) || schema.checkChild( start, '$text' );\n\tconst endIsOnBlock = ( end.nodeBefore && !schema.isLimit( end.nodeBefore ) ) || schema.checkChild( end, '$text' );\n\n\t// We should fix such selection when one of those nodes needs fixing.\n\treturn startIsOnBlock || endIsOnBlock;\n}\n\n// Checks if node exists and if it's an object.\n//\n// @param {module:engine/model/node~Node} node\n// @param {module:engine/model/schema~Schema} schema\n// @returns {Boolean}\nfunction isInObject( node, schema ) {\n\treturn node && schema.isObject( node );\n}\n\n"]}]}
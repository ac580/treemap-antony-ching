{"remainingRequest":"/Users/antonyching/Desktop/project/new-builder-demo/node_modules/babel-loader/lib/index.js!/Users/antonyching/Desktop/project/new-builder-demo/node_modules/@ckeditor/ckeditor5-engine/src/model/document.js","dependencies":[{"path":"/Users/antonyching/Desktop/project/new-builder-demo/node_modules/@ckeditor/ckeditor5-engine/src/model/document.js","mtime":499162500000},{"path":"/Users/antonyching/Desktop/project/new-builder-demo/node_modules/@ckeditor/ckeditor5-dev-webpack-plugin/lib/translatesourceloader.js","mtime":499162500000},{"path":"/Users/antonyching/Desktop/project/new-builder-demo/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/antonyching/Desktop/project/new-builder-demo/node_modules/babel-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:LyoqCiAqIEBsaWNlbnNlIENvcHlyaWdodCAoYykgMjAwMy0yMDE5LCBDS1NvdXJjZSAtIEZyZWRlcmljbyBLbmFiYmVuLiBBbGwgcmlnaHRzIHJlc2VydmVkLgogKiBGb3IgbGljZW5zaW5nLCBzZWUgTElDRU5TRS5tZCBvciBodHRwczovL2NrZWRpdG9yLmNvbS9sZWdhbC9ja2VkaXRvci1vc3MtbGljZW5zZQogKi8KCi8qKgogKiBAbW9kdWxlIGVuZ2luZS9tb2RlbC9kb2N1bWVudAogKi8KaW1wb3J0IERpZmZlciBmcm9tICcuL2RpZmZlcic7CmltcG9ydCBSb290RWxlbWVudCBmcm9tICcuL3Jvb3RlbGVtZW50JzsKaW1wb3J0IEhpc3RvcnkgZnJvbSAnLi9oaXN0b3J5JzsKaW1wb3J0IERvY3VtZW50U2VsZWN0aW9uIGZyb20gJy4vZG9jdW1lbnRzZWxlY3Rpb24nOwppbXBvcnQgQ29sbGVjdGlvbiBmcm9tICdAY2tlZGl0b3IvY2tlZGl0b3I1LXV0aWxzL3NyYy9jb2xsZWN0aW9uJzsKaW1wb3J0IEVtaXR0ZXJNaXhpbiBmcm9tICdAY2tlZGl0b3IvY2tlZGl0b3I1LXV0aWxzL3NyYy9lbWl0dGVybWl4aW4nOwppbXBvcnQgQ0tFZGl0b3JFcnJvciBmcm9tICdAY2tlZGl0b3IvY2tlZGl0b3I1LXV0aWxzL3NyYy9ja2VkaXRvcmVycm9yJzsKaW1wb3J0IG1peCBmcm9tICdAY2tlZGl0b3IvY2tlZGl0b3I1LXV0aWxzL3NyYy9taXgnOwppbXBvcnQgeyBpc0luc2lkZVN1cnJvZ2F0ZVBhaXIsIGlzSW5zaWRlQ29tYmluZWRTeW1ib2wgfSBmcm9tICdAY2tlZGl0b3IvY2tlZGl0b3I1LXV0aWxzL3NyYy91bmljb2RlJzsKaW1wb3J0IHsgY2xvbmUgfSBmcm9tICdsb2Rhc2gtZXMnOyAvLyBAaWYgQ0tfREVCVUdfRU5HSU5FIC8vIGNvbnN0IHsgbG9nRG9jdW1lbnQgfSA9IHJlcXVpcmUoICcuLi9kZXYtdXRpbHMvdXRpbHMnICk7Cgpjb25zdCBncmF2ZXlhcmROYW1lID0gJyRncmF2ZXlhcmQnOwovKioKICogRGF0YSBtb2RlbCdzIGRvY3VtZW50LiBJdCBjb250YWlucyB0aGUgbW9kZWwncyBzdHJ1Y3R1cmUsIGl0cyBzZWxlY3Rpb24gYW5kIHRoZSBoaXN0b3J5IG9mIGNoYW5nZXMuCiAqCiAqIFJlYWQgbW9yZSBhYm91dCB3b3JraW5nIHdpdGggdGhlIG1vZGVsIGluCiAqIHtAZ2xpbmsgZnJhbWV3b3JrL2d1aWRlcy9hcmNoaXRlY3R1cmUvZWRpdGluZy1lbmdpbmUjbW9kZWwgaW50cm9kdWN0aW9uIHRvIHRoZSB0aGUgZWRpdGluZyBlbmdpbmUncyBhcmNoaXRlY3R1cmV9LgogKgogKiBVc3VhbGx5LCB0aGUgZG9jdW1lbnQgY29udGFpbnMganVzdCBvbmUge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvZG9jdW1lbnR+RG9jdW1lbnQjcm9vdHMgcm9vdCBlbGVtZW50fSwgc28KICogeW91IGNhbiByZXRyaWV2ZSBpdCBieSBqdXN0IGNhbGxpbmcge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvZG9jdW1lbnR+RG9jdW1lbnQjZ2V0Um9vdH0gd2l0aG91dCBzcGVjaWZ5aW5nIGl0cyBuYW1lOgogKgogKgkJbW9kZWwuZG9jdW1lbnQuZ2V0Um9vdCgpOyAvLyAtPiByZXR1cm5zIHRoZSBtYWluIHJvb3QKICoKICogSG93ZXZlciwgdGhlIGRvY3VtZW50IG1heSBjb250YWluIG11bHRpcGxlIHJvb3RzIOKAkyBlLmcuIHdoZW4gdGhlIGVkaXRvciBoYXMgbXVsdGlwbGUgZWRpdGFibGUgYXJlYXMKICogKGUuZy4gYSB0aXRsZSBhbmQgYSBib2R5IG9mIGEgbWVzc2FnZSkuCiAqCiAqIEBtaXhlcyBtb2R1bGU6dXRpbHMvZW1pdHRlcm1peGlufkVtaXR0ZXJNaXhpbgogKi8KCmV4cG9ydCBkZWZhdWx0IGNsYXNzIERvY3VtZW50IHsKICAvKioKICAgKiBDcmVhdGVzIGFuIGVtcHR5IGRvY3VtZW50IGluc3RhbmNlIHdpdGggbm8ge0BsaW5rICNyb290c30gKG90aGVyIHRoYW4KICAgKiB0aGUge0BsaW5rICNncmF2ZXlhcmQgZ3JhdmV5YXJkIHJvb3R9KS4KICAgKi8KICBjb25zdHJ1Y3Rvcihtb2RlbCkgewogICAgLyoqCiAgICAgKiBUaGUge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvbW9kZWx+TW9kZWwgbW9kZWx9IHRoYXQgdGhlIGRvY3VtZW50IGlzIGEgcGFydCBvZi4KICAgICAqCiAgICAgKiBAcmVhZG9ubHkKICAgICAqIEB0eXBlIHttb2R1bGU6ZW5naW5lL21vZGVsL21vZGVsfk1vZGVsfQogICAgICovCiAgICB0aGlzLm1vZGVsID0gbW9kZWw7CiAgICAvKioKICAgICAqIFRoZSBkb2N1bWVudCB2ZXJzaW9uLiBJdCBzdGFydHMgZnJvbSBgMGAgYW5kIGV2ZXJ5IG9wZXJhdGlvbiBpbmNyZWFzZXMgdGhlIHZlcnNpb24gbnVtYmVyLiBJdCBpcyB1c2VkIHRvIGVuc3VyZSB0aGF0CiAgICAgKiBvcGVyYXRpb25zIGFyZSBhcHBsaWVkIG9uIGEgcHJvcGVyIGRvY3VtZW50IHZlcnNpb24uCiAgICAgKgogICAgICogSWYgdGhlIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL29wZXJhdGlvbi9vcGVyYXRpb25+T3BlcmF0aW9uI2Jhc2VWZXJzaW9uIGJhc2UgdmVyc2lvbn0gZG9lcyBub3QgbWF0Y2ggdGhlIGRvY3VtZW50IHZlcnNpb24sCiAgICAgKiBhIHtAbGluayBtb2R1bGU6dXRpbHMvY2tlZGl0b3JlcnJvcn5DS0VkaXRvckVycm9yIG1vZGVsLWRvY3VtZW50LWFwcGx5T3BlcmF0aW9uLXdyb25nLXZlcnNpb259IGVycm9yIGlzIHRocm93bi4KICAgICAqCiAgICAgKiBAcmVhZG9ubHkKICAgICAqIEB0eXBlIHtOdW1iZXJ9CiAgICAgKi8KCiAgICB0aGlzLnZlcnNpb24gPSAwOwogICAgLyoqCiAgICAgKiBUaGUgZG9jdW1lbnQncyBoaXN0b3J5LgogICAgICoKICAgICAqIEByZWFkb25seQogICAgICogQHR5cGUge21vZHVsZTplbmdpbmUvbW9kZWwvaGlzdG9yeX5IaXN0b3J5fQogICAgICovCgogICAgdGhpcy5oaXN0b3J5ID0gbmV3IEhpc3RvcnkodGhpcyk7CiAgICAvKioKICAgICAqIFRoZSBzZWxlY3Rpb24gaW4gdGhpcyBkb2N1bWVudC4KICAgICAqCiAgICAgKiBAcmVhZG9ubHkKICAgICAqIEB0eXBlIHttb2R1bGU6ZW5naW5lL21vZGVsL2RvY3VtZW50c2VsZWN0aW9ufkRvY3VtZW50U2VsZWN0aW9ufQogICAgICovCgogICAgdGhpcy5zZWxlY3Rpb24gPSBuZXcgRG9jdW1lbnRTZWxlY3Rpb24odGhpcyk7CiAgICAvKioKICAgICAqIEEgbGlzdCBvZiByb290cyB0aGF0IGFyZSBvd25lZCBhbmQgbWFuYWdlZCBieSB0aGlzIGRvY3VtZW50LiBVc2Uge0BsaW5rICNjcmVhdGVSb290fSBhbmQKICAgICAqIHtAbGluayAjZ2V0Um9vdH0gdG8gbWFuaXB1bGF0ZSBpdC4KICAgICAqCiAgICAgKiBAcmVhZG9ubHkKICAgICAqIEB0eXBlIHttb2R1bGU6dXRpbHMvY29sbGVjdGlvbn5Db2xsZWN0aW9ufQogICAgICovCgogICAgdGhpcy5yb290cyA9IG5ldyBDb2xsZWN0aW9uKHsKICAgICAgaWRQcm9wZXJ0eTogJ3Jvb3ROYW1lJwogICAgfSk7CiAgICAvKioKICAgICAqIFRoZSBtb2RlbCBkaWZmZXIgb2JqZWN0LiBJdHMgcm9sZSBpcyB0byBidWZmZXIgY2hhbmdlcyBkb25lIG9uIHRoZSBtb2RlbCBkb2N1bWVudCBhbmQgdGhlbiBjYWxjdWxhdGUgYSBkaWZmIG9mIHRob3NlIGNoYW5nZXMuCiAgICAgKgogICAgICogQHJlYWRvbmx5CiAgICAgKiBAdHlwZSB7bW9kdWxlOmVuZ2luZS9tb2RlbC9kaWZmZXJ+RGlmZmVyfQogICAgICovCgogICAgdGhpcy5kaWZmZXIgPSBuZXcgRGlmZmVyKG1vZGVsLm1hcmtlcnMpOwogICAgLyoqCiAgICAgKiBQb3N0LWZpeGVyIGNhbGxiYWNrcyByZWdpc3RlcmVkIHRvIHRoZSBtb2RlbCBkb2N1bWVudC4KICAgICAqCiAgICAgKiBAcHJpdmF0ZQogICAgICogQHR5cGUge1NldC48RnVuY3Rpb24+fQogICAgICovCgogICAgdGhpcy5fcG9zdEZpeGVycyA9IG5ldyBTZXQoKTsKICAgIC8qKgogICAgICogQSBib29sZWFuIGluZGljYXRlcyB3aGV0aGVyIHRoZSBzZWxlY3Rpb24gaGFzIGNoYW5nZWQgdW50aWwKICAgICAqCiAgICAgKiBAcHJpdmF0ZQogICAgICogQHR5cGUge0Jvb2xlYW59CiAgICAgKi8KCiAgICB0aGlzLl9oYXNTZWxlY3Rpb25DaGFuZ2VkRnJvbVRoZUxhc3RDaGFuZ2VCbG9jayA9IGZhbHNlOyAvLyBHcmF2ZXlhcmQgdHJlZSByb290LiBEb2N1bWVudCBhbHdheXMgaGF2ZSBhIGdyYXZleWFyZCByb290LCB3aGljaCBzdG9yZXMgcmVtb3ZlZCBub2Rlcy4KCiAgICB0aGlzLmNyZWF0ZVJvb3QoJyRyb290JywgZ3JhdmV5YXJkTmFtZSk7IC8vIEZpcnN0LCBpZiB0aGUgb3BlcmF0aW9uIGlzIGEgZG9jdW1lbnQgb3BlcmF0aW9uIGNoZWNrIGlmIGl0J3MgYmFzZSB2ZXJzaW9uIGlzIGNvcnJlY3QuCgogICAgdGhpcy5saXN0ZW5Ubyhtb2RlbCwgJ2FwcGx5T3BlcmF0aW9uJywgKGV2dCwgYXJncykgPT4gewogICAgICBjb25zdCBvcGVyYXRpb24gPSBhcmdzWzBdOwoKICAgICAgaWYgKG9wZXJhdGlvbi5pc0RvY3VtZW50T3BlcmF0aW9uICYmIG9wZXJhdGlvbi5iYXNlVmVyc2lvbiAhPT0gdGhpcy52ZXJzaW9uKSB7CiAgICAgICAgLyoqCiAgICAgICAgICogT25seSBvcGVyYXRpb25zIHdpdGggbWF0Y2hpbmcgdmVyc2lvbnMgY2FuIGJlIGFwcGxpZWQuCiAgICAgICAgICoKICAgICAgICAgKiBAZXJyb3IgZG9jdW1lbnQtYXBwbHlPcGVyYXRpb24td3JvbmctdmVyc2lvbgogICAgICAgICAqIEBwYXJhbSB7bW9kdWxlOmVuZ2luZS9tb2RlbC9vcGVyYXRpb24vb3BlcmF0aW9ufk9wZXJhdGlvbn0gb3BlcmF0aW9uCiAgICAgICAgICovCiAgICAgICAgdGhyb3cgbmV3IENLRWRpdG9yRXJyb3IoJ21vZGVsLWRvY3VtZW50LWFwcGx5T3BlcmF0aW9uLXdyb25nLXZlcnNpb246IE9ubHkgb3BlcmF0aW9ucyB3aXRoIG1hdGNoaW5nIHZlcnNpb25zIGNhbiBiZSBhcHBsaWVkLicsIHRoaXMsIHsKICAgICAgICAgIG9wZXJhdGlvbgogICAgICAgIH0pOwogICAgICB9CiAgICB9LCB7CiAgICAgIHByaW9yaXR5OiAnaGlnaGVzdCcKICAgIH0pOyAvLyBUaGVuLCBzdGlsbCBiZWZvcmUgYW4gb3BlcmF0aW9uIGlzIGFwcGxpZWQgb24gbW9kZWwsIGJ1ZmZlciB0aGUgY2hhbmdlIGluIGRpZmZlci4KCiAgICB0aGlzLmxpc3RlblRvKG1vZGVsLCAnYXBwbHlPcGVyYXRpb24nLCAoZXZ0LCBhcmdzKSA9PiB7CiAgICAgIGNvbnN0IG9wZXJhdGlvbiA9IGFyZ3NbMF07CgogICAgICBpZiAob3BlcmF0aW9uLmlzRG9jdW1lbnRPcGVyYXRpb24pIHsKICAgICAgICB0aGlzLmRpZmZlci5idWZmZXJPcGVyYXRpb24ob3BlcmF0aW9uKTsKICAgICAgfQogICAgfSwgewogICAgICBwcmlvcml0eTogJ2hpZ2gnCiAgICB9KTsgLy8gQWZ0ZXIgdGhlIG9wZXJhdGlvbiBpcyBhcHBsaWVkLCBidW1wIGRvY3VtZW50J3MgdmVyc2lvbiBhbmQgYWRkIHRoZSBvcGVyYXRpb24gdG8gdGhlIGhpc3RvcnkuCgogICAgdGhpcy5saXN0ZW5Ubyhtb2RlbCwgJ2FwcGx5T3BlcmF0aW9uJywgKGV2dCwgYXJncykgPT4gewogICAgICBjb25zdCBvcGVyYXRpb24gPSBhcmdzWzBdOwoKICAgICAgaWYgKG9wZXJhdGlvbi5pc0RvY3VtZW50T3BlcmF0aW9uKSB7CiAgICAgICAgdGhpcy52ZXJzaW9uKys7CiAgICAgICAgdGhpcy5oaXN0b3J5LmFkZE9wZXJhdGlvbihvcGVyYXRpb24pOwogICAgICB9CiAgICB9LCB7CiAgICAgIHByaW9yaXR5OiAnbG93JwogICAgfSk7IC8vIExpc3RlbiB0byBzZWxlY3Rpb24gY2hhbmdlcy4gSWYgc2VsZWN0aW9uIGNoYW5nZWQsIG1hcmsgaXQuCgogICAgdGhpcy5saXN0ZW5Ubyh0aGlzLnNlbGVjdGlvbiwgJ2NoYW5nZScsICgpID0+IHsKICAgICAgdGhpcy5faGFzU2VsZWN0aW9uQ2hhbmdlZEZyb21UaGVMYXN0Q2hhbmdlQmxvY2sgPSB0cnVlOwogICAgfSk7IC8vIEJ1ZmZlciBtYXJrZXIgY2hhbmdlcy4KICAgIC8vIFRoaXMgaXMgbm90IGNvdmVyZWQgaW4gYnVmZmVyaW5nIG9wZXJhdGlvbnMgYmVjYXVzZSBtYXJrZXJzIG1heSBjaGFuZ2Ugb3V0c2lkZSBvZiB0aGVtICh3aGVuIHRoZXkKICAgIC8vIGFyZSBtb2RpZmllZCB1c2luZyBgbW9kZWwubWFya2Vyc2AgY29sbGVjdGlvbiwgbm90IHRocm91Z2ggYE1hcmtlck9wZXJhdGlvbmApLgoKICAgIHRoaXMubGlzdGVuVG8obW9kZWwubWFya2VycywgJ3VwZGF0ZScsIChldnQsIG1hcmtlciwgb2xkUmFuZ2UsIG5ld1JhbmdlKSA9PiB7CiAgICAgIC8vIFdoZW5ldmVyIG1hcmtlciBpcyB1cGRhdGVkLCBidWZmZXIgdGhhdCBjaGFuZ2UuCiAgICAgIHRoaXMuZGlmZmVyLmJ1ZmZlck1hcmtlckNoYW5nZShtYXJrZXIubmFtZSwgb2xkUmFuZ2UsIG5ld1JhbmdlLCBtYXJrZXIuYWZmZWN0c0RhdGEpOwoKICAgICAgaWYgKG9sZFJhbmdlID09PSBudWxsKSB7CiAgICAgICAgLy8gSWYgdGhpcyBpcyBhIG5ldyBtYXJrZXIsIGFkZCBhIGxpc3RlbmVyIHRoYXQgd2lsbCBidWZmZXIgY2hhbmdlIHdoZW5ldmVyIG1hcmtlciBjaGFuZ2VzLgogICAgICAgIG1hcmtlci5vbignY2hhbmdlJywgKGV2dCwgb2xkUmFuZ2UpID0+IHsKICAgICAgICAgIHRoaXMuZGlmZmVyLmJ1ZmZlck1hcmtlckNoYW5nZShtYXJrZXIubmFtZSwgb2xkUmFuZ2UsIG1hcmtlci5nZXRSYW5nZSgpLCBtYXJrZXIuYWZmZWN0c0RhdGEpOwogICAgICAgIH0pOwogICAgICB9CiAgICB9KTsKICB9CiAgLyoqCiAgICogVGhlIGdyYXZleWFyZCB0cmVlIHJvb3QuIEEgZG9jdW1lbnQgYWx3YXlzIGhhcyBhIGdyYXZleWFyZCByb290IHRoYXQgc3RvcmVzIHJlbW92ZWQgbm9kZXMuCiAgICoKICAgKiBAcmVhZG9ubHkKICAgKiBAbWVtYmVyIHttb2R1bGU6ZW5naW5lL21vZGVsL3Jvb3RlbGVtZW50flJvb3RFbGVtZW50fQogICAqLwoKCiAgZ2V0IGdyYXZleWFyZCgpIHsKICAgIHJldHVybiB0aGlzLmdldFJvb3QoZ3JhdmV5YXJkTmFtZSk7CiAgfQogIC8qKgogICAqIENyZWF0ZXMgYSBuZXcgcm9vdC4KICAgKgogICAqIEBwYXJhbSB7U3RyaW5nfSBbZWxlbWVudE5hbWU9JyRyb290J10gVGhlIGVsZW1lbnQgbmFtZS4gRGVmYXVsdHMgdG8gYCckcm9vdCdgIHdoaWNoIGFsc28gaGFzIHNvbWUgYmFzaWMgc2NoZW1hIGRlZmluZWQKICAgKiAoYCRibG9ja2BzIGFyZSBhbGxvd2VkIGluc2lkZSB0aGUgYCRyb290YCkuIE1ha2Ugc3VyZSB0byBkZWZpbmUgYSBwcm9wZXIgc2NoZW1hIGlmIHlvdSB1c2UgYSBkaWZmZXJlbnQgbmFtZS4KICAgKiBAcGFyYW0ge1N0cmluZ30gW3Jvb3ROYW1lPSdtYWluJ10gQSB1bmlxdWUgcm9vdCBuYW1lLgogICAqIEByZXR1cm5zIHttb2R1bGU6ZW5naW5lL21vZGVsL3Jvb3RlbGVtZW50flJvb3RFbGVtZW50fSBUaGUgY3JlYXRlZCByb290LgogICAqLwoKCiAgY3JlYXRlUm9vdChlbGVtZW50TmFtZSA9ICckcm9vdCcsIHJvb3ROYW1lID0gJ21haW4nKSB7CiAgICBpZiAodGhpcy5yb290cy5nZXQocm9vdE5hbWUpKSB7CiAgICAgIC8qKgogICAgICAgKiBBIHJvb3Qgd2l0aCB0aGUgc3BlY2lmaWVkIG5hbWUgYWxyZWFkeSBleGlzdHMuCiAgICAgICAqCiAgICAgICAqIEBlcnJvciBtb2RlbC1kb2N1bWVudC1jcmVhdGVSb290LW5hbWUtZXhpc3RzCiAgICAgICAqIEBwYXJhbSB7bW9kdWxlOmVuZ2luZS9tb2RlbC9kb2N1bWVudH5Eb2N1bWVudH0gZG9jCiAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSBuYW1lCiAgICAgICAqLwogICAgICB0aHJvdyBuZXcgQ0tFZGl0b3JFcnJvcignbW9kZWwtZG9jdW1lbnQtY3JlYXRlUm9vdC1uYW1lLWV4aXN0czogUm9vdCB3aXRoIHNwZWNpZmllZCBuYW1lIGFscmVhZHkgZXhpc3RzLicsIHRoaXMsIHsKICAgICAgICBuYW1lOiByb290TmFtZQogICAgICB9KTsKICAgIH0KCiAgICBjb25zdCByb290ID0gbmV3IFJvb3RFbGVtZW50KHRoaXMsIGVsZW1lbnROYW1lLCByb290TmFtZSk7CiAgICB0aGlzLnJvb3RzLmFkZChyb290KTsKICAgIHJldHVybiByb290OwogIH0KICAvKioKICAgKiBSZW1vdmVzIGFsbCBldmVudCBsaXN0ZW5lcnMgc2V0IGJ5IHRoZSBkb2N1bWVudCBpbnN0YW5jZS4KICAgKi8KCgogIGRlc3Ryb3koKSB7CiAgICB0aGlzLnNlbGVjdGlvbi5kZXN0cm95KCk7CiAgICB0aGlzLnN0b3BMaXN0ZW5pbmcoKTsKICB9CiAgLyoqCiAgICogUmV0dXJucyBhIHJvb3QgYnkgaXRzIG5hbWUuCiAgICoKICAgKiBAcGFyYW0ge1N0cmluZ30gW25hbWU9J21haW4nXSBBIHVuaXF1ZSByb290IG5hbWUuCiAgICogQHJldHVybnMge21vZHVsZTplbmdpbmUvbW9kZWwvcm9vdGVsZW1lbnR+Um9vdEVsZW1lbnR8bnVsbH0gVGhlIHJvb3QgcmVnaXN0ZXJlZCB1bmRlciBhIGdpdmVuIG5hbWUgb3IgYG51bGxgIHdoZW4KICAgKiB0aGVyZSBpcyBubyByb290IHdpdGggdGhlIGdpdmVuIG5hbWUuCiAgICovCgoKICBnZXRSb290KG5hbWUgPSAnbWFpbicpIHsKICAgIHJldHVybiB0aGlzLnJvb3RzLmdldChuYW1lKTsKICB9CiAgLyoqCiAgICogUmV0dXJucyBhbiBhcnJheSB3aXRoIG5hbWVzIG9mIGFsbCByb290cyAod2l0aG91dCB0aGUge0BsaW5rICNncmF2ZXlhcmR9KSBhZGRlZCB0byB0aGUgZG9jdW1lbnQuCiAgICoKICAgKiBAcmV0dXJucyB7QXJyYXkuPFN0cmluZz59IFJvb3RzIG5hbWVzLgogICAqLwoKCiAgZ2V0Um9vdE5hbWVzKCkgewogICAgcmV0dXJuIEFycmF5LmZyb20odGhpcy5yb290cywgcm9vdCA9PiByb290LnJvb3ROYW1lKS5maWx0ZXIobmFtZSA9PiBuYW1lICE9IGdyYXZleWFyZE5hbWUpOwogIH0KICAvKioKICAgKiBVc2VkIHRvIHJlZ2lzdGVyIGEgcG9zdC1maXhlciBjYWxsYmFjay4gQSBwb3N0LWZpeGVyIG1lY2hhbmlzbSBndWFyYW50ZWVzIHRoYXQgdGhlIGZlYXR1cmVzCiAgICogd2lsbCBvcGVyYXRlIG9uIGEgY29ycmVjdCBtb2RlbCBzdGF0ZS4KICAgKgogICAqIEFuIGV4ZWN1dGlvbiBvZiBhIGZlYXR1cmUgbWF5IGxlYWQgdG8gYW4gaW5jb3JyZWN0IGRvY3VtZW50IHRyZWUgc3RhdGUuIFRoZSBjYWxsYmFja3MgYXJlIHVzZWQgdG8gZml4IHRoZSBkb2N1bWVudCB0cmVlIGFmdGVyCiAgICogaXQgaGFzIGNoYW5nZWQuIFBvc3QtZml4ZXJzIGFyZSBmaXJlZCBqdXN0IGFmdGVyIGFsbCBjaGFuZ2VzIGZyb20gdGhlIG91dGVybW9zdCBjaGFuZ2UgYmxvY2sgd2VyZSBhcHBsaWVkIGJ1dAogICAqIGJlZm9yZSB0aGUge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvZG9jdW1lbnR+RG9jdW1lbnQjZXZlbnQ6Y2hhbmdlIGNoYW5nZSBldmVudH0gaXMgZmlyZWQuIElmIGEgcG9zdC1maXhlciBjYWxsYmFjayBtYWRlCiAgICogYSBjaGFuZ2UsIGl0IHNob3VsZCByZXR1cm4gYHRydWVgLiBXaGVuIHRoaXMgaGFwcGVucywgYWxsIHBvc3QtZml4ZXJzIGFyZSBmaXJlZCBhZ2FpbiB0byBjaGVjayBpZiBzb21ldGhpbmcgZWxzZSBzaG91bGQKICAgKiBub3QgYmUgZml4ZWQgaW4gdGhlIG5ldyBkb2N1bWVudCB0cmVlIHN0YXRlLgogICAqCiAgICogQXMgYSBwYXJhbWV0ZXIsIGEgcG9zdC1maXhlciBjYWxsYmFjayByZWNlaXZlcyBhIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL3dyaXRlcn5Xcml0ZXIgd3JpdGVyfSBpbnN0YW5jZSBjb25uZWN0ZWQgd2l0aCB0aGUKICAgKiBleGVjdXRlZCBjaGFuZ2VzIGJsb2NrLiBUaGFua3MgdG8gdGhhdCwgYWxsIGNoYW5nZXMgZG9uZSBieSB0aGUgY2FsbGJhY2sgd2lsbCBiZSBhZGRlZCB0byB0aGUgc2FtZQogICAqIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL2JhdGNofkJhdGNoIGJhdGNofSAoYW5kIHVuZG8gc3RlcCkgYXMgdGhlIG9yaWdpbmFsIGNoYW5nZXMuIFRoaXMgbWFrZXMgcG9zdC1maXhlciBjaGFuZ2VzIHRyYW5zcGFyZW50CiAgICogZm9yIHRoZSB1c2VyLgogICAqCiAgICogQW4gZXhhbXBsZSBvZiBhIHBvc3QtZml4ZXIgaXMgYSBjYWxsYmFjayB0aGF0IGNoZWNrcyBpZiBhbGwgdGhlIGRhdGEgd2VyZSByZW1vdmVkIGZyb20gdGhlIGVkaXRvci4gSWYgc28sIHRoZQogICAqIGNhbGxiYWNrIHNob3VsZCBhZGQgYW4gZW1wdHkgcGFyYWdyYXBoIHNvIHRoYXQgdGhlIGVkaXRvciBpcyBuZXZlciBlbXB0eToKICAgKgogICAqCQlkb2N1bWVudC5yZWdpc3RlclBvc3RGaXhlciggd3JpdGVyID0+IHsKICAgKgkJCWNvbnN0IGNoYW5nZXMgPSBkb2N1bWVudC5kaWZmZXIuZ2V0Q2hhbmdlcygpOwogICAqCiAgICoJCQkvLyBDaGVjayBpZiB0aGUgY2hhbmdlcyBsZWFkIHRvIGFuIGVtcHR5IHJvb3QgaW4gdGhlIGVkaXRvci4KICAgKgkJCWZvciAoIGNvbnN0IGVudHJ5IG9mIGNoYW5nZXMgKSB7CiAgICoJCQkJaWYgKCBlbnRyeS50eXBlID09ICdyZW1vdmUnICYmIGVudHJ5LnBvc2l0aW9uLnJvb3QuaXNFbXB0eSApIHsKICAgKgkJCQkJd3JpdGVyLmluc2VydEVsZW1lbnQoICdwYXJhZ3JhcGgnLCBlbnRyeS5wb3NpdGlvbi5yb290LCAwICk7CiAgICoKICAgKgkJCQkJLy8gSXQgaXMgZmluZSB0byByZXR1cm4gZWFybHksIGV2ZW4gaWYgbXVsdGlwbGUgcm9vdHMgd291bGQgbmVlZCB0byBiZSBmaXhlZC4KICAgKgkJCQkJLy8gQWxsIHBvc3QtZml4ZXJzIHdpbGwgYmUgZmlyZWQgYWdhaW4sIHNvIGlmIHRoZXJlIGFyZSBtb3JlIGVtcHR5IHJvb3RzLCB0aG9zZSB3aWxsIGJlIGZpeGVkLCB0b28uCiAgICoJCQkJCXJldHVybiB0cnVlOwogICAqCQkJCX0KICAgKgkJCX0KICAgKgkJfSApOwogICAqCiAgICogQHBhcmFtIHtGdW5jdGlvbn0gcG9zdEZpeGVyCiAgICovCgoKICByZWdpc3RlclBvc3RGaXhlcihwb3N0Rml4ZXIpIHsKICAgIHRoaXMuX3Bvc3RGaXhlcnMuYWRkKHBvc3RGaXhlcik7CiAgfQogIC8qKgogICAqIEEgY3VzdG9tIGB0b0pTT04oKWAgbWV0aG9kIHRvIHNvbHZlIGNoaWxkLXBhcmVudCBjaXJjdWxhciBkZXBlbmRlbmNpZXMuCiAgICoKICAgKiBAcmV0dXJucyB7T2JqZWN0fSBBIGNsb25lIG9mIHRoaXMgb2JqZWN0IHdpdGggdGhlIGRvY3VtZW50IHByb3BlcnR5IGNoYW5nZWQgdG8gYSBzdHJpbmcuCiAgICovCgoKICB0b0pTT04oKSB7CiAgICBjb25zdCBqc29uID0gY2xvbmUodGhpcyk7IC8vIER1ZSB0byBjaXJjdWxhciByZWZlcmVuY2VzIHdlIG5lZWQgdG8gcmVtb3ZlIHBhcmVudCByZWZlcmVuY2UuCgogICAganNvbi5zZWxlY3Rpb24gPSAnW2VuZ2luZS5tb2RlbC5Eb2N1bWVudFNlbGVjdGlvbl0nOwogICAganNvbi5tb2RlbCA9ICdbZW5naW5lLm1vZGVsLk1vZGVsXSc7CiAgICByZXR1cm4ganNvbjsKICB9CiAgLyoqCiAgICogQ2hlY2sgaWYgdGhlcmUgd2VyZSBhbnkgY2hhbmdlcyBkb25lIG9uIGRvY3VtZW50LCBhbmQgaWYgc28sIGNhbGwgcG9zdC1maXhlcnMsCiAgICogZmlyZSBgY2hhbmdlYCBldmVudCBmb3IgZmVhdHVyZXMgYW5kIGNvbnZlcnNpb24gYW5kIHRoZW4gcmVzZXQgdGhlIGRpZmZlci4KICAgKiBGaXJlIGBjaGFuZ2U6ZGF0YWAgZXZlbnQgd2hlbiBhdCBsZWFzdCBvbmUgb3BlcmF0aW9uIG9yIGJ1ZmZlcmVkIG1hcmtlciBjaGFuZ2VzIHRoZSBkYXRhLgogICAqCiAgICogQHByb3RlY3RlZAogICAqIEBmaXJlcyBjaGFuZ2UKICAgKiBAZmlyZXMgY2hhbmdlOmRhdGEKICAgKiBAcGFyYW0ge21vZHVsZTplbmdpbmUvbW9kZWwvd3JpdGVyfldyaXRlcn0gd3JpdGVyIFRoZSB3cml0ZXIgb24gd2hpY2ggcG9zdC1maXhlcnMgd2lsbCBiZSBjYWxsZWQuCiAgICovCgoKICBfaGFuZGxlQ2hhbmdlQmxvY2sod3JpdGVyKSB7CiAgICBpZiAodGhpcy5faGFzRG9jdW1lbnRDaGFuZ2VkRnJvbVRoZUxhc3RDaGFuZ2VCbG9jaygpKSB7CiAgICAgIHRoaXMuX2NhbGxQb3N0Rml4ZXJzKHdyaXRlcik7IC8vIFJlZnJlc2ggc2VsZWN0aW9uIGF0dHJpYnV0ZXMgYWNjb3JkaW5nIHRvIHRoZSBmaW5hbCBwb3NpdGlvbiBpbiB0aGUgbW9kZWwgYWZ0ZXIgdGhlIGNoYW5nZS4KCgogICAgICB0aGlzLnNlbGVjdGlvbi5yZWZyZXNoKCk7CgogICAgICBpZiAodGhpcy5kaWZmZXIuaGFzRGF0YUNoYW5nZXMoKSkgewogICAgICAgIHRoaXMuZmlyZSgnY2hhbmdlOmRhdGEnLCB3cml0ZXIuYmF0Y2gpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuZmlyZSgnY2hhbmdlJywgd3JpdGVyLmJhdGNoKTsKICAgICAgfSAvLyBUaGVvcmV0aWNhbGx5LCBpdCBpcyBub3QgbmVjZXNzYXJ5IHRvIHJlZnJlc2ggc2VsZWN0aW9uIGFmdGVyIGNoYW5nZSBldmVudCBiZWNhdXNlCiAgICAgIC8vIHBvc3QtZml4ZXJzIGFyZSB0aGUgbGFzdCB3aG8gc2hvdWxkIGNoYW5nZSB0aGUgbW9kZWwsIGJ1dCBqdXN0IGluIGNhc2UuLi4KCgogICAgICB0aGlzLnNlbGVjdGlvbi5yZWZyZXNoKCk7CiAgICAgIHRoaXMuZGlmZmVyLnJlc2V0KCk7CiAgICB9CgogICAgdGhpcy5faGFzU2VsZWN0aW9uQ2hhbmdlZEZyb21UaGVMYXN0Q2hhbmdlQmxvY2sgPSBmYWxzZTsKICB9CiAgLyoqCiAgICogUmV0dXJucyB3aGV0aGVyIHRoZXJlIGlzIGEgYnVmZmVyZWQgY2hhbmdlIG9yIGlmIHRoZSBzZWxlY3Rpb24gaGFzIGNoYW5nZWQgZnJvbSB0aGUgbGFzdAogICAqIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL21vZGVsfk1vZGVsI2VucXVldWVDaGFuZ2UgYGVucXVldWVDaGFuZ2UoKWAgYmxvY2t9CiAgICogb3Ige0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvbW9kZWx+TW9kZWwjY2hhbmdlIGBjaGFuZ2UoKWAgYmxvY2t9LgogICAqCiAgICogQHByb3RlY3RlZAogICAqIEByZXR1cm5zIHtCb29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiBkb2N1bWVudCBoYXMgY2hhbmdlZCBmcm9tIHRoZSBsYXN0IGBjaGFuZ2UoKWAgb3IgYGVucXVldWVDaGFuZ2UoKWAgYmxvY2suCiAgICovCgoKICBfaGFzRG9jdW1lbnRDaGFuZ2VkRnJvbVRoZUxhc3RDaGFuZ2VCbG9jaygpIHsKICAgIHJldHVybiAhdGhpcy5kaWZmZXIuaXNFbXB0eSB8fCB0aGlzLl9oYXNTZWxlY3Rpb25DaGFuZ2VkRnJvbVRoZUxhc3RDaGFuZ2VCbG9jazsKICB9CiAgLyoqCiAgICogUmV0dXJucyB0aGUgZGVmYXVsdCByb290IGZvciB0aGlzIGRvY3VtZW50IHdoaWNoIGlzIGVpdGhlciB0aGUgZmlyc3Qgcm9vdCB0aGF0IHdhcyBhZGRlZCB0byB0aGUgZG9jdW1lbnQgdXNpbmcKICAgKiB7QGxpbmsgI2NyZWF0ZVJvb3R9IG9yIHRoZSB7QGxpbmsgI2dyYXZleWFyZCBncmF2ZXlhcmQgcm9vdH0gaWYgbm8gb3RoZXIgcm9vdHMgd2VyZSBjcmVhdGVkLgogICAqCiAgICogQHByb3RlY3RlZAogICAqIEByZXR1cm5zIHttb2R1bGU6ZW5naW5lL21vZGVsL3Jvb3RlbGVtZW50flJvb3RFbGVtZW50fSBUaGUgZGVmYXVsdCByb290IGZvciB0aGlzIGRvY3VtZW50LgogICAqLwoKCiAgX2dldERlZmF1bHRSb290KCkgewogICAgZm9yIChjb25zdCByb290IG9mIHRoaXMucm9vdHMpIHsKICAgICAgaWYgKHJvb3QgIT09IHRoaXMuZ3JhdmV5YXJkKSB7CiAgICAgICAgcmV0dXJuIHJvb3Q7CiAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gdGhpcy5ncmF2ZXlhcmQ7CiAgfQogIC8qKgogICAqIFJldHVybnMgdGhlIGRlZmF1bHQgcmFuZ2UgZm9yIHRoaXMgc2VsZWN0aW9uLiBUaGUgZGVmYXVsdCByYW5nZSBpcyBhIGNvbGxhcHNlZCByYW5nZSB0aGF0IHN0YXJ0cyBhbmQgZW5kcwogICAqIGF0IHRoZSBiZWdpbm5pbmcgb2YgdGhpcyBzZWxlY3Rpb24ncyBkb2N1bWVudCB7QGxpbmsgI19nZXREZWZhdWx0Um9vdCBkZWZhdWx0IHJvb3R9LgogICAqCiAgICogQHByb3RlY3RlZAogICAqIEByZXR1cm5zIHttb2R1bGU6ZW5naW5lL21vZGVsL3JhbmdlflJhbmdlfQogICAqLwoKCiAgX2dldERlZmF1bHRSYW5nZSgpIHsKICAgIGNvbnN0IGRlZmF1bHRSb290ID0gdGhpcy5fZ2V0RGVmYXVsdFJvb3QoKTsKCiAgICBjb25zdCBtb2RlbCA9IHRoaXMubW9kZWw7CiAgICBjb25zdCBzY2hlbWEgPSBtb2RlbC5zY2hlbWE7IC8vIEZpbmQgdGhlIGZpcnN0IHBvc2l0aW9uIHdoZXJlIHRoZSBzZWxlY3Rpb24gY2FuIGJlIHB1dC4KCiAgICBjb25zdCBwb3NpdGlvbiA9IG1vZGVsLmNyZWF0ZVBvc2l0aW9uRnJvbVBhdGgoZGVmYXVsdFJvb3QsIFswXSk7CiAgICBjb25zdCBuZWFyZXN0UmFuZ2UgPSBzY2hlbWEuZ2V0TmVhcmVzdFNlbGVjdGlvblJhbmdlKHBvc2l0aW9uKTsgLy8gSWYgdmFsaWQgc2VsZWN0aW9uIHJhbmdlIGlzIG5vdCBmb3VuZCAtIHJldHVybiByYW5nZSBjb2xsYXBzZWQgYXQgdGhlIGJlZ2lubmluZyBvZiB0aGUgcm9vdC4KCiAgICByZXR1cm4gbmVhcmVzdFJhbmdlIHx8IG1vZGVsLmNyZWF0ZVJhbmdlKHBvc2l0aW9uKTsKICB9CiAgLyoqCiAgICogQ2hlY2tzIHdoZXRoZXIgYSBnaXZlbiB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9yYW5nZX5SYW5nZSByYW5nZX0gaXMgYSB2YWxpZCByYW5nZSBmb3IKICAgKiB0aGUge0BsaW5rICNzZWxlY3Rpb24gZG9jdW1lbnQncyBzZWxlY3Rpb259LgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0ge21vZHVsZTplbmdpbmUvbW9kZWwvcmFuZ2V+UmFuZ2V9IHJhbmdlIEEgcmFuZ2UgdG8gY2hlY2suCiAgICogQHJldHVybnMge0Jvb2xlYW59IGB0cnVlYCBpZiBgcmFuZ2VgIGlzIHZhbGlkLCBgZmFsc2VgIG90aGVyd2lzZS4KICAgKi8KCgogIF92YWxpZGF0ZVNlbGVjdGlvblJhbmdlKHJhbmdlKSB7CiAgICByZXR1cm4gdmFsaWRhdGVUZXh0Tm9kZVBvc2l0aW9uKHJhbmdlLnN0YXJ0KSAmJiB2YWxpZGF0ZVRleHROb2RlUG9zaXRpb24ocmFuZ2UuZW5kKTsKICB9CiAgLyoqCiAgICogUGVyZm9ybXMgcG9zdC1maXhlciBsb29wcy4gRXhlY3V0ZXMgcG9zdC1maXhlciBjYWxsYmFja3MgYXMgbG9uZyBhcyBub25lIG9mIHRoZW0gaGFzIGRvbmUgYW55IGNoYW5nZXMgdG8gdGhlIG1vZGVsLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0ge21vZHVsZTplbmdpbmUvbW9kZWwvd3JpdGVyfldyaXRlcn0gd3JpdGVyIFRoZSB3cml0ZXIgb24gd2hpY2ggcG9zdC1maXhlciBjYWxsYmFja3Mgd2lsbCBiZSBjYWxsZWQuCiAgICovCgoKICBfY2FsbFBvc3RGaXhlcnMod3JpdGVyKSB7CiAgICBsZXQgd2FzRml4ZWQgPSBmYWxzZTsKCiAgICBkbyB7CiAgICAgIGZvciAoY29uc3QgY2FsbGJhY2sgb2YgdGhpcy5fcG9zdEZpeGVycykgewogICAgICAgIC8vIEVuc3VyZSBzZWxlY3Rpb24gYXR0cmlidXRlcyBhcmUgdXAgdG8gZGF0ZSBiZWZvcmUgZWFjaCBwb3N0LWZpeGVyLgogICAgICAgIC8vIGh0dHBzOi8vZ2l0aHViLmNvbS9ja2VkaXRvci9ja2VkaXRvcjUtZW5naW5lL2lzc3Vlcy8xNjczLgogICAgICAgIC8vCiAgICAgICAgLy8gSXQgbWlnaHQgYmUgZ29vZCB0byByZWZyZXNoIHRoZSBzZWxlY3Rpb24gYWZ0ZXIgZWFjaCBvcGVyYXRpb24gYnV0IGF0IHRoZSBtb21lbnQgaXQgbGVhZHMKICAgICAgICAvLyB0byBsb3NpbmcgYXR0cmlidXRlcyBmb3IgY29tcG9zaXRpb24gb3IgYW5kIHNwZWxsIGNoZWNraW5nCiAgICAgICAgLy8gaHR0cHM6Ly9naXRodWIuY29tL2NrZWRpdG9yL2NrZWRpdG9yNS10eXBpbmcvaXNzdWVzLzE4OAogICAgICAgIHRoaXMuc2VsZWN0aW9uLnJlZnJlc2goKTsKICAgICAgICB3YXNGaXhlZCA9IGNhbGxiYWNrKHdyaXRlcik7CgogICAgICAgIGlmICh3YXNGaXhlZCkgewogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICB9CiAgICB9IHdoaWxlICh3YXNGaXhlZCk7CiAgfQogIC8qKgogICAqIEZpcmVkIGFmdGVyIGVhY2gge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvbW9kZWx+TW9kZWwjZW5xdWV1ZUNoYW5nZSBgZW5xdWV1ZUNoYW5nZSgpYCBibG9ja30gb3IgdGhlIG91dGVybW9zdAogICAqIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL21vZGVsfk1vZGVsI2NoYW5nZSBgY2hhbmdlKClgIGJsb2NrfSB3YXMgZXhlY3V0ZWQgYW5kIHRoZSBkb2N1bWVudCB3YXMgY2hhbmdlZAogICAqIGR1cmluZyB0aGF0IGJsb2NrJ3MgZXhlY3V0aW9uLgogICAqCiAgICogVGhlIGNoYW5nZXMgd2hpY2ggdGhpcyBldmVudCB3aWxsIGNvdmVyIGluY2x1ZGU6CiAgICoKICAgKiAqIGRvY3VtZW50IHN0cnVjdHVyZSBjaGFuZ2VzLAogICAqICogc2VsZWN0aW9uIGNoYW5nZXMsCiAgICogKiBtYXJrZXIgY2hhbmdlcy4KICAgKgogICAqIElmIHlvdSB3YW50IHRvIGJlIG5vdGlmaWVkIGFib3V0IGFsbCB0aGVzZSBjaGFuZ2VzLCB0aGVuIHNpbXBseSBsaXN0ZW4gdG8gdGhpcyBldmVudCBsaWtlIHRoaXM6CiAgICoKICAgKgkJbW9kZWwuZG9jdW1lbnQub24oICdjaGFuZ2UnLCAoKSA9PiB7CiAgICoJCQljb25zb2xlLmxvZyggJ1RoZSBkb2N1bWVudCBoYXMgY2hhbmdlZCEnICk7CiAgICoJCX0gKTsKICAgKgogICAqIElmLCBob3dldmVyLCB5b3Ugb25seSB3YW50IHRvIGJlIG5vdGlmaWVkIGFib3V0IHRoZSBkYXRhIGNoYW5nZXMsIHRoZW4gdXNlIHRoZQogICAqIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL2RvY3VtZW50fkRvY3VtZW50I2V2ZW50OmNoYW5nZTpkYXRhIGNoYW5nZTpkYXRhfSBldmVudCwKICAgKiB3aGljaCBpcyBmaXJlZCBmb3IgZG9jdW1lbnQgc3RydWN0dXJlIGNoYW5nZXMgYW5kIG1hcmtlciBjaGFuZ2VzICh3aGljaCBhZmZlY3RzIHRoZSBkYXRhKS4KICAgKgogICAqCQltb2RlbC5kb2N1bWVudC5vbiggJ2NoYW5nZTpkYXRhJywgKCkgPT4gewogICAqCQkJY29uc29sZS5sb2coICdUaGUgZGF0YSBoYXMgY2hhbmdlZCEnICk7CiAgICoJCX0gKTsKICAgKgogICAqIEBldmVudCBjaGFuZ2UKICAgKiBAcGFyYW0ge21vZHVsZTplbmdpbmUvbW9kZWwvYmF0Y2h+QmF0Y2h9IGJhdGNoIFRoZSBiYXRjaCB0aGF0IHdhcyB1c2VkIGluIHRoZSBleGVjdXRlZCBjaGFuZ2VzIGJsb2NrLgogICAqLwoKICAvKioKICAgKiBJdCBpcyBhIG5hcnJvd2VyIHZlcnNpb24gb2YgdGhlIHtAbGluayAjZXZlbnQ6Y2hhbmdlfSBldmVudC4gSXQgaXMgZmlyZWQgZm9yIGNoYW5nZXMgd2hpY2gKICAgKiBhZmZlY3QgdGhlIGVkaXRvciBkYXRhLiBUaGlzIGlzOgogICAqCiAgICogKiBkb2N1bWVudCBzdHJ1Y3R1cmUgY2hhbmdlcywKICAgKiAqIG1hcmtlciBjaGFuZ2VzICh3aGljaCBhZmZlY3RzIHRoZSBkYXRhKS4KICAgKgogICAqIElmIHlvdSB3YW50IHRvIGJlIG5vdGlmaWVkIGFib3V0IHRoZSBkYXRhIGNoYW5nZXMsIHRoZW4gbGlzdGVuIHRvIHRoaXMgZXZlbnQ6CiAgICoKICAgKgkJbW9kZWwuZG9jdW1lbnQub24oICdjaGFuZ2U6ZGF0YScsICgpID0+IHsKICAgKgkJCWNvbnNvbGUubG9nKCAnVGhlIGRhdGEgaGFzIGNoYW5nZWQhJyApOwogICAqCQl9ICk7CiAgICoKICAgKiBJZiB5b3Ugd291bGQgbGlrZSB0byBsaXN0ZW4gdG8gYWxsIGRvY3VtZW50IGNoYW5nZXMsIHRoZW4gY2hlY2sgb3V0IHRoZQogICAqIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL2RvY3VtZW50fkRvY3VtZW50I2V2ZW50OmNoYW5nZSBjaGFuZ2V9IGV2ZW50LgogICAqCiAgICogQGV2ZW50IGNoYW5nZTpkYXRhCiAgICogQHBhcmFtIHttb2R1bGU6ZW5naW5lL21vZGVsL2JhdGNofkJhdGNofSBiYXRjaCBUaGUgYmF0Y2ggdGhhdCB3YXMgdXNlZCBpbiB0aGUgZXhlY3V0ZWQgY2hhbmdlcyBibG9jay4KICAgKi8KICAvLyBAaWYgQ0tfREVCVUdfRU5HSU5FIC8vIGxvZyggdmVyc2lvbiA9IG51bGwgKSB7CiAgLy8gQGlmIENLX0RFQlVHX0VOR0lORSAvLyAJdmVyc2lvbiA9IHZlcnNpb24gPT09IG51bGwgPyB0aGlzLnZlcnNpb24gOiB2ZXJzaW9uOwogIC8vIEBpZiBDS19ERUJVR19FTkdJTkUgLy8gCWxvZ0RvY3VtZW50KCB0aGlzLCB2ZXJzaW9uICk7CiAgLy8gQGlmIENLX0RFQlVHX0VOR0lORSAvLyB9CgoKfQptaXgoRG9jdW1lbnQsIEVtaXR0ZXJNaXhpbik7IC8vIENoZWNrcyB3aGV0aGVyIGdpdmVuIHJhbmdlIGJvdW5kYXJ5IHBvc2l0aW9uIGlzIHZhbGlkIGZvciBkb2N1bWVudCBzZWxlY3Rpb24sIG1lYW5pbmcgdGhhdCBpcyBub3QgYmV0d2VlbgovLyB1bmljb2RlIHN1cnJvZ2F0ZSBwYWlycyBvciBiYXNlIGNoYXJhY3RlciBhbmQgY29tYmluaW5nIG1hcmtzLgoKZnVuY3Rpb24gdmFsaWRhdGVUZXh0Tm9kZVBvc2l0aW9uKHJhbmdlQm91bmRhcnkpIHsKICBjb25zdCB0ZXh0Tm9kZSA9IHJhbmdlQm91bmRhcnkudGV4dE5vZGU7CgogIGlmICh0ZXh0Tm9kZSkgewogICAgY29uc3QgZGF0YSA9IHRleHROb2RlLmRhdGE7CiAgICBjb25zdCBvZmZzZXQgPSByYW5nZUJvdW5kYXJ5Lm9mZnNldCAtIHRleHROb2RlLnN0YXJ0T2Zmc2V0OwogICAgcmV0dXJuICFpc0luc2lkZVN1cnJvZ2F0ZVBhaXIoZGF0YSwgb2Zmc2V0KSAmJiAhaXNJbnNpZGVDb21iaW5lZFN5bWJvbChkYXRhLCBvZmZzZXQpOwogIH0KCiAgcmV0dXJuIHRydWU7Cn0="},{"version":3,"sources":["/Users/antonyching/Desktop/project/new-builder-demo/node_modules/@ckeditor/ckeditor5-engine/src/model/document.js"],"names":["Differ","RootElement","History","DocumentSelection","Collection","EmitterMixin","CKEditorError","mix","isInsideSurrogatePair","isInsideCombinedSymbol","clone","graveyardName","Document","constructor","model","version","history","selection","roots","idProperty","differ","markers","_postFixers","Set","_hasSelectionChangedFromTheLastChangeBlock","createRoot","listenTo","evt","args","operation","isDocumentOperation","baseVersion","priority","bufferOperation","addOperation","marker","oldRange","newRange","bufferMarkerChange","name","affectsData","on","getRange","graveyard","getRoot","elementName","rootName","get","root","add","destroy","stopListening","getRootNames","Array","from","filter","registerPostFixer","postFixer","toJSON","json","_handleChangeBlock","writer","_hasDocumentChangedFromTheLastChangeBlock","_callPostFixers","refresh","hasDataChanges","fire","batch","reset","isEmpty","_getDefaultRoot","_getDefaultRange","defaultRoot","schema","position","createPositionFromPath","nearestRange","getNearestSelectionRange","createRange","_validateSelectionRange","range","validateTextNodePosition","start","end","wasFixed","callback","rangeBoundary","textNode","data","offset","startOffset"],"mappings":"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","sourcesContent":["/**\n * @license Copyright (c) 2003-2019, CKSource - Frederico Knabben. All rights reserved.\n * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license\n */\n\n/**\n * @module engine/model/document\n */\n\nimport Differ from './differ';\nimport RootElement from './rootelement';\nimport History from './history';\nimport DocumentSelection from './documentselection';\nimport Collection from '@ckeditor/ckeditor5-utils/src/collection';\nimport EmitterMixin from '@ckeditor/ckeditor5-utils/src/emittermixin';\nimport CKEditorError from '@ckeditor/ckeditor5-utils/src/ckeditorerror';\nimport mix from '@ckeditor/ckeditor5-utils/src/mix';\nimport { isInsideSurrogatePair, isInsideCombinedSymbol } from '@ckeditor/ckeditor5-utils/src/unicode';\nimport { clone } from 'lodash-es';\n\n// @if CK_DEBUG_ENGINE // const { logDocument } = require( '../dev-utils/utils' );\n\nconst graveyardName = '$graveyard';\n\n/**\n * Data model's document. It contains the model's structure, its selection and the history of changes.\n *\n * Read more about working with the model in\n * {@glink framework/guides/architecture/editing-engine#model introduction to the the editing engine's architecture}.\n *\n * Usually, the document contains just one {@link module:engine/model/document~Document#roots root element}, so\n * you can retrieve it by just calling {@link module:engine/model/document~Document#getRoot} without specifying its name:\n *\n *\t\tmodel.document.getRoot(); // -> returns the main root\n *\n * However, the document may contain multiple roots – e.g. when the editor has multiple editable areas\n * (e.g. a title and a body of a message).\n *\n * @mixes module:utils/emittermixin~EmitterMixin\n */\nexport default class Document {\n\t/**\n\t * Creates an empty document instance with no {@link #roots} (other than\n\t * the {@link #graveyard graveyard root}).\n\t */\n\tconstructor( model ) {\n\t\t/**\n\t\t * The {@link module:engine/model/model~Model model} that the document is a part of.\n\t\t *\n\t\t * @readonly\n\t\t * @type {module:engine/model/model~Model}\n\t\t */\n\t\tthis.model = model;\n\n\t\t/**\n\t\t * The document version. It starts from `0` and every operation increases the version number. It is used to ensure that\n\t\t * operations are applied on a proper document version.\n\t\t *\n\t\t * If the {@link module:engine/model/operation/operation~Operation#baseVersion base version} does not match the document version,\n\t\t * a {@link module:utils/ckeditorerror~CKEditorError model-document-applyOperation-wrong-version} error is thrown.\n\t\t *\n\t\t * @readonly\n\t\t * @type {Number}\n\t\t */\n\t\tthis.version = 0;\n\n\t\t/**\n\t\t * The document's history.\n\t\t *\n\t\t * @readonly\n\t\t * @type {module:engine/model/history~History}\n\t\t */\n\t\tthis.history = new History( this );\n\n\t\t/**\n\t\t * The selection in this document.\n\t\t *\n\t\t * @readonly\n\t\t * @type {module:engine/model/documentselection~DocumentSelection}\n\t\t */\n\t\tthis.selection = new DocumentSelection( this );\n\n\t\t/**\n\t\t * A list of roots that are owned and managed by this document. Use {@link #createRoot} and\n\t\t * {@link #getRoot} to manipulate it.\n\t\t *\n\t\t * @readonly\n\t\t * @type {module:utils/collection~Collection}\n\t\t */\n\t\tthis.roots = new Collection( { idProperty: 'rootName' } );\n\n\t\t/**\n\t\t * The model differ object. Its role is to buffer changes done on the model document and then calculate a diff of those changes.\n\t\t *\n\t\t * @readonly\n\t\t * @type {module:engine/model/differ~Differ}\n\t\t */\n\t\tthis.differ = new Differ( model.markers );\n\n\t\t/**\n\t\t * Post-fixer callbacks registered to the model document.\n\t\t *\n\t\t * @private\n\t\t * @type {Set.<Function>}\n\t\t */\n\t\tthis._postFixers = new Set();\n\n\t\t/**\n\t\t * A boolean indicates whether the selection has changed until\n\t\t *\n\t\t * @private\n\t\t * @type {Boolean}\n\t\t */\n\t\tthis._hasSelectionChangedFromTheLastChangeBlock = false;\n\n\t\t// Graveyard tree root. Document always have a graveyard root, which stores removed nodes.\n\t\tthis.createRoot( '$root', graveyardName );\n\n\t\t// First, if the operation is a document operation check if it's base version is correct.\n\t\tthis.listenTo( model, 'applyOperation', ( evt, args ) => {\n\t\t\tconst operation = args[ 0 ];\n\n\t\t\tif ( operation.isDocumentOperation && operation.baseVersion !== this.version ) {\n\t\t\t\t/**\n\t\t\t\t * Only operations with matching versions can be applied.\n\t\t\t\t *\n\t\t\t\t * @error document-applyOperation-wrong-version\n\t\t\t\t * @param {module:engine/model/operation/operation~Operation} operation\n\t\t\t\t */\n\t\t\t\tthrow new CKEditorError(\n\t\t\t\t\t'model-document-applyOperation-wrong-version: Only operations with matching versions can be applied.',\n\t\t\t\t\tthis,\n\t\t\t\t\t{ operation }\n\t\t\t\t);\n\t\t\t}\n\t\t}, { priority: 'highest' } );\n\n\t\t// Then, still before an operation is applied on model, buffer the change in differ.\n\t\tthis.listenTo( model, 'applyOperation', ( evt, args ) => {\n\t\t\tconst operation = args[ 0 ];\n\n\t\t\tif ( operation.isDocumentOperation ) {\n\t\t\t\tthis.differ.bufferOperation( operation );\n\t\t\t}\n\t\t}, { priority: 'high' } );\n\n\t\t// After the operation is applied, bump document's version and add the operation to the history.\n\t\tthis.listenTo( model, 'applyOperation', ( evt, args ) => {\n\t\t\tconst operation = args[ 0 ];\n\n\t\t\tif ( operation.isDocumentOperation ) {\n\t\t\t\tthis.version++;\n\t\t\t\tthis.history.addOperation( operation );\n\t\t\t}\n\t\t}, { priority: 'low' } );\n\n\t\t// Listen to selection changes. If selection changed, mark it.\n\t\tthis.listenTo( this.selection, 'change', () => {\n\t\t\tthis._hasSelectionChangedFromTheLastChangeBlock = true;\n\t\t} );\n\n\t\t// Buffer marker changes.\n\t\t// This is not covered in buffering operations because markers may change outside of them (when they\n\t\t// are modified using `model.markers` collection, not through `MarkerOperation`).\n\t\tthis.listenTo( model.markers, 'update', ( evt, marker, oldRange, newRange ) => {\n\t\t\t// Whenever marker is updated, buffer that change.\n\t\t\tthis.differ.bufferMarkerChange( marker.name, oldRange, newRange, marker.affectsData );\n\n\t\t\tif ( oldRange === null ) {\n\t\t\t\t// If this is a new marker, add a listener that will buffer change whenever marker changes.\n\t\t\t\tmarker.on( 'change', ( evt, oldRange ) => {\n\t\t\t\t\tthis.differ.bufferMarkerChange( marker.name, oldRange, marker.getRange(), marker.affectsData );\n\t\t\t\t} );\n\t\t\t}\n\t\t} );\n\t}\n\n\t/**\n\t * The graveyard tree root. A document always has a graveyard root that stores removed nodes.\n\t *\n\t * @readonly\n\t * @member {module:engine/model/rootelement~RootElement}\n\t */\n\tget graveyard() {\n\t\treturn this.getRoot( graveyardName );\n\t}\n\n\t/**\n\t * Creates a new root.\n\t *\n\t * @param {String} [elementName='$root'] The element name. Defaults to `'$root'` which also has some basic schema defined\n\t * (`$block`s are allowed inside the `$root`). Make sure to define a proper schema if you use a different name.\n\t * @param {String} [rootName='main'] A unique root name.\n\t * @returns {module:engine/model/rootelement~RootElement} The created root.\n\t */\n\tcreateRoot( elementName = '$root', rootName = 'main' ) {\n\t\tif ( this.roots.get( rootName ) ) {\n\t\t\t/**\n\t\t\t * A root with the specified name already exists.\n\t\t\t *\n\t\t\t * @error model-document-createRoot-name-exists\n\t\t\t * @param {module:engine/model/document~Document} doc\n\t\t\t * @param {String} name\n\t\t\t */\n\t\t\tthrow new CKEditorError(\n\t\t\t\t'model-document-createRoot-name-exists: Root with specified name already exists.',\n\t\t\t\tthis,\n\t\t\t\t{ name: rootName }\n\t\t\t);\n\t\t}\n\n\t\tconst root = new RootElement( this, elementName, rootName );\n\t\tthis.roots.add( root );\n\n\t\treturn root;\n\t}\n\n\t/**\n\t * Removes all event listeners set by the document instance.\n\t */\n\tdestroy() {\n\t\tthis.selection.destroy();\n\t\tthis.stopListening();\n\t}\n\n\t/**\n\t * Returns a root by its name.\n\t *\n\t * @param {String} [name='main'] A unique root name.\n\t * @returns {module:engine/model/rootelement~RootElement|null} The root registered under a given name or `null` when\n\t * there is no root with the given name.\n\t */\n\tgetRoot( name = 'main' ) {\n\t\treturn this.roots.get( name );\n\t}\n\n\t/**\n\t * Returns an array with names of all roots (without the {@link #graveyard}) added to the document.\n\t *\n\t * @returns {Array.<String>} Roots names.\n\t */\n\tgetRootNames() {\n\t\treturn Array.from( this.roots, root => root.rootName ).filter( name => name != graveyardName );\n\t}\n\n\t/**\n\t * Used to register a post-fixer callback. A post-fixer mechanism guarantees that the features\n\t * will operate on a correct model state.\n\t *\n\t * An execution of a feature may lead to an incorrect document tree state. The callbacks are used to fix the document tree after\n\t * it has changed. Post-fixers are fired just after all changes from the outermost change block were applied but\n\t * before the {@link module:engine/model/document~Document#event:change change event} is fired. If a post-fixer callback made\n\t * a change, it should return `true`. When this happens, all post-fixers are fired again to check if something else should\n\t * not be fixed in the new document tree state.\n\t *\n\t * As a parameter, a post-fixer callback receives a {@link module:engine/model/writer~Writer writer} instance connected with the\n\t * executed changes block. Thanks to that, all changes done by the callback will be added to the same\n\t * {@link module:engine/model/batch~Batch batch} (and undo step) as the original changes. This makes post-fixer changes transparent\n\t * for the user.\n\t *\n\t * An example of a post-fixer is a callback that checks if all the data were removed from the editor. If so, the\n\t * callback should add an empty paragraph so that the editor is never empty:\n\t *\n\t *\t\tdocument.registerPostFixer( writer => {\n\t *\t\t\tconst changes = document.differ.getChanges();\n\t *\n\t *\t\t\t// Check if the changes lead to an empty root in the editor.\n\t *\t\t\tfor ( const entry of changes ) {\n\t *\t\t\t\tif ( entry.type == 'remove' && entry.position.root.isEmpty ) {\n\t *\t\t\t\t\twriter.insertElement( 'paragraph', entry.position.root, 0 );\n\t *\n\t *\t\t\t\t\t// It is fine to return early, even if multiple roots would need to be fixed.\n\t *\t\t\t\t\t// All post-fixers will be fired again, so if there are more empty roots, those will be fixed, too.\n\t *\t\t\t\t\treturn true;\n\t *\t\t\t\t}\n\t *\t\t\t}\n\t *\t\t} );\n\t *\n\t * @param {Function} postFixer\n\t */\n\tregisterPostFixer( postFixer ) {\n\t\tthis._postFixers.add( postFixer );\n\t}\n\n\t/**\n\t * A custom `toJSON()` method to solve child-parent circular dependencies.\n\t *\n\t * @returns {Object} A clone of this object with the document property changed to a string.\n\t */\n\ttoJSON() {\n\t\tconst json = clone( this );\n\n\t\t// Due to circular references we need to remove parent reference.\n\t\tjson.selection = '[engine.model.DocumentSelection]';\n\t\tjson.model = '[engine.model.Model]';\n\n\t\treturn json;\n\t}\n\n\t/**\n\t * Check if there were any changes done on document, and if so, call post-fixers,\n\t * fire `change` event for features and conversion and then reset the differ.\n\t * Fire `change:data` event when at least one operation or buffered marker changes the data.\n\t *\n\t * @protected\n\t * @fires change\n\t * @fires change:data\n\t * @param {module:engine/model/writer~Writer} writer The writer on which post-fixers will be called.\n\t */\n\t_handleChangeBlock( writer ) {\n\t\tif ( this._hasDocumentChangedFromTheLastChangeBlock() ) {\n\t\t\tthis._callPostFixers( writer );\n\n\t\t\t// Refresh selection attributes according to the final position in the model after the change.\n\t\t\tthis.selection.refresh();\n\n\t\t\tif ( this.differ.hasDataChanges() ) {\n\t\t\t\tthis.fire( 'change:data', writer.batch );\n\t\t\t} else {\n\t\t\t\tthis.fire( 'change', writer.batch );\n\t\t\t}\n\n\t\t\t// Theoretically, it is not necessary to refresh selection after change event because\n\t\t\t// post-fixers are the last who should change the model, but just in case...\n\t\t\tthis.selection.refresh();\n\n\t\t\tthis.differ.reset();\n\t\t}\n\n\t\tthis._hasSelectionChangedFromTheLastChangeBlock = false;\n\t}\n\n\t/**\n\t * Returns whether there is a buffered change or if the selection has changed from the last\n\t * {@link module:engine/model/model~Model#enqueueChange `enqueueChange()` block}\n\t * or {@link module:engine/model/model~Model#change `change()` block}.\n\t *\n\t * @protected\n\t * @returns {Boolean} Returns `true` if document has changed from the last `change()` or `enqueueChange()` block.\n\t */\n\t_hasDocumentChangedFromTheLastChangeBlock() {\n\t\treturn !this.differ.isEmpty || this._hasSelectionChangedFromTheLastChangeBlock;\n\t}\n\n\t/**\n\t * Returns the default root for this document which is either the first root that was added to the document using\n\t * {@link #createRoot} or the {@link #graveyard graveyard root} if no other roots were created.\n\t *\n\t * @protected\n\t * @returns {module:engine/model/rootelement~RootElement} The default root for this document.\n\t */\n\t_getDefaultRoot() {\n\t\tfor ( const root of this.roots ) {\n\t\t\tif ( root !== this.graveyard ) {\n\t\t\t\treturn root;\n\t\t\t}\n\t\t}\n\n\t\treturn this.graveyard;\n\t}\n\n\t/**\n\t * Returns the default range for this selection. The default range is a collapsed range that starts and ends\n\t * at the beginning of this selection's document {@link #_getDefaultRoot default root}.\n\t *\n\t * @protected\n\t * @returns {module:engine/model/range~Range}\n\t */\n\t_getDefaultRange() {\n\t\tconst defaultRoot = this._getDefaultRoot();\n\t\tconst model = this.model;\n\t\tconst schema = model.schema;\n\n\t\t// Find the first position where the selection can be put.\n\t\tconst position = model.createPositionFromPath( defaultRoot, [ 0 ] );\n\t\tconst nearestRange = schema.getNearestSelectionRange( position );\n\n\t\t// If valid selection range is not found - return range collapsed at the beginning of the root.\n\t\treturn nearestRange || model.createRange( position );\n\t}\n\n\t/**\n\t * Checks whether a given {@link module:engine/model/range~Range range} is a valid range for\n\t * the {@link #selection document's selection}.\n\t *\n\t * @private\n\t * @param {module:engine/model/range~Range} range A range to check.\n\t * @returns {Boolean} `true` if `range` is valid, `false` otherwise.\n\t */\n\t_validateSelectionRange( range ) {\n\t\treturn validateTextNodePosition( range.start ) && validateTextNodePosition( range.end );\n\t}\n\n\t/**\n\t * Performs post-fixer loops. Executes post-fixer callbacks as long as none of them has done any changes to the model.\n\t *\n\t * @private\n\t * @param {module:engine/model/writer~Writer} writer The writer on which post-fixer callbacks will be called.\n\t */\n\t_callPostFixers( writer ) {\n\t\tlet wasFixed = false;\n\n\t\tdo {\n\t\t\tfor ( const callback of this._postFixers ) {\n\t\t\t\t// Ensure selection attributes are up to date before each post-fixer.\n\t\t\t\t// https://github.com/ckeditor/ckeditor5-engine/issues/1673.\n\t\t\t\t//\n\t\t\t\t// It might be good to refresh the selection after each operation but at the moment it leads\n\t\t\t\t// to losing attributes for composition or and spell checking\n\t\t\t\t// https://github.com/ckeditor/ckeditor5-typing/issues/188\n\t\t\t\tthis.selection.refresh();\n\n\t\t\t\twasFixed = callback( writer );\n\n\t\t\t\tif ( wasFixed ) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t} while ( wasFixed );\n\t}\n\n\t/**\n\t * Fired after each {@link module:engine/model/model~Model#enqueueChange `enqueueChange()` block} or the outermost\n\t * {@link module:engine/model/model~Model#change `change()` block} was executed and the document was changed\n\t * during that block's execution.\n\t *\n\t * The changes which this event will cover include:\n\t *\n\t * * document structure changes,\n\t * * selection changes,\n\t * * marker changes.\n\t *\n\t * If you want to be notified about all these changes, then simply listen to this event like this:\n\t *\n\t *\t\tmodel.document.on( 'change', () => {\n\t *\t\t\tconsole.log( 'The document has changed!' );\n\t *\t\t} );\n\t *\n\t * If, however, you only want to be notified about the data changes, then use the\n\t * {@link module:engine/model/document~Document#event:change:data change:data} event,\n\t * which is fired for document structure changes and marker changes (which affects the data).\n\t *\n\t *\t\tmodel.document.on( 'change:data', () => {\n\t *\t\t\tconsole.log( 'The data has changed!' );\n\t *\t\t} );\n\t *\n\t * @event change\n\t * @param {module:engine/model/batch~Batch} batch The batch that was used in the executed changes block.\n\t */\n\n\t/**\n\t * It is a narrower version of the {@link #event:change} event. It is fired for changes which\n\t * affect the editor data. This is:\n\t *\n\t * * document structure changes,\n\t * * marker changes (which affects the data).\n\t *\n\t * If you want to be notified about the data changes, then listen to this event:\n\t *\n\t *\t\tmodel.document.on( 'change:data', () => {\n\t *\t\t\tconsole.log( 'The data has changed!' );\n\t *\t\t} );\n\t *\n\t * If you would like to listen to all document changes, then check out the\n\t * {@link module:engine/model/document~Document#event:change change} event.\n\t *\n\t * @event change:data\n\t * @param {module:engine/model/batch~Batch} batch The batch that was used in the executed changes block.\n\t */\n\n\t// @if CK_DEBUG_ENGINE // log( version = null ) {\n\t// @if CK_DEBUG_ENGINE // \tversion = version === null ? this.version : version;\n\t// @if CK_DEBUG_ENGINE // \tlogDocument( this, version );\n\t// @if CK_DEBUG_ENGINE // }\n}\n\nmix( Document, EmitterMixin );\n\n// Checks whether given range boundary position is valid for document selection, meaning that is not between\n// unicode surrogate pairs or base character and combining marks.\nfunction validateTextNodePosition( rangeBoundary ) {\n\tconst textNode = rangeBoundary.textNode;\n\n\tif ( textNode ) {\n\t\tconst data = textNode.data;\n\t\tconst offset = rangeBoundary.offset - textNode.startOffset;\n\n\t\treturn !isInsideSurrogatePair( data, offset ) && !isInsideCombinedSymbol( data, offset );\n\t}\n\n\treturn true;\n}\n"]}]}
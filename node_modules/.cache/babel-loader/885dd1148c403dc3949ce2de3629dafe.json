{"remainingRequest":"/Users/antonyching/Desktop/project/new-builder-demo/node_modules/babel-loader/lib/index.js!/Users/antonyching/Desktop/project/new-builder-demo/node_modules/@ckeditor/ckeditor5-typing/src/utils/injecttypingmutationshandling.js","dependencies":[{"path":"/Users/antonyching/Desktop/project/new-builder-demo/node_modules/@ckeditor/ckeditor5-typing/src/utils/injecttypingmutationshandling.js","mtime":499162500000},{"path":"/Users/antonyching/Desktop/project/new-builder-demo/node_modules/@ckeditor/ckeditor5-dev-webpack-plugin/lib/translatesourceloader.js","mtime":499162500000},{"path":"/Users/antonyching/Desktop/project/new-builder-demo/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/antonyching/Desktop/project/new-builder-demo/node_modules/babel-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:LyoqCiAqIEBsaWNlbnNlIENvcHlyaWdodCAoYykgMjAwMy0yMDE5LCBDS1NvdXJjZSAtIEZyZWRlcmljbyBLbmFiYmVuLiBBbGwgcmlnaHRzIHJlc2VydmVkLgogKiBGb3IgbGljZW5zaW5nLCBzZWUgTElDRU5TRS5tZCBvciBodHRwczovL2NrZWRpdG9yLmNvbS9sZWdhbC9ja2VkaXRvci1vc3MtbGljZW5zZQogKi8KCi8qKgogKiBAbW9kdWxlIHR5cGluZy91dGlscy9pbmplY3R0eXBpbmdtdXRhdGlvbnNoYW5kbGluZwogKi8KaW1wb3J0IGRpZmYgZnJvbSAnQGNrZWRpdG9yL2NrZWRpdG9yNS11dGlscy9zcmMvZGlmZic7CmltcG9ydCBEb21Db252ZXJ0ZXIgZnJvbSAnQGNrZWRpdG9yL2NrZWRpdG9yNS1lbmdpbmUvc3JjL3ZpZXcvZG9tY29udmVydGVyJzsKaW1wb3J0IHsgZ2V0U2luZ2xlVGV4dE5vZGVDaGFuZ2UsIGNvbnRhaW5lckNoaWxkcmVuTXV0YXRlZCB9IGZyb20gJy4vdXRpbHMnOwovKioKICogSGFuZGxlcyBtdXRhdGlvbnMgY2F1c2VkIGJ5IG5vcm1hbCB0eXBpbmcuCiAqCiAqIEBwYXJhbSB7bW9kdWxlOmNvcmUvZWRpdG9yL2VkaXRvcn5FZGl0b3J9IGVkaXRvciBUaGUgZWRpdG9yIGluc3RhbmNlLgogKi8KCmV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIGluamVjdFR5cGluZ011dGF0aW9uc0hhbmRsaW5nKGVkaXRvcikgewogIGVkaXRvci5lZGl0aW5nLnZpZXcuZG9jdW1lbnQub24oJ211dGF0aW9ucycsIChldnQsIG11dGF0aW9ucywgdmlld1NlbGVjdGlvbikgPT4gewogICAgbmV3IE11dGF0aW9uSGFuZGxlcihlZGl0b3IpLmhhbmRsZShtdXRhdGlvbnMsIHZpZXdTZWxlY3Rpb24pOwogIH0pOwp9Ci8qKgogKiBIZWxwZXIgY2xhc3MgZm9yIHRyYW5zbGF0aW5nIERPTSBtdXRhdGlvbnMgaW50byBtb2RlbCBjaGFuZ2VzLgogKgogKiBAcHJpdmF0ZQogKi8KCmNsYXNzIE11dGF0aW9uSGFuZGxlciB7CiAgLyoqCiAgICogQ3JlYXRlcyBhbiBpbnN0YW5jZSBvZiB0aGUgbXV0YXRpb24gaGFuZGxlci4KICAgKgogICAqIEBwYXJhbSB7bW9kdWxlOmNvcmUvZWRpdG9yL2VkaXRvcn5FZGl0b3J9IGVkaXRvcgogICAqLwogIGNvbnN0cnVjdG9yKGVkaXRvcikgewogICAgLyoqCiAgICAgKiBFZGl0b3IgaW5zdGFuY2UgZm9yIHdoaWNoIG11dGF0aW9ucyBhcmUgaGFuZGxlZC4KICAgICAqCiAgICAgKiBAcmVhZG9ubHkKICAgICAqIEBtZW1iZXIge21vZHVsZTpjb3JlL2VkaXRvci9lZGl0b3J+RWRpdG9yfSAjZWRpdG9yCiAgICAgKi8KICAgIHRoaXMuZWRpdG9yID0gZWRpdG9yOwogICAgLyoqCiAgICAgKiBUaGUgZWRpdGluZyBjb250cm9sbGVyLgogICAgICoKICAgICAqIEByZWFkb25seQogICAgICogQG1lbWJlciB7bW9kdWxlOmVuZ2luZS9jb250cm9sbGVyL2VkaXRpbmdjb250cm9sbGVyfkVkaXRpbmdDb250cm9sbGVyfSAjZWRpdGluZwogICAgICovCgogICAgdGhpcy5lZGl0aW5nID0gdGhpcy5lZGl0b3IuZWRpdGluZzsKICB9CiAgLyoqCiAgICogSGFuZGxlcyBnaXZlbiBtdXRhdGlvbnMuCiAgICoKICAgKiBAcGFyYW0ge0FycmF5Ljxtb2R1bGU6ZW5naW5lL3ZpZXcvb2JzZXJ2ZXIvbXV0YXRpb25vYnNlcnZlcn5NdXRhdGVkVGV4dHwKICAgKiBtb2R1bGU6ZW5naW5lL3ZpZXcvb2JzZXJ2ZXIvbXV0YXRpb25vYnNlcnZlcn5NdXRhdGVkQ2hpbGRyZW4+fSBtdXRhdGlvbnMKICAgKiBAcGFyYW0ge21vZHVsZTplbmdpbmUvdmlldy9zZWxlY3Rpb25+U2VsZWN0aW9ufG51bGx9IHZpZXdTZWxlY3Rpb24KICAgKi8KCgogIGhhbmRsZShtdXRhdGlvbnMsIHZpZXdTZWxlY3Rpb24pIHsKICAgIGlmIChjb250YWluZXJDaGlsZHJlbk11dGF0ZWQobXV0YXRpb25zKSkgewogICAgICB0aGlzLl9oYW5kbGVDb250YWluZXJDaGlsZHJlbk11dGF0aW9ucyhtdXRhdGlvbnMsIHZpZXdTZWxlY3Rpb24pOwogICAgfSBlbHNlIHsKICAgICAgZm9yIChjb25zdCBtdXRhdGlvbiBvZiBtdXRhdGlvbnMpIHsKICAgICAgICAvLyBGb3J0dW5hdGVseSBpdCB3aWxsIG5ldmVyIGJlIGJvdGguCiAgICAgICAgdGhpcy5faGFuZGxlVGV4dE11dGF0aW9uKG11dGF0aW9uLCB2aWV3U2VsZWN0aW9uKTsKCiAgICAgICAgdGhpcy5faGFuZGxlVGV4dE5vZGVJbnNlcnRpb24obXV0YXRpb24pOwogICAgICB9CiAgICB9CiAgfQogIC8qKgogICAqIEhhbmRsZXMgc2l0dWF0aW9ucyB3aGVuIGNvbnRhaW5lcidzIGNoaWxkcmVuIG11dGF0ZWQgZHVyaW5nIGlucHV0LiBUaGlzIGNhbiBoYXBwZW4gd2hlbgogICAqIHRoZSBicm93c2VyIGlzIHRyeWluZyB0byAiZml4IiBET00gaW4gY2VydGFpbiBzaXR1YXRpb25zLiBGb3IgZXhhbXBsZSwgd2hlbiB0aGUgdXNlciBzdGFydHMgdG8gdHlwZQogICAqIGluIGA8cD48YSBocmVmPSIiPjxpPkxpbmt7fTwvaT48L2E+PC9wPmAsIHRoZSBicm93c2VyIG1pZ2h0IGNoYW5nZSB0aGUgb3JkZXIgb2YgZWxlbWVudHMKICAgKiB0byBgPHA+PGk+PGEgaHJlZj0iIj5MaW5rPC9hPnh7fTwvaT48L3A+YC4gQSBzaW1pbGFyIHNpdHVhdGlvbiBoYXBwZW5zIHdoZW4gdGhlIHNwZWxsIGNoZWNrZXIKICAgKiByZXBsYWNlcyBhIHdvcmQgd3JhcHBlZCB3aXRoIGA8c3Ryb25nPmAgd2l0aCBhIHdvcmQgd3JhcHBlZCB3aXRoIGEgYDxiPmAgZWxlbWVudC4KICAgKgogICAqIFRvIGhhbmRsZSBzdWNoIHNpdHVhdGlvbnMsIHRoZSBjb21tb24gRE9NIGFuY2VzdG9yIG9mIGFsbCBtdXRhdGlvbnMgaXMgY29udmVydGVkIHRvIHRoZSBtb2RlbCByZXByZXNlbnRhdGlvbgogICAqIGFuZCB0aGVuIGNvbXBhcmVkIHdpdGggdGhlIGN1cnJlbnQgbW9kZWwgdG8gY2FsY3VsYXRlIHRoZSBwcm9wZXIgdGV4dCBjaGFuZ2UuCiAgICoKICAgKiBOb3RlOiBTaW5nbGUgdGV4dCBub2RlIGluc2VydGlvbiBpcyBoYW5kbGVkIGluIHtAbGluayAjX2hhbmRsZVRleHROb2RlSW5zZXJ0aW9ufSBhbmQgdGV4dCBub2RlIG11dGF0aW9uIGlzIGhhbmRsZWQKICAgKiBpbiB7QGxpbmsgI19oYW5kbGVUZXh0TXV0YXRpb259KS4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHtBcnJheS48bW9kdWxlOmVuZ2luZS92aWV3L29ic2VydmVyL211dGF0aW9ub2JzZXJ2ZXJ+TXV0YXRlZFRleHR8CiAgICogbW9kdWxlOmVuZ2luZS92aWV3L29ic2VydmVyL211dGF0aW9ub2JzZXJ2ZXJ+TXV0YXRlZENoaWxkcmVuPn0gbXV0YXRpb25zCiAgICogQHBhcmFtIHttb2R1bGU6ZW5naW5lL3ZpZXcvc2VsZWN0aW9uflNlbGVjdGlvbnxudWxsfSB2aWV3U2VsZWN0aW9uCiAgICovCgoKICBfaGFuZGxlQ29udGFpbmVyQ2hpbGRyZW5NdXRhdGlvbnMobXV0YXRpb25zLCB2aWV3U2VsZWN0aW9uKSB7CiAgICAvLyBHZXQgY29tbW9uIGFuY2VzdG9yIG9mIGFsbCBtdXRhdGlvbnMuCiAgICBjb25zdCBtdXRhdGlvbnNDb21tb25BbmNlc3RvciA9IGdldE11dGF0aW9uc0NvbnRhaW5lcihtdXRhdGlvbnMpOyAvLyBRdWl0IGlmIHRoZXJlIGlzIG5vIGNvbW1vbiBhbmNlc3Rvci4KCiAgICBpZiAoIW11dGF0aW9uc0NvbW1vbkFuY2VzdG9yKSB7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICBjb25zdCBkb21Db252ZXJ0ZXIgPSB0aGlzLmVkaXRvci5lZGl0aW5nLnZpZXcuZG9tQ29udmVydGVyOyAvLyBHZXQgY29tbW9uIGFuY2VzdG9yIGluIERPTS4KCiAgICBjb25zdCBkb21NdXRhdGlvbkNvbW1vbkFuY2VzdG9yID0gZG9tQ29udmVydGVyLm1hcFZpZXdUb0RvbShtdXRhdGlvbnNDb21tb25BbmNlc3Rvcik7IC8vIENyZWF0ZSBmcmVzaCBEb21Db252ZXJ0ZXIgc28gaXQgd2lsbCBub3QgdXNlIGV4aXN0aW5nIG1hcHBpbmcgYW5kIGNvbnZlcnQgY3VycmVudCBET00gdG8gbW9kZWwuCiAgICAvLyBUaGlzIHdvdWxkbid0IGJlIG5lZWRlZCBpZiBEb21Db252ZXJ0ZXIgd291bGQgYWxsb3cgdG8gY3JlYXRlIGZyZXNoIHZpZXcgd2l0aG91dCBjaGVja2luZyBhbnkgbWFwcGluZ3MuCgogICAgY29uc3QgZnJlc2hEb21Db252ZXJ0ZXIgPSBuZXcgRG9tQ29udmVydGVyKCk7CiAgICBjb25zdCBtb2RlbEZyb21DdXJyZW50RG9tID0gdGhpcy5lZGl0b3IuZGF0YS50b01vZGVsKGZyZXNoRG9tQ29udmVydGVyLmRvbVRvVmlldyhkb21NdXRhdGlvbkNvbW1vbkFuY2VzdG9yKSkuZ2V0Q2hpbGQoMCk7IC8vIEN1cnJlbnQgbW9kZWwuCgogICAgY29uc3QgY3VycmVudE1vZGVsID0gdGhpcy5lZGl0b3IuZWRpdGluZy5tYXBwZXIudG9Nb2RlbEVsZW1lbnQobXV0YXRpb25zQ29tbW9uQW5jZXN0b3IpOyAvLyBJZiBjb21tb24gYW5jZXN0b3IgaXMgbm90IG1hcHBlZCwgZG8gbm90IGRvIGFueXRoaW5nLiBJdCBwcm9iYWJseSBpcyBhIHBhcmVudCBvZiBhbm90aGVyIHZpZXcgZWxlbWVudC4KICAgIC8vIFRoYXQgbWVhbnMgdGhhdCB3ZSB3b3VsZCBuZWVkIHRvIGRpZmYgbW9kZWwgZWxlbWVudHMgKHNlZSBgaWZgIGJlbG93KS4gQmV0dGVyIHJldHVybiBlYXJseSBpbnN0ZWFkIG9mCiAgICAvLyB0cnlpbmcgdG8gZ2V0IGEgcmVhc29uYWJsZSBtb2RlbCBhbmNlc3Rvci4gSXQgd2lsbCBmZWxsIGludG8gdGhlIGBpZmAgYmVsb3cgYW55d2F5LgogICAgLy8gVGhpcyBzaXR1YXRpb24gaGFwcGVucyBmb3IgZXhhbXBsZSBmb3IgbGlzdHMuIElmIGA8dWw+YCBpcyBhIGNvbW1vbiBhbmNlc3RvciwgYGN1cnJlbnRNb2RlbGAgaXMgYHVuZGVmaW5lZGAKICAgIC8vIGJlY2F1c2UgYDx1bD5gIGlzIG5vdCBtYXBwZWQgKGA8bGk+YHMgYXJlKS4KICAgIC8vIFNlZSBodHRwczovL2dpdGh1Yi5jb20vY2tlZGl0b3IvY2tlZGl0b3I1L2lzc3Vlcy83MTguCgogICAgaWYgKCFjdXJyZW50TW9kZWwpIHsKICAgICAgcmV0dXJuOwogICAgfSAvLyBHZXQgY2hpbGRyZW4gZnJvbSBib3RoIGFuY2VzdG9ycy4KCgogICAgY29uc3QgbW9kZWxGcm9tRG9tQ2hpbGRyZW4gPSBBcnJheS5mcm9tKG1vZGVsRnJvbUN1cnJlbnREb20uZ2V0Q2hpbGRyZW4oKSk7CiAgICBjb25zdCBjdXJyZW50TW9kZWxDaGlsZHJlbiA9IEFycmF5LmZyb20oY3VycmVudE1vZGVsLmdldENoaWxkcmVuKCkpOyAvLyBSZW1vdmUgdGhlIGxhc3QgYDxzb2Z0QnJlYWs+YCBmcm9tIHRoZSBlbmQgb2YgYG1vZGVsRnJvbURvbUNoaWxkcmVuYCBpZiB0aGVyZSBpcyBubyBgPHNvZnRCcmVhaz5gIGluIGN1cnJlbnQgbW9kZWwuCiAgICAvLyBJZiB0aGUgZGVzY3JpYmVkIHNjZW5hcmlvIGhhcHBlbmVkLCBpdCBtZWFucyB0aGF0IHRoaXMgaXMgYSBib2d1cyBgPGJyIC8+YCBhZGRlZCBieSBhIGJyb3dzZXIuCgogICAgY29uc3QgbGFzdERvbUNoaWxkID0gbW9kZWxGcm9tRG9tQ2hpbGRyZW5bbW9kZWxGcm9tRG9tQ2hpbGRyZW4ubGVuZ3RoIC0gMV07CiAgICBjb25zdCBsYXN0Q3VycmVudENoaWxkID0gY3VycmVudE1vZGVsQ2hpbGRyZW5bY3VycmVudE1vZGVsQ2hpbGRyZW4ubGVuZ3RoIC0gMV07CgogICAgaWYgKGxhc3REb21DaGlsZCAmJiBsYXN0RG9tQ2hpbGQuaXMoJ3NvZnRCcmVhaycpICYmIGxhc3RDdXJyZW50Q2hpbGQgJiYgIWxhc3RDdXJyZW50Q2hpbGQuaXMoJ3NvZnRCcmVhaycpKSB7CiAgICAgIG1vZGVsRnJvbURvbUNoaWxkcmVuLnBvcCgpOwogICAgfQoKICAgIGNvbnN0IHNjaGVtYSA9IHRoaXMuZWRpdG9yLm1vZGVsLnNjaGVtYTsgLy8gU2tpcCBzaXR1YXRpb25zIHdoZW4gY29tbW9uIGFuY2VzdG9yIGhhcyBhbnkgY29udGFpbmVyIGVsZW1lbnRzLgoKICAgIGlmICghaXNTYWZlRm9yVGV4dE11dGF0aW9uKG1vZGVsRnJvbURvbUNoaWxkcmVuLCBzY2hlbWEpIHx8ICFpc1NhZmVGb3JUZXh0TXV0YXRpb24oY3VycmVudE1vZGVsQ2hpbGRyZW4sIHNjaGVtYSkpIHsKICAgICAgcmV0dXJuOwogICAgfSAvLyBSZXBsYWNlICZuYnNwOyBpbnNlcnRlZCBieSB0aGUgYnJvd3NlciB3aXRoIG5vcm1hbCBzcGFjZS4gU2VlIGNvbW1lbnQgaW4gYF9oYW5kbGVUZXh0TXV0YXRpb25gLgogICAgLy8gUmVwbGFjZSBub24tdGV4dHMgd2l0aCBhbnkgY2hhcmFjdGVyLiBUaGlzIGlzIHBvdGVudGlhbGx5IGRhbmdlcm91cyBidXQgcGFzc2VzIGluIG1hbnVhbCB0ZXN0cy4gVGhlIHRoaW5nIGlzCiAgICAvLyB0aGF0IHdlIG5lZWQgdG8gdGFrZSBjYXJlIG9mIHByb3BlciBpbmRleGVzIHNvIHdlIGNhbm5vdCBzaW1wbHkgcmVtb3ZlIG5vbi10ZXh0IGVsZW1lbnRzIGZyb20gdGhlIGNvbnRlbnQuCiAgICAvLyBCeSBpbnNlcnRpbmcgYSBjaGFyYWN0ZXIgd2Uga2VlcCBhbGwgdGhlIHJlYWwgdGV4dHMgb24gdGhlaXIgaW5kZXhlcy4KCgogICAgY29uc3QgbmV3VGV4dCA9IG1vZGVsRnJvbURvbUNoaWxkcmVuLm1hcChpdGVtID0+IGl0ZW0uaXMoJ3RleHQnKSA/IGl0ZW0uZGF0YSA6ICdAJykuam9pbignJykucmVwbGFjZSgvXHUwMEEwL2csICcgJyk7CiAgICBjb25zdCBvbGRUZXh0ID0gY3VycmVudE1vZGVsQ2hpbGRyZW4ubWFwKGl0ZW0gPT4gaXRlbS5pcygndGV4dCcpID8gaXRlbS5kYXRhIDogJ0AnKS5qb2luKCcnKS5yZXBsYWNlKC9cdTAwQTAvZywgJyAnKTsgLy8gRG8gbm90aGluZyBpZiBtdXRhdGlvbnMgY3JlYXRlZCBzYW1lIHRleHQuCgogICAgaWYgKG9sZFRleHQgPT09IG5ld1RleHQpIHsKICAgICAgcmV0dXJuOwogICAgfQoKICAgIGNvbnN0IGRpZmZSZXN1bHQgPSBkaWZmKG9sZFRleHQsIG5ld1RleHQpOwogICAgY29uc3QgewogICAgICBmaXJzdENoYW5nZUF0LAogICAgICBpbnNlcnRpb25zLAogICAgICBkZWxldGlvbnMKICAgIH0gPSBjYWxjdWxhdGVDaGFuZ2VzKGRpZmZSZXN1bHQpOyAvLyBUcnkgc2V0dGluZyBuZXcgbW9kZWwgc2VsZWN0aW9uIGFjY29yZGluZyB0byBwYXNzZWQgdmlldyBzZWxlY3Rpb24uCgogICAgbGV0IG1vZGVsU2VsZWN0aW9uUmFuZ2UgPSBudWxsOwoKICAgIGlmICh2aWV3U2VsZWN0aW9uKSB7CiAgICAgIG1vZGVsU2VsZWN0aW9uUmFuZ2UgPSB0aGlzLmVkaXRpbmcubWFwcGVyLnRvTW9kZWxSYW5nZSh2aWV3U2VsZWN0aW9uLmdldEZpcnN0UmFuZ2UoKSk7CiAgICB9CgogICAgY29uc3QgaW5zZXJ0VGV4dCA9IG5ld1RleHQuc3Vic3RyKGZpcnN0Q2hhbmdlQXQsIGluc2VydGlvbnMpOwogICAgY29uc3QgcmVtb3ZlUmFuZ2UgPSB0aGlzLmVkaXRvci5tb2RlbC5jcmVhdGVSYW5nZSh0aGlzLmVkaXRvci5tb2RlbC5jcmVhdGVQb3NpdGlvbkF0KGN1cnJlbnRNb2RlbCwgZmlyc3RDaGFuZ2VBdCksIHRoaXMuZWRpdG9yLm1vZGVsLmNyZWF0ZVBvc2l0aW9uQXQoY3VycmVudE1vZGVsLCBmaXJzdENoYW5nZUF0ICsgZGVsZXRpb25zKSk7CiAgICB0aGlzLmVkaXRvci5leGVjdXRlKCdpbnB1dCcsIHsKICAgICAgdGV4dDogaW5zZXJ0VGV4dCwKICAgICAgcmFuZ2U6IHJlbW92ZVJhbmdlLAogICAgICByZXN1bHRSYW5nZTogbW9kZWxTZWxlY3Rpb25SYW5nZQogICAgfSk7CiAgfQogIC8qKgogICAqIEBwcml2YXRlCiAgICovCgoKICBfaGFuZGxlVGV4dE11dGF0aW9uKG11dGF0aW9uLCB2aWV3U2VsZWN0aW9uKSB7CiAgICBpZiAobXV0YXRpb24udHlwZSAhPSAndGV4dCcpIHsKICAgICAgcmV0dXJuOwogICAgfSAvLyBSZXBsYWNlICZuYnNwOyBpbnNlcnRlZCBieSB0aGUgYnJvd3NlciB3aXRoIG5vcm1hbCBzcGFjZS4KICAgIC8vIFdlIHdhbnQgb25seSBub3JtYWwgc3BhY2VzIGluIHRoZSBtb2RlbCBhbmQgaW4gdGhlIHZpZXcuIFJlbmRlcmVyIGFuZCBET00gQ29udmVydGVyIHdpbGwgYmUgdGhlbiByZXNwb25zaWJsZQogICAgLy8gZm9yIHJlbmRlcmluZyBjb25zZWN1dGl2ZSBzcGFjZXMgdXNpbmcgJm5ic3A7LCBidXQgdGhlIG1vZGVsIGFuZCB0aGUgdmlldyBoYXMgdG8gYmUgY2xlYXIuCiAgICAvLyBPdGhlciBmZWF0dXJlIG1heSBpbnRyb2R1Y2UgaW5zZXJ0aW5nIG5vbi1icmVha2FibGUgc3BhY2Ugb24gc3BlY2lmaWMga2V5IHN0cm9rZSAoZm9yIGV4YW1wbGUgc2hpZnQgKyBzcGFjZSkuCiAgICAvLyBIb3dldmVyIHRoZW4gaXQgd2lsbCBiZSBoYW5kbGVkIG91dHNpZGUgb2YgbXV0YXRpb25zLCBsaWtlIGVudGVyIGtleSBpcy4KICAgIC8vIFRoZSByZXBsYWNpbmcgaXMgaGVyZSBiZWNhdXNlIGl0IGhhcyB0byBiZSBkb25lIGJlZm9yZSBgZGlmZmAgYW5kIGBkaWZmVG9DaGFuZ2VzYCBmdW5jdGlvbnMsIGFzIHRoZXkKICAgIC8vIHRha2UgYG5ld1RleHRgIGFuZCBjb21wYXJlIGl0IHRvIChjbGVhbmVkIHVwKSB2aWV3LgogICAgLy8gSXQgY291bGQgYWxzbyBiZSBkb25lIGluIG11dGF0aW9uIG9ic2VydmVyIHRvbywgaG93ZXZlciBpZiBhbnkgb3V0c2lkZSBwbHVnaW4gd291bGQgbGlrZSB0bwogICAgLy8gaW50cm9kdWNlIGFkZGl0aW9uYWwgZXZlbnRzIGZvciBtdXRhdGlvbnMsIHRoZXkgd291bGQgZ2V0IGFscmVhZHkgY2xlYW5lZCB1cCB2ZXJzaW9uICh0aGlzIG1heSBiZSBnb29kIG9yIG5vdCkuCgoKICAgIGNvbnN0IG5ld1RleHQgPSBtdXRhdGlvbi5uZXdUZXh0LnJlcGxhY2UoL1x1MDBBMC9nLCAnICcpOyAvLyBUbyBoYXZlIGNvcnJlY3QgYGRpZmZSZXN1bHRgLCB3ZSBhbHNvIGNvbXBhcmUgdmlldyBub2RlIHRleHQgZGF0YSB3aXRoICZuYnNwOyByZXBsYWNlZCBieSBzcGFjZS4KCiAgICBjb25zdCBvbGRUZXh0ID0gbXV0YXRpb24ub2xkVGV4dC5yZXBsYWNlKC9cdTAwQTAvZywgJyAnKTsgLy8gRG8gbm90aGluZyBpZiBtdXRhdGlvbnMgY3JlYXRlZCBzYW1lIHRleHQuCgogICAgaWYgKG9sZFRleHQgPT09IG5ld1RleHQpIHsKICAgICAgcmV0dXJuOwogICAgfQoKICAgIGNvbnN0IGRpZmZSZXN1bHQgPSBkaWZmKG9sZFRleHQsIG5ld1RleHQpOwogICAgY29uc3QgewogICAgICBmaXJzdENoYW5nZUF0LAogICAgICBpbnNlcnRpb25zLAogICAgICBkZWxldGlvbnMKICAgIH0gPSBjYWxjdWxhdGVDaGFuZ2VzKGRpZmZSZXN1bHQpOyAvLyBUcnkgc2V0dGluZyBuZXcgbW9kZWwgc2VsZWN0aW9uIGFjY29yZGluZyB0byBwYXNzZWQgdmlldyBzZWxlY3Rpb24uCgogICAgbGV0IG1vZGVsU2VsZWN0aW9uUmFuZ2UgPSBudWxsOwoKICAgIGlmICh2aWV3U2VsZWN0aW9uKSB7CiAgICAgIG1vZGVsU2VsZWN0aW9uUmFuZ2UgPSB0aGlzLmVkaXRpbmcubWFwcGVyLnRvTW9kZWxSYW5nZSh2aWV3U2VsZWN0aW9uLmdldEZpcnN0UmFuZ2UoKSk7CiAgICB9IC8vIEdldCB0aGUgcG9zaXRpb24gaW4gdmlldyBhbmQgbW9kZWwgd2hlcmUgdGhlIGNoYW5nZXMgd2lsbCBoYXBwZW4uCgoKICAgIGNvbnN0IHZpZXdQb3MgPSB0aGlzLmVkaXRpbmcudmlldy5jcmVhdGVQb3NpdGlvbkF0KG11dGF0aW9uLm5vZGUsIGZpcnN0Q2hhbmdlQXQpOwogICAgY29uc3QgbW9kZWxQb3MgPSB0aGlzLmVkaXRpbmcubWFwcGVyLnRvTW9kZWxQb3NpdGlvbih2aWV3UG9zKTsKICAgIGNvbnN0IHJlbW92ZVJhbmdlID0gdGhpcy5lZGl0b3IubW9kZWwuY3JlYXRlUmFuZ2UobW9kZWxQb3MsIG1vZGVsUG9zLmdldFNoaWZ0ZWRCeShkZWxldGlvbnMpKTsKICAgIGNvbnN0IGluc2VydFRleHQgPSBuZXdUZXh0LnN1YnN0cihmaXJzdENoYW5nZUF0LCBpbnNlcnRpb25zKTsKICAgIHRoaXMuZWRpdG9yLmV4ZWN1dGUoJ2lucHV0JywgewogICAgICB0ZXh0OiBpbnNlcnRUZXh0LAogICAgICByYW5nZTogcmVtb3ZlUmFuZ2UsCiAgICAgIHJlc3VsdFJhbmdlOiBtb2RlbFNlbGVjdGlvblJhbmdlCiAgICB9KTsKICB9CiAgLyoqCiAgICogQHByaXZhdGUKICAgKi8KCgogIF9oYW5kbGVUZXh0Tm9kZUluc2VydGlvbihtdXRhdGlvbikgewogICAgaWYgKG11dGF0aW9uLnR5cGUgIT0gJ2NoaWxkcmVuJykgewogICAgICByZXR1cm47CiAgICB9CgogICAgY29uc3QgY2hhbmdlID0gZ2V0U2luZ2xlVGV4dE5vZGVDaGFuZ2UobXV0YXRpb24pOwogICAgY29uc3Qgdmlld1BvcyA9IHRoaXMuZWRpdGluZy52aWV3LmNyZWF0ZVBvc2l0aW9uQXQobXV0YXRpb24ubm9kZSwgY2hhbmdlLmluZGV4KTsKICAgIGNvbnN0IG1vZGVsUG9zID0gdGhpcy5lZGl0aW5nLm1hcHBlci50b01vZGVsUG9zaXRpb24odmlld1Bvcyk7CiAgICBjb25zdCBpbnNlcnRlZFRleHQgPSBjaGFuZ2UudmFsdWVzWzBdLmRhdGE7CiAgICB0aGlzLmVkaXRvci5leGVjdXRlKCdpbnB1dCcsIHsKICAgICAgLy8gUmVwbGFjZSAmbmJzcDsgaW5zZXJ0ZWQgYnkgdGhlIGJyb3dzZXIgd2l0aCBub3JtYWwgc3BhY2UuCiAgICAgIC8vIFNlZSBjb21tZW50IGluIGBfaGFuZGxlVGV4dE11dGF0aW9uYC4KICAgICAgLy8gSW4gdGhpcyBjYXNlIHdlIGRvbid0IG5lZWQgdG8gZG8gdGhpcyBiZWZvcmUgYGRpZmZgIGJlY2F1c2Ugd2UgZGlmZiB3aG9sZSBub2Rlcy4KICAgICAgLy8gSnVzdCBjaGFuZ2UgJm5ic3A7IGluIGNhc2UgdGhlcmUgYXJlIHNvbWUuCiAgICAgIHRleHQ6IGluc2VydGVkVGV4dC5yZXBsYWNlKC9cdTAwQTAvZywgJyAnKSwKICAgICAgcmFuZ2U6IHRoaXMuZWRpdG9yLm1vZGVsLmNyZWF0ZVJhbmdlKG1vZGVsUG9zKQogICAgfSk7CiAgfQoKfSAvLyBSZXR1cm5zIGZpcnN0IGNvbW1vbiBhbmNlc3RvciBvZiBhbGwgbXV0YXRpb25zIHRoYXQgaXMgZWl0aGVyIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvY29udGFpbmVyZWxlbWVudH5Db250YWluZXJFbGVtZW50fQovLyBvciB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L3Jvb3RlbGVtZW50flJvb3RFbGVtZW50fS4KLy8KLy8gQHByaXZhdGUKLy8gQHBhcmFtIHtBcnJheS48bW9kdWxlOmVuZ2luZS92aWV3L29ic2VydmVyL211dGF0aW9ub2JzZXJ2ZXJ+TXV0YXRlZFRleHR8Ci8vIG1vZHVsZTplbmdpbmUvdmlldy9vYnNlcnZlci9tdXRhdGlvbm9ic2VydmVyfk11dGF0ZWRDaGlsZHJlbj59IG11dGF0aW9ucwovLyBAcmV0dXJucyB7bW9kdWxlOmVuZ2luZS92aWV3L2NvbnRhaW5lcmVsZW1lbnR+Q29udGFpbmVyRWxlbWVudHxlbmdpbmUvdmlldy9yb290ZWxlbWVudH5Sb290RWxlbWVudHx1bmRlZmluZWR9CgoKZnVuY3Rpb24gZ2V0TXV0YXRpb25zQ29udGFpbmVyKG11dGF0aW9ucykgewogIGNvbnN0IGxjYSA9IG11dGF0aW9ucy5tYXAobXV0YXRpb24gPT4gbXV0YXRpb24ubm9kZSkucmVkdWNlKChjb21tb25BbmNlc3Rvciwgbm9kZSkgPT4gewogICAgcmV0dXJuIGNvbW1vbkFuY2VzdG9yLmdldENvbW1vbkFuY2VzdG9yKG5vZGUsIHsKICAgICAgaW5jbHVkZVNlbGY6IHRydWUKICAgIH0pOwogIH0pOwoKICBpZiAoIWxjYSkgewogICAgcmV0dXJuOwogIH0gLy8gV2UgbmVlZCB0byBsb29rIGZvciBjb250YWluZXIgYW5kIHJvb3QgZWxlbWVudHMgb25seSwgc28gY2hlY2sgYWxsIExDQSdzCiAgLy8gYW5jZXN0b3JzIChzdGFydGluZyBmcm9tIGl0c2VsZikuCgoKICByZXR1cm4gbGNhLmdldEFuY2VzdG9ycyh7CiAgICBpbmNsdWRlU2VsZjogdHJ1ZSwKICAgIHBhcmVudEZpcnN0OiB0cnVlCiAgfSkuZmluZChlbGVtZW50ID0+IGVsZW1lbnQuaXMoJ2NvbnRhaW5lckVsZW1lbnQnKSB8fCBlbGVtZW50LmlzKCdyb290RWxlbWVudCcpKTsKfSAvLyBSZXR1cm5zIHRydWUgaWYgcHJvdmlkZWQgYXJyYXkgY29udGFpbnMgY29udGVudCB0aGF0IHdvbid0IGJlIHByb2JsZW1hdGljIGR1cmluZyBkaWZmaW5nIGFuZCB0ZXh0IG11dGF0aW9uIGhhbmRsaW5nLgovLwovLyBAcGFyYW0ge0FycmF5Ljxtb2R1bGU6ZW5naW5lL21vZGVsL25vZGV+Tm9kZT59IGNoaWxkcmVuCi8vIEBwYXJhbSB7bW9kdWxlOmVuZ2luZS9tb2RlbC9zY2hlbWF+U2NoZW1hfSBzY2hlbWEKLy8gQHJldHVybnMge0Jvb2xlYW59CgoKZnVuY3Rpb24gaXNTYWZlRm9yVGV4dE11dGF0aW9uKGNoaWxkcmVuLCBzY2hlbWEpIHsKICByZXR1cm4gY2hpbGRyZW4uZXZlcnkoY2hpbGQgPT4gc2NoZW1hLmlzSW5saW5lKGNoaWxkKSk7Cn0gLy8gQ2FsY3VsYXRlcyBmaXJzdCBjaGFuZ2UgaW5kZXggYW5kIG51bWJlciBvZiBjaGFyYWN0ZXJzIHRoYXQgc2hvdWxkIGJlIGluc2VydGVkIGFuZCBkZWxldGVkIHN0YXJ0aW5nIGZyb20gdGhhdCBpbmRleC4KLy8KLy8gQHByaXZhdGUKLy8gQHBhcmFtIGRpZmZSZXN1bHQKLy8gQHJldHVybnMge3tpbnNlcnRpb25zOiBudW1iZXIsIGRlbGV0aW9uczogbnVtYmVyLCBmaXJzdENoYW5nZUF0OiAqfX0KCgpmdW5jdGlvbiBjYWxjdWxhdGVDaGFuZ2VzKGRpZmZSZXN1bHQpIHsKICAvLyBJbmRleCB3aGVyZSB0aGUgZmlyc3QgY2hhbmdlIGhhcHBlbnMuIFVzZWQgdG8gc2V0IHRoZSBwb3NpdGlvbiBmcm9tIHdoaWNoIG5vZGVzIHdpbGwgYmUgcmVtb3ZlZCBhbmQgd2hlcmUgd2lsbCBiZSBpbnNlcnRlZC4KICBsZXQgZmlyc3RDaGFuZ2VBdCA9IG51bGw7IC8vIEluZGV4IHdoZXJlIHRoZSBsYXN0IGNoYW5nZSBoYXBwZW5zLiBVc2VkIHRvIHByb3Blcmx5IGNvdW50IGhvdyBtYW55IGNoYXJhY3RlcnMgaGF2ZSB0byBiZSByZW1vdmVkIGFuZCBpbnNlcnRlZC4KCiAgbGV0IGxhc3RDaGFuZ2VBdCA9IG51bGw7IC8vIEdldCBgZmlyc3RDaGFuZ2VBdGAgYW5kIGBsYXN0Q2hhbmdlQXRgLgoKICBmb3IgKGxldCBpID0gMDsgaSA8IGRpZmZSZXN1bHQubGVuZ3RoOyBpKyspIHsKICAgIGNvbnN0IGNoYW5nZSA9IGRpZmZSZXN1bHRbaV07CgogICAgaWYgKGNoYW5nZSAhPSAnZXF1YWwnKSB7CiAgICAgIGZpcnN0Q2hhbmdlQXQgPSBmaXJzdENoYW5nZUF0ID09PSBudWxsID8gaSA6IGZpcnN0Q2hhbmdlQXQ7CiAgICAgIGxhc3RDaGFuZ2VBdCA9IGk7CiAgICB9CiAgfSAvLyBIb3cgbWFueSBjaGFyYWN0ZXJzLCBzdGFydGluZyBmcm9tIGBmaXJzdENoYW5nZUF0YCwgc2hvdWxkIGJlIHJlbW92ZWQuCgoKICBsZXQgZGVsZXRpb25zID0gMDsgLy8gSG93IG1hbnkgY2hhcmFjdGVycywgc3RhcnRpbmcgZnJvbSBgZmlyc3RDaGFuZ2VBdGAsIHNob3VsZCBiZSBpbnNlcnRlZC4KCiAgbGV0IGluc2VydGlvbnMgPSAwOwoKICBmb3IgKGxldCBpID0gZmlyc3RDaGFuZ2VBdDsgaSA8PSBsYXN0Q2hhbmdlQXQ7IGkrKykgewogICAgLy8gSWYgdGhlcmUgaXMgbm8gY2hhbmdlIChlcXVhbCkgb3IgZGVsZXRlLCB0aGUgY2hhcmFjdGVyIGlzIGV4aXN0aW5nIGluIGBvbGRUZXh0YC4gV2UgY291bnQgaXQgZm9yIHJlbW92aW5nLgogICAgaWYgKGRpZmZSZXN1bHRbaV0gIT0gJ2luc2VydCcpIHsKICAgICAgZGVsZXRpb25zKys7CiAgICB9IC8vIElmIHRoZXJlIGlzIG5vIGNoYW5nZSAoZXF1YWwpIG9yIGluc2VydCwgdGhlIGNoYXJhY3RlciBpcyBleGlzdGluZyBpbiBgbmV3VGV4dGAuIFdlIGNvdW50IGl0IGZvciBpbnNlcnRpbmcuCgoKICAgIGlmIChkaWZmUmVzdWx0W2ldICE9ICdkZWxldGUnKSB7CiAgICAgIGluc2VydGlvbnMrKzsKICAgIH0KICB9CgogIHJldHVybiB7CiAgICBpbnNlcnRpb25zLAogICAgZGVsZXRpb25zLAogICAgZmlyc3RDaGFuZ2VBdAogIH07Cn0="},{"version":3,"sources":["/Users/antonyching/Desktop/project/new-builder-demo/node_modules/@ckeditor/ckeditor5-typing/src/utils/injecttypingmutationshandling.js"],"names":["diff","DomConverter","getSingleTextNodeChange","containerChildrenMutated","injectTypingMutationsHandling","editor","editing","view","document","on","evt","mutations","viewSelection","MutationHandler","handle","constructor","_handleContainerChildrenMutations","mutation","_handleTextMutation","_handleTextNodeInsertion","mutationsCommonAncestor","getMutationsContainer","domConverter","domMutationCommonAncestor","mapViewToDom","freshDomConverter","modelFromCurrentDom","data","toModel","domToView","getChild","currentModel","mapper","toModelElement","modelFromDomChildren","Array","from","getChildren","currentModelChildren","lastDomChild","length","lastCurrentChild","is","pop","schema","model","isSafeForTextMutation","newText","map","item","join","replace","oldText","diffResult","firstChangeAt","insertions","deletions","calculateChanges","modelSelectionRange","toModelRange","getFirstRange","insertText","substr","removeRange","createRange","createPositionAt","execute","text","range","resultRange","type","viewPos","node","modelPos","toModelPosition","getShiftedBy","change","index","insertedText","values","lca","reduce","commonAncestor","getCommonAncestor","includeSelf","getAncestors","parentFirst","find","element","children","every","child","isInline","lastChangeAt","i"],"mappings":"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","sourcesContent":["/**\n * @license Copyright (c) 2003-2019, CKSource - Frederico Knabben. All rights reserved.\n * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license\n */\n\n/**\n * @module typing/utils/injecttypingmutationshandling\n */\n\nimport diff from '@ckeditor/ckeditor5-utils/src/diff';\nimport DomConverter from '@ckeditor/ckeditor5-engine/src/view/domconverter';\n\nimport { getSingleTextNodeChange, containerChildrenMutated } from './utils';\n\n/**\n * Handles mutations caused by normal typing.\n *\n * @param {module:core/editor/editor~Editor} editor The editor instance.\n */\nexport default function injectTypingMutationsHandling( editor ) {\n\teditor.editing.view.document.on( 'mutations', ( evt, mutations, viewSelection ) => {\n\t\tnew MutationHandler( editor ).handle( mutations, viewSelection );\n\t} );\n}\n\n/**\n * Helper class for translating DOM mutations into model changes.\n *\n * @private\n */\nclass MutationHandler {\n\t/**\n\t * Creates an instance of the mutation handler.\n\t *\n\t * @param {module:core/editor/editor~Editor} editor\n\t */\n\tconstructor( editor ) {\n\t\t/**\n\t\t * Editor instance for which mutations are handled.\n\t\t *\n\t\t * @readonly\n\t\t * @member {module:core/editor/editor~Editor} #editor\n\t\t */\n\t\tthis.editor = editor;\n\n\t\t/**\n\t\t * The editing controller.\n\t\t *\n\t\t * @readonly\n\t\t * @member {module:engine/controller/editingcontroller~EditingController} #editing\n\t\t */\n\t\tthis.editing = this.editor.editing;\n\t}\n\n\t/**\n\t * Handles given mutations.\n\t *\n\t * @param {Array.<module:engine/view/observer/mutationobserver~MutatedText|\n\t * module:engine/view/observer/mutationobserver~MutatedChildren>} mutations\n\t * @param {module:engine/view/selection~Selection|null} viewSelection\n\t */\n\thandle( mutations, viewSelection ) {\n\t\tif ( containerChildrenMutated( mutations ) ) {\n\t\t\tthis._handleContainerChildrenMutations( mutations, viewSelection );\n\t\t} else {\n\t\t\tfor ( const mutation of mutations ) {\n\t\t\t\t// Fortunately it will never be both.\n\t\t\t\tthis._handleTextMutation( mutation, viewSelection );\n\t\t\t\tthis._handleTextNodeInsertion( mutation );\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Handles situations when container's children mutated during input. This can happen when\n\t * the browser is trying to \"fix\" DOM in certain situations. For example, when the user starts to type\n\t * in `<p><a href=\"\"><i>Link{}</i></a></p>`, the browser might change the order of elements\n\t * to `<p><i><a href=\"\">Link</a>x{}</i></p>`. A similar situation happens when the spell checker\n\t * replaces a word wrapped with `<strong>` with a word wrapped with a `<b>` element.\n\t *\n\t * To handle such situations, the common DOM ancestor of all mutations is converted to the model representation\n\t * and then compared with the current model to calculate the proper text change.\n\t *\n\t * Note: Single text node insertion is handled in {@link #_handleTextNodeInsertion} and text node mutation is handled\n\t * in {@link #_handleTextMutation}).\n\t *\n\t * @private\n\t * @param {Array.<module:engine/view/observer/mutationobserver~MutatedText|\n\t * module:engine/view/observer/mutationobserver~MutatedChildren>} mutations\n\t * @param {module:engine/view/selection~Selection|null} viewSelection\n\t */\n\t_handleContainerChildrenMutations( mutations, viewSelection ) {\n\t\t// Get common ancestor of all mutations.\n\t\tconst mutationsCommonAncestor = getMutationsContainer( mutations );\n\n\t\t// Quit if there is no common ancestor.\n\t\tif ( !mutationsCommonAncestor ) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst domConverter = this.editor.editing.view.domConverter;\n\n\t\t// Get common ancestor in DOM.\n\t\tconst domMutationCommonAncestor = domConverter.mapViewToDom( mutationsCommonAncestor );\n\n\t\t// Create fresh DomConverter so it will not use existing mapping and convert current DOM to model.\n\t\t// This wouldn't be needed if DomConverter would allow to create fresh view without checking any mappings.\n\t\tconst freshDomConverter = new DomConverter();\n\t\tconst modelFromCurrentDom = this.editor.data.toModel(\n\t\t\tfreshDomConverter.domToView( domMutationCommonAncestor )\n\t\t).getChild( 0 );\n\n\t\t// Current model.\n\t\tconst currentModel = this.editor.editing.mapper.toModelElement( mutationsCommonAncestor );\n\n\t\t// If common ancestor is not mapped, do not do anything. It probably is a parent of another view element.\n\t\t// That means that we would need to diff model elements (see `if` below). Better return early instead of\n\t\t// trying to get a reasonable model ancestor. It will fell into the `if` below anyway.\n\t\t// This situation happens for example for lists. If `<ul>` is a common ancestor, `currentModel` is `undefined`\n\t\t// because `<ul>` is not mapped (`<li>`s are).\n\t\t// See https://github.com/ckeditor/ckeditor5/issues/718.\n\t\tif ( !currentModel ) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Get children from both ancestors.\n\t\tconst modelFromDomChildren = Array.from( modelFromCurrentDom.getChildren() );\n\t\tconst currentModelChildren = Array.from( currentModel.getChildren() );\n\n\t\t// Remove the last `<softBreak>` from the end of `modelFromDomChildren` if there is no `<softBreak>` in current model.\n\t\t// If the described scenario happened, it means that this is a bogus `<br />` added by a browser.\n\t\tconst lastDomChild = modelFromDomChildren[ modelFromDomChildren.length - 1 ];\n\t\tconst lastCurrentChild = currentModelChildren[ currentModelChildren.length - 1 ];\n\n\t\tif ( lastDomChild && lastDomChild.is( 'softBreak' ) && lastCurrentChild && !lastCurrentChild.is( 'softBreak' ) ) {\n\t\t\tmodelFromDomChildren.pop();\n\t\t}\n\n\t\tconst schema = this.editor.model.schema;\n\n\t\t// Skip situations when common ancestor has any container elements.\n\t\tif ( !isSafeForTextMutation( modelFromDomChildren, schema ) || !isSafeForTextMutation( currentModelChildren, schema ) ) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Replace &nbsp; inserted by the browser with normal space. See comment in `_handleTextMutation`.\n\t\t// Replace non-texts with any character. This is potentially dangerous but passes in manual tests. The thing is\n\t\t// that we need to take care of proper indexes so we cannot simply remove non-text elements from the content.\n\t\t// By inserting a character we keep all the real texts on their indexes.\n\t\tconst newText = modelFromDomChildren.map( item => item.is( 'text' ) ? item.data : '@' ).join( '' ).replace( /\\u00A0/g, ' ' );\n\t\tconst oldText = currentModelChildren.map( item => item.is( 'text' ) ? item.data : '@' ).join( '' ).replace( /\\u00A0/g, ' ' );\n\n\t\t// Do nothing if mutations created same text.\n\t\tif ( oldText === newText ) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst diffResult = diff( oldText, newText );\n\n\t\tconst { firstChangeAt, insertions, deletions } = calculateChanges( diffResult );\n\n\t\t// Try setting new model selection according to passed view selection.\n\t\tlet modelSelectionRange = null;\n\n\t\tif ( viewSelection ) {\n\t\t\tmodelSelectionRange = this.editing.mapper.toModelRange( viewSelection.getFirstRange() );\n\t\t}\n\n\t\tconst insertText = newText.substr( firstChangeAt, insertions );\n\t\tconst removeRange = this.editor.model.createRange(\n\t\t\tthis.editor.model.createPositionAt( currentModel, firstChangeAt ),\n\t\t\tthis.editor.model.createPositionAt( currentModel, firstChangeAt + deletions )\n\t\t);\n\n\t\tthis.editor.execute( 'input', {\n\t\t\ttext: insertText,\n\t\t\trange: removeRange,\n\t\t\tresultRange: modelSelectionRange\n\t\t} );\n\t}\n\n\t/**\n\t * @private\n\t */\n\t_handleTextMutation( mutation, viewSelection ) {\n\t\tif ( mutation.type != 'text' ) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Replace &nbsp; inserted by the browser with normal space.\n\t\t// We want only normal spaces in the model and in the view. Renderer and DOM Converter will be then responsible\n\t\t// for rendering consecutive spaces using &nbsp;, but the model and the view has to be clear.\n\t\t// Other feature may introduce inserting non-breakable space on specific key stroke (for example shift + space).\n\t\t// However then it will be handled outside of mutations, like enter key is.\n\t\t// The replacing is here because it has to be done before `diff` and `diffToChanges` functions, as they\n\t\t// take `newText` and compare it to (cleaned up) view.\n\t\t// It could also be done in mutation observer too, however if any outside plugin would like to\n\t\t// introduce additional events for mutations, they would get already cleaned up version (this may be good or not).\n\t\tconst newText = mutation.newText.replace( /\\u00A0/g, ' ' );\n\t\t// To have correct `diffResult`, we also compare view node text data with &nbsp; replaced by space.\n\t\tconst oldText = mutation.oldText.replace( /\\u00A0/g, ' ' );\n\n\t\t// Do nothing if mutations created same text.\n\t\tif ( oldText === newText ) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst diffResult = diff( oldText, newText );\n\n\t\tconst { firstChangeAt, insertions, deletions } = calculateChanges( diffResult );\n\n\t\t// Try setting new model selection according to passed view selection.\n\t\tlet modelSelectionRange = null;\n\n\t\tif ( viewSelection ) {\n\t\t\tmodelSelectionRange = this.editing.mapper.toModelRange( viewSelection.getFirstRange() );\n\t\t}\n\n\t\t// Get the position in view and model where the changes will happen.\n\t\tconst viewPos = this.editing.view.createPositionAt( mutation.node, firstChangeAt );\n\t\tconst modelPos = this.editing.mapper.toModelPosition( viewPos );\n\t\tconst removeRange = this.editor.model.createRange( modelPos, modelPos.getShiftedBy( deletions ) );\n\t\tconst insertText = newText.substr( firstChangeAt, insertions );\n\n\t\tthis.editor.execute( 'input', {\n\t\t\ttext: insertText,\n\t\t\trange: removeRange,\n\t\t\tresultRange: modelSelectionRange\n\t\t} );\n\t}\n\n\t/**\n\t * @private\n\t */\n\t_handleTextNodeInsertion( mutation ) {\n\t\tif ( mutation.type != 'children' ) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst change = getSingleTextNodeChange( mutation );\n\t\tconst viewPos = this.editing.view.createPositionAt( mutation.node, change.index );\n\t\tconst modelPos = this.editing.mapper.toModelPosition( viewPos );\n\t\tconst insertedText = change.values[ 0 ].data;\n\n\t\tthis.editor.execute( 'input', {\n\t\t\t// Replace &nbsp; inserted by the browser with normal space.\n\t\t\t// See comment in `_handleTextMutation`.\n\t\t\t// In this case we don't need to do this before `diff` because we diff whole nodes.\n\t\t\t// Just change &nbsp; in case there are some.\n\t\t\ttext: insertedText.replace( /\\u00A0/g, ' ' ),\n\t\t\trange: this.editor.model.createRange( modelPos )\n\t\t} );\n\t}\n}\n\n// Returns first common ancestor of all mutations that is either {@link module:engine/view/containerelement~ContainerElement}\n// or {@link module:engine/view/rootelement~RootElement}.\n//\n// @private\n// @param {Array.<module:engine/view/observer/mutationobserver~MutatedText|\n// module:engine/view/observer/mutationobserver~MutatedChildren>} mutations\n// @returns {module:engine/view/containerelement~ContainerElement|engine/view/rootelement~RootElement|undefined}\nfunction getMutationsContainer( mutations ) {\n\tconst lca = mutations\n\t\t.map( mutation => mutation.node )\n\t\t.reduce( ( commonAncestor, node ) => {\n\t\t\treturn commonAncestor.getCommonAncestor( node, { includeSelf: true } );\n\t\t} );\n\n\tif ( !lca ) {\n\t\treturn;\n\t}\n\n\t// We need to look for container and root elements only, so check all LCA's\n\t// ancestors (starting from itself).\n\treturn lca.getAncestors( { includeSelf: true, parentFirst: true } )\n\t\t.find( element => element.is( 'containerElement' ) || element.is( 'rootElement' ) );\n}\n\n// Returns true if provided array contains content that won't be problematic during diffing and text mutation handling.\n//\n// @param {Array.<module:engine/model/node~Node>} children\n// @param {module:engine/model/schema~Schema} schema\n// @returns {Boolean}\nfunction isSafeForTextMutation( children, schema ) {\n\treturn children.every( child => schema.isInline( child ) );\n}\n\n// Calculates first change index and number of characters that should be inserted and deleted starting from that index.\n//\n// @private\n// @param diffResult\n// @returns {{insertions: number, deletions: number, firstChangeAt: *}}\nfunction calculateChanges( diffResult ) {\n\t// Index where the first change happens. Used to set the position from which nodes will be removed and where will be inserted.\n\tlet firstChangeAt = null;\n\t// Index where the last change happens. Used to properly count how many characters have to be removed and inserted.\n\tlet lastChangeAt = null;\n\n\t// Get `firstChangeAt` and `lastChangeAt`.\n\tfor ( let i = 0; i < diffResult.length; i++ ) {\n\t\tconst change = diffResult[ i ];\n\n\t\tif ( change != 'equal' ) {\n\t\t\tfirstChangeAt = firstChangeAt === null ? i : firstChangeAt;\n\t\t\tlastChangeAt = i;\n\t\t}\n\t}\n\n\t// How many characters, starting from `firstChangeAt`, should be removed.\n\tlet deletions = 0;\n\t// How many characters, starting from `firstChangeAt`, should be inserted.\n\tlet insertions = 0;\n\n\tfor ( let i = firstChangeAt; i <= lastChangeAt; i++ ) {\n\t\t// If there is no change (equal) or delete, the character is existing in `oldText`. We count it for removing.\n\t\tif ( diffResult[ i ] != 'insert' ) {\n\t\t\tdeletions++;\n\t\t}\n\n\t\t// If there is no change (equal) or insert, the character is existing in `newText`. We count it for inserting.\n\t\tif ( diffResult[ i ] != 'delete' ) {\n\t\t\tinsertions++;\n\t\t}\n\t}\n\n\treturn { insertions, deletions, firstChangeAt };\n}\n"]}]}
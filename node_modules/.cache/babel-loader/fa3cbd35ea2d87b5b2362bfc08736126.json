{"remainingRequest":"/Users/antonyching/Desktop/project/new-builder-demo/node_modules/babel-loader/lib/index.js!/Users/antonyching/Desktop/project/new-builder-demo/node_modules/@ckeditor/ckeditor5-engine/src/model/utils/insertcontent.js","dependencies":[{"path":"/Users/antonyching/Desktop/project/new-builder-demo/node_modules/@ckeditor/ckeditor5-engine/src/model/utils/insertcontent.js","mtime":499162500000},{"path":"/Users/antonyching/Desktop/project/new-builder-demo/node_modules/@ckeditor/ckeditor5-dev-webpack-plugin/lib/translatesourceloader.js","mtime":499162500000},{"path":"/Users/antonyching/Desktop/project/new-builder-demo/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/antonyching/Desktop/project/new-builder-demo/node_modules/babel-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:LyoqCiAqIEBsaWNlbnNlIENvcHlyaWdodCAoYykgMjAwMy0yMDE5LCBDS1NvdXJjZSAtIEZyZWRlcmljbyBLbmFiYmVuLiBBbGwgcmlnaHRzIHJlc2VydmVkLgogKiBGb3IgbGljZW5zaW5nLCBzZWUgTElDRU5TRS5tZCBvciBodHRwczovL2NrZWRpdG9yLmNvbS9sZWdhbC9ja2VkaXRvci1vc3MtbGljZW5zZQogKi8KCi8qKgogKiBAbW9kdWxlIGVuZ2luZS9tb2RlbC91dGlscy9pbnNlcnRjb250ZW50CiAqLwppbXBvcnQgUG9zaXRpb24gZnJvbSAnLi4vcG9zaXRpb24nOwppbXBvcnQgTGl2ZVBvc2l0aW9uIGZyb20gJy4uL2xpdmVwb3NpdGlvbic7CmltcG9ydCBFbGVtZW50IGZyb20gJy4uL2VsZW1lbnQnOwppbXBvcnQgUmFuZ2UgZnJvbSAnLi4vcmFuZ2UnOwppbXBvcnQgRG9jdW1lbnRTZWxlY3Rpb24gZnJvbSAnLi4vZG9jdW1lbnRzZWxlY3Rpb24nOwppbXBvcnQgU2VsZWN0aW9uIGZyb20gJy4uL3NlbGVjdGlvbic7CmltcG9ydCBDS0VkaXRvckVycm9yIGZyb20gJ0Bja2VkaXRvci9ja2VkaXRvcjUtdXRpbHMvc3JjL2NrZWRpdG9yZXJyb3InOwovKioKICogSW5zZXJ0cyBjb250ZW50IGludG8gdGhlIGVkaXRvciAoc3BlY2lmaWVkIHNlbGVjdGlvbikgYXMgb25lIHdvdWxkIGV4cGVjdCB0aGUgcGFzdGUKICogZnVuY3Rpb25hbGl0eSB0byB3b3JrLgogKgogKiBJZiBhbiBpbnN0YW5jZSBvZiB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9zZWxlY3Rpb25+U2VsZWN0aW9ufSBpcyBwYXNzZWQgYXMgYHNlbGVjdGFibGVgIGl0IHdpbGwgYmUgbW9kaWZpZWQKICogdG8gdGhlIGluc2VydGlvbiBzZWxlY3Rpb24gKGVxdWFsIHRvIGEgcmFuZ2UgdG8gYmUgc2VsZWN0ZWQgYWZ0ZXIgaW5zZXJ0aW9uKS4KICoKICogSWYgYHNlbGVjdGFibGVgIGlzIG5vdCBwYXNzZWQsIHRoZSBjb250ZW50IHdpbGwgYmUgaW5zZXJ0ZWQgdXNpbmcgdGhlIGN1cnJlbnQgc2VsZWN0aW9uIG9mIHRoZSBtb2RlbCBkb2N1bWVudC4KICoKICogKipOb3RlOioqIFVzZSB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9tb2RlbH5Nb2RlbCNpbnNlcnRDb250ZW50fSBpbnN0ZWFkIG9mIHRoaXMgZnVuY3Rpb24uCiAqIFRoaXMgZnVuY3Rpb24gaXMgb25seSBleHBvc2VkIHRvIGJlIHJldXNhYmxlIGluIGFsZ29yaXRobXMgd2hpY2ggY2hhbmdlIHRoZSB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9tb2RlbH5Nb2RlbCNpbnNlcnRDb250ZW50fQogKiBtZXRob2QncyBiZWhhdmlvci4KICoKICogQHBhcmFtIHttb2R1bGU6ZW5naW5lL21vZGVsL21vZGVsfk1vZGVsfSBtb2RlbCBUaGUgbW9kZWwgaW4gY29udGV4dCBvZiB3aGljaCB0aGUgaW5zZXJ0aW9uCiAqIHNob3VsZCBiZSBwZXJmb3JtZWQuCiAqIEBwYXJhbSB7bW9kdWxlOmVuZ2luZS9tb2RlbC9kb2N1bWVudGZyYWdtZW50fkRvY3VtZW50RnJhZ21lbnR8bW9kdWxlOmVuZ2luZS9tb2RlbC9pdGVtfkl0ZW19IGNvbnRlbnQgVGhlIGNvbnRlbnQgdG8gaW5zZXJ0LgogKiBAcGFyYW0ge21vZHVsZTplbmdpbmUvbW9kZWwvc2VsZWN0aW9uflNlbGVjdGFibGV9IFtzZWxlY3RhYmxlPW1vZGVsLmRvY3VtZW50LnNlbGVjdGlvbl0KICogU2VsZWN0aW9uIGludG8gd2hpY2ggdGhlIGNvbnRlbnQgc2hvdWxkIGJlIGluc2VydGVkLgogKiBAcGFyYW0ge051bWJlcnwnYmVmb3JlJ3wnZW5kJ3wnYWZ0ZXInfCdvbid8J2luJ30gW3BsYWNlT3JPZmZzZXRdIFNldHMgcGxhY2Ugb3Igb2Zmc2V0IG9mIHRoZSBzZWxlY3Rpb24uCiAqIEByZXR1cm5zIHttb2R1bGU6ZW5naW5lL21vZGVsL3JhbmdlflJhbmdlfSBSYW5nZSB3aGljaCBjb250YWlucyBhbGwgdGhlIHBlcmZvcm1lZCBjaGFuZ2VzLiBUaGlzIGlzIGEgcmFuZ2UgdGhhdCwgaWYgcmVtb3ZlZCwKICogd291bGQgcmV0dXJuIHRoZSBtb2RlbCB0byB0aGUgc3RhdGUgYmVmb3JlIHRoZSBpbnNlcnRpb24uIElmIG5vIGNoYW5nZXMgd2VyZSBwcmVmb3JtZWQgYnkgYGluc2VydENvbnRlbnRgLCByZXR1cm5zIGEgcmFuZ2UgY29sbGFwc2VkCiAqIGF0IHRoZSBpbnNlcnRpb24gcG9zaXRpb24uCiAqLwoKZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gaW5zZXJ0Q29udGVudChtb2RlbCwgY29udGVudCwgc2VsZWN0YWJsZSwgcGxhY2VPck9mZnNldCkgewogIHJldHVybiBtb2RlbC5jaGFuZ2Uod3JpdGVyID0+IHsKICAgIGxldCBzZWxlY3Rpb247CgogICAgaWYgKCFzZWxlY3RhYmxlKSB7CiAgICAgIHNlbGVjdGlvbiA9IG1vZGVsLmRvY3VtZW50LnNlbGVjdGlvbjsKICAgIH0gZWxzZSBpZiAoc2VsZWN0YWJsZSBpbnN0YW5jZW9mIFNlbGVjdGlvbiB8fCBzZWxlY3RhYmxlIGluc3RhbmNlb2YgRG9jdW1lbnRTZWxlY3Rpb24pIHsKICAgICAgc2VsZWN0aW9uID0gc2VsZWN0YWJsZTsKICAgIH0gZWxzZSB7CiAgICAgIHNlbGVjdGlvbiA9IHdyaXRlci5jcmVhdGVTZWxlY3Rpb24oc2VsZWN0YWJsZSwgcGxhY2VPck9mZnNldCk7CiAgICB9CgogICAgY29uc3QgaW5zZXJ0aW9uUG9zaXRpb24gPSBzZWxlY3Rpb24uZ2V0Rmlyc3RQb3NpdGlvbigpOwoKICAgIGlmICghc2VsZWN0aW9uLmlzQ29sbGFwc2VkKSB7CiAgICAgIG1vZGVsLmRlbGV0ZUNvbnRlbnQoc2VsZWN0aW9uLCB7CiAgICAgICAgZG9Ob3RBdXRvcGFyYWdyYXBoOiB0cnVlCiAgICAgIH0pOwogICAgfQoKICAgIGNvbnN0IGluc2VydGlvbiA9IG5ldyBJbnNlcnRpb24obW9kZWwsIHdyaXRlciwgaW5zZXJ0aW9uUG9zaXRpb24pOwogICAgbGV0IG5vZGVzVG9JbnNlcnQ7CgogICAgaWYgKGNvbnRlbnQuaXMoJ2RvY3VtZW50RnJhZ21lbnQnKSkgewogICAgICBub2Rlc1RvSW5zZXJ0ID0gY29udGVudC5nZXRDaGlsZHJlbigpOwogICAgfSBlbHNlIHsKICAgICAgbm9kZXNUb0luc2VydCA9IFtjb250ZW50XTsKICAgIH0KCiAgICBpbnNlcnRpb24uaGFuZGxlTm9kZXMobm9kZXNUb0luc2VydCwgewogICAgICAvLyBUaGUgc2V0IG9mIGNoaWxkcmVuIGJlaW5nIGluc2VydGVkIGlzIHRoZSBvbmx5IHNldCBpbiB0aGlzIGNvbnRleHQKICAgICAgLy8gc28gaXQncyB0aGUgZmlyc3QgYW5kIGxhc3QgKGl0J3MgYSBoYWNrIDspKS4KICAgICAgaXNGaXJzdDogdHJ1ZSwKICAgICAgaXNMYXN0OiB0cnVlCiAgICB9KTsKICAgIGNvbnN0IG5ld1JhbmdlID0gaW5zZXJ0aW9uLmdldFNlbGVjdGlvblJhbmdlKCk7CiAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgZWxzZSAqLwoKICAgIGlmIChuZXdSYW5nZSkgewogICAgICBpZiAoc2VsZWN0aW9uIGluc3RhbmNlb2YgRG9jdW1lbnRTZWxlY3Rpb24pIHsKICAgICAgICB3cml0ZXIuc2V0U2VsZWN0aW9uKG5ld1JhbmdlKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBzZWxlY3Rpb24uc2V0VG8obmV3UmFuZ2UpOwogICAgICB9CiAgICB9IGVsc2Ugey8vIFdlIGFyZSBub3QgdGVzdGluZyBlbHNlIGJlY2F1c2UgaXQncyBhIHNhZmUgY2hlY2sgZm9yIHVucHJlZGljdGFibGUgZWRnZSBjYXNlczoKICAgICAgLy8gYW4gaW5zZXJ0aW9uIHdpdGhvdXQgcHJvcGVyIHJhbmdlIHRvIHNlbGVjdC4KICAgICAgLy8KICAgICAgLy8gQGlmIENLX0RFQlVHIC8vIGNvbnNvbGUud2FybiggJ0Nhbm5vdCBkZXRlcm1pbmUgYSBwcm9wZXIgc2VsZWN0aW9uIHJhbmdlIGFmdGVyIGluc2VydGlvbi4nICk7CiAgICB9CgogICAgY29uc3QgYWZmZWN0ZWRSYW5nZSA9IGluc2VydGlvbi5nZXRBZmZlY3RlZFJhbmdlKCkgfHwgbW9kZWwuY3JlYXRlUmFuZ2UoaW5zZXJ0aW9uUG9zaXRpb24pOwogICAgaW5zZXJ0aW9uLmRlc3Ryb3koKTsKICAgIHJldHVybiBhZmZlY3RlZFJhbmdlOwogIH0pOwp9Ci8qKgogKiBVdGlsaXR5IGNsYXNzIGZvciBwZXJmb3JtaW5nIGNvbnRlbnQgaW5zZXJ0aW9uLgogKgogKiBAcHJpdmF0ZQogKi8KCmNsYXNzIEluc2VydGlvbiB7CiAgY29uc3RydWN0b3IobW9kZWwsIHdyaXRlciwgcG9zaXRpb24pIHsKICAgIC8qKgogICAgICogVGhlIG1vZGVsIGluIGNvbnRleHQgb2Ygd2hpY2ggdGhlIGluc2VydGlvbiBzaG91bGQgYmUgcGVyZm9ybWVkLgogICAgICoKICAgICAqIEBtZW1iZXIge21vZHVsZTplbmdpbmUvbW9kZWx+TW9kZWx9ICNtb2RlbAogICAgICovCiAgICB0aGlzLm1vZGVsID0gbW9kZWw7CiAgICAvKioKICAgICAqIEJhdGNoIHRvIHdoaWNoIG9wZXJhdGlvbnMgd2lsbCBiZSBhZGRlZC4KICAgICAqCiAgICAgKiBAbWVtYmVyIHttb2R1bGU6ZW5naW5lL2NvbnRyb2xsZXIvd3JpdGVyfkJhdGNofSAjd3JpdGVyCiAgICAgKi8KCiAgICB0aGlzLndyaXRlciA9IHdyaXRlcjsKICAgIC8qKgogICAgICogVGhlIHBvc2l0aW9uIGF0IHdoaWNoIChvciBuZWFyIHdoaWNoKSB0aGUgbmV4dCBub2RlIHdpbGwgYmUgaW5zZXJ0ZWQuCiAgICAgKgogICAgICogQG1lbWJlciB7bW9kdWxlOmVuZ2luZS9tb2RlbC9wb3NpdGlvbn5Qb3NpdGlvbn0gI3Bvc2l0aW9uCiAgICAgKi8KCiAgICB0aGlzLnBvc2l0aW9uID0gcG9zaXRpb247CiAgICAvKioKICAgICAqIEVsZW1lbnRzIHdpdGggd2hpY2ggdGhlIGluc2VydGVkIGVsZW1lbnRzIGNhbiBiZSBtZXJnZWQuCiAgICAgKgogICAgICoJCTxwPnhePC9wPjxwPnk8L3A+ICsgPHA+ejwvcD4gKGNhbiBtZXJnZSB0byA8cD54PC9wPikKICAgICAqCQk8cD54PC9wPjxwPl55PC9wPiArIDxwPno8L3A+IChjYW4gbWVyZ2UgdG8gPHA+eTwvcD4pCiAgICAgKgkJPHA+eF55PC9wPiArIDxwPno8L3A+IChjYW4gbWVyZ2UgdG8gPHA+eHk8L3A+IHdoaWNoIHdpbGwgYmUgc3BsaXQgZHVyaW5nIHRoZSBhY3Rpb24sCiAgICAgKgkJCQkJCQkJc28gYm90aCBpdHMgcGllY2VzIHdpbGwgYmUgYWRkZWQgdG8gdGhpcyBzZXQpCiAgICAgKgogICAgICoKICAgICAqIEBtZW1iZXIge1NldH0gI2Nhbk1lcmdlV2l0aAogICAgICovCgogICAgdGhpcy5jYW5NZXJnZVdpdGggPSBuZXcgU2V0KFt0aGlzLnBvc2l0aW9uLnBhcmVudF0pOwogICAgLyoqCiAgICAgKiBTY2hlbWEgb2YgdGhlIG1vZGVsLgogICAgICoKICAgICAqIEBtZW1iZXIge21vZHVsZTplbmdpbmUvbW9kZWwvc2NoZW1hflNjaGVtYX0gI3NjaGVtYQogICAgICovCgogICAgdGhpcy5zY2hlbWEgPSBtb2RlbC5zY2hlbWE7CiAgICB0aGlzLl9maWx0ZXJBdHRyaWJ1dGVzT2YgPSBbXTsKICAgIC8qKgogICAgICogQmVnaW5uaW5nIG9mIHRoZSBhZmZlY3RlZCByYW5nZS4gU2VlIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL3V0aWxzL2luc2VydGNvbnRlbnR+SW5zZXJ0aW9uI2dldEFmZmVjdGVkUmFuZ2V9LgogICAgICoKICAgICAqIEBwcml2YXRlCiAgICAgKiBAbWVtYmVyIHttb2R1bGU6ZW5naW5lL21vZGVsL2xpdmVwb3NpdGlvbn5MaXZlUG9zaXRpb258bnVsbH0gI19hZmZlY3RlZFN0YXJ0CiAgICAgKi8KCiAgICB0aGlzLl9hZmZlY3RlZFN0YXJ0ID0gbnVsbDsKICAgIC8qKgogICAgICogRW5kIG9mIHRoZSBhZmZlY3RlZCByYW5nZS4gU2VlIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL3V0aWxzL2luc2VydGNvbnRlbnR+SW5zZXJ0aW9uI2dldEFmZmVjdGVkUmFuZ2V9LgogICAgICoKICAgICAqIEBwcml2YXRlCiAgICAgKiBAbWVtYmVyIHttb2R1bGU6ZW5naW5lL21vZGVsL2xpdmVwb3NpdGlvbn5MaXZlUG9zaXRpb258bnVsbH0gI19hZmZlY3RlZEVuZAogICAgICovCgogICAgdGhpcy5fYWZmZWN0ZWRFbmQgPSBudWxsOwogIH0KICAvKioKICAgKiBIYW5kbGVzIGluc2VydGlvbiBvZiBhIHNldCBvZiBub2Rlcy4KICAgKgogICAqIEBwYXJhbSB7SXRlcmFibGUuPG1vZHVsZTplbmdpbmUvbW9kZWwvbm9kZX5Ob2RlPn0gbm9kZXMgTm9kZXMgdG8gaW5zZXJ0LgogICAqIEBwYXJhbSB7T2JqZWN0fSBwYXJlbnRDb250ZXh0IENvbnRleHQgaW4gd2hpY2ggcGFyZW50IG9mIHRoZXNlIG5vZGVzIHdhcyBzdXBwb3NlZCB0byBiZSBpbnNlcnRlZC4KICAgKiBJZiB0aGUgcGFyZW50IGNvbnRleHQgaXMgcGFzc2VkIGl0IG1lYW5zIHRoYXQgdGhlIHBhcmVudCBlbGVtZW50IHdhcyBzdHJpcHBlZCAod2FzIG5vdCBhbGxvd2VkKS4KICAgKi8KCgogIGhhbmRsZU5vZGVzKG5vZGVzLCBwYXJlbnRDb250ZXh0KSB7CiAgICBub2RlcyA9IEFycmF5LmZyb20obm9kZXMpOwoKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbm9kZXMubGVuZ3RoOyBpKyspIHsKICAgICAgY29uc3Qgbm9kZSA9IG5vZGVzW2ldOwoKICAgICAgdGhpcy5faGFuZGxlTm9kZShub2RlLCB7CiAgICAgICAgaXNGaXJzdDogaSA9PT0gMCAmJiBwYXJlbnRDb250ZXh0LmlzRmlyc3QsCiAgICAgICAgaXNMYXN0OiBpID09PSBub2Rlcy5sZW5ndGggLSAxICYmIHBhcmVudENvbnRleHQuaXNMYXN0CiAgICAgIH0pOwogICAgfSAvLyBUTVAgdGhpcyB3aWxsIGJlY29tZSBhIHBvc3QtZml4ZXIuCgoKICAgIHRoaXMuc2NoZW1hLnJlbW92ZURpc2FsbG93ZWRBdHRyaWJ1dGVzKHRoaXMuX2ZpbHRlckF0dHJpYnV0ZXNPZiwgdGhpcy53cml0ZXIpOwogICAgdGhpcy5fZmlsdGVyQXR0cmlidXRlc09mID0gW107CiAgfQogIC8qKgogICAqIFJldHVybnMgcmFuZ2UgdG8gYmUgc2VsZWN0ZWQgYWZ0ZXIgaW5zZXJ0aW9uLgogICAqIFJldHVybnMgYG51bGxgIGlmIHRoZXJlIGlzIG5vIHZhbGlkIHJhbmdlIHRvIHNlbGVjdCBhZnRlciBpbnNlcnRpb24uCiAgICoKICAgKiBAcmV0dXJucyB7bW9kdWxlOmVuZ2luZS9tb2RlbC9yYW5nZX5SYW5nZXxudWxsfQogICAqLwoKCiAgZ2V0U2VsZWN0aW9uUmFuZ2UoKSB7CiAgICBpZiAodGhpcy5ub2RlVG9TZWxlY3QpIHsKICAgICAgcmV0dXJuIFJhbmdlLl9jcmVhdGVPbih0aGlzLm5vZGVUb1NlbGVjdCk7CiAgICB9CgogICAgcmV0dXJuIHRoaXMubW9kZWwuc2NoZW1hLmdldE5lYXJlc3RTZWxlY3Rpb25SYW5nZSh0aGlzLnBvc2l0aW9uKTsKICB9CiAgLyoqCiAgICogUmV0dXJucyBhIHJhbmdlIHdoaWNoIGNvbnRhaW5zIGFsbCB0aGUgcGVyZm9ybWVkIGNoYW5nZXMuIFRoaXMgaXMgYSByYW5nZSB0aGF0LCBpZiByZW1vdmVkLCB3b3VsZCByZXR1cm4gdGhlIG1vZGVsIHRvIHRoZSBzdGF0ZQogICAqIGJlZm9yZSB0aGUgaW5zZXJ0aW9uLiBSZXR1cm5zIGBudWxsYCBpZiBubyBjaGFuZ2VzIHdlcmUgZG9uZS4KICAgKgogICAqIEByZXR1cm5zIHttb2R1bGU6ZW5naW5lL21vZGVsL3JhbmdlflJhbmdlfG51bGx9CiAgICovCgoKICBnZXRBZmZlY3RlZFJhbmdlKCkgewogICAgaWYgKCF0aGlzLl9hZmZlY3RlZFN0YXJ0KSB7CiAgICAgIHJldHVybiBudWxsOwogICAgfQoKICAgIHJldHVybiBuZXcgUmFuZ2UodGhpcy5fYWZmZWN0ZWRTdGFydCwgdGhpcy5fYWZmZWN0ZWRFbmQpOwogIH0KICAvKioKICAgKiBEZXN0cm95cyBgSW5zZXJ0aW9uYCBpbnN0YW5jZS4KICAgKi8KCgogIGRlc3Ryb3koKSB7CiAgICBpZiAodGhpcy5fYWZmZWN0ZWRTdGFydCkgewogICAgICB0aGlzLl9hZmZlY3RlZFN0YXJ0LmRldGFjaCgpOwogICAgfQoKICAgIGlmICh0aGlzLl9hZmZlY3RlZEVuZCkgewogICAgICB0aGlzLl9hZmZlY3RlZEVuZC5kZXRhY2goKTsKICAgIH0KICB9CiAgLyoqCiAgICogSGFuZGxlcyBpbnNlcnRpb24gb2YgYSBzaW5nbGUgbm9kZS4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHttb2R1bGU6ZW5naW5lL21vZGVsL25vZGV+Tm9kZX0gbm9kZQogICAqIEBwYXJhbSB7T2JqZWN0fSBjb250ZXh0CiAgICogQHBhcmFtIHtCb29sZWFufSBjb250ZXh0LmlzRmlyc3QgV2hldGhlciB0aGUgZ2l2ZW4gbm9kZSBpcyB0aGUgZmlyc3Qgb25lIGluIHRoZSBjb250ZW50IHRvIGJlIGluc2VydGVkLgogICAqIEBwYXJhbSB7Qm9vbGVhbn0gY29udGV4dC5pc0xhc3QgV2hldGhlciB0aGUgZ2l2ZW4gbm9kZSBpcyB0aGUgbGFzdCBvbmUgaW4gdGhlIGNvbnRlbnQgdG8gYmUgaW5zZXJ0ZWQuCiAgICovCgoKICBfaGFuZGxlTm9kZShub2RlLCBjb250ZXh0KSB7CiAgICAvLyBMZXQncyBoYW5kbGUgb2JqZWN0IGluIGEgc3BlY2lhbCB3YXkuCiAgICAvLyAqIFRoZXkgc2hvdWxkIG5ldmVyIGJlIG1lcmdlZCB3aXRoIG90aGVyIGVsZW1lbnRzLgogICAgLy8gKiBJZiB0aGV5IGFyZSBub3QgYWxsb3dlZCBpbiBhbnkgb2YgdGhlIHNlbGVjdGlvbiBhbmNlc3RvcnMsIHRoZXkgY291bGQgYmUgZWl0aGVyIGF1dG9wYXJhZ3JhcGhlZCBvciB0b3RhbGx5IHJlbW92ZWQuCiAgICBpZiAodGhpcy5zY2hlbWEuaXNPYmplY3Qobm9kZSkpIHsKICAgICAgdGhpcy5faGFuZGxlT2JqZWN0KG5vZGUsIGNvbnRleHQpOwoKICAgICAgcmV0dXJuOwogICAgfSAvLyBUcnkgdG8gZmluZCBhIHBsYWNlIGZvciB0aGUgZ2l2ZW4gbm9kZS4KICAgIC8vIFNwbGl0IHRoZSBwb3NpdGlvbi5wYXJlbnQncyBicmFuY2ggdXAgdG8gYSBwb2ludCB3aGVyZSB0aGUgbm9kZSBjYW4gYmUgaW5zZXJ0ZWQuCiAgICAvLyBJZiBpdCBpc24ndCBhbGxvd2VkIGluIHRoZSB3aG9sZSBicmFuY2gsIHRoZW4gb2YgY291cnNlIGRvbid0IHNwbGl0IGFueXRoaW5nLgoKCiAgICBjb25zdCBpc0FsbG93ZWQgPSB0aGlzLl9jaGVja0FuZFNwbGl0VG9BbGxvd2VkUG9zaXRpb24obm9kZSwgY29udGV4dCk7CgogICAgaWYgKCFpc0FsbG93ZWQpIHsKICAgICAgdGhpcy5faGFuZGxlRGlzYWxsb3dlZE5vZGUobm9kZSwgY29udGV4dCk7CgogICAgICByZXR1cm47CiAgICB9CgogICAgdGhpcy5faW5zZXJ0KG5vZGUpOyAvLyBBZnRlciB0aGUgbm9kZSB3YXMgaW5zZXJ0ZWQgd2UgbWF5IHRyeSB0byBtZXJnZSBpdCB3aXRoIGl0cyBzaWJsaW5ncy4KICAgIC8vIFRoaXMgc2hvdWxkIGhhcHBlbiBvbmx5IGlmIGl0IHdhcyB0aGUgZmlyc3QgYW5kL29yIGxhc3Qgb2YgdGhlIG5vZGVzIChzbyBvbmx5IHdpdGggYm91bmRhcnkgbm9kZXMpCiAgICAvLyBhbmQgb25seSBpZiB0aGUgc2VsZWN0aW9uIHdhcyBpbiB0aG9zZSBlbGVtZW50cyBpbml0aWFsbHkuCiAgICAvLwogICAgLy8gRS5nLjoKICAgIC8vIDxwPnhePC9wPiArIDxwPnk8L3A+ID0+IDxwPng8L3A+PHA+eTwvcD4gPT4gPHA+eHlbXTwvcD4KICAgIC8vIGFuZDoKICAgIC8vIDxwPnheeTwvcD4gKyA8cD56PC9wPiA9PiA8cD54PC9wPl48cD55PC9wPiArIDxwPno8L3A+ID0+IDxwPng8L3A+PHA+ejwvcD48cD55PC9wPiA9PiA8cD54eltdeTwvcD4KICAgIC8vIGJ1dDoKICAgIC8vIDxwPng8L3A+PHA+XjwvcD48cD56PC9wPiArIDxwPnk8L3A+ID0+IDxwPng8L3A+PHA+eTwvcD48cD56PC9wPiAobm8gbWVyZ2luZykKICAgIC8vIDxwPng8L3A+WzxpbWc+XTxwPno8L3A+ICsgPHA+eTwvcD4gPT4gPHA+eDwvcD48cD55PC9wPjxwPno8L3A+IChubyBtZXJnaW5nLCBub3RlOiBhZnRlciBydW5uaW5nIGRlbGV0ZUNvbnRlbnRzCiAgICAvLwkJCQkJCQkJCQkJCQkJCQkJIGl0J3MgZXhhY3RseSB0aGUgc2FtZSBjYXNlIGFzIGFib3ZlKQoKCiAgICB0aGlzLl9tZXJnZVNpYmxpbmdzT2Yobm9kZSwgY29udGV4dCk7CiAgfQogIC8qKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHttb2R1bGU6ZW5naW5lL21vZGVsL2VsZW1lbnR+RWxlbWVudH0gbm9kZSBUaGUgb2JqZWN0IGVsZW1lbnQuCiAgICogQHBhcmFtIHtPYmplY3R9IGNvbnRleHQKICAgKi8KCgogIF9oYW5kbGVPYmplY3Qobm9kZSwgY29udGV4dCkgewogICAgLy8gVHJ5IGZpbmRpbmcgaXQgYSBwbGFjZSBpbiB0aGUgdHJlZS4KICAgIGlmICh0aGlzLl9jaGVja0FuZFNwbGl0VG9BbGxvd2VkUG9zaXRpb24obm9kZSkpIHsKICAgICAgdGhpcy5faW5zZXJ0KG5vZGUpOwogICAgfSAvLyBUcnkgYXV0b3BhcmFncmFwaGluZy4KICAgIGVsc2UgewogICAgICAgIHRoaXMuX3RyeUF1dG9wYXJhZ3JhcGhpbmcobm9kZSwgY29udGV4dCk7CiAgICAgIH0KICB9CiAgLyoqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0ge21vZHVsZTplbmdpbmUvbW9kZWwvbm9kZX5Ob2RlfSBub2RlIFRoZSBkaXNhbGxvd2VkIG5vZGUgd2hpY2ggbmVlZHMgdG8gYmUgaGFuZGxlZC4KICAgKiBAcGFyYW0ge09iamVjdH0gY29udGV4dAogICAqLwoKCiAgX2hhbmRsZURpc2FsbG93ZWROb2RlKG5vZGUsIGNvbnRleHQpIHsKICAgIC8vIElmIHRoZSBub2RlIGlzIGFuIGVsZW1lbnQsIHRyeSBpbnNlcnRpbmcgaXRzIGNoaWxkcmVuIChzdHJpcCB0aGUgcGFyZW50KS4KICAgIGlmIChub2RlLmlzKCdlbGVtZW50JykpIHsKICAgICAgdGhpcy5oYW5kbGVOb2Rlcyhub2RlLmdldENoaWxkcmVuKCksIGNvbnRleHQpOwogICAgfSAvLyBJZiB0ZXh0IGlzIG5vdCBhbGxvd2VkLCB0cnkgYXV0b3BhcmFncmFwaGluZyBpdC4KICAgIGVsc2UgewogICAgICAgIHRoaXMuX3RyeUF1dG9wYXJhZ3JhcGhpbmcobm9kZSwgY29udGV4dCk7CiAgICAgIH0KICB9CiAgLyoqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0ge21vZHVsZTplbmdpbmUvbW9kZWwvbm9kZX5Ob2RlfSBub2RlIFRoZSBub2RlIHRvIGluc2VydC4KICAgKi8KCgogIF9pbnNlcnQobm9kZSkgewogICAgLyogaXN0YW5idWwgaWdub3JlIGlmICovCiAgICBpZiAoIXRoaXMuc2NoZW1hLmNoZWNrQ2hpbGQodGhpcy5wb3NpdGlvbiwgbm9kZSkpIHsKICAgICAgLy8gQWxnb3JpdGhtJ3MgY29ycmVjdG5lc3MgY2hlY2suIFdlIHNob3VsZCBuZXZlciBlbmQgdXAgaGVyZSBidXQgaXQncyBnb29kIHRvIGtub3cgdGhhdCB3ZSBkaWQuCiAgICAgIC8vIE5vdGUgdGhhdCBpdCB3b3VsZCBvZnRlbiBiZSBhIHNpbGVudCBpc3N1ZSBpZiB3ZSBpbnNlcnQgbm9kZSBpbiBhIHBsYWNlIHdoZXJlIGl0J3Mgbm90IGFsbG93ZWQuCgogICAgICAvKioKICAgICAgICogR2l2ZW4gbm9kZSBjYW5ub3QgYmUgaW5zZXJ0ZWQgb24gdGhlIGdpdmVuIHBvc2l0aW9uLgogICAgICAgKgogICAgICAgKiBAZXJyb3IgaW5zZXJ0Y29udGVudC13cm9uZy1wb3NpdGlvbgogICAgICAgKiBAcGFyYW0ge21vZHVsZTplbmdpbmUvbW9kZWwvbm9kZX5Ob2RlfSBub2RlIE5vZGUgdG8gaW5zZXJ0LgogICAgICAgKiBAcGFyYW0ge21vZHVsZTplbmdpbmUvbW9kZWwvcG9zaXRpb25+UG9zaXRpb259IHBvc2l0aW9uIFBvc2l0aW9uIHRvIGluc2VydCB0aGUgbm9kZSBhdC4KICAgICAgICovCiAgICAgIHRocm93IG5ldyBDS0VkaXRvckVycm9yKCdpbnNlcnRjb250ZW50LXdyb25nLXBvc2l0aW9uOiBHaXZlbiBub2RlIGNhbm5vdCBiZSBpbnNlcnRlZCBvbiB0aGUgZ2l2ZW4gcG9zaXRpb24uJywgdGhpcywgewogICAgICAgIG5vZGUsCiAgICAgICAgcG9zaXRpb246IHRoaXMucG9zaXRpb24KICAgICAgfSk7CiAgICB9CgogICAgY29uc3QgbGl2ZVBvcyA9IExpdmVQb3NpdGlvbi5mcm9tUG9zaXRpb24odGhpcy5wb3NpdGlvbiwgJ3RvTmV4dCcpOwoKICAgIHRoaXMuX3NldEFmZmVjdGVkQm91bmRhcmllcyh0aGlzLnBvc2l0aW9uKTsKCiAgICB0aGlzLndyaXRlci5pbnNlcnQobm9kZSwgdGhpcy5wb3NpdGlvbik7CiAgICB0aGlzLnBvc2l0aW9uID0gbGl2ZVBvcy50b1Bvc2l0aW9uKCk7CiAgICBsaXZlUG9zLmRldGFjaCgpOyAvLyBUaGUgbGFzdCBpbnNlcnRlZCBvYmplY3Qgc2hvdWxkIGJlIHNlbGVjdGVkIGJlY2F1c2Ugd2UgY2FuJ3QgcHV0IGEgY29sbGFwc2VkIHNlbGVjdGlvbiBhZnRlciBpdC4KCiAgICBpZiAodGhpcy5zY2hlbWEuaXNPYmplY3Qobm9kZSkgJiYgIXRoaXMuc2NoZW1hLmNoZWNrQ2hpbGQodGhpcy5wb3NpdGlvbiwgJyR0ZXh0JykpIHsKICAgICAgdGhpcy5ub2RlVG9TZWxlY3QgPSBub2RlOwogICAgfSBlbHNlIHsKICAgICAgdGhpcy5ub2RlVG9TZWxlY3QgPSBudWxsOwogICAgfQoKICAgIHRoaXMuX2ZpbHRlckF0dHJpYnV0ZXNPZi5wdXNoKG5vZGUpOwogIH0KICAvKioKICAgKiBTZXRzIGBfYWZmZWN0ZWRTdGFydGAgYW5kIGBfYWZmZWN0ZWRFbmRgIHRvIHRoZSBnaXZlbiBgcG9zaXRpb25gLiBTaG91bGQgYmUgdXNlZCBiZWZvcmUgYSBjaGFuZ2UgaXMgZG9uZSBkdXJpbmcgaW5zZXJ0aW9uIHByb2Nlc3MgdG8KICAgKiBtYXJrIHRoZSBhZmZlY3RlZCByYW5nZS4KICAgKgogICAqIFRoaXMgbWV0aG9kIGlzIHVzZWQgYmVmb3JlIGluc2VydGluZyBhIG5vZGUgb3Igc3BsaXR0aW5nIGEgcGFyZW50IG5vZGUuIGBfYWZmZWN0ZWRTdGFydGAgYW5kIGBfYWZmZWN0ZWRFbmRgIGFyZSBhbHNvIGNoYW5nZWQKICAgKiBkdXJpbmcgbWVyZ2luZywgYnV0IHRoZSBsb2dpYyB0aGVyZSBpcyBtb3JlIGNvbXBsaWNhdGVkIHNvIGl0IGlzIGxlZnQgb3V0IG9mIHRoaXMgZnVuY3Rpb24uCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBwYXJhbSB7bW9kdWxlOmVuZ2luZS9tb2RlbC9wb3NpdGlvbn5Qb3NpdGlvbn0gcG9zaXRpb24KICAgKi8KCgogIF9zZXRBZmZlY3RlZEJvdW5kYXJpZXMocG9zaXRpb24pIHsKICAgIC8vIFNldCBhZmZlY3RlZCBib3VuZGFyaWVzIHN0aWNraW5lc3Mgc28gdGhhdCB0aG9zZSBwb3NpdGlvbiB3aWxsICJleHBhbmQiIHdoZW4gc29tZXRoaW5nIGlzIGluc2VydGVkIGluIGJldHdlZW4gdGhlbToKICAgIC8vIDxwYXJhZ3JhcGg+Rm9vXVtiYXI8L3BhcmFncmFwaD4gLT4gPHBhcmFncmFwaD5Gb29deHhbYmFyPC9wYXJhZ3JhcGg+CiAgICAvLyBUaGlzIGlzIHdoeSBpdCBjYW5ub3QgYmUgYSByYW5nZSBidXQgdHdvIHNlcGFyYXRlIHBvc2l0aW9ucy4KICAgIGlmICghdGhpcy5fYWZmZWN0ZWRTdGFydCkgewogICAgICB0aGlzLl9hZmZlY3RlZFN0YXJ0ID0gTGl2ZVBvc2l0aW9uLmZyb21Qb3NpdGlvbihwb3NpdGlvbiwgJ3RvUHJldmlvdXMnKTsKICAgIH0gLy8gSWYgYF9hZmZlY3RlZEVuZGAgaXMgYmVmb3JlIHRoZSBuZXcgYm91bmRhcnkgcG9zaXRpb24sIGV4cGFuZCBgX2FmZmVjdGVkRW5kYC4gVGhpcyBjYW4gaGFwcGVuIGlmIGZpcnN0IGluc2VydGVkIG5vZGUgd2FzCiAgICAvLyBpbnNlcnRlZCBpbnRvIHRoZSBwYXJlbnQgYnV0IHRoZSBuZXh0IG5vZGUgaXMgbW92ZWQtb3V0IG9mIHRoYXQgcGFyZW50OgogICAgLy8gKDEpIDxwYXJhZ3JhcGg+Rm9vXVs8L3BhcmFncmFwaD4gLT4gPHBhcmFncmFwaD5Gb29deHhbPC9wYXJhZ3JhcGg+CiAgICAvLyAoMikgPHBhcmFncmFwaD5Gb29deHhbPC9wYXJhZ3JhcGg+IC0+IDxwYXJhZ3JhcGg+Rm9vXXh4PC9wYXJhZ3JhcGg+PHdpZGdldD48L3dpZGdldD5bCgoKICAgIGlmICghdGhpcy5fYWZmZWN0ZWRFbmQgfHwgdGhpcy5fYWZmZWN0ZWRFbmQuaXNCZWZvcmUocG9zaXRpb24pKSB7CiAgICAgIGlmICh0aGlzLl9hZmZlY3RlZEVuZCkgewogICAgICAgIHRoaXMuX2FmZmVjdGVkRW5kLmRldGFjaCgpOwogICAgICB9CgogICAgICB0aGlzLl9hZmZlY3RlZEVuZCA9IExpdmVQb3NpdGlvbi5mcm9tUG9zaXRpb24ocG9zaXRpb24sICd0b05leHQnKTsKICAgIH0KICB9CiAgLyoqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0ge21vZHVsZTplbmdpbmUvbW9kZWwvbm9kZX5Ob2RlfSBub2RlIFRoZSBub2RlIHdoaWNoIGNvdWxkIHBvdGVudGlhbGx5IGJlIG1lcmdlZC4KICAgKiBAcGFyYW0ge09iamVjdH0gY29udGV4dAogICAqLwoKCiAgX21lcmdlU2libGluZ3NPZihub2RlLCBjb250ZXh0KSB7CiAgICBpZiAoIShub2RlIGluc3RhbmNlb2YgRWxlbWVudCkpIHsKICAgICAgcmV0dXJuOwogICAgfQoKICAgIGNvbnN0IG1lcmdlTGVmdCA9IHRoaXMuX2Nhbk1lcmdlTGVmdChub2RlLCBjb250ZXh0KTsKCiAgICBjb25zdCBtZXJnZVJpZ2h0ID0gdGhpcy5fY2FuTWVyZ2VSaWdodChub2RlLCBjb250ZXh0KTsKCiAgICBjb25zdCBtZXJnZVBvc0xlZnQgPSBMaXZlUG9zaXRpb24uX2NyZWF0ZUJlZm9yZShub2RlKTsKCiAgICBtZXJnZVBvc0xlZnQuc3RpY2tpbmVzcyA9ICd0b05leHQnOwoKICAgIGNvbnN0IG1lcmdlUG9zUmlnaHQgPSBMaXZlUG9zaXRpb24uX2NyZWF0ZUFmdGVyKG5vZGUpOwoKICAgIG1lcmdlUG9zUmlnaHQuc3RpY2tpbmVzcyA9ICd0b05leHQnOwoKICAgIGlmIChtZXJnZUxlZnQpIHsKICAgICAgY29uc3QgbGl2ZVBvc2l0aW9uID0gTGl2ZVBvc2l0aW9uLmZyb21Qb3NpdGlvbih0aGlzLnBvc2l0aW9uKTsKICAgICAgbGl2ZVBvc2l0aW9uLnN0aWNraW5lc3MgPSAndG9OZXh0JzsgLy8gSWYgYF9hZmZlY3RlZFN0YXJ0YCBpcyBzYW1lcyBhcyBtZXJnZSBwb3NpdGlvbiwgaXQgbWVhbnMgdGhhdCB0aGUgZWxlbWVudCAibWFya2VkIiBieSBgX2FmZmVjdGVkU3RhcnRgIGlzIGdvaW5nIHRvIGJlCiAgICAgIC8vIHJlbW92ZWQgYW5kIGl0cyBjb250ZW50cyB3aWxsIGJlIG1vdmVkLiBUaGlzIHdvbid0IHRyYW5zZm9ybSBgTGl2ZVBvc2l0aW9uYCBzbyBgX2FmZmVjdGVkU3RhcnRgIG5lZWRzIHRvIGJlIG1vdmVkCiAgICAgIC8vIGJ5IGhhbmQgdG8gcHJvcGVybHkgcmVmbGVjdCBhZmZlY3RlZCByYW5nZS4gKER1ZSB0byBgX2FmZmVjdGVkU3RhcnRgIGFuZCBgX2FmZmVjdGVkRW5kYCBzdGlja2luZXNzLCB0aGUgInJhbmdlIiBpcwogICAgICAvLyBzaG93biBhcyBgXVtgKS4KICAgICAgLy8KICAgICAgLy8gRXhhbXBsZSAtIGluc2VydCBgPHBhcmFncmFwaD5BYmM8L3BhcmFncmFwaD48cGFyYWdyYXBoPlh5ejwvcGFyYWdyYXBoPmAgYXQgdGhlIGVuZCBvZiBgPHBhcmFncmFwaD5Gb29ePC9wYXJhZ3JhcGg+YDoKICAgICAgLy8KICAgICAgLy8gPHBhcmFncmFwaD5Gb288L3BhcmFncmFwaD48cGFyYWdyYXBoPkJhcjwvcGFyYWdyYXBoPiAgIC0tPgogICAgICAvLyA8cGFyYWdyYXBoPkZvbzwvcGFyYWdyYXBoPl08cGFyYWdyYXBoPkFiYzwvcGFyYWdyYXBoPjxwYXJhZ3JhcGg+WHl6PC9wYXJhZ3JhcGg+WzxwYXJhZ3JhcGg+QmFyPC9wYXJhZ3JhcGg+ICAgLS0+CiAgICAgIC8vIDxwYXJhZ3JhcGg+Rm9vXUFiYzwvcGFyYWdyYXBoPjxwYXJhZ3JhcGg+WHl6PC9wYXJhZ3JhcGg+WzxwYXJhZ3JhcGg+QmFyPC9wYXJhZ3JhcGg+CiAgICAgIC8vCiAgICAgIC8vIE5vdGUsIHRoYXQgaWYgd2UgYXJlIGhlcmUgdGhlbiBzb21ldGhpbmcgbXVzdCBoYXZlIGJlZW4gaW5zZXJ0ZWQsIHNvIGBfYWZmZWN0ZWRTdGFydGAgYW5kIGBfYWZmZWN0ZWRFbmRgIGhhdmUgdG8gYmUgc2V0LgoKICAgICAgaWYgKHRoaXMuX2FmZmVjdGVkU3RhcnQuaXNFcXVhbChtZXJnZVBvc0xlZnQpKSB7CiAgICAgICAgdGhpcy5fYWZmZWN0ZWRTdGFydC5kZXRhY2goKTsKCiAgICAgICAgdGhpcy5fYWZmZWN0ZWRTdGFydCA9IExpdmVQb3NpdGlvbi5fY3JlYXRlQXQobWVyZ2VQb3NMZWZ0Lm5vZGVCZWZvcmUsICdlbmQnLCAndG9QcmV2aW91cycpOwogICAgICB9CgogICAgICB0aGlzLndyaXRlci5tZXJnZShtZXJnZVBvc0xlZnQpOyAvLyBJZiBvbmx5IG9uZSBlbGVtZW50ICh0aGUgbWVyZ2VkIG9uZSkgaXMgaW4gdGhlICJhZmZlY3RlZCByYW5nZSIsIGFsc28gbW92ZSB0aGUgYWZmZWN0ZWQgcmFuZ2UgZW5kIGFwcHJvcHJpYXRlbHkuCiAgICAgIC8vCiAgICAgIC8vIEV4YW1wbGUgLSBpbnNlcnQgYDxwYXJhZ3JhcGg+QWJjPC9wYXJhZ3JhcGg+YCBhdCB0aGUgb2YgYDxwYXJhZ3JhcGg+Rm9vXjwvcGFyYWdyYXBoPmA6CiAgICAgIC8vCiAgICAgIC8vIDxwYXJhZ3JhcGg+Rm9vPC9wYXJhZ3JhcGg+PHBhcmFncmFwaD5CYXI8L3BhcmFncmFwaD4gICAtLT4KICAgICAgLy8gPHBhcmFncmFwaD5Gb288L3BhcmFncmFwaD5dPHBhcmFncmFwaD5BYmM8L3BhcmFncmFwaD5bPHBhcmFncmFwaD5CYXI8L3BhcmFncmFwaD4gICAtLT4KICAgICAgLy8gPHBhcmFncmFwaD5Gb29dQWJjPC9wYXJhZ3JhcGg+WzxwYXJhZ3JhcGg+QmFyPC9wYXJhZ3JhcGg+ICAgLS0+CiAgICAgIC8vIDxwYXJhZ3JhcGg+Rm9vXUFiY1s8L3BhcmFncmFwaD48cGFyYWdyYXBoPkJhcjwvcGFyYWdyYXBoPgoKICAgICAgaWYgKG1lcmdlUG9zTGVmdC5pc0VxdWFsKHRoaXMuX2FmZmVjdGVkRW5kKSAmJiBjb250ZXh0LmlzTGFzdCkgewogICAgICAgIHRoaXMuX2FmZmVjdGVkRW5kLmRldGFjaCgpOwoKICAgICAgICB0aGlzLl9hZmZlY3RlZEVuZCA9IExpdmVQb3NpdGlvbi5fY3JlYXRlQXQobWVyZ2VQb3NMZWZ0Lm5vZGVCZWZvcmUsICdlbmQnLCAndG9OZXh0Jyk7CiAgICAgIH0KCiAgICAgIHRoaXMucG9zaXRpb24gPSBsaXZlUG9zaXRpb24udG9Qb3NpdGlvbigpOwogICAgICBsaXZlUG9zaXRpb24uZGV0YWNoKCk7CiAgICB9CgogICAgaWYgKG1lcmdlUmlnaHQpIHsKICAgICAgLyogaXN0YW5idWwgaWdub3JlIGlmICovCiAgICAgIGlmICghdGhpcy5wb3NpdGlvbi5pc0VxdWFsKG1lcmdlUG9zUmlnaHQpKSB7CiAgICAgICAgLy8gQWxnb3JpdGhtJ3MgY29ycmVjdG5lc3MgY2hlY2suIFdlIHNob3VsZCBuZXZlciBlbmQgdXAgaGVyZSBidXQgaXQncyBnb29kIHRvIGtub3cgdGhhdCB3ZSBkaWQuCiAgICAgICAgLy8gQXQgdGhpcyBwb2ludCB0aGUgaW5zZXJ0aW9uIHBvc2l0aW9uIHNob3VsZCBiZSBhZnRlciB0aGUgbm9kZSB3ZSdsbCBtZXJnZS4gSWYgaXQgaXNuJ3QsCiAgICAgICAgLy8gaXQgc2hvdWxkIG5lZWQgdG8gYmUgc2VjdXJlZCBhcyBpbiB0aGUgbGVmdCBtZXJnZSBjYXNlLgoKICAgICAgICAvKioKICAgICAgICAgKiBBbiBpbnRlcm5hbCBlcnJvciBvY2N1cmVkIGR1cmluZyBtZXJnaW5nIGluc2VydGlvbiBjb250ZW50IHdpdGggc2libGluZ3MuCiAgICAgICAgICogVGhlIGluc2VydGlvbiBwb3NpdGlvbiBzaG91bGQgZXF1YWwgdG8gdGhlIG1lcmdlIHBvc2l0aW9uLgogICAgICAgICAqCiAgICAgICAgICogQGVycm9yIGluc2VydGNvbnRlbnQtaW52YWxpZC1pbnNlcnRpb24tcG9zaXRpb24KICAgICAgICAgKi8KICAgICAgICB0aHJvdyBuZXcgQ0tFZGl0b3JFcnJvcignaW5zZXJ0Y29udGVudC1pbnZhbGlkLWluc2VydGlvbi1wb3NpdGlvbicsIHRoaXMpOwogICAgICB9IC8vIE1vdmUgdGhlIHBvc2l0aW9uIHRvIHRoZSBwcmV2aW91cyBub2RlLCBzbyBpdCBpc24ndCBtb3ZlZCB0byB0aGUgZ3JhdmV5YXJkIG9uIG1lcmdlLgogICAgICAvLyA8cD54PC9wPltdPHA+eTwvcD4gPT4gPHA+eFtdPC9wPjxwPnk8L3A+CgoKICAgICAgdGhpcy5wb3NpdGlvbiA9IFBvc2l0aW9uLl9jcmVhdGVBdChtZXJnZVBvc1JpZ2h0Lm5vZGVCZWZvcmUsICdlbmQnKTsgLy8gT0s6ICA8cD54eFtdPC9wPiArIDxwPnl5PC9wPiA9PiA8cD54eFtdeXk8L3A+ICh3aGVuIHN0aWNrcyB0byBwcmV2aW91cykKICAgICAgLy8gTk9LOiA8cD54eFtdPC9wPiArIDxwPnl5PC9wPiA9PiA8cD54eHl5W108L3A+ICh3aGVuIHN0aWNrcyB0byBuZXh0KQoKICAgICAgY29uc3QgbGl2ZVBvc2l0aW9uID0gTGl2ZVBvc2l0aW9uLmZyb21Qb3NpdGlvbih0aGlzLnBvc2l0aW9uLCAndG9QcmV2aW91cycpOyAvLyBTZWUgY29tbWVudCBhYm92ZSBvbiBtb3ZpbmcgYF9hZmZlY3RlZFN0YXJ0YC4KCiAgICAgIGlmICh0aGlzLl9hZmZlY3RlZEVuZC5pc0VxdWFsKG1lcmdlUG9zUmlnaHQpKSB7CiAgICAgICAgdGhpcy5fYWZmZWN0ZWRFbmQuZGV0YWNoKCk7CgogICAgICAgIHRoaXMuX2FmZmVjdGVkRW5kID0gTGl2ZVBvc2l0aW9uLl9jcmVhdGVBdChtZXJnZVBvc1JpZ2h0Lm5vZGVCZWZvcmUsICdlbmQnLCAndG9OZXh0Jyk7CiAgICAgIH0KCiAgICAgIHRoaXMud3JpdGVyLm1lcmdlKG1lcmdlUG9zUmlnaHQpOyAvLyBTZWUgY29tbWVudCBhYm92ZSBvbiBtb3ZpbmcgYF9hZmZlY3RlZFN0YXJ0YC4KCiAgICAgIGlmIChtZXJnZVBvc1JpZ2h0LmdldFNoaWZ0ZWRCeSgtMSkuaXNFcXVhbCh0aGlzLl9hZmZlY3RlZFN0YXJ0KSAmJiBjb250ZXh0LmlzRmlyc3QpIHsKICAgICAgICB0aGlzLl9hZmZlY3RlZFN0YXJ0LmRldGFjaCgpOwoKICAgICAgICB0aGlzLl9hZmZlY3RlZFN0YXJ0ID0gTGl2ZVBvc2l0aW9uLl9jcmVhdGVBdChtZXJnZVBvc1JpZ2h0Lm5vZGVCZWZvcmUsIDAsICd0b1ByZXZpb3VzJyk7CiAgICAgIH0KCiAgICAgIHRoaXMucG9zaXRpb24gPSBsaXZlUG9zaXRpb24udG9Qb3NpdGlvbigpOwogICAgICBsaXZlUG9zaXRpb24uZGV0YWNoKCk7CiAgICB9CgogICAgaWYgKG1lcmdlTGVmdCB8fCBtZXJnZVJpZ2h0KSB7CiAgICAgIC8vIEFmdGVyIG1lcmdlIGVsZW1lbnRzIHRoYXQgd2VyZSBtYXJrZWQgYnkgX2luc2VydCgpIHRvIGJlIGZpbHRlcmVkIG1pZ2h0IGJlIGdvbmUgc28KICAgICAgLy8gd2UgbmVlZCB0byBtYXJrIHRoZSBuZXcgY29udGFpbmVyLgogICAgICB0aGlzLl9maWx0ZXJBdHRyaWJ1dGVzT2YucHVzaCh0aGlzLnBvc2l0aW9uLnBhcmVudCk7CiAgICB9CgogICAgbWVyZ2VQb3NMZWZ0LmRldGFjaCgpOwogICAgbWVyZ2VQb3NSaWdodC5kZXRhY2goKTsKICB9CiAgLyoqCiAgICogQ2hlY2tzIHdoZXRoZXIgc3BlY2lmaWVkIG5vZGUgY2FuIGJlIG1lcmdlZCB3aXRoIHByZXZpb3VzIHNpYmxpbmcgZWxlbWVudC4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHttb2R1bGU6ZW5naW5lL21vZGVsL25vZGV+Tm9kZX0gbm9kZSBUaGUgbm9kZSB3aGljaCBjb3VsZCBwb3RlbnRpYWxseSBiZSBtZXJnZWQuCiAgICogQHBhcmFtIHtPYmplY3R9IGNvbnRleHQKICAgKiBAcmV0dXJucyB7Qm9vbGVhbn0KICAgKi8KCgogIF9jYW5NZXJnZUxlZnQobm9kZSwgY29udGV4dCkgewogICAgY29uc3QgcHJldmlvdXNTaWJsaW5nID0gbm9kZS5wcmV2aW91c1NpYmxpbmc7CiAgICByZXR1cm4gY29udGV4dC5pc0ZpcnN0ICYmIHByZXZpb3VzU2libGluZyBpbnN0YW5jZW9mIEVsZW1lbnQgJiYgdGhpcy5jYW5NZXJnZVdpdGguaGFzKHByZXZpb3VzU2libGluZykgJiYgdGhpcy5tb2RlbC5zY2hlbWEuY2hlY2tNZXJnZShwcmV2aW91c1NpYmxpbmcsIG5vZGUpOwogIH0KICAvKioKICAgKiBDaGVja3Mgd2hldGhlciBzcGVjaWZpZWQgbm9kZSBjYW4gYmUgbWVyZ2VkIHdpdGggbmV4dCBzaWJsaW5nIGVsZW1lbnQuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBwYXJhbSB7bW9kdWxlOmVuZ2luZS9tb2RlbC9ub2Rlfk5vZGV9IG5vZGUgVGhlIG5vZGUgd2hpY2ggY291bGQgcG90ZW50aWFsbHkgYmUgbWVyZ2VkLgogICAqIEBwYXJhbSB7T2JqZWN0fSBjb250ZXh0CiAgICogQHJldHVybnMge0Jvb2xlYW59CiAgICovCgoKICBfY2FuTWVyZ2VSaWdodChub2RlLCBjb250ZXh0KSB7CiAgICBjb25zdCBuZXh0U2libGluZyA9IG5vZGUubmV4dFNpYmxpbmc7CiAgICByZXR1cm4gY29udGV4dC5pc0xhc3QgJiYgbmV4dFNpYmxpbmcgaW5zdGFuY2VvZiBFbGVtZW50ICYmIHRoaXMuY2FuTWVyZ2VXaXRoLmhhcyhuZXh0U2libGluZykgJiYgdGhpcy5tb2RlbC5zY2hlbWEuY2hlY2tNZXJnZShub2RlLCBuZXh0U2libGluZyk7CiAgfQogIC8qKgogICAqIFRyaWVzIHdyYXBwaW5nIHRoZSBub2RlIGluIGEgbmV3IHBhcmFncmFwaCBhbmQgaW5zZXJ0aW5nIGl0IHRoaXMgd2F5LgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0ge21vZHVsZTplbmdpbmUvbW9kZWwvbm9kZX5Ob2RlfSBub2RlIFRoZSBub2RlIHdoaWNoIG5lZWRzIHRvIGJlIGF1dG9wYXJhZ3JhcGhlZC4KICAgKiBAcGFyYW0ge09iamVjdH0gY29udGV4dAogICAqLwoKCiAgX3RyeUF1dG9wYXJhZ3JhcGhpbmcobm9kZSwgY29udGV4dCkgewogICAgY29uc3QgcGFyYWdyYXBoID0gdGhpcy53cml0ZXIuY3JlYXRlRWxlbWVudCgncGFyYWdyYXBoJyk7IC8vIERvIG5vdCBhdXRvcGFyYWdyYXBoIGlmIHRoZSBwYXJhZ3JhcGggd29uJ3QgYmUgYWxsb3dlZCB0aGVyZSwKICAgIC8vIGNhdXNlIHRoYXQgd291bGQgbGVhZCB0byBhbiBpbmZpbml0ZSBsb29wLiBUaGUgcGFyYWdyYXBoIHdvdWxkIGJlIHJlamVjdGVkIGluCiAgICAvLyB0aGUgbmV4dCBfaGFuZGxlTm9kZSgpIGNhbGwgYW5kIHdlJ2QgYmUgaGVyZSBhZ2Fpbi4KCiAgICBpZiAodGhpcy5fZ2V0QWxsb3dlZEluKHBhcmFncmFwaCwgdGhpcy5wb3NpdGlvbi5wYXJlbnQpICYmIHRoaXMuc2NoZW1hLmNoZWNrQ2hpbGQocGFyYWdyYXBoLCBub2RlKSkgewogICAgICBwYXJhZ3JhcGguX2FwcGVuZENoaWxkKG5vZGUpOwoKICAgICAgdGhpcy5faGFuZGxlTm9kZShwYXJhZ3JhcGgsIGNvbnRleHQpOwogICAgfQogIH0KICAvKioKICAgKiBAcHJpdmF0ZQogICAqIEBwYXJhbSB7bW9kdWxlOmVuZ2luZS9tb2RlbC9ub2Rlfk5vZGV9IG5vZGUKICAgKiBAcmV0dXJucyB7Qm9vbGVhbn0gV2hldGhlciBhbiBhbGxvd2VkIHBvc2l0aW9uIHdhcyBmb3VuZC4KICAgKiBgZmFsc2VgIGlzIHJldHVybmVkIGlmIHRoZSBub2RlIGlzbid0IGFsbG93ZWQgYXQgYW55IHBvc2l0aW9uIHVwIGluIHRoZSB0cmVlLCBgdHJ1ZWAgaWYgd2FzLgogICAqLwoKCiAgX2NoZWNrQW5kU3BsaXRUb0FsbG93ZWRQb3NpdGlvbihub2RlKSB7CiAgICBjb25zdCBhbGxvd2VkSW4gPSB0aGlzLl9nZXRBbGxvd2VkSW4obm9kZSwgdGhpcy5wb3NpdGlvbi5wYXJlbnQpOwoKICAgIGlmICghYWxsb3dlZEluKSB7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICB3aGlsZSAoYWxsb3dlZEluICE9IHRoaXMucG9zaXRpb24ucGFyZW50KSB7CiAgICAgIC8vIElmIGEgcGFyZW50IHdoaWNoIHdlJ2QgbmVlZCB0byBsZWF2ZSBpcyBhIGxpbWl0IGVsZW1lbnQsIGJyZWFrLgogICAgICBpZiAodGhpcy5zY2hlbWEuaXNMaW1pdCh0aGlzLnBvc2l0aW9uLnBhcmVudCkpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLnBvc2l0aW9uLmlzQXRTdGFydCkgewogICAgICAgIC8vIElmIGluc2VydGlvbiBwb3NpdGlvbiBpcyBhdCB0aGUgYmVnaW5uaW5nIG9mIHRoZSBwYXJlbnQsIG1vdmUgaXQgb3V0IGluc3RlYWQgb2Ygc3BsaXR0aW5nLgogICAgICAgIC8vIDxwPl5Gb288L3A+IC0+IF48cD5Gb288L3A+CiAgICAgICAgY29uc3QgcGFyZW50ID0gdGhpcy5wb3NpdGlvbi5wYXJlbnQ7CiAgICAgICAgdGhpcy5wb3NpdGlvbiA9IHRoaXMud3JpdGVyLmNyZWF0ZVBvc2l0aW9uQmVmb3JlKHBhcmVudCk7IC8vIFNwZWNpYWwgY2FzZSDigJMgcGFyZW50IGlzIGVtcHR5ICg8cD5ePC9wPikuCiAgICAgICAgLy8KICAgICAgICAvLyAxLiBwYXJlbnQuaXNFbXB0eQogICAgICAgIC8vIFdlIGNhbiByZW1vdmUgdGhlIGVsZW1lbnQgYWZ0ZXIgbW92aW5nIGluc2VydGlvbiBwb3NpdGlvbiBvdXQgb2YgaXQuCiAgICAgICAgLy8KICAgICAgICAvLyAyLiBwYXJlbnQucGFyZW50ID09PSBhbGxvd2VkSW4KICAgICAgICAvLyBIb3dldmVyIHBhcmVudCBzaG91bGQgcmVtYWluIGluIHBsYWNlIHdoZW4gYWxsb3dlZCBlbGVtZW50IGlzIGFib3ZlIGxpbWl0IGVsZW1lbnQgaW4gZG9jdW1lbnQgdHJlZS4KICAgICAgICAvLyBGb3IgZXhhbXBsZSB0aGVyZSBzaG91bGRuJ3QgYmUgYWxsb3dlZCB0byByZW1vdmUgZW1wdHkgcGFyYWdyYXBoIGZyb20gdGFibGVDZWxsLCB3aGVuIGlzIHBhc3RlZAogICAgICAgIC8vIGNvbnRlbnQgYWxsb3dlZCBpbiAkcm9vdC4KCiAgICAgICAgaWYgKHBhcmVudC5pc0VtcHR5ICYmIHBhcmVudC5wYXJlbnQgPT09IGFsbG93ZWRJbikgewogICAgICAgICAgdGhpcy53cml0ZXIucmVtb3ZlKHBhcmVudCk7CiAgICAgICAgfQogICAgICB9IGVsc2UgaWYgKHRoaXMucG9zaXRpb24uaXNBdEVuZCkgewogICAgICAgIC8vIElmIGluc2VydGlvbiBwb3NpdGlvbiBpcyBhdCB0aGUgZW5kIG9mIHRoZSBwYXJlbnQsIG1vdmUgaXQgb3V0IGluc3RlYWQgb2Ygc3BsaXR0aW5nLgogICAgICAgIC8vIDxwPkZvb148L3A+IC0+IDxwPkZvbzwvcD5eCiAgICAgICAgdGhpcy5wb3NpdGlvbiA9IHRoaXMud3JpdGVyLmNyZWF0ZVBvc2l0aW9uQWZ0ZXIodGhpcy5wb3NpdGlvbi5wYXJlbnQpOwogICAgICB9IGVsc2UgewogICAgICAgIGNvbnN0IHRlbXBQb3MgPSB0aGlzLndyaXRlci5jcmVhdGVQb3NpdGlvbkFmdGVyKHRoaXMucG9zaXRpb24ucGFyZW50KTsKCiAgICAgICAgdGhpcy5fc2V0QWZmZWN0ZWRCb3VuZGFyaWVzKHRoaXMucG9zaXRpb24pOwoKICAgICAgICB0aGlzLndyaXRlci5zcGxpdCh0aGlzLnBvc2l0aW9uKTsKICAgICAgICB0aGlzLnBvc2l0aW9uID0gdGVtcFBvczsKICAgICAgICB0aGlzLmNhbk1lcmdlV2l0aC5hZGQodGhpcy5wb3NpdGlvbi5ub2RlQWZ0ZXIpOwogICAgICB9CiAgICB9CgogICAgcmV0dXJuIHRydWU7CiAgfQogIC8qKgogICAqIEdldHMgdGhlIGVsZW1lbnQgaW4gd2hpY2ggdGhlIGdpdmVuIG5vZGUgaXMgYWxsb3dlZC4gSXQgY2hlY2tzIHRoZSBwYXNzZWQgZWxlbWVudCBhbmQgYWxsIGl0cyBhbmNlc3RvcnMuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBwYXJhbSB7bW9kdWxlOmVuZ2luZS9tb2RlbC9ub2Rlfk5vZGV9IG5vZGUgVGhlIG5vZGUgdG8gY2hlY2suCiAgICogQHBhcmFtIHttb2R1bGU6ZW5naW5lL21vZGVsL2VsZW1lbnR+RWxlbWVudH0gZWxlbWVudCBUaGUgZWxlbWVudCBpbiB3aGljaCB0aGUgbm9kZSdzIGNvcnJlY3RuZXNzIHNob3VsZCBiZSBjaGVja2VkLgogICAqIEByZXR1cm5zIHttb2R1bGU6ZW5naW5lL21vZGVsL2VsZW1lbnR+RWxlbWVudHxudWxsfQogICAqLwoKCiAgX2dldEFsbG93ZWRJbihub2RlLCBlbGVtZW50KSB7CiAgICBpZiAodGhpcy5zY2hlbWEuY2hlY2tDaGlsZChlbGVtZW50LCBub2RlKSkgewogICAgICByZXR1cm4gZWxlbWVudDsKICAgIH0KCiAgICBpZiAoZWxlbWVudC5wYXJlbnQpIHsKICAgICAgcmV0dXJuIHRoaXMuX2dldEFsbG93ZWRJbihub2RlLCBlbGVtZW50LnBhcmVudCk7CiAgICB9CgogICAgcmV0dXJuIG51bGw7CiAgfQoKfQ=="},{"version":3,"sources":["/Users/antonyching/Desktop/project/new-builder-demo/node_modules/@ckeditor/ckeditor5-engine/src/model/utils/insertcontent.js"],"names":["Position","LivePosition","Element","Range","DocumentSelection","Selection","CKEditorError","insertContent","model","content","selectable","placeOrOffset","change","writer","selection","document","createSelection","insertionPosition","getFirstPosition","isCollapsed","deleteContent","doNotAutoparagraph","insertion","Insertion","nodesToInsert","is","getChildren","handleNodes","isFirst","isLast","newRange","getSelectionRange","setSelection","setTo","affectedRange","getAffectedRange","createRange","destroy","constructor","position","canMergeWith","Set","parent","schema","_filterAttributesOf","_affectedStart","_affectedEnd","nodes","parentContext","Array","from","i","length","node","_handleNode","removeDisallowedAttributes","nodeToSelect","_createOn","getNearestSelectionRange","detach","context","isObject","_handleObject","isAllowed","_checkAndSplitToAllowedPosition","_handleDisallowedNode","_insert","_mergeSiblingsOf","_tryAutoparagraphing","checkChild","livePos","fromPosition","_setAffectedBoundaries","insert","toPosition","push","isBefore","mergeLeft","_canMergeLeft","mergeRight","_canMergeRight","mergePosLeft","_createBefore","stickiness","mergePosRight","_createAfter","livePosition","isEqual","_createAt","nodeBefore","merge","getShiftedBy","previousSibling","has","checkMerge","nextSibling","paragraph","createElement","_getAllowedIn","_appendChild","allowedIn","isLimit","isAtStart","createPositionBefore","isEmpty","remove","isAtEnd","createPositionAfter","tempPos","split","add","nodeAfter","element"],"mappings":"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","sourcesContent":["/**\n * @license Copyright (c) 2003-2019, CKSource - Frederico Knabben. All rights reserved.\n * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license\n */\n\n/**\n * @module engine/model/utils/insertcontent\n */\n\nimport Position from '../position';\nimport LivePosition from '../liveposition';\nimport Element from '../element';\nimport Range from '../range';\nimport DocumentSelection from '../documentselection';\nimport Selection from '../selection';\nimport CKEditorError from '@ckeditor/ckeditor5-utils/src/ckeditorerror';\n\n/**\n * Inserts content into the editor (specified selection) as one would expect the paste\n * functionality to work.\n *\n * If an instance of {@link module:engine/model/selection~Selection} is passed as `selectable` it will be modified\n * to the insertion selection (equal to a range to be selected after insertion).\n *\n * If `selectable` is not passed, the content will be inserted using the current selection of the model document.\n *\n * **Note:** Use {@link module:engine/model/model~Model#insertContent} instead of this function.\n * This function is only exposed to be reusable in algorithms which change the {@link module:engine/model/model~Model#insertContent}\n * method's behavior.\n *\n * @param {module:engine/model/model~Model} model The model in context of which the insertion\n * should be performed.\n * @param {module:engine/model/documentfragment~DocumentFragment|module:engine/model/item~Item} content The content to insert.\n * @param {module:engine/model/selection~Selectable} [selectable=model.document.selection]\n * Selection into which the content should be inserted.\n * @param {Number|'before'|'end'|'after'|'on'|'in'} [placeOrOffset] Sets place or offset of the selection.\n * @returns {module:engine/model/range~Range} Range which contains all the performed changes. This is a range that, if removed,\n * would return the model to the state before the insertion. If no changes were preformed by `insertContent`, returns a range collapsed\n * at the insertion position.\n */\nexport default function insertContent( model, content, selectable, placeOrOffset ) {\n\treturn model.change( writer => {\n\t\tlet selection;\n\n\t\tif ( !selectable ) {\n\t\t\tselection = model.document.selection;\n\t\t} else if ( selectable instanceof Selection || selectable instanceof DocumentSelection ) {\n\t\t\tselection = selectable;\n\t\t} else {\n\t\t\tselection = writer.createSelection( selectable, placeOrOffset );\n\t\t}\n\n\t\tconst insertionPosition = selection.getFirstPosition();\n\n\t\tif ( !selection.isCollapsed ) {\n\t\t\tmodel.deleteContent( selection, { doNotAutoparagraph: true } );\n\t\t}\n\n\t\tconst insertion = new Insertion( model, writer, insertionPosition );\n\n\t\tlet nodesToInsert;\n\n\t\tif ( content.is( 'documentFragment' ) ) {\n\t\t\tnodesToInsert = content.getChildren();\n\t\t} else {\n\t\t\tnodesToInsert = [ content ];\n\t\t}\n\n\t\tinsertion.handleNodes( nodesToInsert, {\n\t\t\t// The set of children being inserted is the only set in this context\n\t\t\t// so it's the first and last (it's a hack ;)).\n\t\t\tisFirst: true,\n\t\t\tisLast: true\n\t\t} );\n\n\t\tconst newRange = insertion.getSelectionRange();\n\n\t\t/* istanbul ignore else */\n\t\tif ( newRange ) {\n\t\t\tif ( selection instanceof DocumentSelection ) {\n\t\t\t\twriter.setSelection( newRange );\n\t\t\t} else {\n\t\t\t\tselection.setTo( newRange );\n\t\t\t}\n\t\t} else {\n\t\t\t// We are not testing else because it's a safe check for unpredictable edge cases:\n\t\t\t// an insertion without proper range to select.\n\t\t\t//\n\t\t\t// @if CK_DEBUG // console.warn( 'Cannot determine a proper selection range after insertion.' );\n\t\t}\n\n\t\tconst affectedRange = insertion.getAffectedRange() || model.createRange( insertionPosition );\n\n\t\tinsertion.destroy();\n\n\t\treturn affectedRange;\n\t} );\n}\n\n/**\n * Utility class for performing content insertion.\n *\n * @private\n */\nclass Insertion {\n\tconstructor( model, writer, position ) {\n\t\t/**\n\t\t * The model in context of which the insertion should be performed.\n\t\t *\n\t\t * @member {module:engine/model~Model} #model\n\t\t */\n\t\tthis.model = model;\n\n\t\t/**\n\t\t * Batch to which operations will be added.\n\t\t *\n\t\t * @member {module:engine/controller/writer~Batch} #writer\n\t\t */\n\t\tthis.writer = writer;\n\n\t\t/**\n\t\t * The position at which (or near which) the next node will be inserted.\n\t\t *\n\t\t * @member {module:engine/model/position~Position} #position\n\t\t */\n\t\tthis.position = position;\n\n\t\t/**\n\t\t * Elements with which the inserted elements can be merged.\n\t\t *\n\t\t *\t\t<p>x^</p><p>y</p> + <p>z</p> (can merge to <p>x</p>)\n\t\t *\t\t<p>x</p><p>^y</p> + <p>z</p> (can merge to <p>y</p>)\n\t\t *\t\t<p>x^y</p> + <p>z</p> (can merge to <p>xy</p> which will be split during the action,\n\t\t *\t\t\t\t\t\t\t\tso both its pieces will be added to this set)\n\t\t *\n\t\t *\n\t\t * @member {Set} #canMergeWith\n\t\t */\n\t\tthis.canMergeWith = new Set( [ this.position.parent ] );\n\n\t\t/**\n\t\t * Schema of the model.\n\t\t *\n\t\t * @member {module:engine/model/schema~Schema} #schema\n\t\t */\n\t\tthis.schema = model.schema;\n\n\t\tthis._filterAttributesOf = [];\n\n\t\t/**\n\t\t * Beginning of the affected range. See {@link module:engine/model/utils/insertcontent~Insertion#getAffectedRange}.\n\t\t *\n\t\t * @private\n\t\t * @member {module:engine/model/liveposition~LivePosition|null} #_affectedStart\n\t\t */\n\t\tthis._affectedStart = null;\n\n\t\t/**\n\t\t * End of the affected range. See {@link module:engine/model/utils/insertcontent~Insertion#getAffectedRange}.\n\t\t *\n\t\t * @private\n\t\t * @member {module:engine/model/liveposition~LivePosition|null} #_affectedEnd\n\t\t */\n\t\tthis._affectedEnd = null;\n\t}\n\n\t/**\n\t * Handles insertion of a set of nodes.\n\t *\n\t * @param {Iterable.<module:engine/model/node~Node>} nodes Nodes to insert.\n\t * @param {Object} parentContext Context in which parent of these nodes was supposed to be inserted.\n\t * If the parent context is passed it means that the parent element was stripped (was not allowed).\n\t */\n\thandleNodes( nodes, parentContext ) {\n\t\tnodes = Array.from( nodes );\n\n\t\tfor ( let i = 0; i < nodes.length; i++ ) {\n\t\t\tconst node = nodes[ i ];\n\n\t\t\tthis._handleNode( node, {\n\t\t\t\tisFirst: i === 0 && parentContext.isFirst,\n\t\t\t\tisLast: ( i === ( nodes.length - 1 ) ) && parentContext.isLast\n\t\t\t} );\n\t\t}\n\n\t\t// TMP this will become a post-fixer.\n\t\tthis.schema.removeDisallowedAttributes( this._filterAttributesOf, this.writer );\n\t\tthis._filterAttributesOf = [];\n\t}\n\n\t/**\n\t * Returns range to be selected after insertion.\n\t * Returns `null` if there is no valid range to select after insertion.\n\t *\n\t * @returns {module:engine/model/range~Range|null}\n\t */\n\tgetSelectionRange() {\n\t\tif ( this.nodeToSelect ) {\n\t\t\treturn Range._createOn( this.nodeToSelect );\n\t\t}\n\n\t\treturn this.model.schema.getNearestSelectionRange( this.position );\n\t}\n\n\t/**\n\t * Returns a range which contains all the performed changes. This is a range that, if removed, would return the model to the state\n\t * before the insertion. Returns `null` if no changes were done.\n\t *\n\t * @returns {module:engine/model/range~Range|null}\n\t */\n\tgetAffectedRange() {\n\t\tif ( !this._affectedStart ) {\n\t\t\treturn null;\n\t\t}\n\n\t\treturn new Range( this._affectedStart, this._affectedEnd );\n\t}\n\n\t/**\n\t * Destroys `Insertion` instance.\n\t */\n\tdestroy() {\n\t\tif ( this._affectedStart ) {\n\t\t\tthis._affectedStart.detach();\n\t\t}\n\n\t\tif ( this._affectedEnd ) {\n\t\t\tthis._affectedEnd.detach();\n\t\t}\n\t}\n\n\t/**\n\t * Handles insertion of a single node.\n\t *\n\t * @private\n\t * @param {module:engine/model/node~Node} node\n\t * @param {Object} context\n\t * @param {Boolean} context.isFirst Whether the given node is the first one in the content to be inserted.\n\t * @param {Boolean} context.isLast Whether the given node is the last one in the content to be inserted.\n\t */\n\t_handleNode( node, context ) {\n\t\t// Let's handle object in a special way.\n\t\t// * They should never be merged with other elements.\n\t\t// * If they are not allowed in any of the selection ancestors, they could be either autoparagraphed or totally removed.\n\t\tif ( this.schema.isObject( node ) ) {\n\t\t\tthis._handleObject( node, context );\n\n\t\t\treturn;\n\t\t}\n\n\t\t// Try to find a place for the given node.\n\t\t// Split the position.parent's branch up to a point where the node can be inserted.\n\t\t// If it isn't allowed in the whole branch, then of course don't split anything.\n\t\tconst isAllowed = this._checkAndSplitToAllowedPosition( node, context );\n\n\t\tif ( !isAllowed ) {\n\t\t\tthis._handleDisallowedNode( node, context );\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis._insert( node );\n\n\t\t// After the node was inserted we may try to merge it with its siblings.\n\t\t// This should happen only if it was the first and/or last of the nodes (so only with boundary nodes)\n\t\t// and only if the selection was in those elements initially.\n\t\t//\n\t\t// E.g.:\n\t\t// <p>x^</p> + <p>y</p> => <p>x</p><p>y</p> => <p>xy[]</p>\n\t\t// and:\n\t\t// <p>x^y</p> + <p>z</p> => <p>x</p>^<p>y</p> + <p>z</p> => <p>x</p><p>z</p><p>y</p> => <p>xz[]y</p>\n\t\t// but:\n\t\t// <p>x</p><p>^</p><p>z</p> + <p>y</p> => <p>x</p><p>y</p><p>z</p> (no merging)\n\t\t// <p>x</p>[<img>]<p>z</p> + <p>y</p> => <p>x</p><p>y</p><p>z</p> (no merging, note: after running deleteContents\n\t\t//\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t it's exactly the same case as above)\n\t\tthis._mergeSiblingsOf( node, context );\n\t}\n\n\t/**\n\t * @private\n\t * @param {module:engine/model/element~Element} node The object element.\n\t * @param {Object} context\n\t */\n\t_handleObject( node, context ) {\n\t\t// Try finding it a place in the tree.\n\t\tif ( this._checkAndSplitToAllowedPosition( node ) ) {\n\t\t\tthis._insert( node );\n\t\t}\n\t\t// Try autoparagraphing.\n\t\telse {\n\t\t\tthis._tryAutoparagraphing( node, context );\n\t\t}\n\t}\n\n\t/**\n\t * @private\n\t * @param {module:engine/model/node~Node} node The disallowed node which needs to be handled.\n\t * @param {Object} context\n\t */\n\t_handleDisallowedNode( node, context ) {\n\t\t// If the node is an element, try inserting its children (strip the parent).\n\t\tif ( node.is( 'element' ) ) {\n\t\t\tthis.handleNodes( node.getChildren(), context );\n\t\t}\n\t\t// If text is not allowed, try autoparagraphing it.\n\t\telse {\n\t\t\tthis._tryAutoparagraphing( node, context );\n\t\t}\n\t}\n\n\t/**\n\t * @private\n\t * @param {module:engine/model/node~Node} node The node to insert.\n\t */\n\t_insert( node ) {\n\t\t/* istanbul ignore if */\n\t\tif ( !this.schema.checkChild( this.position, node ) ) {\n\t\t\t// Algorithm's correctness check. We should never end up here but it's good to know that we did.\n\t\t\t// Note that it would often be a silent issue if we insert node in a place where it's not allowed.\n\n\t\t\t/**\n\t\t\t * Given node cannot be inserted on the given position.\n\t\t\t *\n\t\t\t * @error insertcontent-wrong-position\n\t\t\t * @param {module:engine/model/node~Node} node Node to insert.\n\t\t\t * @param {module:engine/model/position~Position} position Position to insert the node at.\n\t\t\t */\n\t\t\tthrow new CKEditorError(\n\t\t\t\t'insertcontent-wrong-position: Given node cannot be inserted on the given position.',\n\t\t\t\tthis,\n\t\t\t\t{ node, position: this.position }\n\t\t\t);\n\t\t}\n\n\t\tconst livePos = LivePosition.fromPosition( this.position, 'toNext' );\n\n\t\tthis._setAffectedBoundaries( this.position );\n\t\tthis.writer.insert( node, this.position );\n\n\t\tthis.position = livePos.toPosition();\n\t\tlivePos.detach();\n\n\t\t// The last inserted object should be selected because we can't put a collapsed selection after it.\n\t\tif ( this.schema.isObject( node ) && !this.schema.checkChild( this.position, '$text' ) ) {\n\t\t\tthis.nodeToSelect = node;\n\t\t} else {\n\t\t\tthis.nodeToSelect = null;\n\t\t}\n\n\t\tthis._filterAttributesOf.push( node );\n\t}\n\n\t/**\n\t * Sets `_affectedStart` and `_affectedEnd` to the given `position`. Should be used before a change is done during insertion process to\n\t * mark the affected range.\n\t *\n\t * This method is used before inserting a node or splitting a parent node. `_affectedStart` and `_affectedEnd` are also changed\n\t * during merging, but the logic there is more complicated so it is left out of this function.\n\t *\n\t * @private\n\t * @param {module:engine/model/position~Position} position\n\t */\n\t_setAffectedBoundaries( position ) {\n\t\t// Set affected boundaries stickiness so that those position will \"expand\" when something is inserted in between them:\n\t\t// <paragraph>Foo][bar</paragraph> -> <paragraph>Foo]xx[bar</paragraph>\n\t\t// This is why it cannot be a range but two separate positions.\n\t\tif ( !this._affectedStart ) {\n\t\t\tthis._affectedStart = LivePosition.fromPosition( position, 'toPrevious' );\n\t\t}\n\n\t\t// If `_affectedEnd` is before the new boundary position, expand `_affectedEnd`. This can happen if first inserted node was\n\t\t// inserted into the parent but the next node is moved-out of that parent:\n\t\t// (1) <paragraph>Foo][</paragraph> -> <paragraph>Foo]xx[</paragraph>\n\t\t// (2) <paragraph>Foo]xx[</paragraph> -> <paragraph>Foo]xx</paragraph><widget></widget>[\n\t\tif ( !this._affectedEnd || this._affectedEnd.isBefore( position ) ) {\n\t\t\tif ( this._affectedEnd ) {\n\t\t\t\tthis._affectedEnd.detach();\n\t\t\t}\n\n\t\t\tthis._affectedEnd = LivePosition.fromPosition( position, 'toNext' );\n\t\t}\n\t}\n\n\t/**\n\t * @private\n\t * @param {module:engine/model/node~Node} node The node which could potentially be merged.\n\t * @param {Object} context\n\t */\n\t_mergeSiblingsOf( node, context ) {\n\t\tif ( !( node instanceof Element ) ) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst mergeLeft = this._canMergeLeft( node, context );\n\t\tconst mergeRight = this._canMergeRight( node, context );\n\t\tconst mergePosLeft = LivePosition._createBefore( node );\n\t\tmergePosLeft.stickiness = 'toNext';\n\t\tconst mergePosRight = LivePosition._createAfter( node );\n\t\tmergePosRight.stickiness = 'toNext';\n\n\t\tif ( mergeLeft ) {\n\t\t\tconst livePosition = LivePosition.fromPosition( this.position );\n\t\t\tlivePosition.stickiness = 'toNext';\n\n\t\t\t// If `_affectedStart` is sames as merge position, it means that the element \"marked\" by `_affectedStart` is going to be\n\t\t\t// removed and its contents will be moved. This won't transform `LivePosition` so `_affectedStart` needs to be moved\n\t\t\t// by hand to properly reflect affected range. (Due to `_affectedStart` and `_affectedEnd` stickiness, the \"range\" is\n\t\t\t// shown as `][`).\n\t\t\t//\n\t\t\t// Example - insert `<paragraph>Abc</paragraph><paragraph>Xyz</paragraph>` at the end of `<paragraph>Foo^</paragraph>`:\n\t\t\t//\n\t\t\t// <paragraph>Foo</paragraph><paragraph>Bar</paragraph>   -->\n\t\t\t// <paragraph>Foo</paragraph>]<paragraph>Abc</paragraph><paragraph>Xyz</paragraph>[<paragraph>Bar</paragraph>   -->\n\t\t\t// <paragraph>Foo]Abc</paragraph><paragraph>Xyz</paragraph>[<paragraph>Bar</paragraph>\n\t\t\t//\n\t\t\t// Note, that if we are here then something must have been inserted, so `_affectedStart` and `_affectedEnd` have to be set.\n\t\t\tif ( this._affectedStart.isEqual( mergePosLeft ) ) {\n\t\t\t\tthis._affectedStart.detach();\n\t\t\t\tthis._affectedStart = LivePosition._createAt( mergePosLeft.nodeBefore, 'end', 'toPrevious' );\n\t\t\t}\n\n\t\t\tthis.writer.merge( mergePosLeft );\n\n\t\t\t// If only one element (the merged one) is in the \"affected range\", also move the affected range end appropriately.\n\t\t\t//\n\t\t\t// Example - insert `<paragraph>Abc</paragraph>` at the of `<paragraph>Foo^</paragraph>`:\n\t\t\t//\n\t\t\t// <paragraph>Foo</paragraph><paragraph>Bar</paragraph>   -->\n\t\t\t// <paragraph>Foo</paragraph>]<paragraph>Abc</paragraph>[<paragraph>Bar</paragraph>   -->\n\t\t\t// <paragraph>Foo]Abc</paragraph>[<paragraph>Bar</paragraph>   -->\n\t\t\t// <paragraph>Foo]Abc[</paragraph><paragraph>Bar</paragraph>\n\t\t\tif ( mergePosLeft.isEqual( this._affectedEnd ) && context.isLast ) {\n\t\t\t\tthis._affectedEnd.detach();\n\t\t\t\tthis._affectedEnd = LivePosition._createAt( mergePosLeft.nodeBefore, 'end', 'toNext' );\n\t\t\t}\n\n\t\t\tthis.position = livePosition.toPosition();\n\t\t\tlivePosition.detach();\n\t\t}\n\n\t\tif ( mergeRight ) {\n\t\t\t/* istanbul ignore if */\n\t\t\tif ( !this.position.isEqual( mergePosRight ) ) {\n\t\t\t\t// Algorithm's correctness check. We should never end up here but it's good to know that we did.\n\t\t\t\t// At this point the insertion position should be after the node we'll merge. If it isn't,\n\t\t\t\t// it should need to be secured as in the left merge case.\n\t\t\t\t/**\n\t\t\t\t * An internal error occured during merging insertion content with siblings.\n\t\t\t\t * The insertion position should equal to the merge position.\n\t\t\t\t *\n\t\t\t\t * @error insertcontent-invalid-insertion-position\n\t\t\t\t */\n\t\t\t\tthrow new CKEditorError( 'insertcontent-invalid-insertion-position', this );\n\t\t\t}\n\n\t\t\t// Move the position to the previous node, so it isn't moved to the graveyard on merge.\n\t\t\t// <p>x</p>[]<p>y</p> => <p>x[]</p><p>y</p>\n\t\t\tthis.position = Position._createAt( mergePosRight.nodeBefore, 'end' );\n\n\t\t\t// OK:  <p>xx[]</p> + <p>yy</p> => <p>xx[]yy</p> (when sticks to previous)\n\t\t\t// NOK: <p>xx[]</p> + <p>yy</p> => <p>xxyy[]</p> (when sticks to next)\n\t\t\tconst livePosition = LivePosition.fromPosition( this.position, 'toPrevious' );\n\n\t\t\t// See comment above on moving `_affectedStart`.\n\t\t\tif ( this._affectedEnd.isEqual( mergePosRight ) ) {\n\t\t\t\tthis._affectedEnd.detach();\n\t\t\t\tthis._affectedEnd = LivePosition._createAt( mergePosRight.nodeBefore, 'end', 'toNext' );\n\t\t\t}\n\n\t\t\tthis.writer.merge( mergePosRight );\n\n\t\t\t// See comment above on moving `_affectedStart`.\n\t\t\tif ( mergePosRight.getShiftedBy( -1 ).isEqual( this._affectedStart ) && context.isFirst ) {\n\t\t\t\tthis._affectedStart.detach();\n\t\t\t\tthis._affectedStart = LivePosition._createAt( mergePosRight.nodeBefore, 0, 'toPrevious' );\n\t\t\t}\n\n\t\t\tthis.position = livePosition.toPosition();\n\t\t\tlivePosition.detach();\n\t\t}\n\n\t\tif ( mergeLeft || mergeRight ) {\n\t\t\t// After merge elements that were marked by _insert() to be filtered might be gone so\n\t\t\t// we need to mark the new container.\n\t\t\tthis._filterAttributesOf.push( this.position.parent );\n\t\t}\n\n\t\tmergePosLeft.detach();\n\t\tmergePosRight.detach();\n\t}\n\n\t/**\n\t * Checks whether specified node can be merged with previous sibling element.\n\t *\n\t * @private\n\t * @param {module:engine/model/node~Node} node The node which could potentially be merged.\n\t * @param {Object} context\n\t * @returns {Boolean}\n\t */\n\t_canMergeLeft( node, context ) {\n\t\tconst previousSibling = node.previousSibling;\n\n\t\treturn context.isFirst &&\n\t\t\t( previousSibling instanceof Element ) &&\n\t\t\tthis.canMergeWith.has( previousSibling ) &&\n\t\t\tthis.model.schema.checkMerge( previousSibling, node );\n\t}\n\n\t/**\n\t * Checks whether specified node can be merged with next sibling element.\n\t *\n\t * @private\n\t * @param {module:engine/model/node~Node} node The node which could potentially be merged.\n\t * @param {Object} context\n\t * @returns {Boolean}\n\t */\n\t_canMergeRight( node, context ) {\n\t\tconst nextSibling = node.nextSibling;\n\n\t\treturn context.isLast &&\n\t\t\t( nextSibling instanceof Element ) &&\n\t\t\tthis.canMergeWith.has( nextSibling ) &&\n\t\t\tthis.model.schema.checkMerge( node, nextSibling );\n\t}\n\n\t/**\n\t * Tries wrapping the node in a new paragraph and inserting it this way.\n\t *\n\t * @private\n\t * @param {module:engine/model/node~Node} node The node which needs to be autoparagraphed.\n\t * @param {Object} context\n\t */\n\t_tryAutoparagraphing( node, context ) {\n\t\tconst paragraph = this.writer.createElement( 'paragraph' );\n\n\t\t// Do not autoparagraph if the paragraph won't be allowed there,\n\t\t// cause that would lead to an infinite loop. The paragraph would be rejected in\n\t\t// the next _handleNode() call and we'd be here again.\n\t\tif ( this._getAllowedIn( paragraph, this.position.parent ) && this.schema.checkChild( paragraph, node ) ) {\n\t\t\tparagraph._appendChild( node );\n\t\t\tthis._handleNode( paragraph, context );\n\t\t}\n\t}\n\n\t/**\n\t * @private\n\t * @param {module:engine/model/node~Node} node\n\t * @returns {Boolean} Whether an allowed position was found.\n\t * `false` is returned if the node isn't allowed at any position up in the tree, `true` if was.\n\t */\n\t_checkAndSplitToAllowedPosition( node ) {\n\t\tconst allowedIn = this._getAllowedIn( node, this.position.parent );\n\n\t\tif ( !allowedIn ) {\n\t\t\treturn false;\n\t\t}\n\n\t\twhile ( allowedIn != this.position.parent ) {\n\t\t\t// If a parent which we'd need to leave is a limit element, break.\n\t\t\tif ( this.schema.isLimit( this.position.parent ) ) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif ( this.position.isAtStart ) {\n\t\t\t\t// If insertion position is at the beginning of the parent, move it out instead of splitting.\n\t\t\t\t// <p>^Foo</p> -> ^<p>Foo</p>\n\t\t\t\tconst parent = this.position.parent;\n\n\t\t\t\tthis.position = this.writer.createPositionBefore( parent );\n\n\t\t\t\t// Special case – parent is empty (<p>^</p>).\n\t\t\t\t//\n\t\t\t\t// 1. parent.isEmpty\n\t\t\t\t// We can remove the element after moving insertion position out of it.\n\t\t\t\t//\n\t\t\t\t// 2. parent.parent === allowedIn\n\t\t\t\t// However parent should remain in place when allowed element is above limit element in document tree.\n\t\t\t\t// For example there shouldn't be allowed to remove empty paragraph from tableCell, when is pasted\n\t\t\t\t// content allowed in $root.\n\t\t\t\tif ( parent.isEmpty && parent.parent === allowedIn ) {\n\t\t\t\t\tthis.writer.remove( parent );\n\t\t\t\t}\n\t\t\t} else if ( this.position.isAtEnd ) {\n\t\t\t\t// If insertion position is at the end of the parent, move it out instead of splitting.\n\t\t\t\t// <p>Foo^</p> -> <p>Foo</p>^\n\t\t\t\tthis.position = this.writer.createPositionAfter( this.position.parent );\n\t\t\t} else {\n\t\t\t\tconst tempPos = this.writer.createPositionAfter( this.position.parent );\n\n\t\t\t\tthis._setAffectedBoundaries( this.position );\n\t\t\t\tthis.writer.split( this.position );\n\n\t\t\t\tthis.position = tempPos;\n\n\t\t\t\tthis.canMergeWith.add( this.position.nodeAfter );\n\t\t\t}\n\t\t}\n\n\t\treturn true;\n\t}\n\n\t/**\n\t * Gets the element in which the given node is allowed. It checks the passed element and all its ancestors.\n\t *\n\t * @private\n\t * @param {module:engine/model/node~Node} node The node to check.\n\t * @param {module:engine/model/element~Element} element The element in which the node's correctness should be checked.\n\t * @returns {module:engine/model/element~Element|null}\n\t */\n\t_getAllowedIn( node, element ) {\n\t\tif ( this.schema.checkChild( element, node ) ) {\n\t\t\treturn element;\n\t\t}\n\n\t\tif ( element.parent ) {\n\t\t\treturn this._getAllowedIn( node, element.parent );\n\t\t}\n\n\t\treturn null;\n\t}\n}\n"]}]}
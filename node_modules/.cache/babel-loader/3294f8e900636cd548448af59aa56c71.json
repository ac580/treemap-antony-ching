{"remainingRequest":"/Users/antonyching/Desktop/project/new-builder-demo/node_modules/babel-loader/lib/index.js!/Users/antonyching/Desktop/project/new-builder-demo/node_modules/@ckeditor/ckeditor5-engine/src/view/selection.js","dependencies":[{"path":"/Users/antonyching/Desktop/project/new-builder-demo/node_modules/@ckeditor/ckeditor5-engine/src/view/selection.js","mtime":499162500000},{"path":"/Users/antonyching/Desktop/project/new-builder-demo/node_modules/@ckeditor/ckeditor5-dev-webpack-plugin/lib/translatesourceloader.js","mtime":499162500000},{"path":"/Users/antonyching/Desktop/project/new-builder-demo/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/antonyching/Desktop/project/new-builder-demo/node_modules/babel-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:LyoqCiAqIEBsaWNlbnNlIENvcHlyaWdodCAoYykgMjAwMy0yMDE5LCBDS1NvdXJjZSAtIEZyZWRlcmljbyBLbmFiYmVuLiBBbGwgcmlnaHRzIHJlc2VydmVkLgogKiBGb3IgbGljZW5zaW5nLCBzZWUgTElDRU5TRS5tZCBvciBodHRwczovL2NrZWRpdG9yLmNvbS9sZWdhbC9ja2VkaXRvci1vc3MtbGljZW5zZQogKi8KCi8qKgogKiBAbW9kdWxlIGVuZ2luZS92aWV3L3NlbGVjdGlvbgogKi8KaW1wb3J0IENLRWRpdG9yRXJyb3IgZnJvbSAnQGNrZWRpdG9yL2NrZWRpdG9yNS11dGlscy9zcmMvY2tlZGl0b3JlcnJvcic7CmltcG9ydCBSYW5nZSBmcm9tICcuL3JhbmdlJzsKaW1wb3J0IFBvc2l0aW9uIGZyb20gJy4vcG9zaXRpb24nOwppbXBvcnQgbWl4IGZyb20gJ0Bja2VkaXRvci9ja2VkaXRvcjUtdXRpbHMvc3JjL21peCc7CmltcG9ydCBFbWl0dGVyTWl4aW4gZnJvbSAnQGNrZWRpdG9yL2NrZWRpdG9yNS11dGlscy9zcmMvZW1pdHRlcm1peGluJzsKaW1wb3J0IE5vZGUgZnJvbSAnLi9ub2RlJzsKaW1wb3J0IEVsZW1lbnQgZnJvbSAnLi9lbGVtZW50JzsKaW1wb3J0IGNvdW50IGZyb20gJ0Bja2VkaXRvci9ja2VkaXRvcjUtdXRpbHMvc3JjL2NvdW50JzsKaW1wb3J0IGlzSXRlcmFibGUgZnJvbSAnQGNrZWRpdG9yL2NrZWRpdG9yNS11dGlscy9zcmMvaXNpdGVyYWJsZSc7CmltcG9ydCBEb2N1bWVudFNlbGVjdGlvbiBmcm9tICcuL2RvY3VtZW50c2VsZWN0aW9uJzsKLyoqCiAqIENsYXNzIHJlcHJlc2VudGluZyBhbiBhcmJpcnRhcnkgc2VsZWN0aW9uIGluIHRoZSB2aWV3LgogKiBTZWUgYWxzbyB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2RvY3VtZW50c2VsZWN0aW9ufkRvY3VtZW50U2VsZWN0aW9ufS4KICoKICogTmV3IHNlbGVjdGlvbiBpbnN0YW5jZXMgY2FuIGJlIGNyZWF0ZWQgdmlhIHRoZSBjb25zdHJ1Y3RvciBvciBvbmUgdGhlc2UgbWV0aG9kczoKICoKICogKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L3ZpZXd+VmlldyNjcmVhdGVTZWxlY3Rpb24gYFZpZXcjY3JlYXRlU2VsZWN0aW9uKClgfSwKICogKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L3VwY2FzdHdyaXRlcn5VcGNhc3RXcml0ZXIjY3JlYXRlU2VsZWN0aW9uIGBVcGNhc3RXcml0ZXIjY3JlYXRlU2VsZWN0aW9uKClgfS4KICoKICogQSBzZWxlY3Rpb24gY2FuIGNvbnNpc3Qgb2Yge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9yYW5nZX5SYW5nZSByYW5nZXN9IHRoYXQgY2FuIGJlIHNldCBieSB1c2luZwogKiB0aGUge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9zZWxlY3Rpb25+U2VsZWN0aW9uI3NldFRvIGBTZWxlY3Rpb24jc2V0VG8oKWB9IG1ldGhvZC4KICovCgpleHBvcnQgZGVmYXVsdCBjbGFzcyBTZWxlY3Rpb24gewogIC8qKgogICAqIENyZWF0ZXMgbmV3IHNlbGVjdGlvbiBpbnN0YW5jZS4KICAgKgogICAqICoqTm90ZSoqOiBUaGUgc2VsZWN0aW9uIGNvbnN0cnVjdG9yIGlzIGF2YWlsYWJsZSBhcyBhIGZhY3RvcnkgbWV0aG9kOgogICAqCiAgICogKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L3ZpZXd+VmlldyNjcmVhdGVTZWxlY3Rpb24gYFZpZXcjY3JlYXRlU2VsZWN0aW9uKClgfSwKICAgKiAqIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvdXBjYXN0d3JpdGVyflVwY2FzdFdyaXRlciNjcmVhdGVTZWxlY3Rpb24gYFVwY2FzdFdyaXRlciNjcmVhdGVTZWxlY3Rpb24oKWB9LgogICAqCiAgICogCQkvLyBDcmVhdGVzIGVtcHR5IHNlbGVjdGlvbiB3aXRob3V0IHJhbmdlcy4KICAgKgkJY29uc3Qgc2VsZWN0aW9uID0gd3JpdGVyLmNyZWF0ZVNlbGVjdGlvbigpOwogICAqCiAgICoJCS8vIENyZWF0ZXMgc2VsZWN0aW9uIGF0IHRoZSBnaXZlbiByYW5nZS4KICAgKgkJY29uc3QgcmFuZ2UgPSB3cml0ZXIuY3JlYXRlUmFuZ2UoIHN0YXJ0LCBlbmQgKTsKICAgKgkJY29uc3Qgc2VsZWN0aW9uID0gd3JpdGVyLmNyZWF0ZVNlbGVjdGlvbiggcmFuZ2UgKTsKICAgKgogICAqCQkvLyBDcmVhdGVzIHNlbGVjdGlvbiBhdCB0aGUgZ2l2ZW4gcmFuZ2VzCiAgICogCQljb25zdCByYW5nZXMgPSBbIHdyaXRlci5jcmVhdGVSYW5nZSggc3RhcnQxLCBlbmQyICksIHdyaXRlci5jcmVhdGVSYW5nZSggc3RhcjIsIGVuZDIgKSBdOwogICAqCQljb25zdCBzZWxlY3Rpb24gPSB3cml0ZXIuY3JlYXRlU2VsZWN0aW9uKCByYW5nZXMgKTsKICAgKgogICAqCQkvLyBDcmVhdGVzIHNlbGVjdGlvbiBmcm9tIHRoZSBvdGhlciBzZWxlY3Rpb24uCiAgICoJCWNvbnN0IG90aGVyU2VsZWN0aW9uID0gd3JpdGVyLmNyZWF0ZVNlbGVjdGlvbigpOwogICAqCQljb25zdCBzZWxlY3Rpb24gPSB3cml0ZXIuY3JlYXRlU2VsZWN0aW9uKCBvdGhlclNlbGVjdGlvbiApOwogICAqCiAgICoJCS8vIENyZWF0ZXMgc2VsZWN0aW9uIGZyb20gdGhlIGRvY3VtZW50IHNlbGVjdGlvbi4KICAgKgkJY29uc3Qgc2VsZWN0aW9uID0gd3JpdGVyLmNyZWF0ZVNlbGVjdGlvbiggZWRpdG9yLmVkaXRpbmcudmlldy5kb2N1bWVudC5zZWxlY3Rpb24gKTsKICAgKgogICAqIAkJLy8gQ3JlYXRlcyBzZWxlY3Rpb24gYXQgdGhlIGdpdmVuIHBvc2l0aW9uLgogICAqCQljb25zdCBwb3NpdGlvbiA9IHdyaXRlci5jcmVhdGVQb3NpdGlvbkZyb21QYXRoKCByb290LCBwYXRoICk7CiAgICoJCWNvbnN0IHNlbGVjdGlvbiA9IHdyaXRlci5jcmVhdGVTZWxlY3Rpb24oIHBvc2l0aW9uICk7CiAgICoKICAgKgkJLy8gQ3JlYXRlcyBjb2xsYXBzZWQgc2VsZWN0aW9uIGF0IHRoZSBwb3NpdGlvbiBvZiBnaXZlbiBpdGVtIGFuZCBvZmZzZXQuCiAgICoJCWNvbnN0IHBhcmFncmFwaCA9IHdyaXRlci5jcmVhdGVDb250YWluZXJFbGVtZW50KCAncGFyYWdyYXBoJyApOwogICAqCQljb25zdCBzZWxlY3Rpb24gPSB3cml0ZXIuY3JlYXRlU2VsZWN0aW9uKCBwYXJhZ3JhcGgsIG9mZnNldCApOwogICAqCiAgICoJCS8vIENyZWF0ZXMgYSByYW5nZSBpbnNpZGUgYW4ge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9lbGVtZW50fkVsZW1lbnQgZWxlbWVudH0gd2hpY2ggc3RhcnRzIGJlZm9yZSB0aGUKICAgKgkJLy8gZmlyc3QgY2hpbGQgb2YgdGhhdCBlbGVtZW50IGFuZCBlbmRzIGFmdGVyIHRoZSBsYXN0IGNoaWxkIG9mIHRoYXQgZWxlbWVudC4KICAgKgkJY29uc3Qgc2VsZWN0aW9uID0gd3JpdGVyLmNyZWF0ZVNlbGVjdGlvbiggcGFyYWdyYXBoLCAnaW4nICk7CiAgICoKICAgKgkJLy8gQ3JlYXRlcyBhIHJhbmdlIG9uIGFuIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvaXRlbX5JdGVtIGl0ZW19IHdoaWNoIHN0YXJ0cyBiZWZvcmUgdGhlIGl0ZW0gYW5kIGVuZHMKICAgKgkJLy8ganVzdCBhZnRlciB0aGUgaXRlbS4KICAgKgkJY29uc3Qgc2VsZWN0aW9uID0gd3JpdGVyLmNyZWF0ZVNlbGVjdGlvbiggcGFyYWdyYXBoLCAnb24nICk7CiAgICoKICAgKiBgU2VsZWN0aW9uYCdzIGNvbnN0cnVjdG9yIGFsbG93IHBhc3NpbmcgYWRkaXRpb25hbCBvcHRpb25zIChgYmFja3dhcmRgLCBgZmFrZWAgYW5kIGBsYWJlbGApIGFzIHRoZSBsYXN0IGFyZ3VtZW50LgogICAqCiAgICoJCS8vIENyZWF0ZXMgYmFja3dhcmQgc2VsZWN0aW9uLgogICAqCQljb25zdCBzZWxlY3Rpb24gPSB3cml0ZXIuY3JlYXRlU2VsZWN0aW9uKCByYW5nZSwgeyBiYWNrd2FyZDogdHJ1ZSB9ICk7CiAgICoKICAgKiBGYWtlIHNlbGVjdGlvbiBkb2VzIG5vdCByZW5kZXIgYXMgYnJvd3NlciBuYXRpdmUgc2VsZWN0aW9uIG92ZXIgc2VsZWN0ZWQgZWxlbWVudHMgYW5kIGlzIGhpZGRlbiB0byB0aGUgdXNlci4KICAgKiBUaGlzIHdheSwgbm8gbmF0aXZlIHNlbGVjdGlvbiBVSSBhcnRpZmFjdHMgYXJlIGRpc3BsYXllZCB0byB0aGUgdXNlciBhbmQgc2VsZWN0aW9uIG92ZXIgZWxlbWVudHMgY2FuIGJlCiAgICogcmVwcmVzZW50ZWQgaW4gb3RoZXIgd2F5LCBmb3IgZXhhbXBsZSBieSBhcHBseWluZyBwcm9wZXIgQ1NTIGNsYXNzLgogICAqCiAgICogQWRkaXRpb25hbGx5IGZha2UncyBzZWxlY3Rpb24gbGFiZWwgY2FuIGJlIHByb3ZpZGVkLiBJdCB3aWxsIGJlIHVzZWQgdG8gZGVzY3JpYmUgZmFrZSBzZWxlY3Rpb24gaW4gRE9NCiAgICogKGFuZCBiZSAgcHJvcGVybHkgaGFuZGxlZCBieSBzY3JlZW4gcmVhZGVycykuCiAgICoKICAgKgkJLy8gQ3JlYXRlcyBmYWtlIHNlbGVjdGlvbiB3aXRoIGxhYmVsLgogICAqCQljb25zdCBzZWxlY3Rpb24gPSB3cml0ZXIuY3JlYXRlU2VsZWN0aW9uKCByYW5nZSwgeyBmYWtlOiB0cnVlLCBsYWJlbDogJ2ZvbycgfSApOwogICAqCiAgICogQHBhcmFtIHttb2R1bGU6ZW5naW5lL3ZpZXcvc2VsZWN0aW9uflNlbGVjdGFibGV9IFtzZWxlY3RhYmxlPW51bGxdCiAgICogQHBhcmFtIHtOdW1iZXJ8J2JlZm9yZSd8J2VuZCd8J2FmdGVyJ3wnb24nfCdpbid9IFtwbGFjZU9yT2Zmc2V0XSBPZmZzZXQgb3IgcGxhY2Ugd2hlbiBzZWxlY3RhYmxlIGlzIGFuIGBJdGVtYC4KICAgKiBAcGFyYW0ge09iamVjdH0gW29wdGlvbnNdCiAgICogQHBhcmFtIHtCb29sZWFufSBbb3B0aW9ucy5iYWNrd2FyZF0gU2V0cyB0aGlzIHNlbGVjdGlvbiBpbnN0YW5jZSB0byBiZSBiYWNrd2FyZC4KICAgKiBAcGFyYW0ge0Jvb2xlYW59IFtvcHRpb25zLmZha2VdIFNldHMgdGhpcyBzZWxlY3Rpb24gaW5zdGFuY2UgdG8gYmUgbWFya2VkIGFzIGBmYWtlYC4KICAgKiBAcGFyYW0ge1N0cmluZ30gW29wdGlvbnMubGFiZWxdIExhYmVsIGZvciB0aGUgZmFrZSBzZWxlY3Rpb24uCiAgICovCiAgY29uc3RydWN0b3Ioc2VsZWN0YWJsZSA9IG51bGwsIHBsYWNlT3JPZmZzZXQsIG9wdGlvbnMpIHsKICAgIC8qKgogICAgICogU3RvcmVzIGFsbCByYW5nZXMgdGhhdCBhcmUgc2VsZWN0ZWQuCiAgICAgKgogICAgICogQHByb3RlY3RlZAogICAgICogQG1lbWJlciB7QXJyYXkuPG1vZHVsZTplbmdpbmUvdmlldy9yYW5nZX5SYW5nZT59CiAgICAgKi8KICAgIHRoaXMuX3JhbmdlcyA9IFtdOwogICAgLyoqCiAgICAgKiBTcGVjaWZpZXMgd2hldGhlciB0aGUgbGFzdCBhZGRlZCByYW5nZSB3YXMgYWRkZWQgYXMgYSBiYWNrd2FyZCBvciBmb3J3YXJkIHJhbmdlLgogICAgICoKICAgICAqIEBwcm90ZWN0ZWQKICAgICAqIEBtZW1iZXIge0Jvb2xlYW59CiAgICAgKi8KCiAgICB0aGlzLl9sYXN0UmFuZ2VCYWNrd2FyZCA9IGZhbHNlOwogICAgLyoqCiAgICAgKiBTcGVjaWZpZXMgd2hldGhlciBzZWxlY3Rpb24gaW5zdGFuY2UgaXMgZmFrZS4KICAgICAqCiAgICAgKiBAcHJpdmF0ZQogICAgICogQG1lbWJlciB7Qm9vbGVhbn0KICAgICAqLwoKICAgIHRoaXMuX2lzRmFrZSA9IGZhbHNlOwogICAgLyoqCiAgICAgKiBGYWtlIHNlbGVjdGlvbidzIGxhYmVsLgogICAgICoKICAgICAqIEBwcml2YXRlCiAgICAgKiBAbWVtYmVyIHtTdHJpbmd9CiAgICAgKi8KCiAgICB0aGlzLl9mYWtlU2VsZWN0aW9uTGFiZWwgPSAnJzsKICAgIHRoaXMuc2V0VG8oc2VsZWN0YWJsZSwgcGxhY2VPck9mZnNldCwgb3B0aW9ucyk7CiAgfQogIC8qKgogICAqIFJldHVybnMgdHJ1ZSBpZiBzZWxlY3Rpb24gaW5zdGFuY2UgaXMgbWFya2VkIGFzIGBmYWtlYC4KICAgKgogICAqIEBzZWUgI3NldFRvCiAgICogQHJldHVybnMge0Jvb2xlYW59CiAgICovCgoKICBnZXQgaXNGYWtlKCkgewogICAgcmV0dXJuIHRoaXMuX2lzRmFrZTsKICB9CiAgLyoqCiAgICogUmV0dXJucyBmYWtlIHNlbGVjdGlvbiBsYWJlbC4KICAgKgogICAqIEBzZWUgI3NldFRvCiAgICogQHJldHVybnMge1N0cmluZ30KICAgKi8KCgogIGdldCBmYWtlU2VsZWN0aW9uTGFiZWwoKSB7CiAgICByZXR1cm4gdGhpcy5fZmFrZVNlbGVjdGlvbkxhYmVsOwogIH0KICAvKioKICAgKiBTZWxlY3Rpb24gYW5jaG9yLiBBbmNob3IgbWF5IGJlIGRlc2NyaWJlZCBhcyBhIHBvc2l0aW9uIHdoZXJlIHRoZSBzZWxlY3Rpb24gc3RhcnRzLiBUb2dldGhlciB3aXRoCiAgICoge0BsaW5rICNmb2N1cyBmb2N1c30gdGhleSBkZWZpbmUgdGhlIGRpcmVjdGlvbiBvZiBzZWxlY3Rpb24sIHdoaWNoIGlzIGltcG9ydGFudAogICAqIHdoZW4gZXhwYW5kaW5nL3Nocmlua2luZyBzZWxlY3Rpb24uIEFuY2hvciBpcyBhbHdheXMgdGhlIHN0YXJ0IG9yIGVuZCBvZiB0aGUgbW9zdCByZWNlbnQgYWRkZWQgcmFuZ2UuCiAgICogSXQgbWF5IGJlIGEgYml0IHVuaW50dWl0aXZlIHdoZW4gdGhlcmUgYXJlIG11bHRpcGxlIHJhbmdlcyBpbiBzZWxlY3Rpb24uCiAgICoKICAgKiBAc2VlICNmb2N1cwogICAqIEB0eXBlIHttb2R1bGU6ZW5naW5lL3ZpZXcvcG9zaXRpb25+UG9zaXRpb259CiAgICovCgoKICBnZXQgYW5jaG9yKCkgewogICAgaWYgKCF0aGlzLl9yYW5nZXMubGVuZ3RoKSB7CiAgICAgIHJldHVybiBudWxsOwogICAgfQoKICAgIGNvbnN0IHJhbmdlID0gdGhpcy5fcmFuZ2VzW3RoaXMuX3Jhbmdlcy5sZW5ndGggLSAxXTsKICAgIGNvbnN0IGFuY2hvciA9IHRoaXMuX2xhc3RSYW5nZUJhY2t3YXJkID8gcmFuZ2UuZW5kIDogcmFuZ2Uuc3RhcnQ7CiAgICByZXR1cm4gYW5jaG9yLmNsb25lKCk7CiAgfQogIC8qKgogICAqIFNlbGVjdGlvbiBmb2N1cy4gRm9jdXMgaXMgYSBwb3NpdGlvbiB3aGVyZSB0aGUgc2VsZWN0aW9uIGVuZHMuCiAgICoKICAgKiBAc2VlICNhbmNob3IKICAgKiBAdHlwZSB7bW9kdWxlOmVuZ2luZS92aWV3L3Bvc2l0aW9uflBvc2l0aW9ufQogICAqLwoKCiAgZ2V0IGZvY3VzKCkgewogICAgaWYgKCF0aGlzLl9yYW5nZXMubGVuZ3RoKSB7CiAgICAgIHJldHVybiBudWxsOwogICAgfQoKICAgIGNvbnN0IHJhbmdlID0gdGhpcy5fcmFuZ2VzW3RoaXMuX3Jhbmdlcy5sZW5ndGggLSAxXTsKICAgIGNvbnN0IGZvY3VzID0gdGhpcy5fbGFzdFJhbmdlQmFja3dhcmQgPyByYW5nZS5zdGFydCA6IHJhbmdlLmVuZDsKICAgIHJldHVybiBmb2N1cy5jbG9uZSgpOwogIH0KICAvKioKICAgKiBSZXR1cm5zIHdoZXRoZXIgdGhlIHNlbGVjdGlvbiBpcyBjb2xsYXBzZWQuIFNlbGVjdGlvbiBpcyBjb2xsYXBzZWQgd2hlbiB0aGVyZSBpcyBleGFjdGx5IG9uZSByYW5nZSB3aGljaCBpcwogICAqIGNvbGxhcHNlZC4KICAgKgogICAqIEB0eXBlIHtCb29sZWFufQogICAqLwoKCiAgZ2V0IGlzQ29sbGFwc2VkKCkgewogICAgcmV0dXJuIHRoaXMucmFuZ2VDb3VudCA9PT0gMSAmJiB0aGlzLl9yYW5nZXNbMF0uaXNDb2xsYXBzZWQ7CiAgfQogIC8qKgogICAqIFJldHVybnMgbnVtYmVyIG9mIHJhbmdlcyBpbiBzZWxlY3Rpb24uCiAgICoKICAgKiBAdHlwZSB7TnVtYmVyfQogICAqLwoKCiAgZ2V0IHJhbmdlQ291bnQoKSB7CiAgICByZXR1cm4gdGhpcy5fcmFuZ2VzLmxlbmd0aDsKICB9CiAgLyoqCiAgICogU3BlY2lmaWVzIHdoZXRoZXIgdGhlIHtAbGluayAjZm9jdXN9IHByZWNlZGVzIHtAbGluayAjYW5jaG9yfS4KICAgKgogICAqIEB0eXBlIHtCb29sZWFufQogICAqLwoKCiAgZ2V0IGlzQmFja3dhcmQoKSB7CiAgICByZXR1cm4gIXRoaXMuaXNDb2xsYXBzZWQgJiYgdGhpcy5fbGFzdFJhbmdlQmFja3dhcmQ7CiAgfQogIC8qKgogICAqIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvZWRpdGFibGVlbGVtZW50fkVkaXRhYmxlRWxlbWVudCBFZGl0YWJsZUVsZW1lbnR9IGluc3RhbmNlIHRoYXQgY29udGFpbnMgdGhpcyBzZWxlY3Rpb24sIG9yIGBudWxsYAogICAqIGlmIHRoZSBzZWxlY3Rpb24gaXMgbm90IGluc2lkZSBhbiBlZGl0YWJsZSBlbGVtZW50LgogICAqCiAgICogQHR5cGUge21vZHVsZTplbmdpbmUvdmlldy9lZGl0YWJsZWVsZW1lbnR+RWRpdGFibGVFbGVtZW50fG51bGx9CiAgICovCgoKICBnZXQgZWRpdGFibGVFbGVtZW50KCkgewogICAgaWYgKHRoaXMuYW5jaG9yKSB7CiAgICAgIHJldHVybiB0aGlzLmFuY2hvci5lZGl0YWJsZUVsZW1lbnQ7CiAgICB9CgogICAgcmV0dXJuIG51bGw7CiAgfQogIC8qKgogICAqIFJldHVybnMgYW4gaXRlcmFibGUgdGhhdCBjb250YWlucyBjb3BpZXMgb2YgYWxsIHJhbmdlcyBhZGRlZCB0byB0aGUgc2VsZWN0aW9uLgogICAqCiAgICogQHJldHVybnMge0l0ZXJhYmxlLjxtb2R1bGU6ZW5naW5lL3ZpZXcvcmFuZ2V+UmFuZ2U+fQogICAqLwoKCiAgKmdldFJhbmdlcygpIHsKICAgIGZvciAoY29uc3QgcmFuZ2Ugb2YgdGhpcy5fcmFuZ2VzKSB7CiAgICAgIHlpZWxkIHJhbmdlLmNsb25lKCk7CiAgICB9CiAgfQogIC8qKgogICAqIFJldHVybnMgY29weSBvZiB0aGUgZmlyc3QgcmFuZ2UgaW4gdGhlIHNlbGVjdGlvbi4gRmlyc3QgcmFuZ2UgaXMgdGhlIG9uZSB3aGljaAogICAqIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvcmFuZ2V+UmFuZ2Ujc3RhcnQgc3RhcnR9IHBvc2l0aW9uIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvcG9zaXRpb25+UG9zaXRpb24jaXNCZWZvcmUgaXMgYmVmb3JlfSBzdGFydAogICAqIHBvc2l0aW9uIG9mIGFsbCBvdGhlciByYW5nZXMgKG5vdCB0byBjb25mdXNlIHdpdGggdGhlIGZpcnN0IHJhbmdlIGFkZGVkIHRvIHRoZSBzZWxlY3Rpb24pLgogICAqIFJldHVybnMgYG51bGxgIGlmIG5vIHJhbmdlcyBhcmUgYWRkZWQgdG8gc2VsZWN0aW9uLgogICAqCiAgICogQHJldHVybnMge21vZHVsZTplbmdpbmUvdmlldy9yYW5nZX5SYW5nZXxudWxsfQogICAqLwoKCiAgZ2V0Rmlyc3RSYW5nZSgpIHsKICAgIGxldCBmaXJzdCA9IG51bGw7CgogICAgZm9yIChjb25zdCByYW5nZSBvZiB0aGlzLl9yYW5nZXMpIHsKICAgICAgaWYgKCFmaXJzdCB8fCByYW5nZS5zdGFydC5pc0JlZm9yZShmaXJzdC5zdGFydCkpIHsKICAgICAgICBmaXJzdCA9IHJhbmdlOwogICAgICB9CiAgICB9CgogICAgcmV0dXJuIGZpcnN0ID8gZmlyc3QuY2xvbmUoKSA6IG51bGw7CiAgfQogIC8qKgogICAqIFJldHVybnMgY29weSBvZiB0aGUgbGFzdCByYW5nZSBpbiB0aGUgc2VsZWN0aW9uLiBMYXN0IHJhbmdlIGlzIHRoZSBvbmUgd2hpY2gge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9yYW5nZX5SYW5nZSNlbmQgZW5kfQogICAqIHBvc2l0aW9uIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvcG9zaXRpb25+UG9zaXRpb24jaXNBZnRlciBpcyBhZnRlcn0gZW5kIHBvc2l0aW9uIG9mIGFsbCBvdGhlciByYW5nZXMgKG5vdCB0byBjb25mdXNlCiAgICogd2l0aCB0aGUgbGFzdCByYW5nZSBhZGRlZCB0byB0aGUgc2VsZWN0aW9uKS4gUmV0dXJucyBgbnVsbGAgaWYgbm8gcmFuZ2VzIGFyZSBhZGRlZCB0byBzZWxlY3Rpb24uCiAgICoKICAgKiBAcmV0dXJucyB7bW9kdWxlOmVuZ2luZS92aWV3L3JhbmdlflJhbmdlfG51bGx9CiAgICovCgoKICBnZXRMYXN0UmFuZ2UoKSB7CiAgICBsZXQgbGFzdCA9IG51bGw7CgogICAgZm9yIChjb25zdCByYW5nZSBvZiB0aGlzLl9yYW5nZXMpIHsKICAgICAgaWYgKCFsYXN0IHx8IHJhbmdlLmVuZC5pc0FmdGVyKGxhc3QuZW5kKSkgewogICAgICAgIGxhc3QgPSByYW5nZTsKICAgICAgfQogICAgfQoKICAgIHJldHVybiBsYXN0ID8gbGFzdC5jbG9uZSgpIDogbnVsbDsKICB9CiAgLyoqCiAgICogUmV0dXJucyBjb3B5IG9mIHRoZSBmaXJzdCBwb3NpdGlvbiBpbiB0aGUgc2VsZWN0aW9uLiBGaXJzdCBwb3NpdGlvbiBpcyB0aGUgcG9zaXRpb24gdGhhdAogICAqIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvcG9zaXRpb25+UG9zaXRpb24jaXNCZWZvcmUgaXMgYmVmb3JlfSBhbnkgb3RoZXIgcG9zaXRpb24gaW4gdGhlIHNlbGVjdGlvbiByYW5nZXMuCiAgICogUmV0dXJucyBgbnVsbGAgaWYgbm8gcmFuZ2VzIGFyZSBhZGRlZCB0byBzZWxlY3Rpb24uCiAgICoKICAgKiBAcmV0dXJucyB7bW9kdWxlOmVuZ2luZS92aWV3L3Bvc2l0aW9uflBvc2l0aW9ufG51bGx9CiAgICovCgoKICBnZXRGaXJzdFBvc2l0aW9uKCkgewogICAgY29uc3QgZmlyc3RSYW5nZSA9IHRoaXMuZ2V0Rmlyc3RSYW5nZSgpOwogICAgcmV0dXJuIGZpcnN0UmFuZ2UgPyBmaXJzdFJhbmdlLnN0YXJ0LmNsb25lKCkgOiBudWxsOwogIH0KICAvKioKICAgKiBSZXR1cm5zIGNvcHkgb2YgdGhlIGxhc3QgcG9zaXRpb24gaW4gdGhlIHNlbGVjdGlvbi4gTGFzdCBwb3NpdGlvbiBpcyB0aGUgcG9zaXRpb24gdGhhdAogICAqIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvcG9zaXRpb25+UG9zaXRpb24jaXNBZnRlciBpcyBhZnRlcn0gYW55IG90aGVyIHBvc2l0aW9uIGluIHRoZSBzZWxlY3Rpb24gcmFuZ2VzLgogICAqIFJldHVybnMgYG51bGxgIGlmIG5vIHJhbmdlcyBhcmUgYWRkZWQgdG8gc2VsZWN0aW9uLgogICAqCiAgICogQHJldHVybnMge21vZHVsZTplbmdpbmUvdmlldy9wb3NpdGlvbn5Qb3NpdGlvbnxudWxsfQogICAqLwoKCiAgZ2V0TGFzdFBvc2l0aW9uKCkgewogICAgY29uc3QgbGFzdFJhbmdlID0gdGhpcy5nZXRMYXN0UmFuZ2UoKTsKICAgIHJldHVybiBsYXN0UmFuZ2UgPyBsYXN0UmFuZ2UuZW5kLmNsb25lKCkgOiBudWxsOwogIH0KICAvKioKICAgKiBDaGVja3Mgd2hldGhlciwgdGhpcyBzZWxlY3Rpb24gaXMgZXF1YWwgdG8gZ2l2ZW4gc2VsZWN0aW9uLiBTZWxlY3Rpb25zIGFyZSBlcXVhbCBpZiB0aGV5IGhhdmUgc2FtZSBkaXJlY3Rpb25zLAogICAqIHNhbWUgbnVtYmVyIG9mIHJhbmdlcyBhbmQgYWxsIHJhbmdlcyBmcm9tIG9uZSBzZWxlY3Rpb24gZXF1YWwgdG8gYSByYW5nZSBmcm9tIG90aGVyIHNlbGVjdGlvbi4KICAgKgogICAqIEBwYXJhbSB7bW9kdWxlOmVuZ2luZS92aWV3L3NlbGVjdGlvbn5TZWxlY3Rpb258bW9kdWxlOmVuZ2luZS92aWV3L2RvY3VtZW50c2VsZWN0aW9ufkRvY3VtZW50U2VsZWN0aW9ufSBvdGhlclNlbGVjdGlvbgogICAqIFNlbGVjdGlvbiB0byBjb21wYXJlIHdpdGguCiAgICogQHJldHVybnMge0Jvb2xlYW59IGB0cnVlYCBpZiBzZWxlY3Rpb25zIGFyZSBlcXVhbCwgYGZhbHNlYCBvdGhlcndpc2UuCiAgICovCgoKICBpc0VxdWFsKG90aGVyU2VsZWN0aW9uKSB7CiAgICBpZiAodGhpcy5pc0Zha2UgIT0gb3RoZXJTZWxlY3Rpb24uaXNGYWtlKSB7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICBpZiAodGhpcy5pc0Zha2UgJiYgdGhpcy5mYWtlU2VsZWN0aW9uTGFiZWwgIT0gb3RoZXJTZWxlY3Rpb24uZmFrZVNlbGVjdGlvbkxhYmVsKSB7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICBpZiAodGhpcy5yYW5nZUNvdW50ICE9IG90aGVyU2VsZWN0aW9uLnJhbmdlQ291bnQpIHsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfSBlbHNlIGlmICh0aGlzLnJhbmdlQ291bnQgPT09IDApIHsKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgaWYgKCF0aGlzLmFuY2hvci5pc0VxdWFsKG90aGVyU2VsZWN0aW9uLmFuY2hvcikgfHwgIXRoaXMuZm9jdXMuaXNFcXVhbChvdGhlclNlbGVjdGlvbi5mb2N1cykpIHsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIGZvciAoY29uc3QgdGhpc1JhbmdlIG9mIHRoaXMuX3JhbmdlcykgewogICAgICBsZXQgZm91bmQgPSBmYWxzZTsKCiAgICAgIGZvciAoY29uc3Qgb3RoZXJSYW5nZSBvZiBvdGhlclNlbGVjdGlvbi5fcmFuZ2VzKSB7CiAgICAgICAgaWYgKHRoaXNSYW5nZS5pc0VxdWFsKG90aGVyUmFuZ2UpKSB7CiAgICAgICAgICBmb3VuZCA9IHRydWU7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGlmICghZm91bmQpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gdHJ1ZTsKICB9CiAgLyoqCiAgICogQ2hlY2tzIHdoZXRoZXIgdGhpcyBzZWxlY3Rpb24gaXMgc2ltaWxhciB0byBnaXZlbiBzZWxlY3Rpb24uIFNlbGVjdGlvbnMgYXJlIHNpbWlsYXIgaWYgdGhleSBoYXZlIHNhbWUgZGlyZWN0aW9ucywgc2FtZQogICAqIG51bWJlciBvZiByYW5nZXMsIGFuZCBhbGwge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9yYW5nZX5SYW5nZSNnZXRUcmltbWVkIHRyaW1tZWR9IHJhbmdlcyBmcm9tIG9uZSBzZWxlY3Rpb24gYXJlCiAgICogZXF1YWwgdG8gYW55IHRyaW1tZWQgcmFuZ2UgZnJvbSBvdGhlciBzZWxlY3Rpb24uCiAgICoKICAgKiBAcGFyYW0ge21vZHVsZTplbmdpbmUvdmlldy9zZWxlY3Rpb25+U2VsZWN0aW9ufG1vZHVsZTplbmdpbmUvdmlldy9kb2N1bWVudHNlbGVjdGlvbn5Eb2N1bWVudFNlbGVjdGlvbn0gb3RoZXJTZWxlY3Rpb24KICAgKiBTZWxlY3Rpb24gdG8gY29tcGFyZSB3aXRoLgogICAqIEByZXR1cm5zIHtCb29sZWFufSBgdHJ1ZWAgaWYgc2VsZWN0aW9ucyBhcmUgc2ltaWxhciwgYGZhbHNlYCBvdGhlcndpc2UuCiAgICovCgoKICBpc1NpbWlsYXIob3RoZXJTZWxlY3Rpb24pIHsKICAgIGlmICh0aGlzLmlzQmFja3dhcmQgIT0gb3RoZXJTZWxlY3Rpb24uaXNCYWNrd2FyZCkgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgY29uc3QgbnVtT2ZSYW5nZXNBID0gY291bnQodGhpcy5nZXRSYW5nZXMoKSk7CiAgICBjb25zdCBudW1PZlJhbmdlc0IgPSBjb3VudChvdGhlclNlbGVjdGlvbi5nZXRSYW5nZXMoKSk7IC8vIElmIHNlbGVjdGlvbnMgaGF2ZSBkaWZmZXJlbnQgbnVtYmVyIG9mIHJhbmdlcywgdGhleSBjYW5ub3QgYmUgc2ltaWxhci4KCiAgICBpZiAobnVtT2ZSYW5nZXNBICE9IG51bU9mUmFuZ2VzQikgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9IC8vIElmIGJvdGggc2VsZWN0aW9ucyBoYXZlIG5vIHJhbmdlcywgdGhleSBhcmUgc2ltaWxhci4KCgogICAgaWYgKG51bU9mUmFuZ2VzQSA9PSAwKSB7CiAgICAgIHJldHVybiB0cnVlOwogICAgfSAvLyBDaGVjayBpZiBlYWNoIHJhbmdlIGluIG9uZSBzZWxlY3Rpb24gaGFzIGEgc2ltaWxhciByYW5nZSBpbiBvdGhlciBzZWxlY3Rpb24uCgoKICAgIGZvciAobGV0IHJhbmdlQSBvZiB0aGlzLmdldFJhbmdlcygpKSB7CiAgICAgIHJhbmdlQSA9IHJhbmdlQS5nZXRUcmltbWVkKCk7CiAgICAgIGxldCBmb3VuZCA9IGZhbHNlOwoKICAgICAgZm9yIChsZXQgcmFuZ2VCIG9mIG90aGVyU2VsZWN0aW9uLmdldFJhbmdlcygpKSB7CiAgICAgICAgcmFuZ2VCID0gcmFuZ2VCLmdldFRyaW1tZWQoKTsKCiAgICAgICAgaWYgKHJhbmdlQS5zdGFydC5pc0VxdWFsKHJhbmdlQi5zdGFydCkgJiYgcmFuZ2VBLmVuZC5pc0VxdWFsKHJhbmdlQi5lbmQpKSB7CiAgICAgICAgICBmb3VuZCA9IHRydWU7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIH0gLy8gRm9yIGByYW5nZUFgLCBuZWl0aGVyIHJhbmdlIGluIGBvdGhlclNlbGVjdGlvbmAgd2FzIHNpbWlsYXIuIFNvIHNlbGVjdGlvbnMgYXJlIG5vdCBzaW1pbGFyLgoKCiAgICAgIGlmICghZm91bmQpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgIH0gLy8gVGhlcmUgd2VyZSBubyByYW5nZXMgdGhhdCB3ZXJlbid0IG1hdGNoZWQuIFNlbGVjdGlvbnMgYXJlIHNpbWlsYXIuCgoKICAgIHJldHVybiB0cnVlOwogIH0KICAvKioKICAgKiBSZXR1cm5zIHRoZSBzZWxlY3RlZCBlbGVtZW50LiB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2VsZW1lbnR+RWxlbWVudCBFbGVtZW50fSBpcyBjb25zaWRlcmVkIGFzIHNlbGVjdGVkIGlmIHRoZXJlIGlzIG9ubHkKICAgKiBvbmUgcmFuZ2UgaW4gdGhlIHNlbGVjdGlvbiwgYW5kIHRoYXQgcmFuZ2UgY29udGFpbnMgZXhhY3RseSBvbmUgZWxlbWVudC4KICAgKiBSZXR1cm5zIGBudWxsYCBpZiB0aGVyZSBpcyBubyBzZWxlY3RlZCBlbGVtZW50LgogICAqCiAgICogQHJldHVybnMge21vZHVsZTplbmdpbmUvdmlldy9lbGVtZW50fkVsZW1lbnR8bnVsbH0KICAgKi8KCgogIGdldFNlbGVjdGVkRWxlbWVudCgpIHsKICAgIGlmICh0aGlzLnJhbmdlQ291bnQgIT09IDEpIHsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CgogICAgY29uc3QgcmFuZ2UgPSB0aGlzLmdldEZpcnN0UmFuZ2UoKTsKICAgIGxldCBub2RlQWZ0ZXJTdGFydCA9IHJhbmdlLnN0YXJ0Lm5vZGVBZnRlcjsKICAgIGxldCBub2RlQmVmb3JlRW5kID0gcmFuZ2UuZW5kLm5vZGVCZWZvcmU7IC8vIEhhbmRsZSB0aGUgc2l0dWF0aW9uIHdoZW4gc2VsZWN0aW9uIHBvc2l0aW9uIGlzIGF0IHRoZSBiZWdpbm5pbmcgLyBhdCB0aGUgZW5kIG9mIGEgdGV4dCBub2RlLgogICAgLy8gSW4gc3VjaCBzaXR1YXRpb24gYC5ub2RlQWZ0ZXJgIGFuZCBgLm5vZGVCZWZvcmVgIGFyZSBgbnVsbGAgYnV0IHRoZSBzZWxlY3Rpb24gc3RpbGwgbWlnaHQgYmUgc3Bhbm5pbmcKICAgIC8vIG92ZXIgb25lIGVsZW1lbnQuCiAgICAvLwogICAgLy8gPHA+Rm9vezxzcGFuIGNsYXNzPSJ3aWRnZXQiPjwvc3Bhbj59YmFyPC9wPiB2cyA8cD5Gb29bPHNwYW4gY2xhc3M9IndpZGdldCI+PC9zcGFuPl1iYXI8L3A+CiAgICAvLwogICAgLy8gVGhlc2UgYXJlIGJhc2ljYWxseSB0aGUgc2FtZSBzZWxlY3Rpb25zLCBvbmx5IHRoZSBkaWZmZXJlbmNlIGlzIGlmIHRoZSBzZWxlY3Rpb24gcG9zaXRpb24gaXMgYXQKICAgIC8vIGF0IHRoZSBlbmQvYXQgdGhlIGJlZ2lubmluZyBvZiBhIHRleHQgbm9kZSBvciBqdXN0IGJlZm9yZS9qdXN0IGFmdGVyIHRoZSB0ZXh0IG5vZGUuCiAgICAvLwoKICAgIGlmIChyYW5nZS5zdGFydC5wYXJlbnQuaXMoJ3RleHQnKSAmJiByYW5nZS5zdGFydC5pc0F0RW5kICYmIHJhbmdlLnN0YXJ0LnBhcmVudC5uZXh0U2libGluZykgewogICAgICBub2RlQWZ0ZXJTdGFydCA9IHJhbmdlLnN0YXJ0LnBhcmVudC5uZXh0U2libGluZzsKICAgIH0KCiAgICBpZiAocmFuZ2UuZW5kLnBhcmVudC5pcygndGV4dCcpICYmIHJhbmdlLmVuZC5pc0F0U3RhcnQgJiYgcmFuZ2UuZW5kLnBhcmVudC5wcmV2aW91c1NpYmxpbmcpIHsKICAgICAgbm9kZUJlZm9yZUVuZCA9IHJhbmdlLmVuZC5wYXJlbnQucHJldmlvdXNTaWJsaW5nOwogICAgfQoKICAgIHJldHVybiBub2RlQWZ0ZXJTdGFydCBpbnN0YW5jZW9mIEVsZW1lbnQgJiYgbm9kZUFmdGVyU3RhcnQgPT0gbm9kZUJlZm9yZUVuZCA/IG5vZGVBZnRlclN0YXJ0IDogbnVsbDsKICB9CiAgLyoqCiAgICogU2V0cyB0aGlzIHNlbGVjdGlvbidzIHJhbmdlcyBhbmQgZGlyZWN0aW9uIHRvIHRoZSBzcGVjaWZpZWQgbG9jYXRpb24gYmFzZWQgb24gdGhlIGdpdmVuCiAgICoge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9zZWxlY3Rpb25+U2VsZWN0YWJsZSBzZWxlY3RhYmxlfS4KICAgKgogICAqCQkvLyBTZXRzIHNlbGVjdGlvbiB0byB0aGUgZ2l2ZW4gcmFuZ2UuCiAgICoJCWNvbnN0IHJhbmdlID0gd3JpdGVyLmNyZWF0ZVJhbmdlKCBzdGFydCwgZW5kICk7CiAgICoJCXNlbGVjdGlvbi5zZXRUbyggcmFuZ2UgKTsKICAgKgogICAqCQkvLyBTZXRzIHNlbGVjdGlvbiB0byBnaXZlbiByYW5nZXMuCiAgICogCQljb25zdCByYW5nZXMgPSBbIHdyaXRlci5jcmVhdGVSYW5nZSggc3RhcnQxLCBlbmQyICksIHdyaXRlci5jcmVhdGVSYW5nZSggc3RhcjIsIGVuZDIgKSBdOwogICAqCQlzZWxlY3Rpb24uc2V0VG8oIHJhbmdlICk7CiAgICoKICAgKgkJLy8gU2V0cyBzZWxlY3Rpb24gdG8gdGhlIG90aGVyIHNlbGVjdGlvbi4KICAgKgkJY29uc3Qgb3RoZXJTZWxlY3Rpb24gPSB3cml0ZXIuY3JlYXRlU2VsZWN0aW9uKCk7CiAgICoJCXNlbGVjdGlvbi5zZXRUbyggb3RoZXJTZWxlY3Rpb24gKTsKICAgKgogICAqCSAJLy8gU2V0cyBzZWxlY3Rpb24gdG8gY29udGVudHMgb2YgRG9jdW1lbnRTZWxlY3Rpb24uCiAgICoJCXNlbGVjdGlvbi5zZXRUbyggZWRpdG9yLmVkaXRpbmcudmlldy5kb2N1bWVudC5zZWxlY3Rpb24gKTsKICAgKgogICAqIAkJLy8gU2V0cyBjb2xsYXBzZWQgc2VsZWN0aW9uIGF0IHRoZSBnaXZlbiBwb3NpdGlvbi4KICAgKgkJY29uc3QgcG9zaXRpb24gPSB3cml0ZXIuY3JlYXRlUG9zaXRpb25BdCggcm9vdCwgcGF0aCApOwogICAqCQlzZWxlY3Rpb24uc2V0VG8oIHBvc2l0aW9uICk7CiAgICoKICAgKiAJCS8vIFNldHMgY29sbGFwc2VkIHNlbGVjdGlvbiBhdCB0aGUgcG9zaXRpb24gb2YgZ2l2ZW4gaXRlbSBhbmQgb2Zmc2V0LgogICAqCQlzZWxlY3Rpb24uc2V0VG8oIHBhcmFncmFwaCwgb2Zmc2V0ICk7CiAgICoKICAgKiBDcmVhdGVzIGEgcmFuZ2UgaW5zaWRlIGFuIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvZWxlbWVudH5FbGVtZW50IGVsZW1lbnR9IHdoaWNoIHN0YXJ0cyBiZWZvcmUgdGhlIGZpcnN0IGNoaWxkIG9mCiAgICogdGhhdCBlbGVtZW50IGFuZCBlbmRzIGFmdGVyIHRoZSBsYXN0IGNoaWxkIG9mIHRoYXQgZWxlbWVudC4KICAgKgogICAqCQlzZWxlY3Rpb24uc2V0VG8oIHBhcmFncmFwaCwgJ2luJyApOwogICAqCiAgICogQ3JlYXRlcyBhIHJhbmdlIG9uIGFuIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvaXRlbX5JdGVtIGl0ZW19IHdoaWNoIHN0YXJ0cyBiZWZvcmUgdGhlIGl0ZW0gYW5kIGVuZHMganVzdCBhZnRlciB0aGUgaXRlbS4KICAgKgogICAqCQlzZWxlY3Rpb24uc2V0VG8oIHBhcmFncmFwaCwgJ29uJyApOwogICAqCiAgICogCQkvLyBDbGVhcnMgc2VsZWN0aW9uLiBSZW1vdmVzIGFsbCByYW5nZXMuCiAgICoJCXNlbGVjdGlvbi5zZXRUbyggbnVsbCApOwogICAqCiAgICogYFNlbGVjdGlvbiNzZXRUbygpYCBtZXRob2QgYWxsb3cgcGFzc2luZyBhZGRpdGlvbmFsIG9wdGlvbnMgKGBiYWNrd2FyZGAsIGBmYWtlYCBhbmQgYGxhYmVsYCkgYXMgdGhlIGxhc3QgYXJndW1lbnQuCiAgICoKICAgKgkJLy8gU2V0cyBzZWxlY3Rpb24gYXMgYmFja3dhcmQuCiAgICoJCXNlbGVjdGlvbi5zZXRUbyggcmFuZ2UsIHsgYmFja3dhcmQ6IHRydWUgfSApOwogICAqCiAgICogRmFrZSBzZWxlY3Rpb24gZG9lcyBub3QgcmVuZGVyIGFzIGJyb3dzZXIgbmF0aXZlIHNlbGVjdGlvbiBvdmVyIHNlbGVjdGVkIGVsZW1lbnRzIGFuZCBpcyBoaWRkZW4gdG8gdGhlIHVzZXIuCiAgICogVGhpcyB3YXksIG5vIG5hdGl2ZSBzZWxlY3Rpb24gVUkgYXJ0aWZhY3RzIGFyZSBkaXNwbGF5ZWQgdG8gdGhlIHVzZXIgYW5kIHNlbGVjdGlvbiBvdmVyIGVsZW1lbnRzIGNhbiBiZQogICAqIHJlcHJlc2VudGVkIGluIG90aGVyIHdheSwgZm9yIGV4YW1wbGUgYnkgYXBwbHlpbmcgcHJvcGVyIENTUyBjbGFzcy4KICAgKgogICAqIEFkZGl0aW9uYWxseSBmYWtlJ3Mgc2VsZWN0aW9uIGxhYmVsIGNhbiBiZSBwcm92aWRlZC4gSXQgd2lsbCBiZSB1c2VkIHRvIGRlc2NyaWJlIGZha2Ugc2VsZWN0aW9uIGluIERPTQogICAqIChhbmQgYmUgIHByb3Blcmx5IGhhbmRsZWQgYnkgc2NyZWVuIHJlYWRlcnMpLgogICAqCiAgICoJCS8vIENyZWF0ZXMgZmFrZSBzZWxlY3Rpb24gd2l0aCBsYWJlbC4KICAgKgkJc2VsZWN0aW9uLnNldFRvKCByYW5nZSwgeyBmYWtlOiB0cnVlLCBsYWJlbDogJ2ZvbycgfSApOwogICAqCiAgICogQGZpcmVzIGNoYW5nZQogICAqIEBwYXJhbSB7bW9kdWxlOmVuZ2luZS92aWV3L3NlbGVjdGlvbn5TZWxlY3RhYmxlfSBzZWxlY3RhYmxlCiAgICogQHBhcmFtIHtOdW1iZXJ8J2JlZm9yZSd8J2VuZCd8J2FmdGVyJ3wnb24nfCdpbid9IFtwbGFjZU9yT2Zmc2V0XSBTZXRzIHBsYWNlIG9yIG9mZnNldCBvZiB0aGUgc2VsZWN0aW9uLgogICAqIEBwYXJhbSB7T2JqZWN0fSBbb3B0aW9uc10KICAgKiBAcGFyYW0ge0Jvb2xlYW59IFtvcHRpb25zLmJhY2t3YXJkXSBTZXRzIHRoaXMgc2VsZWN0aW9uIGluc3RhbmNlIHRvIGJlIGJhY2t3YXJkLgogICAqIEBwYXJhbSB7Qm9vbGVhbn0gW29wdGlvbnMuZmFrZV0gU2V0cyB0aGlzIHNlbGVjdGlvbiBpbnN0YW5jZSB0byBiZSBtYXJrZWQgYXMgYGZha2VgLgogICAqIEBwYXJhbSB7U3RyaW5nfSBbb3B0aW9ucy5sYWJlbF0gTGFiZWwgZm9yIHRoZSBmYWtlIHNlbGVjdGlvbi4KICAgKi8KCgogIHNldFRvKHNlbGVjdGFibGUsIHBsYWNlT3JPZmZzZXQsIG9wdGlvbnMpIHsKICAgIGlmIChzZWxlY3RhYmxlID09PSBudWxsKSB7CiAgICAgIHRoaXMuX3NldFJhbmdlcyhbXSk7CgogICAgICB0aGlzLl9zZXRGYWtlT3B0aW9ucyhwbGFjZU9yT2Zmc2V0KTsKICAgIH0gZWxzZSBpZiAoc2VsZWN0YWJsZSBpbnN0YW5jZW9mIFNlbGVjdGlvbiB8fCBzZWxlY3RhYmxlIGluc3RhbmNlb2YgRG9jdW1lbnRTZWxlY3Rpb24pIHsKICAgICAgdGhpcy5fc2V0UmFuZ2VzKHNlbGVjdGFibGUuZ2V0UmFuZ2VzKCksIHNlbGVjdGFibGUuaXNCYWNrd2FyZCk7CgogICAgICB0aGlzLl9zZXRGYWtlT3B0aW9ucyh7CiAgICAgICAgZmFrZTogc2VsZWN0YWJsZS5pc0Zha2UsCiAgICAgICAgbGFiZWw6IHNlbGVjdGFibGUuZmFrZVNlbGVjdGlvbkxhYmVsCiAgICAgIH0pOwogICAgfSBlbHNlIGlmIChzZWxlY3RhYmxlIGluc3RhbmNlb2YgUmFuZ2UpIHsKICAgICAgdGhpcy5fc2V0UmFuZ2VzKFtzZWxlY3RhYmxlXSwgcGxhY2VPck9mZnNldCAmJiBwbGFjZU9yT2Zmc2V0LmJhY2t3YXJkKTsKCiAgICAgIHRoaXMuX3NldEZha2VPcHRpb25zKHBsYWNlT3JPZmZzZXQpOwogICAgfSBlbHNlIGlmIChzZWxlY3RhYmxlIGluc3RhbmNlb2YgUG9zaXRpb24pIHsKICAgICAgdGhpcy5fc2V0UmFuZ2VzKFtuZXcgUmFuZ2Uoc2VsZWN0YWJsZSldKTsKCiAgICAgIHRoaXMuX3NldEZha2VPcHRpb25zKHBsYWNlT3JPZmZzZXQpOwogICAgfSBlbHNlIGlmIChzZWxlY3RhYmxlIGluc3RhbmNlb2YgTm9kZSkgewogICAgICBjb25zdCBiYWNrd2FyZCA9ICEhb3B0aW9ucyAmJiAhIW9wdGlvbnMuYmFja3dhcmQ7CiAgICAgIGxldCByYW5nZTsKCiAgICAgIGlmIChwbGFjZU9yT2Zmc2V0ID09PSB1bmRlZmluZWQpIHsKICAgICAgICAvKioKICAgICAgICAgKiBzZWxlY3Rpb24uc2V0VG8gcmVxdWlyZXMgdGhlIHNlY29uZCBwYXJhbWV0ZXIgd2hlbiB0aGUgZmlyc3QgcGFyYW1ldGVyIGlzIGEgbm9kZS4KICAgICAgICAgKgogICAgICAgICAqIEBlcnJvciB2aWV3LXNlbGVjdGlvbi1zZXRUby1yZXF1aXJlZC1zZWNvbmQtcGFyYW1ldGVyCiAgICAgICAgICovCiAgICAgICAgdGhyb3cgbmV3IENLRWRpdG9yRXJyb3IoJ3ZpZXctc2VsZWN0aW9uLXNldFRvLXJlcXVpcmVkLXNlY29uZC1wYXJhbWV0ZXI6ICcgKyAnc2VsZWN0aW9uLnNldFRvIHJlcXVpcmVzIHRoZSBzZWNvbmQgcGFyYW1ldGVyIHdoZW4gdGhlIGZpcnN0IHBhcmFtZXRlciBpcyBhIG5vZGUuJywgdGhpcyk7CiAgICAgIH0gZWxzZSBpZiAocGxhY2VPck9mZnNldCA9PSAnaW4nKSB7CiAgICAgICAgcmFuZ2UgPSBSYW5nZS5fY3JlYXRlSW4oc2VsZWN0YWJsZSk7CiAgICAgIH0gZWxzZSBpZiAocGxhY2VPck9mZnNldCA9PSAnb24nKSB7CiAgICAgICAgcmFuZ2UgPSBSYW5nZS5fY3JlYXRlT24oc2VsZWN0YWJsZSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmFuZ2UgPSBuZXcgUmFuZ2UoUG9zaXRpb24uX2NyZWF0ZUF0KHNlbGVjdGFibGUsIHBsYWNlT3JPZmZzZXQpKTsKICAgICAgfQoKICAgICAgdGhpcy5fc2V0UmFuZ2VzKFtyYW5nZV0sIGJhY2t3YXJkKTsKCiAgICAgIHRoaXMuX3NldEZha2VPcHRpb25zKG9wdGlvbnMpOwogICAgfSBlbHNlIGlmIChpc0l0ZXJhYmxlKHNlbGVjdGFibGUpKSB7CiAgICAgIC8vIFdlIGFzc3VtZSB0aGF0IHRoZSBzZWxlY3RhYmxlIGlzIGFuIGl0ZXJhYmxlIG9mIHJhbmdlcy4KICAgICAgLy8gQXJyYXkuZnJvbSgpIGlzIHVzZWQgdG8gcHJldmVudCBzZXR0aW5nIHJhbmdlcyB0byB0aGUgb2xkIGl0ZXJhYmxlCiAgICAgIHRoaXMuX3NldFJhbmdlcyhzZWxlY3RhYmxlLCBwbGFjZU9yT2Zmc2V0ICYmIHBsYWNlT3JPZmZzZXQuYmFja3dhcmQpOwoKICAgICAgdGhpcy5fc2V0RmFrZU9wdGlvbnMocGxhY2VPck9mZnNldCk7CiAgICB9IGVsc2UgewogICAgICAvKioKICAgICAgICogQ2Fubm90IHNldCBzZWxlY3Rpb24gdG8gZ2l2ZW4gcGxhY2UuCiAgICAgICAqCiAgICAgICAqIEBlcnJvciB2aWV3LXNlbGVjdGlvbi1zZXRUby1ub3Qtc2VsZWN0YWJsZQogICAgICAgKi8KICAgICAgdGhyb3cgbmV3IENLRWRpdG9yRXJyb3IoJ3ZpZXctc2VsZWN0aW9uLXNldFRvLW5vdC1zZWxlY3RhYmxlOiBDYW5ub3Qgc2V0IHNlbGVjdGlvbiB0byBnaXZlbiBwbGFjZS4nLCB0aGlzKTsKICAgIH0KCiAgICB0aGlzLmZpcmUoJ2NoYW5nZScpOwogIH0KICAvKioKICAgKiBNb3ZlcyB7QGxpbmsgI2ZvY3VzfSB0byB0aGUgc3BlY2lmaWVkIGxvY2F0aW9uLgogICAqCiAgICogVGhlIGxvY2F0aW9uIGNhbiBiZSBzcGVjaWZpZWQgaW4gdGhlIHNhbWUgZm9ybSBhcyB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L3ZpZXd+VmlldyNjcmVhdGVQb3NpdGlvbkF0IHZpZXcuY3JlYXRlUG9zaXRpb25BdCgpfQogICAqIHBhcmFtZXRlcnMuCiAgICoKICAgKiBAZmlyZXMgY2hhbmdlCiAgICogQHBhcmFtIHttb2R1bGU6ZW5naW5lL3ZpZXcvaXRlbX5JdGVtfG1vZHVsZTplbmdpbmUvdmlldy9wb3NpdGlvbn5Qb3NpdGlvbn0gaXRlbU9yUG9zaXRpb24KICAgKiBAcGFyYW0ge051bWJlcnwnZW5kJ3wnYmVmb3JlJ3wnYWZ0ZXInfSBbb2Zmc2V0XSBPZmZzZXQgb3Igb25lIG9mIHRoZSBmbGFncy4gVXNlZCBvbmx5IHdoZW4KICAgKiBmaXJzdCBwYXJhbWV0ZXIgaXMgYSB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2l0ZW1+SXRlbSB2aWV3IGl0ZW19LgogICAqLwoKCiAgc2V0Rm9jdXMoaXRlbU9yUG9zaXRpb24sIG9mZnNldCkgewogICAgaWYgKHRoaXMuYW5jaG9yID09PSBudWxsKSB7CiAgICAgIC8qKgogICAgICAgKiBDYW5ub3Qgc2V0IHNlbGVjdGlvbiBmb2N1cyBpZiB0aGVyZSBhcmUgbm8gcmFuZ2VzIGluIHNlbGVjdGlvbi4KICAgICAgICoKICAgICAgICogQGVycm9yIHZpZXctc2VsZWN0aW9uLXNldEZvY3VzLW5vLXJhbmdlcwogICAgICAgKi8KICAgICAgdGhyb3cgbmV3IENLRWRpdG9yRXJyb3IoJ3ZpZXctc2VsZWN0aW9uLXNldEZvY3VzLW5vLXJhbmdlczogQ2Fubm90IHNldCBzZWxlY3Rpb24gZm9jdXMgaWYgdGhlcmUgYXJlIG5vIHJhbmdlcyBpbiBzZWxlY3Rpb24uJywgdGhpcyk7CiAgICB9CgogICAgY29uc3QgbmV3Rm9jdXMgPSBQb3NpdGlvbi5fY3JlYXRlQXQoaXRlbU9yUG9zaXRpb24sIG9mZnNldCk7CgogICAgaWYgKG5ld0ZvY3VzLmNvbXBhcmVXaXRoKHRoaXMuZm9jdXMpID09ICdzYW1lJykgewogICAgICByZXR1cm47CiAgICB9CgogICAgY29uc3QgYW5jaG9yID0gdGhpcy5hbmNob3I7CgogICAgdGhpcy5fcmFuZ2VzLnBvcCgpOwoKICAgIGlmIChuZXdGb2N1cy5jb21wYXJlV2l0aChhbmNob3IpID09ICdiZWZvcmUnKSB7CiAgICAgIHRoaXMuX2FkZFJhbmdlKG5ldyBSYW5nZShuZXdGb2N1cywgYW5jaG9yKSwgdHJ1ZSk7CiAgICB9IGVsc2UgewogICAgICB0aGlzLl9hZGRSYW5nZShuZXcgUmFuZ2UoYW5jaG9yLCBuZXdGb2N1cykpOwogICAgfQoKICAgIHRoaXMuZmlyZSgnY2hhbmdlJyk7CiAgfQogIC8qKgogICAqIENoZWNrcyB3aGV0aGVyIHRoaXMgb2JqZWN0IGlzIG9mIHRoZSBnaXZlbiB0eXBlLgogICAqCiAgICoJCXNlbGVjdGlvbi5pcyggJ3NlbGVjdGlvbicgKTsgLy8gLT4gdHJ1ZQogICAqCQlzZWxlY3Rpb24uaXMoICd2aWV3OnNlbGVjdGlvbicgKTsgLy8gLT4gdHJ1ZQogICAqCiAgICoJCXNlbGVjdGlvbi5pcyggJ21vZGVsOnNlbGVjdGlvbicgKTsgLy8gLT4gZmFsc2UKICAgKgkJc2VsZWN0aW9uLmlzKCAnZWxlbWVudCcgKTsgLy8gLT4gZmFsc2UKICAgKgkJc2VsZWN0aW9uLmlzKCAncmFuZ2UnICk7IC8vIC0+IGZhbHNlCiAgICoKICAgKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L25vZGV+Tm9kZSNpcyBDaGVjayB0aGUgZW50aXJlIGxpc3Qgb2YgdmlldyBvYmplY3RzfSB3aGljaCBpbXBsZW1lbnQgdGhlIGBpcygpYCBtZXRob2QuCiAgICoKICAgKiBAcGFyYW0ge1N0cmluZ30gdHlwZQogICAqIEByZXR1cm5zIHtCb29sZWFufQogICAqLwoKCiAgaXModHlwZSkgewogICAgcmV0dXJuIHR5cGUgPT0gJ3NlbGVjdGlvbicgfHwgdHlwZSA9PSAndmlldzpzZWxlY3Rpb24nOwogIH0KICAvKioKICAgKiBSZXBsYWNlcyBhbGwgcmFuZ2VzIHRoYXQgd2VyZSBhZGRlZCB0byB0aGUgc2VsZWN0aW9uIHdpdGggZ2l2ZW4gYXJyYXkgb2YgcmFuZ2VzLiBMYXN0IHJhbmdlIG9mIHRoZSBhcnJheQogICAqIGlzIHRyZWF0ZWQgbGlrZSB0aGUgbGFzdCBhZGRlZCByYW5nZSBhbmQgaXMgdXNlZCB0byBzZXQge0BsaW5rICNhbmNob3IgYW5jaG9yfSBhbmQge0BsaW5rICNmb2N1cyBmb2N1c30uCiAgICogQWNjZXB0cyBhIGZsYWcgZGVzY3JpYmluZyBpbiB3aGljaCB3YXkgdGhlIHNlbGVjdGlvbiBpcyBtYWRlLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0ge0l0ZXJhYmxlLjxtb2R1bGU6ZW5naW5lL3ZpZXcvcmFuZ2V+UmFuZ2U+fSBuZXdSYW5nZXMgSXRlcmFibGUgb2JqZWN0IG9mIHJhbmdlcyB0byBzZXQuCiAgICogQHBhcmFtIHtCb29sZWFufSBbaXNMYXN0QmFja3dhcmQ9ZmFsc2VdIEZsYWcgZGVzY3JpYmluZyBpZiBsYXN0IGFkZGVkIHJhbmdlIHdhcyBzZWxlY3RlZCBmb3J3YXJkIC0gZnJvbSBzdGFydCB0byBlbmQKICAgKiAoYGZhbHNlYCkgb3IgYmFja3dhcmQgLSBmcm9tIGVuZCB0byBzdGFydCAoYHRydWVgKS4gRGVmYXVsdHMgdG8gYGZhbHNlYC4KICAgKi8KCgogIF9zZXRSYW5nZXMobmV3UmFuZ2VzLCBpc0xhc3RCYWNrd2FyZCA9IGZhbHNlKSB7CiAgICAvLyBOZXcgcmFuZ2VzIHNob3VsZCBiZSBjb3BpZWQgdG8gcHJldmVudCByZW1vdmluZyB0aGVtIGJ5IHNldHRpbmcgdGhlbSB0byBgW11gIGZpcnN0LgogICAgLy8gT25seSBhcHBsaWVzIHRvIHNpdHVhdGlvbnMgd2hlbiBzZWxlY3Rpb24gaXMgc2V0IHRvIHRoZSBzYW1lIHNlbGVjdGlvbiBvciBzYW1lIHNlbGVjdGlvbidzIHJhbmdlcy4KICAgIG5ld1JhbmdlcyA9IEFycmF5LmZyb20obmV3UmFuZ2VzKTsKICAgIHRoaXMuX3JhbmdlcyA9IFtdOwoKICAgIGZvciAoY29uc3QgcmFuZ2Ugb2YgbmV3UmFuZ2VzKSB7CiAgICAgIHRoaXMuX2FkZFJhbmdlKHJhbmdlKTsKICAgIH0KCiAgICB0aGlzLl9sYXN0UmFuZ2VCYWNrd2FyZCA9ICEhaXNMYXN0QmFja3dhcmQ7CiAgfQogIC8qKgogICAqIFNldHMgdGhpcyBzZWxlY3Rpb24gaW5zdGFuY2UgdG8gYmUgbWFya2VkIGFzIGBmYWtlYC4gQSBmYWtlIHNlbGVjdGlvbiBkb2VzIG5vdCByZW5kZXIgYXMgYnJvd3NlciBuYXRpdmUgc2VsZWN0aW9uCiAgICogb3ZlciBzZWxlY3RlZCBlbGVtZW50cyBhbmQgaXMgaGlkZGVuIHRvIHRoZSB1c2VyLiBUaGlzIHdheSwgbm8gbmF0aXZlIHNlbGVjdGlvbiBVSSBhcnRpZmFjdHMgYXJlIGRpc3BsYXllZCB0bwogICAqIHRoZSB1c2VyIGFuZCBzZWxlY3Rpb24gb3ZlciBlbGVtZW50cyBjYW4gYmUgcmVwcmVzZW50ZWQgaW4gb3RoZXIgd2F5LCBmb3IgZXhhbXBsZSBieSBhcHBseWluZyBwcm9wZXIgQ1NTIGNsYXNzLgogICAqCiAgICogQWRkaXRpb25hbGx5IGZha2UncyBzZWxlY3Rpb24gbGFiZWwgY2FuIGJlIHByb3ZpZGVkLiBJdCB3aWxsIGJlIHVzZWQgdG8gZGVzY3JpYmUgZmFrZSBzZWxlY3Rpb24gaW4gRE9NIChhbmQgYmUKICAgKiBwcm9wZXJseSBoYW5kbGVkIGJ5IHNjcmVlbiByZWFkZXJzKS4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHtPYmplY3R9IFtvcHRpb25zXSBPcHRpb25zLgogICAqIEBwYXJhbSB7Qm9vbGVhbn0gW29wdGlvbnMuZmFrZV0gSWYgc2V0IHRvIHRydWUgc2VsZWN0aW9uIHdpbGwgYmUgbWFya2VkIGFzIGBmYWtlYC4KICAgKiBAcGFyYW0ge1N0cmluZ30gW29wdGlvbnMubGFiZWw9JyddIEZha2Ugc2VsZWN0aW9uIGxhYmVsLgogICAqLwoKCiAgX3NldEZha2VPcHRpb25zKG9wdGlvbnMgPSB7fSkgewogICAgdGhpcy5faXNGYWtlID0gISFvcHRpb25zLmZha2U7CiAgICB0aGlzLl9mYWtlU2VsZWN0aW9uTGFiZWwgPSBvcHRpb25zLmZha2UgPyBvcHRpb25zLmxhYmVsIHx8ICcnIDogJyc7CiAgfQogIC8qKgogICAqIEFkZHMgYSByYW5nZSB0byB0aGUgc2VsZWN0aW9uLiBBZGRlZCByYW5nZSBpcyBjb3BpZWQuIFRoaXMgbWVhbnMgdGhhdCBwYXNzZWQgcmFuZ2UgaXMgbm90IHNhdmVkIGluIHRoZQogICAqIHNlbGVjdGlvbiBpbnN0YW5jZSBhbmQgeW91IGNhbiBzYWZlbHkgb3BlcmF0ZSBvbiBpdC4KICAgKgogICAqIEFjY2VwdHMgYSBmbGFnIGRlc2NyaWJpbmcgaW4gd2hpY2ggd2F5IHRoZSBzZWxlY3Rpb24gaXMgbWFkZSAtIHBhc3NlZCByYW5nZSBtaWdodCBiZSBzZWxlY3RlZCBmcm9tCiAgICoge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9yYW5nZX5SYW5nZSNzdGFydCBzdGFydH0gdG8ge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9yYW5nZX5SYW5nZSNlbmQgZW5kfQogICAqIG9yIGZyb20ge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9yYW5nZX5SYW5nZSNlbmQgZW5kfSB0byB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L3JhbmdlflJhbmdlI3N0YXJ0IHN0YXJ0fS4KICAgKiBUaGUgZmxhZyBpcyB1c2VkIHRvIHNldCB7QGxpbmsgI2FuY2hvciBhbmNob3J9IGFuZCB7QGxpbmsgI2ZvY3VzIGZvY3VzfSBwcm9wZXJ0aWVzLgogICAqCiAgICogVGhyb3dzIHtAbGluayBtb2R1bGU6dXRpbHMvY2tlZGl0b3JlcnJvcn5DS0VkaXRvckVycm9yIENLRWRpdG9yRXJyb3J9IGB2aWV3LXNlbGVjdGlvbi1yYW5nZS1pbnRlcnNlY3RzYCBpZiBhZGRlZCByYW5nZSBpbnRlcnNlY3RzCiAgICogd2l0aCByYW5nZXMgYWxyZWFkeSBzdG9yZWQgaW4gU2VsZWN0aW9uIGluc3RhbmNlLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAZmlyZXMgY2hhbmdlCiAgICogQHBhcmFtIHttb2R1bGU6ZW5naW5lL3ZpZXcvcmFuZ2V+UmFuZ2V9IHJhbmdlCiAgICogQHBhcmFtIHtCb29sZWFufSBbaXNCYWNrd2FyZF0KICAgKi8KCgogIF9hZGRSYW5nZShyYW5nZSwgaXNCYWNrd2FyZCA9IGZhbHNlKSB7CiAgICBpZiAoIShyYW5nZSBpbnN0YW5jZW9mIFJhbmdlKSkgewogICAgICAvKioKICAgICAgICogU2VsZWN0aW9uIHJhbmdlIHNldCB0byBhbiBvYmplY3QgdGhhdCBpcyBub3QgYW4gaW5zdGFuY2Ugb2Yge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9yYW5nZX5SYW5nZX0uCiAgICAgICAqCiAgICAgICAqIEBlcnJvciB2aWV3LXNlbGVjdGlvbi1hZGQtcmFuZ2Utbm90LXJhbmdlCiAgICAgICAqLwogICAgICB0aHJvdyBuZXcgQ0tFZGl0b3JFcnJvcigndmlldy1zZWxlY3Rpb24tYWRkLXJhbmdlLW5vdC1yYW5nZTogJyArICdTZWxlY3Rpb24gcmFuZ2Ugc2V0IHRvIGFuIG9iamVjdCB0aGF0IGlzIG5vdCBhbiBpbnN0YW5jZSBvZiB2aWV3LlJhbmdlJywgdGhpcyk7CiAgICB9CgogICAgdGhpcy5fcHVzaFJhbmdlKHJhbmdlKTsKCiAgICB0aGlzLl9sYXN0UmFuZ2VCYWNrd2FyZCA9ICEhaXNCYWNrd2FyZDsKICB9CiAgLyoqCiAgICogQWRkcyByYW5nZSB0byBzZWxlY3Rpb24gLSBjcmVhdGVzIGNvcHkgb2YgZ2l2ZW4gcmFuZ2Ugc28gaXQgY2FuIGJlIHNhZmVseSB1c2VkIGFuZCBtb2RpZmllZC4KICAgKgogICAqIFRocm93cyB7QGxpbmsgbW9kdWxlOnV0aWxzL2NrZWRpdG9yZXJyb3J+Q0tFZGl0b3JFcnJvciBDS0VkaXRvckVycm9yfSBgdmlldy1zZWxlY3Rpb24tcmFuZ2UtaW50ZXJzZWN0c2AgaWYgYWRkZWQgcmFuZ2UgaW50ZXJzZWN0cwogICAqIHdpdGggcmFuZ2VzIGFscmVhZHkgc3RvcmVkIGluIHNlbGVjdGlvbiBpbnN0YW5jZS4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHttb2R1bGU6ZW5naW5lL3ZpZXcvcmFuZ2V+UmFuZ2V9IHJhbmdlCiAgICovCgoKICBfcHVzaFJhbmdlKHJhbmdlKSB7CiAgICBmb3IgKGNvbnN0IHN0b3JlZFJhbmdlIG9mIHRoaXMuX3JhbmdlcykgewogICAgICBpZiAocmFuZ2UuaXNJbnRlcnNlY3Rpbmcoc3RvcmVkUmFuZ2UpKSB7CiAgICAgICAgLyoqCiAgICAgICAgICogVHJ5aW5nIHRvIGFkZCBhIHJhbmdlIHRoYXQgaW50ZXJzZWN0cyB3aXRoIGFub3RoZXIgcmFuZ2UgZnJvbSBzZWxlY3Rpb24uCiAgICAgICAgICoKICAgICAgICAgKiBAZXJyb3Igdmlldy1zZWxlY3Rpb24tcmFuZ2UtaW50ZXJzZWN0cwogICAgICAgICAqIEBwYXJhbSB7bW9kdWxlOmVuZ2luZS92aWV3L3JhbmdlflJhbmdlfSBhZGRlZFJhbmdlIFJhbmdlIHRoYXQgd2FzIGFkZGVkIHRvIHRoZSBzZWxlY3Rpb24uCiAgICAgICAgICogQHBhcmFtIHttb2R1bGU6ZW5naW5lL3ZpZXcvcmFuZ2V+UmFuZ2V9IGludGVyc2VjdGluZ1JhbmdlIFJhbmdlIGZyb20gc2VsZWN0aW9uIHRoYXQgaW50ZXJzZWN0cyB3aXRoIGBhZGRlZFJhbmdlYC4KICAgICAgICAgKi8KICAgICAgICB0aHJvdyBuZXcgQ0tFZGl0b3JFcnJvcigndmlldy1zZWxlY3Rpb24tcmFuZ2UtaW50ZXJzZWN0czogVHJ5aW5nIHRvIGFkZCBhIHJhbmdlIHRoYXQgaW50ZXJzZWN0cyB3aXRoIGFub3RoZXIgcmFuZ2UgZnJvbSBzZWxlY3Rpb24uJywgdGhpcywgewogICAgICAgICAgYWRkZWRSYW5nZTogcmFuZ2UsCiAgICAgICAgICBpbnRlcnNlY3RpbmdSYW5nZTogc3RvcmVkUmFuZ2UKICAgICAgICB9KTsKICAgICAgfQogICAgfQoKICAgIHRoaXMuX3Jhbmdlcy5wdXNoKG5ldyBSYW5nZShyYW5nZS5zdGFydCwgcmFuZ2UuZW5kKSk7CiAgfQogIC8qKgogICAqIEZpcmVkIHdoZW5ldmVyIHNlbGVjdGlvbiByYW5nZXMgYXJlIGNoYW5nZWQgdGhyb3VnaCB7QGxpbmsgflNlbGVjdGlvbiBTZWxlY3Rpb24gQVBJfS4KICAgKgogICAqIEBldmVudCBjaGFuZ2UKICAgKi8KCgp9Cm1peChTZWxlY3Rpb24sIEVtaXR0ZXJNaXhpbik7Ci8qKgogKiBBbiBlbnRpdHkgdGhhdCBpcyB1c2VkIHRvIHNldCBzZWxlY3Rpb24uCiAqCiAqIFNlZSBhbHNvIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvc2VsZWN0aW9uflNlbGVjdGlvbiNzZXRUb30KICoKICogQHR5cGVkZWYgewogKiAgICBtb2R1bGU6ZW5naW5lL3ZpZXcvc2VsZWN0aW9uflNlbGVjdGlvbnwKICogICAgbW9kdWxlOmVuZ2luZS92aWV3L2RvY3VtZW50c2VsZWN0aW9ufkRvY3VtZW50U2VsZWN0aW9ufAogKiAgICBtb2R1bGU6ZW5naW5lL3ZpZXcvcG9zaXRpb25+UG9zaXRpb258CiAqICAgIEl0ZXJhYmxlLjxtb2R1bGU6ZW5naW5lL3ZpZXcvcmFuZ2V+UmFuZ2U+fAogKiAgICBtb2R1bGU6ZW5naW5lL3ZpZXcvcmFuZ2V+UmFuZ2V8CiAqICAgIG1vZHVsZTplbmdpbmUvdmlldy9pdGVtfkl0ZW18CiAqICAgIG51bGwKICogfSBtb2R1bGU6ZW5naW5lL3ZpZXcvc2VsZWN0aW9uflNlbGVjdGFibGUKICov"},{"version":3,"sources":["/Users/antonyching/Desktop/project/new-builder-demo/node_modules/@ckeditor/ckeditor5-engine/src/view/selection.js"],"names":["CKEditorError","Range","Position","mix","EmitterMixin","Node","Element","count","isIterable","DocumentSelection","Selection","constructor","selectable","placeOrOffset","options","_ranges","_lastRangeBackward","_isFake","_fakeSelectionLabel","setTo","isFake","fakeSelectionLabel","anchor","length","range","end","start","clone","focus","isCollapsed","rangeCount","isBackward","editableElement","getRanges","getFirstRange","first","isBefore","getLastRange","last","isAfter","getFirstPosition","firstRange","getLastPosition","lastRange","isEqual","otherSelection","thisRange","found","otherRange","isSimilar","numOfRangesA","numOfRangesB","rangeA","getTrimmed","rangeB","getSelectedElement","nodeAfterStart","nodeAfter","nodeBeforeEnd","nodeBefore","parent","is","isAtEnd","nextSibling","isAtStart","previousSibling","_setRanges","_setFakeOptions","fake","label","backward","undefined","_createIn","_createOn","_createAt","fire","setFocus","itemOrPosition","offset","newFocus","compareWith","pop","_addRange","type","newRanges","isLastBackward","Array","from","_pushRange","storedRange","isIntersecting","addedRange","intersectingRange","push"],"mappings":"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","sourcesContent":["/**\n * @license Copyright (c) 2003-2019, CKSource - Frederico Knabben. All rights reserved.\n * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license\n */\n\n/**\n * @module engine/view/selection\n */\n\nimport CKEditorError from '@ckeditor/ckeditor5-utils/src/ckeditorerror';\nimport Range from './range';\nimport Position from './position';\nimport mix from '@ckeditor/ckeditor5-utils/src/mix';\nimport EmitterMixin from '@ckeditor/ckeditor5-utils/src/emittermixin';\nimport Node from './node';\nimport Element from './element';\nimport count from '@ckeditor/ckeditor5-utils/src/count';\nimport isIterable from '@ckeditor/ckeditor5-utils/src/isiterable';\nimport DocumentSelection from './documentselection';\n\n/**\n * Class representing an arbirtary selection in the view.\n * See also {@link module:engine/view/documentselection~DocumentSelection}.\n *\n * New selection instances can be created via the constructor or one these methods:\n *\n * * {@link module:engine/view/view~View#createSelection `View#createSelection()`},\n * * {@link module:engine/view/upcastwriter~UpcastWriter#createSelection `UpcastWriter#createSelection()`}.\n *\n * A selection can consist of {@link module:engine/view/range~Range ranges} that can be set by using\n * the {@link module:engine/view/selection~Selection#setTo `Selection#setTo()`} method.\n */\nexport default class Selection {\n\t/**\n\t * Creates new selection instance.\n\t *\n\t * **Note**: The selection constructor is available as a factory method:\n\t *\n\t * * {@link module:engine/view/view~View#createSelection `View#createSelection()`},\n\t * * {@link module:engine/view/upcastwriter~UpcastWriter#createSelection `UpcastWriter#createSelection()`}.\n\t *\n\t * \t\t// Creates empty selection without ranges.\n\t *\t\tconst selection = writer.createSelection();\n\t *\n\t *\t\t// Creates selection at the given range.\n\t *\t\tconst range = writer.createRange( start, end );\n\t *\t\tconst selection = writer.createSelection( range );\n\t *\n\t *\t\t// Creates selection at the given ranges\n\t * \t\tconst ranges = [ writer.createRange( start1, end2 ), writer.createRange( star2, end2 ) ];\n\t *\t\tconst selection = writer.createSelection( ranges );\n\t *\n\t *\t\t// Creates selection from the other selection.\n\t *\t\tconst otherSelection = writer.createSelection();\n\t *\t\tconst selection = writer.createSelection( otherSelection );\n\t *\n\t *\t\t// Creates selection from the document selection.\n\t *\t\tconst selection = writer.createSelection( editor.editing.view.document.selection );\n\t *\n\t * \t\t// Creates selection at the given position.\n\t *\t\tconst position = writer.createPositionFromPath( root, path );\n\t *\t\tconst selection = writer.createSelection( position );\n\t *\n\t *\t\t// Creates collapsed selection at the position of given item and offset.\n\t *\t\tconst paragraph = writer.createContainerElement( 'paragraph' );\n\t *\t\tconst selection = writer.createSelection( paragraph, offset );\n\t *\n\t *\t\t// Creates a range inside an {@link module:engine/view/element~Element element} which starts before the\n\t *\t\t// first child of that element and ends after the last child of that element.\n\t *\t\tconst selection = writer.createSelection( paragraph, 'in' );\n\t *\n\t *\t\t// Creates a range on an {@link module:engine/view/item~Item item} which starts before the item and ends\n\t *\t\t// just after the item.\n\t *\t\tconst selection = writer.createSelection( paragraph, 'on' );\n\t *\n\t * `Selection`'s constructor allow passing additional options (`backward`, `fake` and `label`) as the last argument.\n\t *\n\t *\t\t// Creates backward selection.\n\t *\t\tconst selection = writer.createSelection( range, { backward: true } );\n\t *\n\t * Fake selection does not render as browser native selection over selected elements and is hidden to the user.\n\t * This way, no native selection UI artifacts are displayed to the user and selection over elements can be\n\t * represented in other way, for example by applying proper CSS class.\n\t *\n\t * Additionally fake's selection label can be provided. It will be used to describe fake selection in DOM\n\t * (and be  properly handled by screen readers).\n\t *\n\t *\t\t// Creates fake selection with label.\n\t *\t\tconst selection = writer.createSelection( range, { fake: true, label: 'foo' } );\n\t *\n\t * @param {module:engine/view/selection~Selectable} [selectable=null]\n\t * @param {Number|'before'|'end'|'after'|'on'|'in'} [placeOrOffset] Offset or place when selectable is an `Item`.\n\t * @param {Object} [options]\n\t * @param {Boolean} [options.backward] Sets this selection instance to be backward.\n\t * @param {Boolean} [options.fake] Sets this selection instance to be marked as `fake`.\n\t * @param {String} [options.label] Label for the fake selection.\n\t */\n\tconstructor( selectable = null, placeOrOffset, options ) {\n\t\t/**\n\t\t * Stores all ranges that are selected.\n\t\t *\n\t\t * @protected\n\t\t * @member {Array.<module:engine/view/range~Range>}\n\t\t */\n\t\tthis._ranges = [];\n\n\t\t/**\n\t\t * Specifies whether the last added range was added as a backward or forward range.\n\t\t *\n\t\t * @protected\n\t\t * @member {Boolean}\n\t\t */\n\t\tthis._lastRangeBackward = false;\n\n\t\t/**\n\t\t * Specifies whether selection instance is fake.\n\t\t *\n\t\t * @private\n\t\t * @member {Boolean}\n\t\t */\n\t\tthis._isFake = false;\n\n\t\t/**\n\t\t * Fake selection's label.\n\t\t *\n\t\t * @private\n\t\t * @member {String}\n\t\t */\n\t\tthis._fakeSelectionLabel = '';\n\n\t\tthis.setTo( selectable, placeOrOffset, options );\n\t}\n\n\t/**\n\t * Returns true if selection instance is marked as `fake`.\n\t *\n\t * @see #setTo\n\t * @returns {Boolean}\n\t */\n\tget isFake() {\n\t\treturn this._isFake;\n\t}\n\n\t/**\n\t * Returns fake selection label.\n\t *\n\t * @see #setTo\n\t * @returns {String}\n\t */\n\tget fakeSelectionLabel() {\n\t\treturn this._fakeSelectionLabel;\n\t}\n\n\t/**\n\t * Selection anchor. Anchor may be described as a position where the selection starts. Together with\n\t * {@link #focus focus} they define the direction of selection, which is important\n\t * when expanding/shrinking selection. Anchor is always the start or end of the most recent added range.\n\t * It may be a bit unintuitive when there are multiple ranges in selection.\n\t *\n\t * @see #focus\n\t * @type {module:engine/view/position~Position}\n\t */\n\tget anchor() {\n\t\tif ( !this._ranges.length ) {\n\t\t\treturn null;\n\t\t}\n\t\tconst range = this._ranges[ this._ranges.length - 1 ];\n\t\tconst anchor = this._lastRangeBackward ? range.end : range.start;\n\n\t\treturn anchor.clone();\n\t}\n\n\t/**\n\t * Selection focus. Focus is a position where the selection ends.\n\t *\n\t * @see #anchor\n\t * @type {module:engine/view/position~Position}\n\t */\n\tget focus() {\n\t\tif ( !this._ranges.length ) {\n\t\t\treturn null;\n\t\t}\n\t\tconst range = this._ranges[ this._ranges.length - 1 ];\n\t\tconst focus = this._lastRangeBackward ? range.start : range.end;\n\n\t\treturn focus.clone();\n\t}\n\n\t/**\n\t * Returns whether the selection is collapsed. Selection is collapsed when there is exactly one range which is\n\t * collapsed.\n\t *\n\t * @type {Boolean}\n\t */\n\tget isCollapsed() {\n\t\treturn this.rangeCount === 1 && this._ranges[ 0 ].isCollapsed;\n\t}\n\n\t/**\n\t * Returns number of ranges in selection.\n\t *\n\t * @type {Number}\n\t */\n\tget rangeCount() {\n\t\treturn this._ranges.length;\n\t}\n\n\t/**\n\t * Specifies whether the {@link #focus} precedes {@link #anchor}.\n\t *\n\t * @type {Boolean}\n\t */\n\tget isBackward() {\n\t\treturn !this.isCollapsed && this._lastRangeBackward;\n\t}\n\n\t/**\n\t * {@link module:engine/view/editableelement~EditableElement EditableElement} instance that contains this selection, or `null`\n\t * if the selection is not inside an editable element.\n\t *\n\t * @type {module:engine/view/editableelement~EditableElement|null}\n\t */\n\tget editableElement() {\n\t\tif ( this.anchor ) {\n\t\t\treturn this.anchor.editableElement;\n\t\t}\n\n\t\treturn null;\n\t}\n\n\t/**\n\t * Returns an iterable that contains copies of all ranges added to the selection.\n\t *\n\t * @returns {Iterable.<module:engine/view/range~Range>}\n\t */\n\t* getRanges() {\n\t\tfor ( const range of this._ranges ) {\n\t\t\tyield range.clone();\n\t\t}\n\t}\n\n\t/**\n\t * Returns copy of the first range in the selection. First range is the one which\n\t * {@link module:engine/view/range~Range#start start} position {@link module:engine/view/position~Position#isBefore is before} start\n\t * position of all other ranges (not to confuse with the first range added to the selection).\n\t * Returns `null` if no ranges are added to selection.\n\t *\n\t * @returns {module:engine/view/range~Range|null}\n\t */\n\tgetFirstRange() {\n\t\tlet first = null;\n\n\t\tfor ( const range of this._ranges ) {\n\t\t\tif ( !first || range.start.isBefore( first.start ) ) {\n\t\t\t\tfirst = range;\n\t\t\t}\n\t\t}\n\n\t\treturn first ? first.clone() : null;\n\t}\n\n\t/**\n\t * Returns copy of the last range in the selection. Last range is the one which {@link module:engine/view/range~Range#end end}\n\t * position {@link module:engine/view/position~Position#isAfter is after} end position of all other ranges (not to confuse\n\t * with the last range added to the selection). Returns `null` if no ranges are added to selection.\n\t *\n\t * @returns {module:engine/view/range~Range|null}\n\t */\n\tgetLastRange() {\n\t\tlet last = null;\n\n\t\tfor ( const range of this._ranges ) {\n\t\t\tif ( !last || range.end.isAfter( last.end ) ) {\n\t\t\t\tlast = range;\n\t\t\t}\n\t\t}\n\n\t\treturn last ? last.clone() : null;\n\t}\n\n\t/**\n\t * Returns copy of the first position in the selection. First position is the position that\n\t * {@link module:engine/view/position~Position#isBefore is before} any other position in the selection ranges.\n\t * Returns `null` if no ranges are added to selection.\n\t *\n\t * @returns {module:engine/view/position~Position|null}\n\t */\n\tgetFirstPosition() {\n\t\tconst firstRange = this.getFirstRange();\n\n\t\treturn firstRange ? firstRange.start.clone() : null;\n\t}\n\n\t/**\n\t * Returns copy of the last position in the selection. Last position is the position that\n\t * {@link module:engine/view/position~Position#isAfter is after} any other position in the selection ranges.\n\t * Returns `null` if no ranges are added to selection.\n\t *\n\t * @returns {module:engine/view/position~Position|null}\n\t */\n\tgetLastPosition() {\n\t\tconst lastRange = this.getLastRange();\n\n\t\treturn lastRange ? lastRange.end.clone() : null;\n\t}\n\n\t/**\n\t * Checks whether, this selection is equal to given selection. Selections are equal if they have same directions,\n\t * same number of ranges and all ranges from one selection equal to a range from other selection.\n\t *\n\t * @param {module:engine/view/selection~Selection|module:engine/view/documentselection~DocumentSelection} otherSelection\n\t * Selection to compare with.\n\t * @returns {Boolean} `true` if selections are equal, `false` otherwise.\n\t */\n\tisEqual( otherSelection ) {\n\t\tif ( this.isFake != otherSelection.isFake ) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif ( this.isFake && this.fakeSelectionLabel != otherSelection.fakeSelectionLabel ) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif ( this.rangeCount != otherSelection.rangeCount ) {\n\t\t\treturn false;\n\t\t} else if ( this.rangeCount === 0 ) {\n\t\t\treturn true;\n\t\t}\n\n\t\tif ( !this.anchor.isEqual( otherSelection.anchor ) || !this.focus.isEqual( otherSelection.focus ) ) {\n\t\t\treturn false;\n\t\t}\n\n\t\tfor ( const thisRange of this._ranges ) {\n\t\t\tlet found = false;\n\n\t\t\tfor ( const otherRange of otherSelection._ranges ) {\n\t\t\t\tif ( thisRange.isEqual( otherRange ) ) {\n\t\t\t\t\tfound = true;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif ( !found ) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\n\t\treturn true;\n\t}\n\n\t/**\n\t * Checks whether this selection is similar to given selection. Selections are similar if they have same directions, same\n\t * number of ranges, and all {@link module:engine/view/range~Range#getTrimmed trimmed} ranges from one selection are\n\t * equal to any trimmed range from other selection.\n\t *\n\t * @param {module:engine/view/selection~Selection|module:engine/view/documentselection~DocumentSelection} otherSelection\n\t * Selection to compare with.\n\t * @returns {Boolean} `true` if selections are similar, `false` otherwise.\n\t */\n\tisSimilar( otherSelection ) {\n\t\tif ( this.isBackward != otherSelection.isBackward ) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst numOfRangesA = count( this.getRanges() );\n\t\tconst numOfRangesB = count( otherSelection.getRanges() );\n\n\t\t// If selections have different number of ranges, they cannot be similar.\n\t\tif ( numOfRangesA != numOfRangesB ) {\n\t\t\treturn false;\n\t\t}\n\n\t\t// If both selections have no ranges, they are similar.\n\t\tif ( numOfRangesA == 0 ) {\n\t\t\treturn true;\n\t\t}\n\n\t\t// Check if each range in one selection has a similar range in other selection.\n\t\tfor ( let rangeA of this.getRanges() ) {\n\t\t\trangeA = rangeA.getTrimmed();\n\n\t\t\tlet found = false;\n\n\t\t\tfor ( let rangeB of otherSelection.getRanges() ) {\n\t\t\t\trangeB = rangeB.getTrimmed();\n\n\t\t\t\tif ( rangeA.start.isEqual( rangeB.start ) && rangeA.end.isEqual( rangeB.end ) ) {\n\t\t\t\t\tfound = true;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// For `rangeA`, neither range in `otherSelection` was similar. So selections are not similar.\n\t\t\tif ( !found ) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\n\t\t// There were no ranges that weren't matched. Selections are similar.\n\t\treturn true;\n\t}\n\n\t/**\n\t * Returns the selected element. {@link module:engine/view/element~Element Element} is considered as selected if there is only\n\t * one range in the selection, and that range contains exactly one element.\n\t * Returns `null` if there is no selected element.\n\t *\n\t * @returns {module:engine/view/element~Element|null}\n\t */\n\tgetSelectedElement() {\n\t\tif ( this.rangeCount !== 1 ) {\n\t\t\treturn null;\n\t\t}\n\n\t\tconst range = this.getFirstRange();\n\n\t\tlet nodeAfterStart = range.start.nodeAfter;\n\t\tlet nodeBeforeEnd = range.end.nodeBefore;\n\n\t\t// Handle the situation when selection position is at the beginning / at the end of a text node.\n\t\t// In such situation `.nodeAfter` and `.nodeBefore` are `null` but the selection still might be spanning\n\t\t// over one element.\n\t\t//\n\t\t// <p>Foo{<span class=\"widget\"></span>}bar</p> vs <p>Foo[<span class=\"widget\"></span>]bar</p>\n\t\t//\n\t\t// These are basically the same selections, only the difference is if the selection position is at\n\t\t// at the end/at the beginning of a text node or just before/just after the text node.\n\t\t//\n\t\tif ( range.start.parent.is( 'text' ) && range.start.isAtEnd && range.start.parent.nextSibling ) {\n\t\t\tnodeAfterStart = range.start.parent.nextSibling;\n\t\t}\n\n\t\tif ( range.end.parent.is( 'text' ) && range.end.isAtStart && range.end.parent.previousSibling ) {\n\t\t\tnodeBeforeEnd = range.end.parent.previousSibling;\n\t\t}\n\n\t\treturn ( nodeAfterStart instanceof Element && nodeAfterStart == nodeBeforeEnd ) ? nodeAfterStart : null;\n\t}\n\n\t/**\n\t * Sets this selection's ranges and direction to the specified location based on the given\n\t * {@link module:engine/view/selection~Selectable selectable}.\n\t *\n\t *\t\t// Sets selection to the given range.\n\t *\t\tconst range = writer.createRange( start, end );\n\t *\t\tselection.setTo( range );\n\t *\n\t *\t\t// Sets selection to given ranges.\n\t * \t\tconst ranges = [ writer.createRange( start1, end2 ), writer.createRange( star2, end2 ) ];\n\t *\t\tselection.setTo( range );\n\t *\n\t *\t\t// Sets selection to the other selection.\n\t *\t\tconst otherSelection = writer.createSelection();\n\t *\t\tselection.setTo( otherSelection );\n\t *\n\t *\t \t// Sets selection to contents of DocumentSelection.\n\t *\t\tselection.setTo( editor.editing.view.document.selection );\n\t *\n\t * \t\t// Sets collapsed selection at the given position.\n\t *\t\tconst position = writer.createPositionAt( root, path );\n\t *\t\tselection.setTo( position );\n\t *\n\t * \t\t// Sets collapsed selection at the position of given item and offset.\n\t *\t\tselection.setTo( paragraph, offset );\n\t *\n\t * Creates a range inside an {@link module:engine/view/element~Element element} which starts before the first child of\n\t * that element and ends after the last child of that element.\n\t *\n\t *\t\tselection.setTo( paragraph, 'in' );\n\t *\n\t * Creates a range on an {@link module:engine/view/item~Item item} which starts before the item and ends just after the item.\n\t *\n\t *\t\tselection.setTo( paragraph, 'on' );\n\t *\n\t * \t\t// Clears selection. Removes all ranges.\n\t *\t\tselection.setTo( null );\n\t *\n\t * `Selection#setTo()` method allow passing additional options (`backward`, `fake` and `label`) as the last argument.\n\t *\n\t *\t\t// Sets selection as backward.\n\t *\t\tselection.setTo( range, { backward: true } );\n\t *\n\t * Fake selection does not render as browser native selection over selected elements and is hidden to the user.\n\t * This way, no native selection UI artifacts are displayed to the user and selection over elements can be\n\t * represented in other way, for example by applying proper CSS class.\n\t *\n\t * Additionally fake's selection label can be provided. It will be used to describe fake selection in DOM\n\t * (and be  properly handled by screen readers).\n\t *\n\t *\t\t// Creates fake selection with label.\n\t *\t\tselection.setTo( range, { fake: true, label: 'foo' } );\n\t *\n\t * @fires change\n\t * @param {module:engine/view/selection~Selectable} selectable\n\t * @param {Number|'before'|'end'|'after'|'on'|'in'} [placeOrOffset] Sets place or offset of the selection.\n\t * @param {Object} [options]\n\t * @param {Boolean} [options.backward] Sets this selection instance to be backward.\n\t * @param {Boolean} [options.fake] Sets this selection instance to be marked as `fake`.\n\t * @param {String} [options.label] Label for the fake selection.\n\t */\n\tsetTo( selectable, placeOrOffset, options ) {\n\t\tif ( selectable === null ) {\n\t\t\tthis._setRanges( [] );\n\t\t\tthis._setFakeOptions( placeOrOffset );\n\t\t} else if ( selectable instanceof Selection || selectable instanceof DocumentSelection ) {\n\t\t\tthis._setRanges( selectable.getRanges(), selectable.isBackward );\n\t\t\tthis._setFakeOptions( { fake: selectable.isFake, label: selectable.fakeSelectionLabel } );\n\t\t} else if ( selectable instanceof Range ) {\n\t\t\tthis._setRanges( [ selectable ], placeOrOffset && placeOrOffset.backward );\n\t\t\tthis._setFakeOptions( placeOrOffset );\n\t\t} else if ( selectable instanceof Position ) {\n\t\t\tthis._setRanges( [ new Range( selectable ) ] );\n\t\t\tthis._setFakeOptions( placeOrOffset );\n\t\t} else if ( selectable instanceof Node ) {\n\t\t\tconst backward = !!options && !!options.backward;\n\t\t\tlet range;\n\n\t\t\tif ( placeOrOffset === undefined ) {\n\t\t\t\t/**\n\t\t\t\t * selection.setTo requires the second parameter when the first parameter is a node.\n\t\t\t\t *\n\t\t\t\t * @error view-selection-setTo-required-second-parameter\n\t\t\t\t */\n\t\t\t\tthrow new CKEditorError(\n\t\t\t\t\t'view-selection-setTo-required-second-parameter: ' +\n\t\t\t\t\t'selection.setTo requires the second parameter when the first parameter is a node.',\n\t\t\t\t\tthis\n\t\t\t\t);\n\t\t\t} else if ( placeOrOffset == 'in' ) {\n\t\t\t\trange = Range._createIn( selectable );\n\t\t\t} else if ( placeOrOffset == 'on' ) {\n\t\t\t\trange = Range._createOn( selectable );\n\t\t\t} else {\n\t\t\t\trange = new Range( Position._createAt( selectable, placeOrOffset ) );\n\t\t\t}\n\n\t\t\tthis._setRanges( [ range ], backward );\n\t\t\tthis._setFakeOptions( options );\n\t\t} else if ( isIterable( selectable ) ) {\n\t\t\t// We assume that the selectable is an iterable of ranges.\n\t\t\t// Array.from() is used to prevent setting ranges to the old iterable\n\t\t\tthis._setRanges( selectable, placeOrOffset && placeOrOffset.backward );\n\t\t\tthis._setFakeOptions( placeOrOffset );\n\t\t} else {\n\t\t\t/**\n\t\t\t * Cannot set selection to given place.\n\t\t\t *\n\t\t\t * @error view-selection-setTo-not-selectable\n\t\t\t */\n\t\t\tthrow new CKEditorError( 'view-selection-setTo-not-selectable: Cannot set selection to given place.', this );\n\t\t}\n\n\t\tthis.fire( 'change' );\n\t}\n\n\t/**\n\t * Moves {@link #focus} to the specified location.\n\t *\n\t * The location can be specified in the same form as {@link module:engine/view/view~View#createPositionAt view.createPositionAt()}\n\t * parameters.\n\t *\n\t * @fires change\n\t * @param {module:engine/view/item~Item|module:engine/view/position~Position} itemOrPosition\n\t * @param {Number|'end'|'before'|'after'} [offset] Offset or one of the flags. Used only when\n\t * first parameter is a {@link module:engine/view/item~Item view item}.\n\t */\n\tsetFocus( itemOrPosition, offset ) {\n\t\tif ( this.anchor === null ) {\n\t\t\t/**\n\t\t\t * Cannot set selection focus if there are no ranges in selection.\n\t\t\t *\n\t\t\t * @error view-selection-setFocus-no-ranges\n\t\t\t */\n\t\t\tthrow new CKEditorError(\n\t\t\t\t'view-selection-setFocus-no-ranges: Cannot set selection focus if there are no ranges in selection.',\n\t\t\t\tthis\n\t\t\t);\n\t\t}\n\n\t\tconst newFocus = Position._createAt( itemOrPosition, offset );\n\n\t\tif ( newFocus.compareWith( this.focus ) == 'same' ) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst anchor = this.anchor;\n\n\t\tthis._ranges.pop();\n\n\t\tif ( newFocus.compareWith( anchor ) == 'before' ) {\n\t\t\tthis._addRange( new Range( newFocus, anchor ), true );\n\t\t} else {\n\t\t\tthis._addRange( new Range( anchor, newFocus ) );\n\t\t}\n\n\t\tthis.fire( 'change' );\n\t}\n\n\t/**\n\t * Checks whether this object is of the given type.\n\t *\n\t *\t\tselection.is( 'selection' ); // -> true\n\t *\t\tselection.is( 'view:selection' ); // -> true\n\t *\n\t *\t\tselection.is( 'model:selection' ); // -> false\n\t *\t\tselection.is( 'element' ); // -> false\n\t *\t\tselection.is( 'range' ); // -> false\n\t *\n\t * {@link module:engine/view/node~Node#is Check the entire list of view objects} which implement the `is()` method.\n\t *\n\t * @param {String} type\n\t * @returns {Boolean}\n\t */\n\tis( type ) {\n\t\treturn type == 'selection' || type == 'view:selection';\n\t}\n\n\t/**\n\t * Replaces all ranges that were added to the selection with given array of ranges. Last range of the array\n\t * is treated like the last added range and is used to set {@link #anchor anchor} and {@link #focus focus}.\n\t * Accepts a flag describing in which way the selection is made.\n\t *\n\t * @private\n\t * @param {Iterable.<module:engine/view/range~Range>} newRanges Iterable object of ranges to set.\n\t * @param {Boolean} [isLastBackward=false] Flag describing if last added range was selected forward - from start to end\n\t * (`false`) or backward - from end to start (`true`). Defaults to `false`.\n\t */\n\t_setRanges( newRanges, isLastBackward = false ) {\n\t\t// New ranges should be copied to prevent removing them by setting them to `[]` first.\n\t\t// Only applies to situations when selection is set to the same selection or same selection's ranges.\n\t\tnewRanges = Array.from( newRanges );\n\n\t\tthis._ranges = [];\n\n\t\tfor ( const range of newRanges ) {\n\t\t\tthis._addRange( range );\n\t\t}\n\n\t\tthis._lastRangeBackward = !!isLastBackward;\n\t}\n\n\t/**\n\t * Sets this selection instance to be marked as `fake`. A fake selection does not render as browser native selection\n\t * over selected elements and is hidden to the user. This way, no native selection UI artifacts are displayed to\n\t * the user and selection over elements can be represented in other way, for example by applying proper CSS class.\n\t *\n\t * Additionally fake's selection label can be provided. It will be used to describe fake selection in DOM (and be\n\t * properly handled by screen readers).\n\t *\n\t * @private\n\t * @param {Object} [options] Options.\n\t * @param {Boolean} [options.fake] If set to true selection will be marked as `fake`.\n\t * @param {String} [options.label=''] Fake selection label.\n\t */\n\t_setFakeOptions( options = {} ) {\n\t\tthis._isFake = !!options.fake;\n\t\tthis._fakeSelectionLabel = options.fake ? options.label || '' : '';\n\t}\n\n\t/**\n\t * Adds a range to the selection. Added range is copied. This means that passed range is not saved in the\n\t * selection instance and you can safely operate on it.\n\t *\n\t * Accepts a flag describing in which way the selection is made - passed range might be selected from\n\t * {@link module:engine/view/range~Range#start start} to {@link module:engine/view/range~Range#end end}\n\t * or from {@link module:engine/view/range~Range#end end} to {@link module:engine/view/range~Range#start start}.\n\t * The flag is used to set {@link #anchor anchor} and {@link #focus focus} properties.\n\t *\n\t * Throws {@link module:utils/ckeditorerror~CKEditorError CKEditorError} `view-selection-range-intersects` if added range intersects\n\t * with ranges already stored in Selection instance.\n\t *\n\t * @private\n\t * @fires change\n\t * @param {module:engine/view/range~Range} range\n\t * @param {Boolean} [isBackward]\n\t */\n\t_addRange( range, isBackward = false ) {\n\t\tif ( !( range instanceof Range ) ) {\n\t\t\t/**\n\t\t\t * Selection range set to an object that is not an instance of {@link module:engine/view/range~Range}.\n\t\t\t *\n\t\t\t * @error view-selection-add-range-not-range\n\t\t\t */\n\t\t\tthrow new CKEditorError(\n\t\t\t\t'view-selection-add-range-not-range: ' +\n\t\t\t\t'Selection range set to an object that is not an instance of view.Range',\n\t\t\t\tthis\n\t\t\t);\n\t\t}\n\n\t\tthis._pushRange( range );\n\t\tthis._lastRangeBackward = !!isBackward;\n\t}\n\n\t/**\n\t * Adds range to selection - creates copy of given range so it can be safely used and modified.\n\t *\n\t * Throws {@link module:utils/ckeditorerror~CKEditorError CKEditorError} `view-selection-range-intersects` if added range intersects\n\t * with ranges already stored in selection instance.\n\t *\n\t * @private\n\t * @param {module:engine/view/range~Range} range\n\t */\n\t_pushRange( range ) {\n\t\tfor ( const storedRange of this._ranges ) {\n\t\t\tif ( range.isIntersecting( storedRange ) ) {\n\t\t\t\t/**\n\t\t\t\t * Trying to add a range that intersects with another range from selection.\n\t\t\t\t *\n\t\t\t\t * @error view-selection-range-intersects\n\t\t\t\t * @param {module:engine/view/range~Range} addedRange Range that was added to the selection.\n\t\t\t\t * @param {module:engine/view/range~Range} intersectingRange Range from selection that intersects with `addedRange`.\n\t\t\t\t */\n\t\t\t\tthrow new CKEditorError(\n\t\t\t\t\t'view-selection-range-intersects: Trying to add a range that intersects with another range from selection.',\n\t\t\t\t\tthis,\n\t\t\t\t\t{ addedRange: range, intersectingRange: storedRange }\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\n\t\tthis._ranges.push( new Range( range.start, range.end ) );\n\t}\n\n\t/**\n\t * Fired whenever selection ranges are changed through {@link ~Selection Selection API}.\n\t *\n\t * @event change\n\t */\n}\n\nmix( Selection, EmitterMixin );\n\n/**\n * An entity that is used to set selection.\n *\n * See also {@link module:engine/view/selection~Selection#setTo}\n *\n * @typedef {\n *    module:engine/view/selection~Selection|\n *    module:engine/view/documentselection~DocumentSelection|\n *    module:engine/view/position~Position|\n *    Iterable.<module:engine/view/range~Range>|\n *    module:engine/view/range~Range|\n *    module:engine/view/item~Item|\n *    null\n * } module:engine/view/selection~Selectable\n */\n"]}]}
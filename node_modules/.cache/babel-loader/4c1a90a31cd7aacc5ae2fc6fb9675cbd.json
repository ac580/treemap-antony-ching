{"remainingRequest":"/Users/antonyching/Desktop/project/new-builder-demo/node_modules/babel-loader/lib/index.js!/Users/antonyching/Desktop/project/new-builder-demo/node_modules/@ckeditor/ckeditor5-undo/src/basecommand.js","dependencies":[{"path":"/Users/antonyching/Desktop/project/new-builder-demo/node_modules/@ckeditor/ckeditor5-undo/src/basecommand.js","mtime":499162500000},{"path":"/Users/antonyching/Desktop/project/new-builder-demo/node_modules/@ckeditor/ckeditor5-dev-webpack-plugin/lib/translatesourceloader.js","mtime":499162500000},{"path":"/Users/antonyching/Desktop/project/new-builder-demo/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/antonyching/Desktop/project/new-builder-demo/node_modules/babel-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:LyoqCiAqIEBsaWNlbnNlIENvcHlyaWdodCAoYykgMjAwMy0yMDE5LCBDS1NvdXJjZSAtIEZyZWRlcmljbyBLbmFiYmVuLiBBbGwgcmlnaHRzIHJlc2VydmVkLgogKiBGb3IgbGljZW5zaW5nLCBzZWUgTElDRU5TRS5tZCBvciBodHRwczovL2NrZWRpdG9yLmNvbS9sZWdhbC9ja2VkaXRvci1vc3MtbGljZW5zZQogKi8KCi8qKgogKiBAbW9kdWxlIHVuZG8vYmFzZWNvbW1hbmQKICovCmltcG9ydCBDb21tYW5kIGZyb20gJ0Bja2VkaXRvci9ja2VkaXRvcjUtY29yZS9zcmMvY29tbWFuZCc7CmltcG9ydCB7IHRyYW5zZm9ybVNldHMgfSBmcm9tICdAY2tlZGl0b3IvY2tlZGl0b3I1LWVuZ2luZS9zcmMvbW9kZWwvb3BlcmF0aW9uL3RyYW5zZm9ybSc7Ci8qKgogKiBCYXNlIGNsYXNzIGZvciB1bmRvIGZlYXR1cmUgY29tbWFuZHM6IHtAbGluayBtb2R1bGU6dW5kby91bmRvY29tbWFuZH5VbmRvQ29tbWFuZH0gYW5kIHtAbGluayBtb2R1bGU6dW5kby9yZWRvY29tbWFuZH5SZWRvQ29tbWFuZH0uCiAqCiAqIEBwcm90ZWN0ZWQKICogQGV4dGVuZHMgbW9kdWxlOmNvcmUvY29tbWFuZH5Db21tYW5kCiAqLwoKZXhwb3J0IGRlZmF1bHQgY2xhc3MgQmFzZUNvbW1hbmQgZXh0ZW5kcyBDb21tYW5kIHsKICBjb25zdHJ1Y3RvcihlZGl0b3IpIHsKICAgIHN1cGVyKGVkaXRvcik7CiAgICAvKioKICAgICAqIFN0YWNrIG9mIGl0ZW1zIHN0b3JlZCBieSB0aGUgY29tbWFuZC4gVGhlc2UgYXJlIHBhaXJzIG9mOgogICAgICoKICAgICAqICoge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvYmF0Y2h+QmF0Y2ggYmF0Y2h9IHNhdmVkIGJ5IHRoZSBjb21tYW5kLAogICAgICogKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9zZWxlY3Rpb25+U2VsZWN0aW9uIHNlbGVjdGlvbn0gc3RhdGUgYXQgdGhlIG1vbWVudCBvZiBzYXZpbmcgdGhlIGJhdGNoLgogICAgICoKICAgICAqIEBwcm90ZWN0ZWQKICAgICAqIEBtZW1iZXIge0FycmF5fSAjX3N0YWNrCiAgICAgKi8KCiAgICB0aGlzLl9zdGFjayA9IFtdOwogICAgLyoqCiAgICAgKiBTdG9yZXMgYWxsIGJhdGNoZXMgdGhhdCB3ZXJlIGNyZWF0ZWQgYnkgdGhpcyBjb21tYW5kLgogICAgICoKICAgICAqIEBwcm90ZWN0ZWQKICAgICAqIEBtZW1iZXIge1dlYWtTZXQuPG1vZHVsZTplbmdpbmUvbW9kZWwvYmF0Y2h+QmF0Y2g+fSAjX2NyZWF0ZWRCYXRjaGVzCiAgICAgKi8KCiAgICB0aGlzLl9jcmVhdGVkQmF0Y2hlcyA9IG5ldyBXZWFrU2V0KCk7IC8vIFJlZnJlc2ggc3RhdGUsIHNvIHRoZSBjb21tYW5kIGlzIGluYWN0aXZlIHJpZ2h0IGFmdGVyIGluaXRpYWxpemF0aW9uLgoKICAgIHRoaXMucmVmcmVzaCgpOwogIH0KICAvKioKICAgKiBAaW5oZXJpdERvYwogICAqLwoKCiAgcmVmcmVzaCgpIHsKICAgIHRoaXMuaXNFbmFibGVkID0gdGhpcy5fc3RhY2subGVuZ3RoID4gMDsKICB9CiAgLyoqCiAgICogU3RvcmVzIGEgYmF0Y2ggaW4gdGhlIGNvbW1hbmQsIHRvZ2V0aGVyIHdpdGggdGhlIHNlbGVjdGlvbiBzdGF0ZSBvZiB0aGUge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvZG9jdW1lbnR+RG9jdW1lbnQgZG9jdW1lbnR9CiAgICogY3JlYXRlZCBieSB0aGUgZWRpdG9yIHdoaWNoIHRoaXMgY29tbWFuZCBpcyByZWdpc3RlcmVkIHRvLgogICAqCiAgICogQHBhcmFtIHttb2R1bGU6ZW5naW5lL21vZGVsL2JhdGNofkJhdGNofSBiYXRjaCBUaGUgYmF0Y2ggdG8gYWRkLgogICAqLwoKCiAgYWRkQmF0Y2goYmF0Y2gpIHsKICAgIGNvbnN0IGRvY1NlbGVjdGlvbiA9IHRoaXMuZWRpdG9yLm1vZGVsLmRvY3VtZW50LnNlbGVjdGlvbjsKICAgIGNvbnN0IHNlbGVjdGlvbiA9IHsKICAgICAgcmFuZ2VzOiBkb2NTZWxlY3Rpb24uaGFzT3duUmFuZ2UgPyBBcnJheS5mcm9tKGRvY1NlbGVjdGlvbi5nZXRSYW5nZXMoKSkgOiBbXSwKICAgICAgaXNCYWNrd2FyZDogZG9jU2VsZWN0aW9uLmlzQmFja3dhcmQKICAgIH07CgogICAgdGhpcy5fc3RhY2sucHVzaCh7CiAgICAgIGJhdGNoLAogICAgICBzZWxlY3Rpb24KICAgIH0pOwoKICAgIHRoaXMucmVmcmVzaCgpOwogIH0KICAvKioKICAgKiBSZW1vdmVzIGFsbCBpdGVtcyBmcm9tIHRoZSBzdGFjay4KICAgKi8KCgogIGNsZWFyU3RhY2soKSB7CiAgICB0aGlzLl9zdGFjayA9IFtdOwogICAgdGhpcy5yZWZyZXNoKCk7CiAgfQogIC8qKgogICAqIFJlc3RvcmVzIHRoZSB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9kb2N1bWVudH5Eb2N1bWVudCNzZWxlY3Rpb24gZG9jdW1lbnQgc2VsZWN0aW9ufSBzdGF0ZSBhZnRlciBhIGJhdGNoIHdhcyB1bmRvbmUuCiAgICoKICAgKiBAcHJvdGVjdGVkCiAgICogQHBhcmFtIHtBcnJheS48bW9kdWxlOmVuZ2luZS9tb2RlbC9yYW5nZX5SYW5nZT59IHJhbmdlcyBSYW5nZXMgdG8gYmUgcmVzdG9yZWQuCiAgICogQHBhcmFtIHtCb29sZWFufSBpc0JhY2t3YXJkIEEgZmxhZyBkZXNjcmliaW5nIHdoZXRoZXIgdGhlIHJlc3RvcmVkIHJhbmdlIHdhcyBzZWxlY3RlZCBmb3J3YXJkIG9yIGJhY2t3YXJkLgogICAqIEBwYXJhbSB7QXJyYXkuPG1vZHVsZTplbmdpbmUvbW9kZWwvb3BlcmF0aW9uL29wZXJhdGlvbn5PcGVyYXRpb24+fSBvcGVyYXRpb25zIE9wZXJhdGlvbnMgd2hpY2ggaGFzIGJlZW4gYXBwbGllZAogICAqIHNpbmNlIHNlbGVjdGlvbiBoYXMgYmVlbiBzdG9yZWQuCiAgICovCgoKICBfcmVzdG9yZVNlbGVjdGlvbihyYW5nZXMsIGlzQmFja3dhcmQsIG9wZXJhdGlvbnMpIHsKICAgIGNvbnN0IG1vZGVsID0gdGhpcy5lZGl0b3IubW9kZWw7CiAgICBjb25zdCBkb2N1bWVudCA9IG1vZGVsLmRvY3VtZW50OyAvLyBUaGlzIHdpbGwga2VlcCB0aGUgdHJhbnNmb3JtZWQgc2VsZWN0aW9uIHJhbmdlcy4KCiAgICBjb25zdCBzZWxlY3Rpb25SYW5nZXMgPSBbXTsgLy8gVHJhbnNmb3JtIGFsbCByYW5nZXMgZnJvbSB0aGUgcmVzdG9yZWQgc2VsZWN0aW9uLgoKICAgIGZvciAoY29uc3QgcmFuZ2Ugb2YgcmFuZ2VzKSB7CiAgICAgIGNvbnN0IHRyYW5zZm9ybWVkID0gdHJhbnNmb3JtU2VsZWN0aW9uUmFuZ2UocmFuZ2UsIG9wZXJhdGlvbnMpOyAvLyBGb3IgZWFjaCBgcmFuZ2VgIGZyb20gYHJhbmdlc2AsIHdlIHRha2Ugb25seSBvbmUgdHJhbnNmb3JtZWQgcmFuZ2UuCiAgICAgIC8vIFRoaXMgaXMgYmVjYXVzZSB3ZSB3YW50IHRvIHByZXZlbnQgc2l0dWF0aW9uIHdoZXJlIHNpbmdsZS1yYW5nZSBzZWxlY3Rpb24KICAgICAgLy8gZ290IHRyYW5zZm9ybWVkIHRvIG11bHRpLXJhbmdlIHNlbGVjdGlvbi4gV2Ugd2lsbCB0YWtlIHRoZSBmaXJzdCByYW5nZSB0aGF0CiAgICAgIC8vIGlzIG5vdCBpbiB0aGUgZ3JhdmV5YXJkLgoKICAgICAgY29uc3QgbmV3UmFuZ2UgPSB0cmFuc2Zvcm1lZC5maW5kKHJhbmdlID0+IHJhbmdlLnN0YXJ0LnJvb3QgIT0gZG9jdW1lbnQuZ3JhdmV5YXJkKTsgLy8gYHRyYW5zZm9ybWVkUmFuZ2VgIG1pZ2h0IGJlIGB1bmRlZmluZWRgIGlmIHRyYW5zZm9ybWVkIHJhbmdlIGVuZGVkIHVwIGluIGdyYXZleWFyZC4KCiAgICAgIGlmIChuZXdSYW5nZSkgewogICAgICAgIHNlbGVjdGlvblJhbmdlcy5wdXNoKG5ld1JhbmdlKTsKICAgICAgfQogICAgfSAvLyBgc2VsZWN0aW9uUmFuZ2VzYCBtYXkgYmUgZW1wdHkgaWYgYWxsIHJhbmdlcyBlbmRlZCB1cCBpbiBncmF2ZXlhcmQuIElmIHRoYXQgaXMgdGhlIGNhc2UsIGRvIG5vdCByZXN0b3JlIHNlbGVjdGlvbi4KCgogICAgaWYgKHNlbGVjdGlvblJhbmdlcy5sZW5ndGgpIHsKICAgICAgbW9kZWwuY2hhbmdlKHdyaXRlciA9PiB7CiAgICAgICAgd3JpdGVyLnNldFNlbGVjdGlvbihzZWxlY3Rpb25SYW5nZXMsIHsKICAgICAgICAgIGJhY2t3YXJkOiBpc0JhY2t3YXJkCiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgfQogIH0KICAvKioKICAgKiBVbmRvZXMgYSBiYXRjaCBieSByZXZlcnNpbmcgdGhhdCBiYXRjaCwgdHJhbnNmb3JtaW5nIHJldmVyc2VkIGJhdGNoIGFuZCBmaW5hbGx5IGFwcGx5aW5nIGl0LgogICAqIFRoaXMgaXMgYSBoZWxwZXIgbWV0aG9kIGZvciB7QGxpbmsgI2V4ZWN1dGV9LgogICAqCiAgICogQHByb3RlY3RlZAogICAqIEBwYXJhbSB7bW9kdWxlOmVuZ2luZS9tb2RlbC9iYXRjaH5CYXRjaH0gYmF0Y2hUb1VuZG8gVGhlIGJhdGNoIHRvIGJlIHVuZG9uZS4KICAgKiBAcGFyYW0ge21vZHVsZTplbmdpbmUvbW9kZWwvYmF0Y2h+QmF0Y2h9IHVuZG9pbmdCYXRjaCBUaGUgYmF0Y2ggdGhhdCB3aWxsIGNvbnRhaW4gdW5kb2luZyBjaGFuZ2VzLgogICAqLwoKCiAgX3VuZG8oYmF0Y2hUb1VuZG8sIHVuZG9pbmdCYXRjaCkgewogICAgY29uc3QgbW9kZWwgPSB0aGlzLmVkaXRvci5tb2RlbDsKICAgIGNvbnN0IGRvY3VtZW50ID0gbW9kZWwuZG9jdW1lbnQ7IC8vIEFsbCBjaGFuZ2VzIGRvbmUgYnkgdGhlIGNvbW1hbmQgZXhlY3V0aW9uIHdpbGwgYmUgc2F2ZWQgYXMgb25lIGJhdGNoLgoKICAgIHRoaXMuX2NyZWF0ZWRCYXRjaGVzLmFkZCh1bmRvaW5nQmF0Y2gpOwoKICAgIGNvbnN0IG9wZXJhdGlvbnNUb1VuZG8gPSBiYXRjaFRvVW5kby5vcGVyYXRpb25zLnNsaWNlKCkuZmlsdGVyKG9wZXJhdGlvbiA9PiBvcGVyYXRpb24uaXNEb2N1bWVudE9wZXJhdGlvbik7CiAgICBvcGVyYXRpb25zVG9VbmRvLnJldmVyc2UoKTsgLy8gV2Ugd2lsbCBwcm9jZXNzIGVhY2ggb3BlcmF0aW9uIGZyb20gYGJhdGNoVG9VbmRvYCwgaW4gcmV2ZXJzZSBvcmRlci4gSWYgdGhlcmUgd2VyZSBvcGVyYXRpb25zIEEsIEIgYW5kIEMgaW4gdW5kb25lIGJhdGNoLAogICAgLy8gd2UgbmVlZCB0byByZXZlcnQgdGhlbSBpbiByZXZlcnNlIG9yZGVyLCBzbyBmaXJzdCBDJyAocmV2ZXJzZWQgQyksIHRoZW4gQicsIHRoZW4gQScuCgogICAgZm9yIChjb25zdCBvcGVyYXRpb25Ub1VuZG8gb2Ygb3BlcmF0aW9uc1RvVW5kbykgewogICAgICBjb25zdCBuZXh0QmFzZVZlcnNpb24gPSBvcGVyYXRpb25Ub1VuZG8uYmFzZVZlcnNpb24gKyAxOwogICAgICBjb25zdCBoaXN0b3J5T3BlcmF0aW9ucyA9IEFycmF5LmZyb20oZG9jdW1lbnQuaGlzdG9yeS5nZXRPcGVyYXRpb25zKG5leHRCYXNlVmVyc2lvbikpOwogICAgICBjb25zdCB0cmFuc2Zvcm1lZFNldHMgPSB0cmFuc2Zvcm1TZXRzKFtvcGVyYXRpb25Ub1VuZG8uZ2V0UmV2ZXJzZWQoKV0sIGhpc3RvcnlPcGVyYXRpb25zLCB7CiAgICAgICAgdXNlUmVsYXRpb25zOiB0cnVlLAogICAgICAgIGRvY3VtZW50OiB0aGlzLmVkaXRvci5tb2RlbC5kb2N1bWVudCwKICAgICAgICBwYWRXaXRoTm9PcHM6IGZhbHNlLAogICAgICAgIGZvcmNlV2Vha1JlbW92ZTogdHJ1ZQogICAgICB9KTsKICAgICAgY29uc3QgcmV2ZXJzZWRPcGVyYXRpb25zID0gdHJhbnNmb3JtZWRTZXRzLm9wZXJhdGlvbnNBOyAvLyBBZnRlciByZXZlcnNlZCBvcGVyYXRpb24gaGFzIGJlZW4gdHJhbnNmb3JtZWQgYnkgYWxsIGhpc3Rvcnkgb3BlcmF0aW9ucywgYXBwbHkgaXQuCgogICAgICBmb3IgKGNvbnN0IG9wZXJhdGlvbiBvZiByZXZlcnNlZE9wZXJhdGlvbnMpIHsKICAgICAgICAvLyBCZWZvcmUgYXBwbHlpbmcsIGFkZCB0aGUgb3BlcmF0aW9uIHRvIHRoZSBgdW5kb2luZ0JhdGNoYC4KICAgICAgICB1bmRvaW5nQmF0Y2guYWRkT3BlcmF0aW9uKG9wZXJhdGlvbik7CiAgICAgICAgbW9kZWwuYXBwbHlPcGVyYXRpb24ob3BlcmF0aW9uKTsKICAgICAgICBkb2N1bWVudC5oaXN0b3J5LnNldE9wZXJhdGlvbkFzVW5kb25lKG9wZXJhdGlvblRvVW5kbywgb3BlcmF0aW9uKTsKICAgICAgfQogICAgfQogIH0KCn0gLy8gVHJhbnNmb3JtcyBnaXZlbiByYW5nZSBgcmFuZ2VgIGJ5IGdpdmVuIGBvcGVyYXRpb25zYC4KLy8gUmV0dXJucyBhbiBhcnJheSBjb250YWluaW5nIG9uZSBvciBtb3JlIHJhbmdlcywgd2hpY2ggYXJlIHJlc3VsdCBvZiB0aGUgdHJhbnNmb3JtYXRpb24uCgpmdW5jdGlvbiB0cmFuc2Zvcm1TZWxlY3Rpb25SYW5nZShyYW5nZSwgb3BlcmF0aW9ucykgewogIGNvbnN0IHRyYW5zZm9ybWVkID0gcmFuZ2UuZ2V0VHJhbnNmb3JtZWRCeU9wZXJhdGlvbnMob3BlcmF0aW9ucyk7IC8vIEFmdGVyIGByYW5nZWAgZ290IHRyYW5zZm9ybWVkLCB3ZSBoYXZlIGFuIGFycmF5IG9mIHJhbmdlcy4gU29tZSBvZiB0aG9zZQogIC8vIHJhbmdlcyBtYXkgYmUgInRvdWNoaW5nIiAtLSB0aGV5IGNhbiBiZSBuZXh0IHRvIGVhY2ggb3RoZXIgYW5kIGNvdWxkIGJlIG1lcmdlZC4KICAvLyBGaXJzdCwgd2UgaGF2ZSB0byBzb3J0IHRob3NlIHJhbmdlcyB0byBhc3N1cmUgdGhhdCB0aGV5IGFyZSBpbiBvcmRlci4KCiAgdHJhbnNmb3JtZWQuc29ydCgoYSwgYikgPT4gYS5zdGFydC5pc0JlZm9yZShiLnN0YXJ0KSA/IC0xIDogMSk7IC8vIFRoZW4sIHdlIGNoZWNrIGlmIHR3byBjb25zZWN1dGl2ZSByYW5nZXMgYXJlIHRvdWNoaW5nLgoKICBmb3IgKGxldCBpID0gMTsgaSA8IHRyYW5zZm9ybWVkLmxlbmd0aDsgaSsrKSB7CiAgICBjb25zdCBhID0gdHJhbnNmb3JtZWRbaSAtIDFdOwogICAgY29uc3QgYiA9IHRyYW5zZm9ybWVkW2ldOwoKICAgIGlmIChhLmVuZC5pc1RvdWNoaW5nKGIuc3RhcnQpKSB7CiAgICAgIC8vIEFuZCBqb2luIHRoZW0gdG9nZXRoZXIgaWYgdGhleSBhcmUuCiAgICAgIGEuZW5kID0gYi5lbmQ7CiAgICAgIHRyYW5zZm9ybWVkLnNwbGljZShpLCAxKTsKICAgICAgaS0tOwogICAgfQogIH0KCiAgcmV0dXJuIHRyYW5zZm9ybWVkOwp9"},{"version":3,"sources":["/Users/antonyching/Desktop/project/new-builder-demo/node_modules/@ckeditor/ckeditor5-undo/src/basecommand.js"],"names":["Command","transformSets","BaseCommand","constructor","editor","_stack","_createdBatches","WeakSet","refresh","isEnabled","length","addBatch","batch","docSelection","model","document","selection","ranges","hasOwnRange","Array","from","getRanges","isBackward","push","clearStack","_restoreSelection","operations","selectionRanges","range","transformed","transformSelectionRange","newRange","find","start","root","graveyard","change","writer","setSelection","backward","_undo","batchToUndo","undoingBatch","add","operationsToUndo","slice","filter","operation","isDocumentOperation","reverse","operationToUndo","nextBaseVersion","baseVersion","historyOperations","history","getOperations","transformedSets","getReversed","useRelations","padWithNoOps","forceWeakRemove","reversedOperations","operationsA","addOperation","applyOperation","setOperationAsUndone","getTransformedByOperations","sort","a","b","isBefore","i","end","isTouching","splice"],"mappings":"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","sourcesContent":["/**\n * @license Copyright (c) 2003-2019, CKSource - Frederico Knabben. All rights reserved.\n * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license\n */\n\n/**\n * @module undo/basecommand\n */\n\nimport Command from '@ckeditor/ckeditor5-core/src/command';\nimport { transformSets } from '@ckeditor/ckeditor5-engine/src/model/operation/transform';\n\n/**\n * Base class for undo feature commands: {@link module:undo/undocommand~UndoCommand} and {@link module:undo/redocommand~RedoCommand}.\n *\n * @protected\n * @extends module:core/command~Command\n */\nexport default class BaseCommand extends Command {\n\tconstructor( editor ) {\n\t\tsuper( editor );\n\n\t\t/**\n\t\t * Stack of items stored by the command. These are pairs of:\n\t\t *\n\t\t * * {@link module:engine/model/batch~Batch batch} saved by the command,\n\t\t * * {@link module:engine/model/selection~Selection selection} state at the moment of saving the batch.\n\t\t *\n\t\t * @protected\n\t\t * @member {Array} #_stack\n\t\t */\n\t\tthis._stack = [];\n\n\t\t/**\n\t\t * Stores all batches that were created by this command.\n\t\t *\n\t\t * @protected\n\t\t * @member {WeakSet.<module:engine/model/batch~Batch>} #_createdBatches\n\t\t */\n\t\tthis._createdBatches = new WeakSet();\n\n\t\t// Refresh state, so the command is inactive right after initialization.\n\t\tthis.refresh();\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\trefresh() {\n\t\tthis.isEnabled = this._stack.length > 0;\n\t}\n\n\t/**\n\t * Stores a batch in the command, together with the selection state of the {@link module:engine/model/document~Document document}\n\t * created by the editor which this command is registered to.\n\t *\n\t * @param {module:engine/model/batch~Batch} batch The batch to add.\n\t */\n\taddBatch( batch ) {\n\t\tconst docSelection = this.editor.model.document.selection;\n\n\t\tconst selection = {\n\t\t\tranges: docSelection.hasOwnRange ? Array.from( docSelection.getRanges() ) : [],\n\t\t\tisBackward: docSelection.isBackward\n\t\t};\n\n\t\tthis._stack.push( { batch, selection } );\n\t\tthis.refresh();\n\t}\n\n\t/**\n\t * Removes all items from the stack.\n\t */\n\tclearStack() {\n\t\tthis._stack = [];\n\t\tthis.refresh();\n\t}\n\n\t/**\n\t * Restores the {@link module:engine/model/document~Document#selection document selection} state after a batch was undone.\n\t *\n\t * @protected\n\t * @param {Array.<module:engine/model/range~Range>} ranges Ranges to be restored.\n\t * @param {Boolean} isBackward A flag describing whether the restored range was selected forward or backward.\n\t * @param {Array.<module:engine/model/operation/operation~Operation>} operations Operations which has been applied\n\t * since selection has been stored.\n\t */\n\t_restoreSelection( ranges, isBackward, operations ) {\n\t\tconst model = this.editor.model;\n\t\tconst document = model.document;\n\n\t\t// This will keep the transformed selection ranges.\n\t\tconst selectionRanges = [];\n\n\t\t// Transform all ranges from the restored selection.\n\t\tfor ( const range of ranges ) {\n\t\t\tconst transformed = transformSelectionRange( range, operations );\n\n\t\t\t// For each `range` from `ranges`, we take only one transformed range.\n\t\t\t// This is because we want to prevent situation where single-range selection\n\t\t\t// got transformed to multi-range selection. We will take the first range that\n\t\t\t// is not in the graveyard.\n\t\t\tconst newRange = transformed.find(\n\t\t\t\trange => range.start.root != document.graveyard\n\t\t\t);\n\n\t\t\t// `transformedRange` might be `undefined` if transformed range ended up in graveyard.\n\t\t\tif ( newRange ) {\n\t\t\t\tselectionRanges.push( newRange );\n\t\t\t}\n\t\t}\n\n\t\t// `selectionRanges` may be empty if all ranges ended up in graveyard. If that is the case, do not restore selection.\n\t\tif ( selectionRanges.length ) {\n\t\t\tmodel.change( writer => {\n\t\t\t\twriter.setSelection( selectionRanges, { backward: isBackward } );\n\t\t\t} );\n\t\t}\n\t}\n\n\t/**\n\t * Undoes a batch by reversing that batch, transforming reversed batch and finally applying it.\n\t * This is a helper method for {@link #execute}.\n\t *\n\t * @protected\n\t * @param {module:engine/model/batch~Batch} batchToUndo The batch to be undone.\n\t * @param {module:engine/model/batch~Batch} undoingBatch The batch that will contain undoing changes.\n\t */\n\t_undo( batchToUndo, undoingBatch ) {\n\t\tconst model = this.editor.model;\n\t\tconst document = model.document;\n\n\t\t// All changes done by the command execution will be saved as one batch.\n\t\tthis._createdBatches.add( undoingBatch );\n\n\t\tconst operationsToUndo = batchToUndo.operations.slice().filter( operation => operation.isDocumentOperation );\n\t\toperationsToUndo.reverse();\n\n\t\t// We will process each operation from `batchToUndo`, in reverse order. If there were operations A, B and C in undone batch,\n\t\t// we need to revert them in reverse order, so first C' (reversed C), then B', then A'.\n\t\tfor ( const operationToUndo of operationsToUndo ) {\n\t\t\tconst nextBaseVersion = operationToUndo.baseVersion + 1;\n\t\t\tconst historyOperations = Array.from( document.history.getOperations( nextBaseVersion ) );\n\n\t\t\tconst transformedSets = transformSets(\n\t\t\t\t[ operationToUndo.getReversed() ],\n\t\t\t\thistoryOperations,\n\t\t\t\t{\n\t\t\t\t\tuseRelations: true,\n\t\t\t\t\tdocument: this.editor.model.document,\n\t\t\t\t\tpadWithNoOps: false,\n\t\t\t\t\tforceWeakRemove: true\n\t\t\t\t}\n\t\t\t);\n\n\t\t\tconst reversedOperations = transformedSets.operationsA;\n\n\t\t\t// After reversed operation has been transformed by all history operations, apply it.\n\t\t\tfor ( const operation of reversedOperations ) {\n\t\t\t\t// Before applying, add the operation to the `undoingBatch`.\n\t\t\t\tundoingBatch.addOperation( operation );\n\t\t\t\tmodel.applyOperation( operation );\n\n\t\t\t\tdocument.history.setOperationAsUndone( operationToUndo, operation );\n\t\t\t}\n\t\t}\n\t}\n}\n\n// Transforms given range `range` by given `operations`.\n// Returns an array containing one or more ranges, which are result of the transformation.\nfunction transformSelectionRange( range, operations ) {\n\tconst transformed = range.getTransformedByOperations( operations );\n\n\t// After `range` got transformed, we have an array of ranges. Some of those\n\t// ranges may be \"touching\" -- they can be next to each other and could be merged.\n\t// First, we have to sort those ranges to assure that they are in order.\n\ttransformed.sort( ( a, b ) => a.start.isBefore( b.start ) ? -1 : 1 );\n\n\t// Then, we check if two consecutive ranges are touching.\n\tfor ( let i = 1; i < transformed.length; i++ ) {\n\t\tconst a = transformed[ i - 1 ];\n\t\tconst b = transformed[ i ];\n\n\t\tif ( a.end.isTouching( b.start ) ) {\n\t\t\t// And join them together if they are.\n\t\t\ta.end = b.end;\n\t\t\ttransformed.splice( i, 1 );\n\t\t\ti--;\n\t\t}\n\t}\n\n\treturn transformed;\n}\n"]}]}